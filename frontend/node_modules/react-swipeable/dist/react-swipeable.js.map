{"version":3,"file":"react-swipeable.js","sources":["../src/types.ts","../src/index.ts"],"sourcesContent":["import * as React from \"react\";\n\nexport const LEFT = \"Left\";\nexport const RIGHT = \"Right\";\nexport const UP = \"Up\";\nexport const DOWN = \"Down\";\nexport type HandledEvents = React.MouseEvent | TouchEvent | MouseEvent;\nexport type Vector2 = [number, number];\nexport type SwipeDirections =\n  | typeof LEFT\n  | typeof RIGHT\n  | typeof UP\n  | typeof DOWN;\nexport interface SwipeEventData {\n  absX: number;\n  absY: number;\n  deltaX: number;\n  deltaY: number;\n  dir: SwipeDirections;\n  event: HandledEvents;\n  first: boolean;\n  initial: Vector2;\n  velocity: number;\n  vxvy: Vector2;\n}\n\nexport type SwipeCallback = (eventData: SwipeEventData) => void;\nexport type TapCallback = ({ event }: { event: HandledEvents }) => void;\n\nexport type SwipeableCallbacks = {\n  // Event handler/callbacks\n  onSwipeStart: SwipeCallback;\n  onSwiped: SwipeCallback;\n  onSwipedDown: SwipeCallback;\n  onSwipedLeft: SwipeCallback;\n  onSwipedRight: SwipeCallback;\n  onSwipedUp: SwipeCallback;\n  onSwiping: SwipeCallback;\n  onTap: TapCallback;\n};\n\n// Configuration Options\nexport interface ConfigurationOptions {\n  delta: number;\n  preventDefaultTouchmoveEvent: boolean;\n  rotationAngle: number;\n  trackMouse: boolean;\n  trackTouch: boolean;\n}\n\nexport type SwipeableProps = Partial<SwipeableCallbacks & ConfigurationOptions>;\n\nexport type SwipeablePropsWithDefaultOptions = Partial<SwipeableCallbacks> &\n  ConfigurationOptions;\n\nexport interface SwipeableHandlers {\n  ref(element: HTMLElement | null): void;\n  onMouseDown?(event: React.MouseEvent): void;\n}\n\nexport type SwipeableState = {\n  cleanUpTouch?: () => void;\n  el?: HTMLElement;\n  eventData?: SwipeEventData;\n  first: boolean;\n  initial: Vector2;\n  start: number;\n  swiping: boolean;\n  xy: Vector2;\n};\n\nexport type StateSetter = (\n  state: SwipeableState,\n  props: SwipeablePropsWithDefaultOptions\n) => SwipeableState;\nexport type Setter = (stateSetter: StateSetter) => void;\nexport type AttachTouch = (el: HTMLElement, passive: boolean) => () => void;\n","/* global document */\nimport * as React from \"react\";\nimport {\n  AttachTouch,\n  SwipeDirections,\n  DOWN,\n  SwipeEventData,\n  HandledEvents,\n  LEFT,\n  RIGHT,\n  Setter,\n  SwipeableHandlers,\n  SwipeableProps,\n  SwipeablePropsWithDefaultOptions,\n  SwipeableState,\n  SwipeCallback,\n  TapCallback,\n  UP,\n  Vector2,\n} from \"./types\";\n\nexport {\n  LEFT,\n  RIGHT,\n  UP,\n  DOWN,\n  SwipeDirections,\n  SwipeEventData,\n  SwipeCallback,\n  TapCallback,\n  SwipeableHandlers,\n  SwipeableProps,\n  Vector2,\n};\n\nconst defaultProps = {\n  delta: 10,\n  preventDefaultTouchmoveEvent: false,\n  rotationAngle: 0,\n  trackMouse: false,\n  trackTouch: true,\n};\nconst initialState: SwipeableState = {\n  first: true,\n  initial: [0, 0],\n  start: 0,\n  swiping: false,\n  xy: [0, 0],\n};\nconst mouseMove = \"mousemove\";\nconst mouseUp = \"mouseup\";\nconst touchEnd = \"touchend\";\nconst touchMove = \"touchmove\";\nconst touchStart = \"touchstart\";\n\nfunction getDirection(\n  absX: number,\n  absY: number,\n  deltaX: number,\n  deltaY: number\n): SwipeDirections {\n  if (absX > absY) {\n    if (deltaX > 0) {\n      return RIGHT;\n    }\n    return LEFT;\n  } else if (deltaY > 0) {\n    return DOWN;\n  }\n  return UP;\n}\n\nfunction rotateXYByAngle(pos: Vector2, angle: number): Vector2 {\n  if (angle === 0) return pos;\n  const angleInRadians = (Math.PI / 180) * angle;\n  const x =\n    pos[0] * Math.cos(angleInRadians) + pos[1] * Math.sin(angleInRadians);\n  const y =\n    pos[1] * Math.cos(angleInRadians) - pos[0] * Math.sin(angleInRadians);\n  return [x, y];\n}\n\nfunction getHandlers(\n  set: Setter,\n  handlerProps: { trackMouse: boolean | undefined }\n): [\n  {\n    ref: (element: HTMLElement | null) => void;\n    onMouseDown?: (event: React.MouseEvent) => void;\n  },\n  AttachTouch\n] {\n  const onStart = (event: HandledEvents) => {\n    // if more than a single touch don't track, for now...\n    if (event && \"touches\" in event && event.touches.length > 1) return;\n\n    set((state, props) => {\n      // setup mouse listeners on document to track swipe since swipe can leave container\n      if (props.trackMouse) {\n        document.addEventListener(mouseMove, onMove);\n        document.addEventListener(mouseUp, onUp);\n      }\n      const { clientX, clientY } =\n        \"touches\" in event ? event.touches[0] : event;\n      const xy = rotateXYByAngle([clientX, clientY], props.rotationAngle);\n      return {\n        ...state,\n        ...initialState,\n        initial: [...xy],\n        xy,\n        start: event.timeStamp || 0,\n      };\n    });\n  };\n\n  const onMove = (event: HandledEvents) => {\n    set((state, props) => {\n      // Discount a swipe if additional touches are present after\n      // a swipe has started.\n      if (\"touches\" in event && event.touches.length > 1) {\n        return state;\n      }\n      const { clientX, clientY } =\n        \"touches\" in event ? event.touches[0] : event;\n      const [x, y] = rotateXYByAngle([clientX, clientY], props.rotationAngle);\n      const deltaX = x - state.xy[0];\n      const deltaY = y - state.xy[1];\n      const absX = Math.abs(deltaX);\n      const absY = Math.abs(deltaY);\n      const time = (event.timeStamp || 0) - state.start;\n      const velocity = Math.sqrt(absX * absX + absY * absY) / (time || 1);\n      const vxvy: Vector2 = [deltaX / (time || 1), deltaY / (time || 1)];\n\n      // if swipe is under delta and we have not started to track a swipe: skip update\n      if (absX < props.delta && absY < props.delta && !state.swiping)\n        return state;\n\n      const dir = getDirection(absX, absY, deltaX, deltaY);\n      const eventData = {\n        absX,\n        absY,\n        deltaX,\n        deltaY,\n        dir,\n        event,\n        first: state.first,\n        initial: state.initial,\n        velocity,\n        vxvy,\n      };\n\n      // call onSwipeStart if present and is first swipe event\n      eventData.first && props.onSwipeStart && props.onSwipeStart(eventData);\n\n      // Call onSwiping if present\n      props.onSwiping && props.onSwiping(eventData);\n\n      // track if a swipe is cancelable(handler for swiping or swiped(dir) exists)\n      // so we can call preventDefault if needed\n      let cancelablePageSwipe = false;\n      if (props.onSwiping || props.onSwiped || `onSwiped${dir}` in props) {\n        cancelablePageSwipe = true;\n      }\n\n      if (\n        cancelablePageSwipe &&\n        props.preventDefaultTouchmoveEvent &&\n        props.trackTouch &&\n        event.cancelable\n      )\n        event.preventDefault();\n\n      return {\n        ...state,\n        // first is now always false\n        first: false,\n        eventData,\n        swiping: true,\n      };\n    });\n  };\n\n  const onEnd = (event: HandledEvents) => {\n    set((state, props) => {\n      let eventData: SwipeEventData | undefined;\n      if (state.swiping && state.eventData) {\n        eventData = { ...state.eventData, event };\n        props.onSwiped && props.onSwiped(eventData);\n\n        const onSwipedDir = `onSwiped${eventData.dir}`;\n        if (onSwipedDir in props) {\n          ((props as any)[onSwipedDir] as SwipeCallback)(eventData);\n        }\n      } else {\n        props.onTap && props.onTap({ event });\n      }\n      return { ...state, ...initialState, eventData };\n    });\n  };\n\n  const cleanUpMouse = () => {\n    // safe to just call removeEventListener\n    document.removeEventListener(mouseMove, onMove);\n    document.removeEventListener(mouseUp, onUp);\n  };\n\n  const onUp = (e: HandledEvents) => {\n    cleanUpMouse();\n    onEnd(e);\n  };\n\n  /**\n   * Switch of \"passive\" property for now.\n   * When `preventDefaultTouchmoveEvent` is:\n   * - true => { passive: false }\n   * - false => { passive: true }\n   *\n   * Could take entire `addEventListener` options object as a param later?\n   */\n  const attachTouch: AttachTouch = (el, passive) => {\n    let cleanup = () => {};\n    if (el && el.addEventListener) {\n      // attach touch event listeners and handlers\n      const tls: [\n        typeof touchStart | typeof touchMove | typeof touchEnd,\n        (e: HandledEvents) => void\n      ][] = [\n        [touchStart, onStart],\n        [touchMove, onMove],\n        [touchEnd, onEnd],\n      ];\n      tls.forEach(([e, h]) => el.addEventListener(e, h, { passive }));\n      // return properly scoped cleanup method for removing listeners, options not required\n      cleanup = () => tls.forEach(([e, h]) => el.removeEventListener(e, h));\n    }\n    return cleanup;\n  };\n\n  const onRef = (el: HTMLElement | null) => {\n    // \"inline\" ref functions are called twice on render, once with null then again with DOM element\n    // ignore null here\n    if (el === null) return;\n    set((state, props) => {\n      // if the same DOM el as previous just return state\n      if (state.el === el) return state;\n\n      const addState: { cleanUpTouch?: () => void } = {};\n      // if new DOM el clean up old DOM and reset cleanUpTouch\n      if (state.el && state.el !== el && state.cleanUpTouch) {\n        state.cleanUpTouch();\n        addState.cleanUpTouch = undefined;\n      }\n      // only attach if we want to track touch\n      if (props.trackTouch && el) {\n        addState.cleanUpTouch = attachTouch(\n          el,\n          !props.preventDefaultTouchmoveEvent\n        );\n      }\n\n      // store event attached DOM el for comparison, clean up, and re-attachment\n      return { ...state, el, ...addState };\n    });\n  };\n\n  // set ref callback to attach touch event listeners\n  const output: { ref: typeof onRef; onMouseDown?: typeof onStart } = {\n    ref: onRef,\n  };\n\n  // if track mouse attach mouse down listener\n  if (handlerProps.trackMouse) {\n    output.onMouseDown = onStart;\n  }\n\n  return [output, attachTouch];\n}\n\nfunction updateTransientState(\n  state: SwipeableState,\n  props: SwipeableProps,\n  attachTouch: AttachTouch\n) {\n  const addState: { cleanUpTouch?(): void } = {};\n  // clean up touch handlers if no longer tracking touches\n  if (!props.trackTouch && state.cleanUpTouch) {\n    state.cleanUpTouch();\n    addState.cleanUpTouch = undefined;\n  } else if (props.trackTouch && !state.cleanUpTouch) {\n    // attach/re-attach touch handlers\n    if (state.el) {\n      addState.cleanUpTouch = attachTouch(\n        state.el,\n        !props.preventDefaultTouchmoveEvent\n      );\n    }\n  }\n  return { ...state, ...addState };\n}\n\nexport function useSwipeable(options: SwipeableProps): SwipeableHandlers {\n  const { trackMouse } = options;\n  const transientState = React.useRef({ ...initialState });\n  const transientProps = React.useRef<SwipeablePropsWithDefaultOptions>({\n    ...defaultProps,\n  });\n  transientProps.current = { ...defaultProps, ...options };\n\n  const [handlers, attachTouch] = React.useMemo(\n    () =>\n      getHandlers(\n        (stateSetter) =>\n          (transientState.current = stateSetter(\n            transientState.current,\n            transientProps.current\n          )),\n        { trackMouse }\n      ),\n    [trackMouse]\n  );\n\n  transientState.current = updateTransientState(\n    transientState.current,\n    transientProps.current,\n    attachTouch\n  );\n\n  return handlers;\n}\n"],"names":["LEFT","RIGHT","UP","DOWN","defaultProps","delta","preventDefaultTouchmoveEvent","rotationAngle","trackMouse","trackTouch","initialState","first","initial","start","swiping","xy","mouseMove","mouseUp","touchEnd","touchMove","touchStart","getDirection","absX","absY","deltaX","deltaY","rotateXYByAngle","pos","angle","angleInRadians","Math","PI","x","cos","sin","y","getHandlers","set","handlerProps","onStart","event","touches","length","state","props","document","addEventListener","onMove","onUp","clientX","clientY","timeStamp","abs","time","velocity","sqrt","vxvy","dir","eventData","onSwipeStart","onSwiping","cancelablePageSwipe","onSwiped","cancelable","preventDefault","onEnd","onSwipedDir","onTap","cleanUpMouse","removeEventListener","e","attachTouch","el","passive","cleanup","tls","forEach","h","onRef","addState","cleanUpTouch","undefined","output","ref","onMouseDown","updateTransientState","useSwipeable","options","transientState","React","transientProps","current","stateSetter","handlers"],"mappings":"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"}