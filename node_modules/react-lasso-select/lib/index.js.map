{"version":3,"file":"index.js","sources":["../src/helpers.ts","../src/SVGHelpers.ts","../src/withDraggable.tsx","../src/SVGPolyline.tsx","../src/SVGPolygon.tsx","../src/SVGPoint.tsx","../src/pathReducer.ts","../src/index.tsx"],"sourcesContent":["export interface Point {\r\n  x: number;\r\n  y: number;\r\n}\r\n\r\nexport interface Vector {\r\n  dx: number;\r\n  dy: number;\r\n}\r\n\r\nexport interface Size {\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\nexport interface Dictionary<T> {\r\n  [key: string]: T;\r\n}\r\n\r\nexport type touchOrMouseEvent<T> = React.MouseEvent<T, MouseEvent> | React.TouchEvent<T>;\r\nexport type touchAndMouseEvent<T> = React.MouseEvent<T, MouseEvent> & React.TouchEvent<T>;\r\n\r\nexport const objectToClassName = (obj: Dictionary<boolean>) => {\r\n  return Object.keys(obj)\r\n    .filter((key) => obj[key])\r\n    .join(' ');\r\n};\r\n\r\nexport const arePointsEqual = (p1: Point, p2: Point) => p1.x === p2.x && p1.y === p2.y;\r\n\r\nexport const arePointListEqual = (arr1: Point[], arr2: Point[]) => {\r\n  if ((!arr1 && arr2) || (arr1 && !arr2) || arr1.length !== arr2.length) return false;\r\n  return arr1.every((point, i) => arePointsEqual(point, arr2[i]));\r\n};\r\n\r\nexport const roundPointCoordinates = ({ x, y }: Point, p = 1): Point => ({\r\n  x: Math.round((x + Number.EPSILON) * p) / p,\r\n  y: Math.round((y + Number.EPSILON) * p) / p\r\n});\r\n\r\nexport const findPointByPosition = (\r\n  points: Point[],\r\n  position: Point,\r\n  r = 0\r\n): { point: Point; index: number } => {\r\n  const index = points.findIndex(\r\n    (point) => Math.max(Math.abs(point.x - position.x), Math.abs(point.y - position.y)) <= r\r\n  );\r\n  return { point: { ...points[index] }, index };\r\n};\r\n\r\nexport const getDistance = (p1: Point, p2: Point) => {\r\n  return Math.hypot(p2.x - p1.x, p2.y - p1.y);\r\n};\r\n\r\nexport const getAngle = (p1: Point, p2: Point) => {\r\n  return Math.atan2(p2.y - p1.y, p2.x - p1.x);\r\n};\r\n\r\nexport const approximateToAnAngleMultiplicity = (\r\n  startPoint: Point,\r\n  endPoint: Point,\r\n  minAngle: number\r\n): Point => {\r\n  const r = getDistance(startPoint, endPoint);\r\n  const angle = getAngle(startPoint, endPoint);\r\n  const newAngle = Math.round(angle / minAngle) * minAngle;\r\n  return {\r\n    x: startPoint.x + r * Math.cos(newAngle),\r\n    y: startPoint.y + r * Math.sin(newAngle)\r\n  };\r\n};\r\n\r\nexport const approximateToAngles = (\r\n  startPoint: Point,\r\n  endPoint: Point,\r\n  angles: number[]\r\n): Point => {\r\n  const r = getDistance(startPoint, endPoint);\r\n  const angle = getAngle(startPoint, endPoint);\r\n  const nearestAngle = angles.reduce(\r\n    (prev, now) => (Math.abs(now - angle) < Math.abs(prev - angle) ? now : prev),\r\n    Infinity\r\n  );\r\n  if (nearestAngle !== Infinity) {\r\n    endPoint.x = startPoint.x + r * Math.cos(nearestAngle);\r\n    endPoint.y = startPoint.y + r * Math.sin(nearestAngle);\r\n  }\r\n  return endPoint;\r\n};\r\n\r\nexport const calculateAnglesBeetwenPoints = (points: Point[]) => {\r\n  const angles: number[] = [];\r\n  for (let i = 1; i < points.length; i++) {\r\n    const alpha = Math.atan2(points[i].y - points[i - 1].y, points[i].x - points[i - 1].x);\r\n    const alpha2 = alpha + Math.PI;\r\n    angles.push(alpha, alpha2 > Math.PI ? alpha2 - 2 * Math.PI : alpha2);\r\n  }\r\n  return angles.filter((val, idx, arr) => arr.indexOf(val) === idx);\r\n};\r\n\r\nexport function getClippedImageCanvas(\r\n  src: string,\r\n  path: Point[],\r\n  callback: (err: Error | null, canvas: HTMLCanvasElement) => void,\r\n  crop = true\r\n) {\r\n  const image = new Image();\r\n  image.crossOrigin = 'Anonymous';\r\n  const canvas = document.createElement('canvas');\r\n  const ctx = canvas.getContext('2d');\r\n  if (!ctx) {\r\n    return callback(new Error('CTX is null'), canvas);\r\n  }\r\n  image.onerror = () => {\r\n    callback(new Error('Failed to load image'), canvas);\r\n  };\r\n  image.onload = () => {\r\n    try {\r\n      canvas.width = image.naturalWidth + 2;\r\n      canvas.height = image.naturalHeight + 2;\r\n      ctx.drawImage(image, 0, 0);\r\n      if (path.length < 3) {\r\n        callback(null, canvas);\r\n        return;\r\n      }\r\n      ctx.beginPath();\r\n      ctx.moveTo(0, 0);\r\n      ctx.lineTo(canvas.width, 0);\r\n      ctx.lineTo(canvas.width, canvas.height);\r\n      ctx.lineTo(0, canvas.height);\r\n      ctx.lineTo(0, 0);\r\n      ctx.lineTo(path[0].x + 1, path[0].y + 1);\r\n      path.slice(1).forEach(({ x, y }) => ctx.lineTo(x + 1, y + 1));\r\n      ctx.lineTo(path[0].x + 1, path[0].y + 1);\r\n      ctx.lineTo(0, 0);\r\n      ctx.closePath();\r\n      ctx.clip('evenodd');\r\n      ctx.globalCompositeOperation = 'destination-out';\r\n      ctx.fill();\r\n      if (crop) {\r\n        const xAxis = path.map(({ x }) => x + 1);\r\n        const yAxis = path.map(({ y }) => y + 1);\r\n        const [minX, minY] = [Math.min.apply(null, xAxis), Math.min.apply(null, yAxis)];\r\n        const [maxX, maxY] = [Math.max.apply(null, xAxis), Math.max.apply(null, yAxis)];\r\n        const [width, height] = [maxX - minX, maxY - minY];\r\n        const imageData = ctx.getImageData(minX, minY, width, height);\r\n        canvas.width = width;\r\n        canvas.height = height;\r\n        ctx.putImageData(imageData, 0, 0);\r\n      }\r\n      callback(null, canvas);\r\n    } catch (err) {\r\n      callback(err, canvas);\r\n    }\r\n  };\r\n  image.src = src;\r\n}\r\n","import { Point, roundPointCoordinates, Size, touchOrMouseEvent } from './helpers';\r\n\r\nexport class SVGHelper {\r\n  public getSvgElement: () => SVGSVGElement | null | undefined;\r\n  constructor(getSvgElement: () => SVGSVGElement | null | undefined) {\r\n    this.getSvgElement = getSvgElement;\r\n  }\r\n  getSvg() {\r\n    const svg = this.getSvgElement();\r\n    if (!svg) throw new Error('SVG is null');\r\n    return svg;\r\n  }\r\n  getCTM() {\r\n    const ctm = this.getSvg().getCTM();\r\n    if (!ctm) throw new Error('CTM is null');\r\n    return ctm;\r\n  }\r\n  getViewboxSize() {\r\n    return this.getSvg().viewBox.baseVal;\r\n  }\r\n  getRealSize(): Size {\r\n    return {\r\n      width: this.getSvg().width.baseVal.value,\r\n      height: this.getSvg().height.baseVal.value\r\n    };\r\n  }\r\n  getViewboxOffset(): Point {\r\n    const svg = this.getSvg();\r\n    const { width: rWidth, height: rHeight } = this.getRealSize();\r\n    const { width: vWidth, height: vHeight } = this.getViewboxSize();\r\n    const point = Object.assign(svg.createSVGPoint(), {\r\n      x: rWidth,\r\n      y: rHeight\r\n    });\r\n    const ctm = this.getCTM();\r\n    const { x, y } = point.matrixTransform(ctm.inverse());\r\n    // only for preserveAspectRatio=\"xMidYMid meet\" !!!\r\n    return {\r\n      x: x - vWidth,\r\n      y: y - vHeight\r\n    };\r\n  }\r\n  convertViewboxPointsToReal(points: Point[]): Point[] {\r\n    const svg = this.getSvg();\r\n    const ctm = this.getCTM();\r\n    return points.map(({ x, y }) => {\r\n      const p = Object.assign(svg.createSVGPoint(), { x, y }).matrixTransform(ctm);\r\n      return roundPointCoordinates(p);\r\n    });\r\n  }\r\n  convertRealPointsToViewbox(points: Point[]): Point[] {\r\n    const svg = this.getSvg();\r\n    const ctm = this.getCTM().inverse();\r\n    return points.map(({ x, y }) => {\r\n      const p = Object.assign(svg.createSVGPoint(), { x, y }).matrixTransform(ctm);\r\n      return roundPointCoordinates(p, 1e3);\r\n    });\r\n  }\r\n  getBorderPoints(repeatFirst = true) {\r\n    const { width, height } = this.getViewboxSize();\r\n    const { x: offsetX, y: offsetY } = this.getViewboxOffset();\r\n    const arr: Point[] = [\r\n      { x: -offsetX, y: -offsetY },\r\n      { x: width + offsetX, y: -offsetY },\r\n      { x: width + offsetX, y: height + offsetY },\r\n      { x: -offsetX, y: height + offsetY }\r\n    ];\r\n    if (repeatFirst) {\r\n      arr.push({ x: -offsetX, y: -offsetY });\r\n    }\r\n    return arr;\r\n  }\r\n  isAboveTheBorder({ x, y }: Point) {\r\n    const { width, height } = this.getViewboxSize();\r\n    const { x: offsetX, y: offsetY } = this.getViewboxOffset();\r\n    return x < -offsetX || x > width + offsetX || y < -offsetY || y > height + offsetY;\r\n  }\r\n  getMouseCoordinates(event: touchOrMouseEvent<SVGSVGElement>): Point {\r\n    const e = event as React.MouseEvent<SVGSVGElement, MouseEvent> &\r\n      React.TouchEvent<SVGSVGElement>;\r\n    const { clientX, clientY } =\r\n      e.changedTouches && e.touches ? e.changedTouches[0] || e.touches[0] : e;\r\n    const svg = this.getSvg();\r\n    const ctm = svg.getScreenCTM();\r\n    if (!ctm) throw new Error('ScreenCTM is null');\r\n    const point = svg.createSVGPoint();\r\n    point.x = clientX;\r\n    point.y = clientY;\r\n    const { x, y } = point.matrixTransform(ctm.inverse());\r\n    return { x, y };\r\n  }\r\n}\r\n","import React from 'react';\r\nimport { SVGHelper } from './SVGHelpers';\r\n\r\nimport { Point, Vector, touchOrMouseEvent } from './helpers';\r\n\r\nexport interface WithDraggableProps {\r\n  draggable: boolean;\r\n  onDragStart?: (arg: Point & Vector) => void;\r\n  onDrag?: (arg: Vector) => void;\r\n  onDragEnd?: (arg: Point) => void;\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/ban-types\r\nexport const withDraggable = <P extends object>(Component: React.ComponentType<P>) =>\r\n  class DraggableHOC extends React.Component<P & WithDraggableProps> {\r\n    public ref = React.createRef<SVGSVGElement>();\r\n    public svg = new SVGHelper(() => this.ref?.current?.ownerSVGElement);\r\n    public dragLastPosition: null | Point = null;\r\n    public wasMoved = false;\r\n    render() {\r\n      const { draggable, onDrag, onDragStart, onDragEnd, ...rest } = this.props;\r\n      return <Component ref={this.ref} {...(rest as P)} draggable={draggable} />;\r\n    }\r\n    componentDidUpdate(prevProps: WithDraggableProps) {\r\n      if (prevProps.draggable && !this.props.draggable) {\r\n        // cleanup after props.draggable changed to false\r\n        if (this.dragLastPosition && this.wasMoved) {\r\n          if (this.props.onDragEnd) {\r\n            this.props.onDragEnd({\r\n              x: this.dragLastPosition.x,\r\n              y: this.dragLastPosition.y\r\n            });\r\n          }\r\n          this.dragLastPosition = null;\r\n          this.wasMoved = false;\r\n        }\r\n      }\r\n    }\r\n    componentDidMount() {\r\n      window.addEventListener('mousedown', this.onMouseTouchDown, true);\r\n      window.addEventListener('mousemove', this.onMouseTouchMove, true);\r\n      window.addEventListener('mouseup', this.onMouseTouchUp, true);\r\n      window.addEventListener('touchstart', this.onMouseTouchDown, true);\r\n      window.addEventListener('touchmove', this.onMouseTouchMove, true);\r\n      window.addEventListener('touchend', this.onMouseTouchUp, true);\r\n    }\r\n    componentWillUnmount() {\r\n      window.removeEventListener('mousedown', this.onMouseTouchDown);\r\n      window.removeEventListener('mousemove', this.onMouseTouchMove);\r\n      window.removeEventListener('mouseup', this.onMouseTouchUp);\r\n      window.removeEventListener('touchstart', this.onMouseTouchDown);\r\n      window.removeEventListener('touchmove', this.onMouseTouchMove);\r\n      window.removeEventListener('touchend', this.onMouseTouchUp);\r\n    }\r\n    getMousePosition(ev: TouchEvent | MouseEvent) {\r\n      const e = (ev as unknown) as touchOrMouseEvent<SVGSVGElement>;\r\n      return this.svg.getMouseCoordinates(e);\r\n    }\r\n    onMouseTouchDown = (e: TouchEvent | MouseEvent) => {\r\n      if (e.target === this.ref.current && this.props.draggable) {\r\n        e.stopImmediatePropagation();\r\n        e.preventDefault();\r\n        const target = e.target as EventTarget & SVGSVGElement;\r\n        this.dragLastPosition = this.getMousePosition(e);\r\n        if (target.ownerSVGElement) {\r\n          target.ownerSVGElement.focus({ preventScroll: true });\r\n        }\r\n      }\r\n    };\r\n    onMouseTouchMove = (e: TouchEvent | MouseEvent) => {\r\n      if (this.dragLastPosition) {\r\n        e.stopImmediatePropagation();\r\n        e.preventDefault();\r\n        const { x, y } = this.getMousePosition(e);\r\n        const dx = x - this.dragLastPosition.x;\r\n        const dy = y - this.dragLastPosition.y;\r\n        if (!this.wasMoved && this.props.onDragStart) {\r\n          this.props.onDragStart({\r\n            x: this.dragLastPosition.x,\r\n            y: this.dragLastPosition.y,\r\n            dx,\r\n            dy\r\n          });\r\n        }\r\n        if (this.props.onDrag) {\r\n          this.props.onDrag({ dx, dy });\r\n        }\r\n        this.dragLastPosition = { x, y };\r\n        this.wasMoved = true;\r\n      }\r\n    };\r\n    onMouseTouchUp = (e: TouchEvent | MouseEvent) => {\r\n      if (this.dragLastPosition && this.wasMoved) {\r\n        e.stopImmediatePropagation();\r\n        e.preventDefault();\r\n        if (e instanceof MouseEvent || !e.touches) {\r\n          window.addEventListener('click', (e) => e.stopPropagation(), {\r\n            capture: true,\r\n            once: true\r\n          });\r\n        }\r\n        if (this.props.onDragEnd) {\r\n          this.props.onDragEnd({\r\n            x: this.dragLastPosition.x,\r\n            y: this.dragLastPosition.y\r\n          });\r\n        }\r\n      }\r\n      this.dragLastPosition = null;\r\n      this.wasMoved = false;\r\n    };\r\n  };\r\n","import React from 'react';\r\nimport { withDraggable } from './withDraggable';\r\nimport { Point } from './helpers';\r\n\r\nexport interface SVGPolylineProps {\r\n  path: Point[];\r\n  animate: boolean;\r\n  draggable: boolean;\r\n}\r\n\r\nexport const SVGPolyline = withDraggable(\r\n  React.forwardRef<SVGPolylineElement, SVGPolylineProps>(function SVGPolyline(\r\n    { path, animate, draggable },\r\n    ref\r\n  ) {\r\n    return (\r\n      <polyline\r\n        ref={ref}\r\n        style={{ cursor: draggable ? 'move' : '' }}\r\n        points={path.map(({ x, y }) => `${x},${y}`).join(' ')}\r\n        fill=\"rgba(0,0,0,0)\"\r\n        stroke=\"white\"\r\n        strokeWidth=\"1.5\"\r\n        shapeRendering=\"geometricPrecision\"\r\n        strokeDasharray=\"3\"\r\n        strokeDashoffset=\"0\"\r\n        vectorEffect=\"non-scaling-stroke\"\r\n      >\r\n        {animate && (\r\n          <animate\r\n            attributeName=\"stroke-dashoffset\"\r\n            values=\"0;1000;0\"\r\n            dur=\"100s\"\r\n            repeatCount=\"indefinite\"\r\n          />\r\n        )}\r\n      </polyline>\r\n    );\r\n  })\r\n);\r\n","import React from 'react';\r\nimport { Point } from './helpers';\r\n\r\nexport interface SVGPolygonProps {\r\n  path: Point[];\r\n}\r\n\r\nexport function SVGPolygon({ path }: SVGPolygonProps) {\r\n  return (\r\n    <polygon\r\n      style={{\r\n        pointerEvents: 'none',\r\n        transform: 'translate(-1px, -1px)'\r\n      }}\r\n      points={path.map(({ x, y }) => `${x},${y}`).join(' ')}\r\n      fill=\"rgba(0, 0, 0, 0.5)\"\r\n      fillRule=\"evenodd\"\r\n      stroke=\"null\"\r\n      shapeRendering=\"geometricPrecision\"\r\n    />\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { withDraggable } from './withDraggable';\r\nimport { Point } from './helpers';\r\n\r\nexport interface SVGPointProps extends Point {\r\n  style: React.CSSProperties;\r\n  draggable: boolean;\r\n  onClickTouchEvent: (e: React.MouseEvent | React.TouchEvent) => void;\r\n}\r\n\r\nexport const SVGPoint = withDraggable(\r\n  React.forwardRef<SVGRectElement, SVGPointProps>(function SVGPoint(\r\n    { x, y, onClickTouchEvent, draggable, style },\r\n    ref\r\n  ) {\r\n    const { cursor = draggable ? 'move' : 'default', ...rest } = style;\r\n    return (\r\n      <rect\r\n        style={{\r\n          cursor,\r\n          ...rest\r\n        }}\r\n        ref={ref}\r\n        x={x - 10}\r\n        y={y - 10}\r\n        onClick={(e) => {\r\n          e.stopPropagation();\r\n          e.preventDefault();\r\n          onClickTouchEvent(e);\r\n        }}\r\n        onTouchEnd={(e) => {\r\n          e.stopPropagation();\r\n          e.preventDefault();\r\n          onClickTouchEvent(e);\r\n        }}\r\n        width=\"20px\"\r\n        height=\"20\"\r\n        fill=\"rgba(0, 0, 0, 0)\"\r\n        stroke=\"white\"\r\n        strokeWidth=\"1.25\"\r\n        vectorEffect=\"non-scaling-stroke\"\r\n        // vectorEffect=\"non-scaling-size\" will be featured in SVG 2.0!\r\n      />\r\n    );\r\n  })\r\n);\r\n","import { arePointListEqual, arePointsEqual, Point } from './helpers';\r\n\r\nexport enum pathActions {\r\n  ADD = 'ADD',\r\n  DELETE = 'DELETE',\r\n  MODIFY = 'MODIFY',\r\n  MOVE = 'MOVE',\r\n  RESET = 'RESET',\r\n  CHANGE = 'CHANGE'\r\n}\r\n\r\nexport type pathReducerAction =\r\n  | { type: pathActions.ADD; payload: Point }\r\n  | { type: pathActions.DELETE; payload: number }\r\n  | { type: pathActions.MODIFY; payload: { index: number } & Point }\r\n  | { type: pathActions.MOVE; payload: Point }\r\n  | { type: pathActions.RESET }\r\n  | { type: pathActions.CHANGE; payload: Point[] };\r\nexport interface PathState {\r\n  points: Point[];\r\n  closed: boolean;\r\n}\r\n\r\nexport function pathReducer(state: PathState, action: pathReducerAction): [PathState, boolean] {\r\n  const length = state.points.length;\r\n  switch (action.type) {\r\n    case pathActions.ADD: {\r\n      if (state.closed) return [state, false];\r\n      if (\r\n        (length > 0 && arePointsEqual(state.points[length - 1], action.payload)) ||\r\n        (length > 1 && arePointsEqual(state.points[length - 2], action.payload))\r\n      ) {\r\n        return [state, false];\r\n      }\r\n      const needToBeClosed = length > 2 && arePointsEqual(state.points[0], action.payload);\r\n      if (needToBeClosed) return [{ points: [...state.points], closed: true }, true];\r\n      return [{ points: [...state.points, action.payload], closed: false }, true];\r\n    }\r\n    case pathActions.DELETE: {\r\n      return [\r\n        {\r\n          points: [...state.points.filter((_, idx) => action.payload !== idx)],\r\n          closed: length > 4 && state.closed\r\n        },\r\n        true\r\n      ];\r\n    }\r\n    case pathActions.MODIFY: {\r\n      const { x: sx, y: sy } = state.points[action.payload.index];\r\n      const newPoints = state.points.map(({ x, y }) => {\r\n        if (x === sx && y === sy) {\r\n          return {\r\n            x: action.payload.x,\r\n            y: action.payload.y\r\n          };\r\n        }\r\n        return { x, y };\r\n      });\r\n      return [\r\n        { points: newPoints, closed: state.closed },\r\n        !!(action.payload.x || action.payload.y)\r\n      ];\r\n    }\r\n    case pathActions.MOVE: {\r\n      return [\r\n        {\r\n          points: state.points.map(({ x, y }) => ({\r\n            x: x + action.payload.x,\r\n            y: y + action.payload.y\r\n          })),\r\n          closed: state.closed\r\n        },\r\n        !!(action.payload.x || action.payload.y)\r\n      ];\r\n    }\r\n    case pathActions.CHANGE: {\r\n      const wasModified = !arePointListEqual(action.payload, state.points);\r\n      return [\r\n        {\r\n          points: action.payload,\r\n          closed: wasModified ? action.payload.length > 2 : state.closed\r\n        },\r\n        wasModified\r\n      ];\r\n    }\r\n    case pathActions.RESET:\r\n      return [{ points: [], closed: false }, !!state.points.length];\r\n    default:\r\n      return [state, false];\r\n  }\r\n}\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nimport { SVGPolyline } from './SVGPolyline';\r\nimport { SVGPolygon } from './SVGPolygon';\r\nimport { SVGPoint } from './SVGPoint';\r\nimport { SVGHelper } from './SVGHelpers';\r\n\r\nimport {\r\n  roundPointCoordinates,\r\n  arePointListEqual,\r\n  objectToClassName,\r\n  getClippedImageCanvas,\r\n  Point,\r\n  Vector,\r\n  touchOrMouseEvent,\r\n  Size,\r\n  approximateToAnAngleMultiplicity,\r\n  approximateToAngles,\r\n  calculateAnglesBeetwenPoints,\r\n  findPointByPosition\r\n} from './helpers';\r\n\r\nimport { pathReducer, pathActions, pathReducerAction, PathState } from './pathReducer';\r\n\r\nexport interface ReactLassoProps {\r\n  src: string;\r\n  value: Point[];\r\n  style: React.CSSProperties;\r\n  viewBox: Size;\r\n  disabled: boolean;\r\n  imageStyle: React.CSSProperties;\r\n  onImageLoad: (e: React.SyntheticEvent<HTMLImageElement, Event>) => void;\r\n  onImageError: (e: React.SyntheticEvent<HTMLImageElement, Event>) => void;\r\n  onChange?: (path: Point[]) => void;\r\n  onComplete?: (path: Point[]) => void;\r\n  imageAlt?: string;\r\n  crossOrigin?: 'anonymous' | 'use-credentials' | '';\r\n}\r\n\r\nexport interface ReactLassoState {\r\n  path: PathState;\r\n  pointer: Point;\r\n}\r\n\r\nexport class ReactLasso extends React.Component<ReactLassoProps, ReactLassoState> {\r\n  public state: ReactLassoState;\r\n  public imageRef = React.createRef<HTMLImageElement>();\r\n  public svgRef = React.createRef<SVGSVGElement>();\r\n  public svg = new SVGHelper(() => this.svgRef?.current);\r\n  public angles: number[] = [];\r\n  public path: PathState = {\r\n    points: [],\r\n    closed: false\r\n  };\r\n  public lastEmittedPoints: Point[] = [];\r\n  public lastUpdatedPoints: Point[] = [];\r\n  public imgError = false;\r\n  public setPathFromPropsOnMediaLoad = true;\r\n  constructor(props: ReactLassoProps) {\r\n    super(props);\r\n    this.state = {\r\n      path: {\r\n        points: [],\r\n        closed: false\r\n      },\r\n      pointer: {\r\n        x: props.viewBox.width / 2,\r\n        y: props.viewBox.width / 2\r\n      }\r\n    };\r\n  }\r\n  render() {\r\n    return (\r\n      <div\r\n        className={objectToClassName({\r\n          ReactFreeSelect__Component: true,\r\n          ReactFreeSelect__Closed: this.state.path.closed,\r\n          ReactFreeSelect__Disabled: this.props.disabled\r\n        })}\r\n        style={{\r\n          display: 'inline-block',\r\n          position: 'relative',\r\n          margin: '0',\r\n          padding: '0',\r\n          fontSize: '0',\r\n          cursor: this.props.disabled ? 'not-allowed' : 'default',\r\n          ...this.props.style\r\n        }}\r\n      >\r\n        <img\r\n          ref={this.imageRef}\r\n          src={this.props.src}\r\n          alt={this.props.imageAlt}\r\n          crossOrigin={this.props.crossOrigin}\r\n          style={this.props.imageStyle}\r\n          onLoad={this.onMediaLoaded}\r\n          onError={this.onMediaError}\r\n        />\r\n        <svg\r\n          ref={this.svgRef}\r\n          style={{\r\n            position: 'absolute',\r\n            top: '0',\r\n            left: '0',\r\n            width: '100%',\r\n            height: '100%',\r\n            overflow: 'hidden',\r\n            userSelect: 'none',\r\n            touchAction: 'none'\r\n          }}\r\n          viewBox={`0 0 ${this.props.viewBox.width} ${this.props.viewBox.height}`}\r\n          onMouseMove={this.onMouseTouchMove}\r\n          onTouchMove={this.onMouseTouchMove}\r\n          onClick={this.onClick}\r\n          onTouchEnd={this.onTouchEnd}\r\n          onContextMenu={this.onContextMenu}\r\n          onMouseLeave={this.hidePointer}\r\n        >\r\n          {!!this.state.path.points.length && <SVGPolygon path={this.getPolygonPoints()} />}\r\n          <SVGPolyline\r\n            draggable={this.state.path.closed && !this.props.disabled}\r\n            onDrag={this.onShapeDrag}\r\n            onDragEnd={this.onDragEnd}\r\n            animate={!this.props.disabled}\r\n            path={this.getPolylinePoints()}\r\n          />\r\n          {this.getRoundedPoints().map(({ x, y }, idx) => (\r\n            <SVGPoint\r\n              key={idx}\r\n              x={x}\r\n              y={y}\r\n              draggable={!this.props.disabled}\r\n              style={{\r\n                cursor:\r\n                  !idx && this.state.path.points.length > 2 && !this.state.path.closed\r\n                    ? 'pointer'\r\n                    : undefined\r\n              }}\r\n              onDrag={({ dx, dy }) => this.onPointDrag(idx, { dx, dy })}\r\n              onDragEnd={this.onDragEnd}\r\n              onClickTouchEvent={() => this.onPointClick(idx)}\r\n            />\r\n          ))}\r\n        </svg>\r\n      </div>\r\n    );\r\n  }\r\n  componentDidUpdate(prevProps: ReactLassoProps) {\r\n    if (!prevProps.disabled && this.props.disabled && !this.path.closed) {\r\n      this.hidePointer();\r\n    }\r\n    if (prevProps.src && prevProps.src !== this.props.src) {\r\n      this.dispatchPathAction({ type: pathActions.RESET });\r\n    } else if (!arePointListEqual(prevProps.value, this.props.value)) {\r\n      if (this.isLoaded()) {\r\n        this.setPathStateFromProps();\r\n      } else {\r\n        this.setPathFromPropsOnMediaLoad = true;\r\n      }\r\n    }\r\n  }\r\n  convertPoints(points: Point[]): Point[] {\r\n    const aspectRatio = this.getAspectRatio();\r\n    return this.svg.convertViewboxPointsToReal(points).map(({ x, y }) => ({\r\n      x: Math.round(x / aspectRatio.x),\r\n      y: Math.round(y / aspectRatio.y)\r\n    }));\r\n  }\r\n  checkIfPathUpdated(wasClosedBefore: boolean) {\r\n    if (this.path.closed || wasClosedBefore) {\r\n      const convertedPoints = this.convertPoints(this.path.points);\r\n      if (!arePointListEqual(convertedPoints, this.lastUpdatedPoints)) {\r\n        this.emitOnComplete(convertedPoints);\r\n        this.lastUpdatedPoints = convertedPoints.map(({ x, y }) => ({ x, y }));\r\n      }\r\n    }\r\n  }\r\n  emitOnChange({ points }: PathState) {\r\n    if (this.props.onChange) {\r\n      const convertedPoints = this.convertPoints(points);\r\n      this.lastEmittedPoints = convertedPoints;\r\n      this.props.onChange(convertedPoints);\r\n    }\r\n  }\r\n  emitOnComplete(convertedPoints: Point[]) {\r\n    if (this.props.onComplete) {\r\n      this.props.onComplete(convertedPoints);\r\n    }\r\n  }\r\n  setPointer({ x, y }: Point, force = false) {\r\n    if (force || !this.props.disabled) {\r\n      this.setState({\r\n        path: this.path,\r\n        pointer: { x, y }\r\n      });\r\n    }\r\n  }\r\n  hidePointer = () => {\r\n    const lastPoint = this.path.points[this.path.points.length - 1] || {\r\n      x: 0,\r\n      y: 0\r\n    };\r\n    this.setPointer({ ...lastPoint }, true); // tricky way to hide pointer line\r\n  };\r\n  dispatchPathAction(action: pathReducerAction & { pointer?: Point }) {\r\n    const wasClosedBefore = this.path.closed;\r\n    const [newPathState, wasModified] = pathReducer(this.path, action);\r\n    newPathState.points = newPathState.points.map((point) => roundPointCoordinates(point, 1e3));\r\n    if (wasModified) {\r\n      this.path = newPathState;\r\n      this.setState({\r\n        pointer: action.pointer || this.path.points[this.path.points.length - 1] || { x: 0, y: 0 },\r\n        path: newPathState\r\n      });\r\n      this.angles = calculateAnglesBeetwenPoints(newPathState.points);\r\n      this.emitOnChange(newPathState);\r\n      if (![pathActions.MODIFY, pathActions.MOVE].includes(action.type)) {\r\n        this.checkIfPathUpdated(wasClosedBefore); // optimized version of onChange\r\n      }\r\n    }\r\n  }\r\n  isLoaded() {\r\n    if (this.imgError || !this.svgRef.current) return false;\r\n    const svg = this.svgRef.current;\r\n    return !!(svg.width.baseVal.value && svg.height.baseVal.value);\r\n  }\r\n  getAspectRatio(): Point {\r\n    if (!this.imageRef.current) {\r\n      return { x: NaN, y: NaN };\r\n    }\r\n    // original * aspectRatio = size\r\n    return {\r\n      x: this.imageRef.current.clientWidth / this.imageRef.current.naturalWidth,\r\n      y: this.imageRef.current.clientHeight / this.imageRef.current.naturalHeight\r\n    };\r\n  }\r\n  setPathStateFromProps() {\r\n    if (arePointListEqual(this.lastEmittedPoints, this.props.value)) return;\r\n    const aspectRatio = this.getAspectRatio();\r\n    const value = this.svg.convertRealPointsToViewbox(\r\n      this.props.value.map(({ x, y }) => ({\r\n        x: x * aspectRatio.x,\r\n        y: y * aspectRatio.y\r\n      }))\r\n    );\r\n    this.dispatchPathAction({\r\n      type: pathActions.CHANGE,\r\n      payload: value\r\n    });\r\n  }\r\n  getRoundedPoints() {\r\n    return this.state.path.points.map((point) => roundPointCoordinates(point));\r\n  }\r\n  getBorder(): Point[] {\r\n    return this.svg\r\n      .getBorderPoints()\r\n      .map((point) => roundPointCoordinates(point))\r\n      .map(({ x, y }) => ({ x: x - 1, y: y + 1 })); // fishy bug here so i have to margin area\r\n  }\r\n  getPolygonPoints(): Point[] {\r\n    const roundedPoints = this.getRoundedPoints();\r\n    const border = this.getBorder();\r\n    return this.state.path.closed\r\n      ? [...border, ...roundedPoints, roundedPoints[0], border[0]]\r\n      : border;\r\n  }\r\n  getPolylinePoints(): Point[] {\r\n    const roundedPoints = this.getRoundedPoints();\r\n    return roundedPoints.concat(\r\n      this.state.path.closed ? roundedPoints[0] : roundPointCoordinates(this.state.pointer)\r\n    );\r\n  }\r\n  getMousePosition(\r\n    e: touchOrMouseEvent<SVGSVGElement>,\r\n    lookupForNearlyPoints = true,\r\n    lookupForApproximation = true\r\n  ): [Point, { point: Point; index: number }] {\r\n    let pointer = this.svg.getMouseCoordinates(e);\r\n    if (lookupForApproximation) {\r\n      const ctrlCmdPressed = navigator.platform.includes('Mac') ? e.metaKey : e.ctrlKey;\r\n      const lastPoint = this.path.points[this.path.points.length - 1];\r\n      // straighten path from last point\r\n      if (ctrlCmdPressed && lastPoint) {\r\n        if (e.shiftKey) {\r\n          // lookup for parallel lines\r\n          pointer = approximateToAngles(lastPoint, pointer, this.angles);\r\n        } else {\r\n          // angle approximation to 15 deg\r\n          pointer = approximateToAnAngleMultiplicity(lastPoint, pointer, Math.PI / 12);\r\n        }\r\n      }\r\n    }\r\n    const { point, index } = findPointByPosition(this.path.points, pointer, 10);\r\n    if (lookupForNearlyPoints && index > -1) {\r\n      pointer = { ...point };\r\n    }\r\n    return [pointer, { point, index }];\r\n  }\r\n  // Events\r\n  onShapeDrag = ({ dx, dy }: Vector) => {\r\n    const newPath = this.path.points.map(({ x, y }) => ({\r\n      x: x + dx,\r\n      y: y + dy\r\n    }));\r\n    if (!newPath.some((point) => this.svg.isAboveTheBorder(point))) {\r\n      this.dispatchPathAction({\r\n        type: pathActions.MOVE,\r\n        payload: { x: dx, y: dy }\r\n      });\r\n    }\r\n  };\r\n  onPointDrag = (idx: number, { dx, dy }: Vector) => {\r\n    const point = { ...this.path.points[idx] };\r\n    point.x += dx;\r\n    point.y += dy;\r\n    if (!this.svg.isAboveTheBorder(point)) {\r\n      this.dispatchPathAction({\r\n        type: pathActions.MODIFY,\r\n        payload: { ...point, index: idx }\r\n      });\r\n    }\r\n  };\r\n  onPointClick = (idx: number) => {\r\n    if (this.isLoaded() && !this.props.disabled && !this.path.closed) {\r\n      this.dispatchPathAction({\r\n        type: pathActions.ADD,\r\n        payload: this.path.points[idx]\r\n      });\r\n    }\r\n  };\r\n  onDragEnd = () => {\r\n    this.checkIfPathUpdated(false);\r\n  };\r\n  onMediaLoaded = (e: React.SyntheticEvent<HTMLImageElement, Event>) => {\r\n    if (this.setPathFromPropsOnMediaLoad) {\r\n      this.setPathStateFromProps();\r\n      this.setPathFromPropsOnMediaLoad = false;\r\n    }\r\n    this.imgError = false;\r\n    this.props.onImageLoad(e);\r\n  };\r\n  onMediaError = (e: React.SyntheticEvent<HTMLImageElement, Event>) => {\r\n    this.dispatchPathAction({ type: pathActions.RESET });\r\n    this.imgError = true;\r\n    this.props.onImageError(e);\r\n  };\r\n  onClickTouchEvent = (e: touchOrMouseEvent<SVGSVGElement>) => {\r\n    if (this.isLoaded() && !this.props.disabled) {\r\n      if (this.path.closed) {\r\n        if (e.target === this.svgRef.current) {\r\n          this.dispatchPathAction({\r\n            type: pathActions.RESET\r\n          });\r\n        }\r\n        return;\r\n      }\r\n      const [pointer] = this.getMousePosition(e);\r\n      if (!this.svg.isAboveTheBorder(pointer)) {\r\n        this.dispatchPathAction({\r\n          type: pathActions.ADD,\r\n          payload: roundPointCoordinates(pointer, 1e3),\r\n          pointer\r\n        });\r\n      } else {\r\n        this.hidePointer();\r\n      }\r\n    }\r\n  };\r\n  onClick = (e: React.MouseEvent<SVGSVGElement, MouseEvent>) => {\r\n    this.onClickTouchEvent(e);\r\n  };\r\n  onTouchEnd = (e: React.TouchEvent<SVGSVGElement>) => {\r\n    if (e.cancelable) {\r\n      e.preventDefault();\r\n      this.onClickTouchEvent(e);\r\n    }\r\n    this.hidePointer();\r\n  };\r\n  onMouseTouchMove = (e: touchOrMouseEvent<SVGSVGElement>) => {\r\n    if (this.isLoaded()) {\r\n      const [pointer] = this.getMousePosition(e);\r\n      this.setPointer(pointer);\r\n    }\r\n  };\r\n  onContextMenu = (e: React.MouseEvent<SVGSVGElement, MouseEvent>) => {\r\n    if (this.isLoaded()) {\r\n      e.preventDefault();\r\n      if (!this.props.disabled && !this.path.closed) {\r\n        const [pointer, { index }] = this.getMousePosition(e);\r\n        if (index > -1) {\r\n          this.dispatchPathAction({\r\n            type: pathActions.DELETE,\r\n            payload: index,\r\n            pointer\r\n          });\r\n        } else {\r\n          this.setPointer(pointer);\r\n        }\r\n      }\r\n    }\r\n  };\r\n  static propTypes = {\r\n    value: PropTypes.arrayOf(\r\n      PropTypes.exact({\r\n        x: PropTypes.number.isRequired,\r\n        y: PropTypes.number.isRequired\r\n      })\r\n    ),\r\n    style: PropTypes.shape({}),\r\n    viewBox: PropTypes.exact({\r\n      width: PropTypes.number.isRequired,\r\n      height: PropTypes.number.isRequired\r\n    }),\r\n    disabled: PropTypes.bool,\r\n    onChange: PropTypes.func,\r\n    onComplete: PropTypes.func,\r\n    src: PropTypes.string.isRequired,\r\n    imageAlt: PropTypes.string,\r\n    crossOrigin: PropTypes.string,\r\n    imageStyle: PropTypes.shape({}),\r\n    onImageLoad: PropTypes.func,\r\n    onImageError: PropTypes.func\r\n  };\r\n  static defaultProps = {\r\n    value: [],\r\n    style: {},\r\n    imageStyle: {},\r\n    viewBox: { width: 1e3, height: 1e3 },\r\n    disabled: false,\r\n    onImageError: Function.prototype,\r\n    onImageLoad: Function.prototype\r\n  };\r\n}\r\n\r\nexport { ReactLasso as default, ReactLasso as Component, getClippedImageCanvas as getCanvas };\r\n"],"names":["React","PropTypes"],"mappings":"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"}