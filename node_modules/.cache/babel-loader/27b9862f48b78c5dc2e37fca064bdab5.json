{"ast":null,"code":"/*! *****************************************************************************\nCopyright (c) Microsoft Corporation.\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n***************************************************************************** */\nvar t = function (e, i) {\n  return (t = Object.setPrototypeOf || {\n    __proto__: []\n  } instanceof Array && function (t, e) {\n    t.__proto__ = e;\n  } || function (t, e) {\n    for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]);\n  })(e, i);\n};\n\nfunction e(e, i) {\n  function o() {\n    this.constructor = e;\n  }\n\n  t(e, i), e.prototype = null === i ? Object.create(i) : (o.prototype = i.prototype, new o());\n}\n\nfunction i(t, e, i, o) {\n  return new (i || (i = Promise))(function (s, r) {\n    function n(t) {\n      try {\n        l(o.next(t));\n      } catch (t) {\n        r(t);\n      }\n    }\n\n    function a(t) {\n      try {\n        l(o.throw(t));\n      } catch (t) {\n        r(t);\n      }\n    }\n\n    function l(t) {\n      var e;\n      t.done ? s(t.value) : (e = t.value, e instanceof i ? e : new i(function (t) {\n        t(e);\n      })).then(n, a);\n    }\n\n    l((o = o.apply(t, e || [])).next());\n  });\n}\n\nfunction o(t, e) {\n  var i,\n      o,\n      s,\n      r,\n      n = {\n    label: 0,\n    sent: function () {\n      if (1 & s[0]) throw s[1];\n      return s[1];\n    },\n    trys: [],\n    ops: []\n  };\n  return r = {\n    next: a(0),\n    throw: a(1),\n    return: a(2)\n  }, \"function\" == typeof Symbol && (r[Symbol.iterator] = function () {\n    return this;\n  }), r;\n\n  function a(r) {\n    return function (a) {\n      return function (r) {\n        if (i) throw new TypeError(\"Generator is already executing.\");\n\n        for (; n;) try {\n          if (i = 1, o && (s = 2 & r[0] ? o.return : r[0] ? o.throw || ((s = o.return) && s.call(o), 0) : o.next) && !(s = s.call(o, r[1])).done) return s;\n\n          switch (o = 0, s && (r = [2 & r[0], s.value]), r[0]) {\n            case 0:\n            case 1:\n              s = r;\n              break;\n\n            case 4:\n              return n.label++, {\n                value: r[1],\n                done: !1\n              };\n\n            case 5:\n              n.label++, o = r[1], r = [0];\n              continue;\n\n            case 7:\n              r = n.ops.pop(), n.trys.pop();\n              continue;\n\n            default:\n              if (!(s = n.trys, (s = s.length > 0 && s[s.length - 1]) || 6 !== r[0] && 2 !== r[0])) {\n                n = 0;\n                continue;\n              }\n\n              if (3 === r[0] && (!s || r[1] > s[0] && r[1] < s[3])) {\n                n.label = r[1];\n                break;\n              }\n\n              if (6 === r[0] && n.label < s[1]) {\n                n.label = s[1], s = r;\n                break;\n              }\n\n              if (s && n.label < s[2]) {\n                n.label = s[2], n.ops.push(r);\n                break;\n              }\n\n              s[2] && n.ops.pop(), n.trys.pop();\n              continue;\n          }\n\n          r = e.call(t, n);\n        } catch (t) {\n          r = [6, t], o = 0;\n        } finally {\n          i = s = 0;\n        }\n\n        if (5 & r[0]) throw r[1];\n        return {\n          value: r[0] ? r[1] : void 0,\n          done: !0\n        };\n      }([r, a]);\n    };\n  }\n}\n\nfunction s() {\n  for (var t = 0, e = 0, i = arguments.length; e < i; e++) t += arguments[e].length;\n\n  var o = Array(t),\n      s = 0;\n\n  for (e = 0; e < i; e++) for (var r = arguments[e], n = 0, a = r.length; n < a; n++, s++) o[s] = r[n];\n\n  return o;\n}\n\nvar r = function () {\n  function t() {}\n\n  return t.createDefs = function () {\n    return document.createElementNS(\"http://www.w3.org/2000/svg\", \"defs\");\n  }, t.setAttributes = function (t, e) {\n    for (var i = 0, o = e; i < o.length; i++) {\n      var s = o[i],\n          r = s[0],\n          n = s[1];\n      t.setAttribute(r, n);\n    }\n  }, t.createRect = function (e, i, o) {\n    var s = document.createElementNS(\"http://www.w3.org/2000/svg\", \"rect\");\n    return s.setAttribute(\"width\", e.toString()), s.setAttribute(\"height\", i.toString()), o && t.setAttributes(s, o), s;\n  }, t.createLine = function (e, i, o, s, r) {\n    var n = document.createElementNS(\"http://www.w3.org/2000/svg\", \"line\");\n    return n.setAttribute(\"x1\", e.toString()), n.setAttribute(\"y1\", i.toString()), n.setAttribute(\"x2\", o.toString()), n.setAttribute(\"y2\", s.toString()), r && t.setAttributes(n, r), n;\n  }, t.createPolygon = function (e, i) {\n    var o = document.createElementNS(\"http://www.w3.org/2000/svg\", \"polygon\");\n    return o.setAttribute(\"points\", e), i && t.setAttributes(o, i), o;\n  }, t.createCircle = function (e, i) {\n    var o = document.createElementNS(\"http://www.w3.org/2000/svg\", \"circle\");\n    return o.setAttribute(\"cx\", (e / 2).toString()), o.setAttribute(\"cy\", (e / 2).toString()), o.setAttribute(\"r\", e.toString()), i && t.setAttributes(o, i), o;\n  }, t.createEllipse = function (e, i, o) {\n    var s = document.createElementNS(\"http://www.w3.org/2000/svg\", \"ellipse\");\n    return s.setAttribute(\"cx\", (e / 2).toString()), s.setAttribute(\"cy\", (i / 2).toString()), s.setAttribute(\"rx\", (e / 2).toString()), s.setAttribute(\"ry\", (i / 2).toString()), o && t.setAttributes(s, o), s;\n  }, t.createGroup = function (e) {\n    var i = document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\");\n    return e && t.setAttributes(i, e), i;\n  }, t.createTransform = function () {\n    return document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\").createSVGTransform();\n  }, t.createMarker = function (e, i, o, s, r, n, a) {\n    var l = document.createElementNS(\"http://www.w3.org/2000/svg\", \"marker\");\n    return t.setAttributes(l, [[\"id\", e], [\"orient\", i], [\"markerWidth\", o.toString()], [\"markerHeight\", s.toString()], [\"refX\", r.toString()], [\"refY\", n.toString()]]), l.appendChild(a), l;\n  }, t.createText = function (e) {\n    var i = document.createElementNS(\"http://www.w3.org/2000/svg\", \"text\");\n    return i.setAttribute(\"x\", \"0\"), i.setAttribute(\"y\", \"0\"), e && t.setAttributes(i, e), i;\n  }, t.createTSpan = function (e, i) {\n    var o = document.createElementNS(\"http://www.w3.org/2000/svg\", \"tspan\");\n    return o.textContent = e, i && t.setAttributes(o, i), o;\n  }, t.createImage = function (e) {\n    var i = document.createElementNS(\"http://www.w3.org/2000/svg\", \"image\");\n    return e && t.setAttributes(i, e), i;\n  }, t.createPoint = function (t, e) {\n    var i = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\").createSVGPoint();\n    return i.x = t, i.y = e, i;\n  }, t;\n}(),\n    n = function () {\n  function t() {}\n\n  return t.addKey = function (e) {\n    t.key = e;\n  }, Object.defineProperty(t, \"isLicensed\", {\n    get: function () {\n      return !!t.key && new RegExp(/^MJS2-[A-Z][0-9]{3}-[A-Z][0-9]{3}-[0-9]{4}$/, \"i\").test(t.key);\n    },\n    enumerable: !1,\n    configurable: !0\n  }), t;\n}(),\n    a = function () {\n  function t() {\n    this.naturalSize = !1, this.imageType = \"image/png\", this.markersOnly = !1;\n  }\n\n  return t.prototype.rasterize = function (t, e) {\n    var i = this;\n    return new Promise(function (o) {\n      var s = document.createElement(\"canvas\"),\n          r = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\n      r.setAttribute(\"xmlns\", \"http://www.w3.org/2000/svg\"), r.setAttribute(\"width\", e.width.baseVal.valueAsString), r.setAttribute(\"height\", e.height.baseVal.valueAsString), r.setAttribute(\"viewBox\", \"0 0 \" + e.viewBox.baseVal.width.toString() + \" \" + e.viewBox.baseVal.height.toString()), r.innerHTML = e.innerHTML, !0 === i.naturalSize ? (r.width.baseVal.value = t.naturalWidth, r.height.baseVal.value = t.naturalHeight) : void 0 !== i.width && void 0 !== i.height && (r.width.baseVal.value = i.width, r.height.baseVal.value = i.height), s.width = r.width.baseVal.value, s.height = r.height.baseVal.value;\n      var n = r.outerHTML,\n          a = s.getContext(\"2d\");\n      !0 !== i.markersOnly && a.drawImage(t, 0, 0, s.width, s.height);\n      var l = window.URL,\n          h = new Image(s.width, s.height);\n      h.setAttribute(\"crossOrigin\", \"anonymous\");\n      var p = new Blob([n], {\n        type: \"image/svg+xml\"\n      }),\n          c = l.createObjectURL(p);\n      h.onload = function () {\n        a.drawImage(h, 0, 0), l.revokeObjectURL(c);\n        var t = s.toDataURL(i.imageType, i.imageQuality);\n        o(t);\n      }, h.src = c;\n    });\n  }, t;\n}(),\n    l = function () {\n  function t() {}\n\n  return Object.defineProperty(t, \"defaultSettings\", {\n    get: function () {\n      return {\n        canvasBackgroundColor: \"#ffffff\",\n        toolbarBackgroundColor: \"#111111\",\n        toolbarBackgroundHoverColor: \"#333333\",\n        toolbarColor: \"#eeeeee\",\n        toolbarHeight: 40,\n        toolboxBackgroundColor: \"#2a2a2a\",\n        toolboxColor: \"#eeeeee\",\n        toolboxAccentColor: \"#3080c3\",\n        undoButtonVisible: !0,\n        redoButtonVisible: !1\n      };\n    },\n    enumerable: !1,\n    configurable: !0\n  }), Object.defineProperty(t, \"fadeInAnimationClassName\", {\n    get: function () {\n      return t.CLASS_PREFIX + \"fade_in\";\n    },\n    enumerable: !1,\n    configurable: !0\n  }), Object.defineProperty(t, \"fadeOutAnimationClassName\", {\n    get: function () {\n      return t.CLASS_PREFIX + \"fade_out\";\n    },\n    enumerable: !1,\n    configurable: !0\n  }), t.addClass = function (e) {\n    return void 0 === t.styleSheet && t.addStyleSheet(), t.classes.push(e), t.styleSheet.sheet.addRule(\".\" + e.name, e.style), e;\n  }, t.addRule = function (e) {\n    void 0 === t.styleSheet && t.addStyleSheet(), t.rules.push(e), t.styleSheet.sheet.addRule(e.selector, e.style);\n  }, t.addStyleSheet = function () {\n    var e;\n    t.styleSheet = document.createElement(\"style\"), (null !== (e = t.styleSheetRoot) && void 0 !== e ? e : document.head).appendChild(t.styleSheet), t.addRule(new h(\".\" + t.CLASS_PREFIX + \" h3\", \"font-family: sans-serif\")), t.addRule(new h(\"@keyframes \" + t.CLASS_PREFIX + \"_fade_in_animation_frames\", \"\\n        from {\\n          opacity: 0;\\n        }\\n        to {\\n          opacity: 1;\\n        }\\n    \")), t.addRule(new h(\"@keyframes \" + t.CLASS_PREFIX + \"_fade_out_animation_frames\", \"\\n        from {\\n          opacity: 1;\\n        }\\n        to {\\n          opacity: 0;\\n        }\\n    \")), t.addClass(new p(\"fade_in\", \"\\n      animation-duration: 0.3s;\\n      animation-name: \" + t.CLASS_PREFIX + \"_fade_in_animation_frames;\\n    \")), t.addClass(new p(\"fade_out\", \"\\n      animation-duration: 0.3s;\\n      animation-name: \" + t.CLASS_PREFIX + \"_fade_out_animation_frames;\\n    \"));\n  }, t.removeStyleSheet = function () {\n    var e;\n    t.styleSheet && ((null !== (e = t.styleSheetRoot) && void 0 !== e ? e : document.head).removeChild(t.styleSheet), t.styleSheet = void 0);\n  }, t.CLASS_PREFIX = \"__markerjs2_\", t.classes = [], t.rules = [], t.settings = t.defaultSettings, t;\n}(),\n    h = function (t, e) {\n  this.selector = t, this.style = e;\n},\n    p = function () {\n  function t(t, e) {\n    this._localName = t, this.style = e;\n  }\n\n  return Object.defineProperty(t.prototype, \"name\", {\n    get: function () {\n      return \"\" + l.CLASS_PREFIX + this._localName;\n    },\n    enumerable: !1,\n    configurable: !0\n  }), t;\n}(),\n    c = function () {\n  function t(t, e, i, o) {\n    this.buttons = [], this.markerButtons = [], this.buttonClickListeners = [], this.markerjsContainer = t, this.displayMode = e, this.markerItems = i, this.uiStyleSettings = o, this.addStyles(), this.adjustLayout = this.adjustLayout.bind(this), this.overflowButtonClicked = this.overflowButtonClicked.bind(this), this.setCurrentMarker = this.setCurrentMarker.bind(this);\n  }\n\n  return t.prototype.show = function (t) {\n    var e = this;\n    this.uiContainer = document.createElement(\"div\"), this.uiContainer.style.visibility = t, this.uiContainer.className = this.toolbarStyleClass.name + \" \" + l.fadeInAnimationClassName + \" \" + (this.uiStyleSettings.toolbarStyleColorsClassName ? this.uiStyleSettings.toolbarStyleColorsClassName : this.toolbarStyleColorsClass.name);\n    var i = document.createElement(\"div\");\n    i.className = this.toolbarBlockStyleClass.name, i.style.whiteSpace = \"nowrap\", this.uiContainer.appendChild(i), this.addActionButton(i, '<svg viewBox=\"0 0 24 24\"><path d=\"M10.07 14.27a.997.997 0 011.33.48l2.3 4.99 1.8-.85-2.31-4.98c-.24-.5-.02-1.1.48-1.33l.28-.08 2.3-.45L8 5.12V15.9l1.82-1.47.25-.16m3.57 7.7a.99.99 0 01-1.33-.47l-2.18-4.74-2.51 2.02c-.17.14-.38.22-.62.22a1 1 0 01-1-1V3a1 1 0 011-1c.24 0 .47.09.64.23l.01-.01 11.49 9.64a1.001 1.001 0 01-.44 1.75l-3.16.62 2.2 4.73c.26.5.02 1.09-.48 1.32l-3.62 1.69z\"/></svg>', \"select\"), this.addActionButton(i, '<svg viewBox=\"0 0 24 24\"><path d=\"M9 3v1H4v2h1v13a2 2 0 002 2h10a2 2 0 002-2V6h1V4h-5V3H9M7 6h10v13H7V6m2 2v9h2V8H9m4 0v9h2V8h-2z\"/></svg>', \"delete\"), this.uiStyleSettings.undoButtonVisible && this.addActionButton(i, '<svg viewBox=\"0 0 24 24\"><path d=\"M12.5 8c-2.65 0-5.05 1-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z\"/></svg>', \"undo\"), this.uiStyleSettings.redoButtonVisible && this.addActionButton(i, '<svg viewBox=\"0 0 24 24\"><path d=\"M18.4 10.6C16.55 9 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16a8.002 8.002 0 017.6-5.5c1.95 0 3.73.72 5.12 1.88L13 16h9V7l-3.6 3.6z\"/></svg>', \"redo\"), this.markerButtonBlock = document.createElement(\"div\"), this.markerButtonBlock.className = this.toolbarBlockStyleClass.name, this.markerButtonBlock.style.flexGrow = \"2\", this.markerButtonBlock.style.textAlign = \"center\", this.uiContainer.appendChild(this.markerButtonBlock), this.markerButtonOverflowBlock = document.createElement(\"div\"), this.markerButtonOverflowBlock.className = this.toolbarOverflowBlockStyleClass.name + \" \" + (this.uiStyleSettings.toolbarOverflowBlockStyleColorsClassName ? this.uiStyleSettings.toolbarOverflowBlockStyleColorsClassName : this.toolbarOverflowBlockStyleColorsClass.name), this.markerButtonOverflowBlock.style.display = \"none\", this.uiContainer.appendChild(this.markerButtonOverflowBlock), this.markerItems && (this.markerItems.forEach(function (t) {\n      var i = document.createElement(\"div\");\n      i.className = \"\" + e.toolbarButtonStyleClass.name, i.innerHTML = t.icon, i.addEventListener(\"click\", function () {\n        e.markerToolbarButtonClicked(i, t);\n      }), e.buttons.push(i), e.markerButtons.push(i);\n    }), this.overflowButton = document.createElement(\"div\"), this.overflowButton.className = this.toolbarButtonStyleClass.name + \" \" + (this.uiStyleSettings.toolbarButtonStyleColorsClassName ? this.uiStyleSettings.toolbarButtonStyleColorsClassName : this.toolbarButtonStyleColorsClass.name), this.overflowButton.innerHTML = '<svg viewBox=\"0 0 24 24\"><path d=\"M12 16a2 2 0 012 2 2 2 0 01-2 2 2 2 0 01-2-2 2 2 0 012-2m0-6a2 2 0 012 2 2 2 0 01-2 2 2 2 0 01-2-2 2 2 0 012-2m0-6a2 2 0 012 2 2 2 0 01-2 2 2 2 0 01-2-2 2 2 0 012-2z\"/></svg>', this.overflowButton.addEventListener(\"click\", this.overflowButtonClicked), this.markerButtonBlock.appendChild(this.overflowButton));\n    var o = document.createElement(\"div\");\n    o.className = this.toolbarBlockStyleClass.name, o.style.whiteSpace = \"nowrap\", this.uiContainer.appendChild(o), this.addActionButton(o, '<svg viewBox=\"0 0 24 24\"><path d=\"M9 20.42l-6.21-6.21 2.83-2.83L9 14.77l9.88-9.89 2.83 2.83L9 20.42z\"/></svg>', \"render\"), this.addActionButton(o, '<svg viewBox=\"0 0 24 24\"><path d=\"M20 6.91L17.09 4 12 9.09 6.91 4 4 6.91 9.09 12 4 17.09 6.91 20 12 14.91 17.09 20 20 17.09 14.91 12 20 6.91z\"/></svg>', \"close\"), this.markerjsContainer.appendChild(this.uiContainer), this.setSelectMode(), this.setCurrentMarker(), this.adjustLayout();\n  }, t.prototype.addButtonClickListener = function (t) {\n    this.buttonClickListeners.push(t);\n  }, t.prototype.removeButtonClickListener = function (t) {\n    this.buttonClickListeners.indexOf(t) > -1 && this.buttonClickListeners.splice(this.buttonClickListeners.indexOf(t), 1);\n  }, t.prototype.setSelectMode = function () {\n    this.resetButtonStyles(), this.setActiveButton(this.buttons[0]);\n  }, t.prototype.adjustLayout = function () {\n    if (this.markerButtons && this.markerButtons.length > 0) {\n      var t = Math.floor(this.markerButtonBlock.clientWidth / this.uiStyleSettings.toolbarHeight) - 1;\n      this.markerButtonBlock.innerHTML = \"\", this.markerButtonOverflowBlock.innerHTML = \"\";\n\n      for (var e = 0; e < this.markerButtons.length; e++) e < t || e === t && this.markerButtons.length - 1 === t ? this.markerButtonBlock.appendChild(this.markerButtons[e]) : (e === t && this.markerButtonBlock.appendChild(this.overflowButton), this.markerButtonOverflowBlock.appendChild(this.markerButtons[e]));\n    }\n  }, t.prototype.overflowButtonClicked = function () {\n    \"none\" !== this.markerButtonOverflowBlock.style.display ? (this.markerButtonOverflowBlock.className = this.markerButtonOverflowBlock.className.replace(l.fadeInAnimationClassName, \"\"), this.markerButtonOverflowBlock.style.display = \"none\") : (this.markerButtonOverflowBlock.className += \" \" + l.fadeInAnimationClassName, this.markerButtonOverflowBlock.style.top = this.uiContainer.offsetTop + this.overflowButton.offsetHeight + \"px\", this.markerButtonOverflowBlock.style.right = this.uiContainer.offsetWidth - this.overflowButton.offsetLeft - this.overflowButton.offsetWidth + 2 * this.uiContainer.offsetLeft + \"px\", this.markerButtonOverflowBlock.style.display = \"inline-block\");\n  }, t.prototype.resetButtonStyles = function () {\n    var t = this;\n    this.buttons.forEach(function (e) {\n      e.className = e.className.replace(t.uiStyleSettings.toolbarButtonStyleColorsClassName ? t.uiStyleSettings.toolbarButtonStyleColorsClassName : t.toolbarButtonStyleColorsClass.name, \"\").trim(), e.className = e.className.replace(t.uiStyleSettings.toolbarActiveButtonStyleColorsClassName ? t.uiStyleSettings.toolbarActiveButtonStyleColorsClassName : t.toolbarActiveButtonStyleColorsClass.name, \"\").trim(), e.className += \" \" + (t.uiStyleSettings.toolbarButtonStyleColorsClassName ? t.uiStyleSettings.toolbarButtonStyleColorsClassName : t.toolbarButtonStyleColorsClass.name);\n    });\n  }, t.prototype.addActionButton = function (t, e, i) {\n    var o = this,\n        s = document.createElement(\"div\");\n\n    switch (s.className = \"\" + this.toolbarButtonStyleClass.name, s.innerHTML = e, s.addEventListener(\"click\", function () {\n      o.actionToolbarButtonClicked(s, i);\n    }), i) {\n      case \"select\":\n        s.style.fill = this.uiStyleSettings.selectButtonColor;\n        break;\n\n      case \"delete\":\n        s.style.fill = this.uiStyleSettings.deleteButtonColor;\n        break;\n\n      case \"undo\":\n      case \"redo\":\n        s.style.fill = this.uiStyleSettings.selectButtonColor;\n        break;\n\n      case \"render\":\n        s.style.fill = this.uiStyleSettings.okButtonColor;\n        break;\n\n      case \"close\":\n        s.style.fill = this.uiStyleSettings.closeButtonColor;\n    }\n\n    t.appendChild(s), this.buttons.push(s);\n  }, t.prototype.addStyles = function () {\n    this.toolbarStyleClass = l.addClass(new p(\"toolbar\", \"\\n      width: 100%;\\n      flex-shrink: 0;\\n      display: flex;\\n      flex-direction: row;\\n      justify-content: space-between;      \\n      height: \" + this.uiStyleSettings.toolbarHeight + \"px;\\n      box-sizing: content-box;\\n      \" + (\"inline\" === this.displayMode ? \"border-top-left-radius: \" + Math.round(this.uiStyleSettings.toolbarHeight / 10) + \"px;\" : \"\") + \"\\n      \" + (\"inline\" === this.displayMode ? \"border-top-right-radius: \" + Math.round(this.uiStyleSettings.toolbarHeight / 10) + \"px;\" : \"\") + \"\\n      overflow: hidden;\\n    \")), this.toolbarStyleColorsClass = l.addClass(new p(\"toolbar_colors\", \"\\n      background-color: \" + this.uiStyleSettings.toolbarBackgroundColor + \";\\n      box-shadow: 0px 3px rgba(33, 33, 33, 0.1);\\n    \")), this.toolbarBlockStyleClass = l.addClass(new p(\"toolbar-block\", \"\\n        display: inline-block;\\n        box-sizing: content-box;\\n    \")), this.toolbarOverflowBlockStyleClass = l.addClass(new p(\"toolbar-overflow-block\", \"\\n        position: absolute;\\n        top: \" + this.uiStyleSettings.toolbarHeight + \"px;\\n        max-width: \" + 2 * this.uiStyleSettings.toolbarHeight + \"px;\\n        z-index: 10;\\n        box-sizing: content-box;\\n      \")), this.toolbarOverflowBlockStyleColorsClass = l.addClass(new p(\"toolbar-overflow-block_colors\", \"\\n        background-color: \" + this.uiStyleSettings.toolbarBackgroundColor + \";\\n      \"));\n    var t = this.uiStyleSettings.toolbarHeight / 4;\n    this.toolbarButtonStyleClass = l.addClass(new p(\"toolbar_button\", \"\\n      display: inline-block;\\n      width: \" + (this.uiStyleSettings.toolbarHeight - 2 * t) + \"px;\\n      height: \" + (this.uiStyleSettings.toolbarHeight - 2 * t) + \"px;\\n      padding: \" + t + \"px;\\n      box-sizing: content-box;\\n    \")), this.toolbarButtonStyleColorsClass = l.addClass(new p(\"toolbar_button_colors\", \"\\n      fill: \" + this.uiStyleSettings.toolbarColor + \";\\n    \")), this.toolbarActiveButtonStyleColorsClass = l.addClass(new p(\"toolbar_active_button\", \"\\n      fill: \" + this.uiStyleSettings.toolbarColor + \";\\n      background-color: \" + this.uiStyleSettings.toolbarBackgroundHoverColor + \"\\n    \")), l.addRule(new h(\".\" + this.toolbarButtonStyleClass.name + \" svg\", \"\\n      height: \" + this.uiStyleSettings.toolbarHeight / 2 + \"px;\\n    \")), l.addRule(new h(\".\" + this.toolbarButtonStyleColorsClass.name + \":hover\", \"\\n        background-color: \" + this.uiStyleSettings.toolbarBackgroundHoverColor + \"\\n    \"));\n  }, t.prototype.markerToolbarButtonClicked = function (t, e) {\n    this.setActiveButton(t), this.buttonClickListeners && this.buttonClickListeners.length > 0 && this.buttonClickListeners.forEach(function (t) {\n      return t(\"marker\", e);\n    }), this.markerButtonOverflowBlock.style.display = \"none\";\n  }, t.prototype.actionToolbarButtonClicked = function (t, e) {\n    this.buttonClickListeners && this.buttonClickListeners.length > 0 && this.buttonClickListeners.forEach(function (t) {\n      return t(\"action\", e);\n    }), this.markerButtonOverflowBlock.style.display = \"none\", this.setActiveButton(this.buttons[0]);\n  }, t.prototype.setActiveButton = function (t) {\n    this.resetButtonStyles(), t.className = t.className.replace(this.uiStyleSettings.toolbarButtonStyleColorsClassName ? this.uiStyleSettings.toolbarButtonStyleColorsClassName : this.toolbarButtonStyleColorsClass.name, \"\").trim(), t.className += \" \" + (this.uiStyleSettings.toolbarActiveButtonStyleColorsClassName ? this.uiStyleSettings.toolbarActiveButtonStyleColorsClassName : this.toolbarActiveButtonStyleColorsClass.name);\n  }, t.prototype.setCurrentMarker = function (t) {\n    this.currentMarker = t, void 0 === this.currentMarker ? (this.buttons[1].style.fillOpacity = \"0.4\", this.buttons[1].style.pointerEvents = \"none\") : (this.buttons[1].style.fillOpacity = \"1\", this.buttons[1].style.pointerEvents = \"all\");\n  }, t;\n}(),\n    d = function () {\n  function t(t, e, i) {\n    this.panels = [], this.panelButtons = [], this.markerjsContainer = t, this.displayMode = e, this.uiStyleSettings = i, this.panelButtonClick = this.panelButtonClick.bind(this), this.addStyles();\n  }\n\n  return t.prototype.addStyles = function () {\n    this.toolboxStyleClass = l.addClass(new p(\"toolbox\", \"\\n      width: 100%;\\n      flex-shrink: 0;\\n      display: flex;\\n      flex-direction: column;\\n      font-family: sans-serif;\\n      \" + (\"popup\" === this.displayMode ? \"height:\" + 2.5 * this.uiStyleSettings.toolbarHeight + \"px;\" : \"\") + \"\\n      box-sizing: content-box;\\n      \" + (\"popup\" === this.displayMode ? \"background-color: \" + this.uiStyleSettings.canvasBackgroundColor + \";\" : \"\") + \"\\n      \" + (\"inline\" === this.displayMode ? \"border-bottom-left-radius: \" + Math.round(this.uiStyleSettings.toolbarHeight / 10) + \"px;\" : \"\") + \"\\n      \" + (\"inline\" === this.displayMode ? \"border-bottom-right-radius: \" + Math.round(this.uiStyleSettings.toolbarHeight / 10) + \"px;\" : \"\") + \"\\n      overflow: hidden;\\n    \")), this.toolboxStyleColorsClass = l.addClass(new p(\"toolbox_colors\", \"\\n      color: \" + this.uiStyleSettings.toolboxColor + \";\\n    \"));\n    var t = this.uiStyleSettings.toolbarHeight / 4;\n    this.toolboxButtonRowStyleClass = l.addClass(new p(\"toolbox-button-row\", \"\\n      display: flex;\\n      cursor: default;\\n      box-sizing: content-box;\\n    \")), this.toolboxButtonRowStyleColorsClass = l.addClass(new p(\"toolbox-button-row_colors\", \"\\n      background-color: \" + this.uiStyleSettings.toolbarBackgroundColor + \";\\n    \")), this.toolboxPanelRowStyleClass = l.addClass(new p(\"toolbox-panel-row\", \"\\n      display: flex;\\n      \" + (\"inline\" === this.displayMode ? \"position: absolute;\" : \"\") + \"\\n      \" + (\"inline\" === this.displayMode ? \"bottom: \" + this.uiStyleSettings.toolbarHeight + \"px;\" : \"\") + \"\\n      cursor: default;\\n      height: \" + 1.5 * this.uiStyleSettings.toolbarHeight + \"px;\\n      \" + (\"inline\" === this.displayMode ? \"width: 100%;\" : \"\") + \"\\n      box-sizing: content-box;\\n    \")), this.toolboxPanelRowStyleColorsClass = l.addClass(new p(\"toolbox-panel-row_colors\", \"\\n      background-color: \" + this.uiStyleSettings.toolbarBackgroundHoverColor + \";\\n    \")), this.toolboxButtonStyleClass = l.addClass(new p(\"toolbox_button\", \"\\n      display: inline-block;\\n      width: \" + (this.uiStyleSettings.toolbarHeight - 2 * t) + \"px;\\n      height: \" + (this.uiStyleSettings.toolbarHeight - 2 * t) + \"px;\\n      padding: \" + t + \"px;\\n      box-sizing: content-box;\\n    \")), this.toolboxButtonStyleColorsClass = l.addClass(new p(\"toolbox-button_colors\", \"\\n      fill: \" + this.uiStyleSettings.toolbarColor + \";\\n    \")), this.toolboxActiveButtonStyleColorsClass = l.addClass(new p(\"toolbox-active-button_colors\", \"\\n      background-color: \" + this.uiStyleSettings.toolbarBackgroundHoverColor + \";\\n      fill: \" + this.uiStyleSettings.toolbarColor + \";\\n    \")), l.addRule(new h(\".\" + this.toolboxButtonStyleColorsClass.name + \":hover\", \"\\n        background-color: \" + this.uiStyleSettings.toolbarBackgroundHoverColor + \"\\n    \")), l.addRule(new h(\".\" + this.toolboxButtonStyleClass.name + \" svg\", \"\\n      height: \" + this.uiStyleSettings.toolbarHeight / 2 + \"px;\\n    \"));\n  }, t.prototype.show = function (t) {\n    var e;\n    this.uiContainer = document.createElement(\"div\"), this.uiContainer.style.visibility = t, this.uiContainer.className = this.toolboxStyleClass.name + \" \" + (null !== (e = this.uiStyleSettings.toolboxStyleColorsClassName) && void 0 !== e ? e : this.toolboxStyleColorsClass.name), this.markerjsContainer.appendChild(this.uiContainer);\n  }, t.prototype.setPanelButtons = function (t) {\n    var e,\n        i,\n        o = this;\n    this.panels = t, void 0 !== this.uiContainer && (this.uiContainer.innerHTML = \"\", this.panelRow = document.createElement(\"div\"), this.panelRow.className = this.toolboxPanelRowStyleClass.name + \" \" + (null !== (e = this.uiStyleSettings.toolboxPanelRowStyleColorsClassName) && void 0 !== e ? e : this.toolboxPanelRowStyleColorsClass.name), this.uiContainer.appendChild(this.panelRow), this.buttonRow = document.createElement(\"div\"), this.buttonRow.className = this.toolboxButtonRowStyleClass.name + \" \" + (null !== (i = this.uiStyleSettings.toolboxButtonRowStyleColorsClassName) && void 0 !== i ? i : this.toolboxButtonRowStyleColorsClass.name) + \" \", this.uiContainer.appendChild(this.buttonRow), this.panelButtons.splice(0), this.panels.forEach(function (t) {\n      var e,\n          i = document.createElement(\"div\");\n      i.className = o.toolboxButtonStyleClass.name + \" \" + (null !== (e = o.uiStyleSettings.toolboxButtonStyleColorsClassName) && void 0 !== e ? e : o.toolboxButtonStyleColorsClass.name), i.innerHTML = t.icon, i.title = t.title, i.addEventListener(\"click\", function () {\n        o.panelButtonClick(t);\n      }), o.panelButtons.push(i), o.buttonRow.appendChild(i);\n    }), \"inline\" === this.displayMode ? this.panelRow.style.display = \"none\" : this.panelRow.style.visibility = \"hidden\");\n  }, t.prototype.panelButtonClick = function (t) {\n    var e = this,\n        i = -1;\n\n    if (t !== this.activePanel) {\n      i = this.panels.indexOf(t), this.panelRow.innerHTML = \"\";\n      var o = t.getUi();\n      o.style.margin = this.uiStyleSettings.toolbarHeight / 4 + \"px\", this.panelRow.appendChild(o), this.panelRow.style.display = \"flex\", this.panelRow.style.visibility = \"visible\", this.panelRow.className = this.panelRow.className.replace(l.fadeOutAnimationClassName, \"\"), this.panelRow.className += \" \" + l.fadeInAnimationClassName, this.activePanel = t;\n    } else this.activePanel = void 0, this.panelRow.className = this.panelRow.className.replace(l.fadeInAnimationClassName, \"\"), this.panelRow.className += \" \" + l.fadeOutAnimationClassName, setTimeout(function () {\n      \"inline\" === e.displayMode ? e.panelRow.style.display = \"none\" : e.panelRow.style.visibility = \"hidden\";\n    }, 200);\n\n    this.panelButtons.forEach(function (t, o) {\n      var s, r;\n      t.className = e.toolboxButtonStyleClass.name + \" \" + (o === i ? \"\" + (null !== (s = e.uiStyleSettings.toolboxActiveButtonStyleColorsClassName) && void 0 !== s ? s : e.toolboxActiveButtonStyleColorsClass.name) : \"\" + (null !== (r = e.uiStyleSettings.toolboxButtonStyleColorsClassName) && void 0 !== r ? r : e.toolboxButtonStyleColorsClass.name));\n    });\n  }, t;\n}(),\n    u = function (t, e) {\n  this.title = t, this.icon = e;\n},\n    y = function (t) {\n  function i(e, i, o, s) {\n    var r = t.call(this, e, s || '<svg viewBox=\"0 0 24 24\"><path d=\"M17.5 12a1.5 1.5 0 01-1.5-1.5A1.5 1.5 0 0117.5 9a1.5 1.5 0 011.5 1.5 1.5 1.5 0 01-1.5 1.5m-3-4A1.5 1.5 0 0113 6.5 1.5 1.5 0 0114.5 5 1.5 1.5 0 0116 6.5 1.5 1.5 0 0114.5 8m-5 0A1.5 1.5 0 018 6.5 1.5 1.5 0 019.5 5 1.5 1.5 0 0111 6.5 1.5 1.5 0 019.5 8m-3 4A1.5 1.5 0 015 10.5 1.5 1.5 0 016.5 9 1.5 1.5 0 018 10.5 1.5 1.5 0 016.5 12M12 3a9 9 0 00-9 9 9 9 0 009 9 1.5 1.5 0 001.5-1.5c0-.39-.15-.74-.39-1-.23-.27-.38-.62-.38-1a1.5 1.5 0 011.5-1.5H16a5 5 0 005-5c0-4.42-4.03-8-9-8z\"/></svg>') || this;\n    return r.colors = [], r.addTransparent = !1, r.colorBoxes = [], r.colors = i, r.currentColor = o, r.setCurrentColor = r.setCurrentColor.bind(r), r.getColorBox = r.getColorBox.bind(r), r;\n  }\n\n  return e(i, t), i.prototype.getUi = function () {\n    var t = this,\n        e = document.createElement(\"div\");\n    return this.colors.forEach(function (i) {\n      var o = t.getColorBox(i);\n      e.appendChild(o), t.colorBoxes.push(o);\n    }), e;\n  }, i.prototype.getColorBox = function (t) {\n    var e = this,\n        i = l.settings.toolbarHeight / 4,\n        o = l.settings.toolbarHeight - i,\n        s = document.createElement(\"div\");\n    s.style.display = \"inline-block\", s.style.boxSizing = \"content-box\", s.style.width = o - 2 + \"px\", s.style.height = o - 2 + \"px\", s.style.padding = \"1px\", s.style.marginRight = \"2px\", s.style.marginBottom = \"2px\", s.style.borderWidth = \"2px\", s.style.borderStyle = \"solid\", s.style.borderRadius = (o + 2) / 2 + \"px\", s.style.borderColor = t === this.currentColor ? l.settings.toolboxAccentColor : \"transparent\", s.addEventListener(\"click\", function () {\n      e.setCurrentColor(t, s);\n    });\n    var r = document.createElement(\"div\");\n    return r.style.display = \"inline-block\", r.style.width = o - 2 + \"px\", r.style.height = o - 2 + \"px\", r.style.backgroundColor = t, r.style.borderRadius = o / 2 + \"px\", \"transparent\" === t && (r.style.fill = l.settings.toolboxAccentColor, r.innerHTML = '<svg viewBox=\"0 0 24 24\">\\n        <path d=\"M2,5.27L3.28,4L20,20.72L18.73,22L15.65,18.92C14.5,19.3 13.28,19.5 12,19.5C7,19.5 2.73,16.39 1,12C1.69,10.24 2.79,8.69 4.19,7.46L2,5.27M12,9A3,3 0 0,1 15,12C15,12.35 14.94,12.69 14.83,13L11,9.17C11.31,9.06 11.65,9 12,9M12,4.5C17,4.5 21.27,7.61 23,12C22.18,14.08 20.79,15.88 19,17.19L17.58,15.76C18.94,14.82 20.06,13.54 20.82,12C19.17,8.64 15.76,6.5 12,6.5C10.91,6.5 9.84,6.68 8.84,7L7.3,5.47C8.74,4.85 10.33,4.5 12,4.5M3.18,12C4.83,15.36 8.24,17.5 12,17.5C12.69,17.5 13.37,17.43 14,17.29L11.72,15C10.29,14.85 9.15,13.71 9,12.28L5.6,8.87C4.61,9.72 3.78,10.78 3.18,12Z\" />\\n      </svg>'), s.appendChild(r), s;\n  }, i.prototype.setCurrentColor = function (t, e) {\n    this.currentColor = t, this.colorBoxes.forEach(function (t) {\n      t.style.borderColor = t === e ? l.settings.toolboxAccentColor : \"transparent\";\n    }), this.onColorChanged && this.onColorChanged(t);\n  }, i;\n}(u),\n    g = function () {\n  function t(t, e, i) {\n    this._state = \"new\", this._container = t, this._overlayContainer = e, this.globalSettings = i;\n  }\n\n  return Object.defineProperty(t.prototype, \"container\", {\n    get: function () {\n      return this._container;\n    },\n    enumerable: !1,\n    configurable: !0\n  }), Object.defineProperty(t.prototype, \"overlayContainer\", {\n    get: function () {\n      return this._overlayContainer;\n    },\n    enumerable: !1,\n    configurable: !0\n  }), Object.defineProperty(t.prototype, \"state\", {\n    get: function () {\n      return this._state;\n    },\n    enumerable: !1,\n    configurable: !0\n  }), Object.defineProperty(t.prototype, \"toolboxPanels\", {\n    get: function () {\n      return [];\n    },\n    enumerable: !1,\n    configurable: !0\n  }), t.prototype.ownsTarget = function (t) {\n    return !1;\n  }, t.prototype.select = function () {\n    this.container.style.cursor = \"move\";\n  }, t.prototype.deselect = function () {\n    this.container.style.cursor = \"default\";\n  }, t.prototype.pointerDown = function (t, e) {}, t.prototype.dblClick = function (t, e) {}, t.prototype.manipulate = function (t) {}, t.prototype.pointerUp = function (t) {}, t.prototype.dispose = function () {}, t.prototype.addMarkerVisualToContainer = function (t) {\n    this.container.childNodes.length > 0 ? this.container.insertBefore(t, this.container.childNodes[0]) : this.container.appendChild(t);\n  }, t.prototype.getState = function () {\n    return {\n      typeName: t.typeName,\n      state: this.state\n    };\n  }, t.prototype.restoreState = function (t) {\n    this._state = t.state;\n  }, t.prototype.scale = function (t, e) {}, t.typeName = \"MarkerBase\", t;\n}(),\n    f = function () {\n  function t() {\n    this.findGripByVisual = this.findGripByVisual.bind(this);\n  }\n\n  return t.prototype.findGripByVisual = function (t) {\n    return this.topLeft.ownsTarget(t) ? this.topLeft : this.topCenter.ownsTarget(t) ? this.topCenter : this.topRight.ownsTarget(t) ? this.topRight : this.centerLeft.ownsTarget(t) ? this.centerLeft : this.centerRight.ownsTarget(t) ? this.centerRight : this.bottomLeft.ownsTarget(t) ? this.bottomLeft : this.bottomCenter.ownsTarget(t) ? this.bottomCenter : this.bottomRight.ownsTarget(t) ? this.bottomRight : void 0;\n  }, t;\n}(),\n    m = function () {\n  function t() {\n    this.GRIP_SIZE = 10, this.visual = r.createGroup(), this.visual.appendChild(r.createCircle(1.5 * this.GRIP_SIZE, [[\"fill\", \"transparent\"]])), this.visual.appendChild(r.createCircle(this.GRIP_SIZE, [[\"fill\", \"#cccccc\"], [\"fill-opacity\", \"0.7\"], [\"stroke\", \"#333333\"], [\"stroke-width\", \"2\"], [\"stroke-opacity\", \"0.7\"]]));\n  }\n\n  return t.prototype.ownsTarget = function (t) {\n    return t === this.visual || t === this.visual.childNodes[0] || t === this.visual.childNodes[1];\n  }, t;\n}(),\n    v = function () {\n  function t() {}\n\n  return t.toITransformMatrix = function (t) {\n    return {\n      a: t.a,\n      b: t.b,\n      c: t.c,\n      d: t.d,\n      e: t.e,\n      f: t.f\n    };\n  }, t.toSVGMatrix = function (t, e) {\n    return t.a = e.a, t.b = e.b, t.c = e.c, t.d = e.d, t.e = e.e, t.f = e.f, t;\n  }, t;\n}(),\n    C = function (t) {\n  function i(e, i, o) {\n    var s = t.call(this, e, i, o) || this;\n    return s.left = 0, s.top = 0, s.width = 0, s.height = 0, s.defaultSize = {\n      x: 50,\n      y: 20\n    }, s.offsetX = 0, s.offsetY = 0, s.rotationAngle = 0, s.CB_DISTANCE = 10, s.container.transform.baseVal.appendItem(r.createTransform()), s.setupControlBox(), s;\n  }\n\n  return e(i, t), Object.defineProperty(i.prototype, \"centerX\", {\n    get: function () {\n      return this.left + this.width / 2;\n    },\n    enumerable: !1,\n    configurable: !0\n  }), Object.defineProperty(i.prototype, \"centerY\", {\n    get: function () {\n      return this.top + this.height / 2;\n    },\n    enumerable: !1,\n    configurable: !0\n  }), Object.defineProperty(i.prototype, \"visual\", {\n    get: function () {\n      return this._visual;\n    },\n    set: function (t) {\n      this._visual = t;\n      var e = r.createTransform();\n\n      this._visual.transform.baseVal.appendItem(e);\n    },\n    enumerable: !1,\n    configurable: !0\n  }), i.prototype.ownsTarget = function (e) {\n    return !!t.prototype.ownsTarget.call(this, e) || !(void 0 === this.controlGrips.findGripByVisual(e) && !this.rotatorGrip.ownsTarget(e));\n  }, i.prototype.pointerDown = function (e, i) {\n    t.prototype.pointerDown.call(this, e, i), \"new\" === this.state && (this.left = e.x, this.top = e.y), this.manipulationStartLeft = this.left, this.manipulationStartTop = this.top, this.manipulationStartWidth = this.width, this.manipulationStartHeight = this.height;\n    var o = this.unrotatePoint(e);\n    if (this.manipulationStartX = o.x, this.manipulationStartY = o.y, this.offsetX = o.x - this.left, this.offsetY = o.y - this.top, \"new\" !== this.state) if (this.select(), this.activeGrip = this.controlGrips.findGripByVisual(i), void 0 !== this.activeGrip) this._state = \"resize\";else if (this.rotatorGrip.ownsTarget(i)) {\n      this.activeGrip = this.rotatorGrip;\n      var s = this.rotatePoint({\n        x: this.centerX,\n        y: this.centerY\n      });\n      this.left = s.x - this.width / 2, this.top = s.y - this.height / 2, this.moveVisual({\n        x: this.left,\n        y: this.top\n      });\n      var r = this.container.transform.baseVal.getItem(0);\n      r.setRotate(this.rotationAngle, this.centerX, this.centerY), this.container.transform.baseVal.replaceItem(r, 0), this.adjustControlBox(), this._state = \"rotate\";\n    } else this._state = \"move\";\n  }, i.prototype.pointerUp = function (e) {\n    var i = this.state;\n    t.prototype.pointerUp.call(this, e), \"creating\" === this.state && this.width < 10 && this.height < 10 ? (this.width = this.defaultSize.x, this.height = this.defaultSize.y) : this.manipulate(e), this._state = \"select\", \"creating\" === i && this.onMarkerCreated && this.onMarkerCreated(this);\n  }, i.prototype.moveVisual = function (t) {\n    var e = this.visual.transform.baseVal.getItem(0);\n    e.setTranslate(t.x, t.y), this.visual.transform.baseVal.replaceItem(e, 0);\n  }, i.prototype.manipulate = function (t) {\n    var e = this.unrotatePoint(t);\n    \"creating\" === this.state ? this.resize(t) : \"move\" === this.state ? (this.left = this.manipulationStartLeft + (e.x - this.manipulationStartLeft) - this.offsetX, this.top = this.manipulationStartTop + (e.y - this.manipulationStartTop) - this.offsetY, this.moveVisual({\n      x: this.left,\n      y: this.top\n    }), this.adjustControlBox()) : \"resize\" === this.state ? this.resize(e) : \"rotate\" === this.state && this.rotate(t);\n  }, i.prototype.resize = function (t) {\n    var e = this.manipulationStartLeft,\n        i = this.manipulationStartWidth,\n        o = this.manipulationStartTop,\n        s = this.manipulationStartHeight;\n\n    switch (this.activeGrip) {\n      case this.controlGrips.bottomLeft:\n      case this.controlGrips.centerLeft:\n      case this.controlGrips.topLeft:\n        e = this.manipulationStartLeft + t.x - this.manipulationStartX, i = this.manipulationStartWidth + this.manipulationStartLeft - e;\n        break;\n\n      case this.controlGrips.bottomRight:\n      case this.controlGrips.centerRight:\n      case this.controlGrips.topRight:\n      case void 0:\n        i = this.manipulationStartWidth + t.x - this.manipulationStartX;\n    }\n\n    switch (this.activeGrip) {\n      case this.controlGrips.topCenter:\n      case this.controlGrips.topLeft:\n      case this.controlGrips.topRight:\n        o = this.manipulationStartTop + t.y - this.manipulationStartY, s = this.manipulationStartHeight + this.manipulationStartTop - o;\n        break;\n\n      case this.controlGrips.bottomCenter:\n      case this.controlGrips.bottomLeft:\n      case this.controlGrips.bottomRight:\n      case void 0:\n        s = this.manipulationStartHeight + t.y - this.manipulationStartY;\n    }\n\n    i >= 0 ? (this.left = e, this.width = i) : (this.left = e + i, this.width = -i), s >= 0 ? (this.top = o, this.height = s) : (this.top = o + s, this.height = -s), this.setSize();\n  }, i.prototype.setSize = function () {\n    this.moveVisual({\n      x: this.left,\n      y: this.top\n    }), this.adjustControlBox();\n  }, i.prototype.rotate = function (t) {\n    if (Math.abs(t.x - this.centerX) > .1) {\n      var e = Math.sign(t.x - this.centerX);\n      this.rotationAngle = 180 * Math.atan((t.y - this.centerY) / (t.x - this.centerX)) / Math.PI + 90 * e, this.applyRotation();\n    }\n  }, i.prototype.applyRotation = function () {\n    var t = this.container.transform.baseVal.getItem(0);\n    t.setRotate(this.rotationAngle, this.centerX, this.centerY), this.container.transform.baseVal.replaceItem(t, 0);\n  }, i.prototype.rotatePoint = function (t) {\n    if (0 === this.rotationAngle) return t;\n    var e = this.container.getCTM(),\n        i = r.createPoint(t.x, t.y);\n    return {\n      x: (i = i.matrixTransform(e)).x,\n      y: i.y\n    };\n  }, i.prototype.unrotatePoint = function (t) {\n    if (0 === this.rotationAngle) return t;\n    var e = this.container.getCTM();\n    e = e.inverse();\n    var i = r.createPoint(t.x, t.y);\n    return {\n      x: (i = i.matrixTransform(e)).x,\n      y: i.y\n    };\n  }, i.prototype.select = function () {\n    t.prototype.select.call(this), this.adjustControlBox(), this.controlBox.style.display = \"\";\n  }, i.prototype.deselect = function () {\n    t.prototype.deselect.call(this), this.controlBox.style.display = \"none\";\n  }, i.prototype.setupControlBox = function () {\n    this.controlBox = r.createGroup();\n    var t = r.createTransform();\n    t.setTranslate(-this.CB_DISTANCE / 2, -this.CB_DISTANCE / 2), this.controlBox.transform.baseVal.appendItem(t), this.container.appendChild(this.controlBox), this.controlRect = r.createRect(this.width + this.CB_DISTANCE, this.height + this.CB_DISTANCE, [[\"stroke\", \"black\"], [\"stroke-width\", \"1\"], [\"stroke-opacity\", \"0.5\"], [\"stroke-dasharray\", \"3, 2\"], [\"fill\", \"transparent\"], [\"pointer-events\", \"none\"]]), this.controlBox.appendChild(this.controlRect), this.rotatorGripLine = r.createLine((this.width + 2 * this.CB_DISTANCE) / 2, this.top - this.CB_DISTANCE, (this.width + 2 * this.CB_DISTANCE) / 2, this.top - 3 * this.CB_DISTANCE, [[\"stroke\", \"black\"], [\"stroke-width\", \"1\"], [\"stroke-opacity\", \"0.5\"], [\"stroke-dasharray\", \"3, 2\"]]), this.controlBox.appendChild(this.rotatorGripLine), this.controlGrips = new f(), this.addControlGrips(), this.controlBox.style.display = \"none\";\n  }, i.prototype.adjustControlBox = function () {\n    var t = this.controlBox.transform.baseVal.getItem(0);\n    t.setTranslate(this.left - this.CB_DISTANCE / 2, this.top - this.CB_DISTANCE / 2), this.controlBox.transform.baseVal.replaceItem(t, 0), this.controlRect.setAttribute(\"width\", (this.width + this.CB_DISTANCE).toString()), this.controlRect.setAttribute(\"height\", (this.height + this.CB_DISTANCE).toString()), this.rotatorGripLine.setAttribute(\"x1\", ((this.width + this.CB_DISTANCE) / 2).toString()), this.rotatorGripLine.setAttribute(\"y1\", (-this.CB_DISTANCE / 2).toString()), this.rotatorGripLine.setAttribute(\"x2\", ((this.width + this.CB_DISTANCE) / 2).toString()), this.rotatorGripLine.setAttribute(\"y2\", (3 * -this.CB_DISTANCE).toString()), this.positionGrips();\n  }, i.prototype.addControlGrips = function () {\n    this.controlGrips.topLeft = this.createGrip(), this.controlGrips.topCenter = this.createGrip(), this.controlGrips.topRight = this.createGrip(), this.controlGrips.centerLeft = this.createGrip(), this.controlGrips.centerRight = this.createGrip(), this.controlGrips.bottomLeft = this.createGrip(), this.controlGrips.bottomCenter = this.createGrip(), this.controlGrips.bottomRight = this.createGrip(), this.rotatorGrip = this.createGrip(), this.positionGrips();\n  }, i.prototype.createGrip = function () {\n    var t = new m();\n    return t.visual.transform.baseVal.appendItem(r.createTransform()), this.controlBox.appendChild(t.visual), t;\n  }, i.prototype.positionGrips = function () {\n    var t = this.controlGrips.topLeft.GRIP_SIZE,\n        e = -t / 2,\n        i = e,\n        o = (this.width + this.CB_DISTANCE) / 2 - t / 2,\n        s = (this.height + this.CB_DISTANCE) / 2 - t / 2,\n        r = this.height + this.CB_DISTANCE - t / 2,\n        n = this.width + this.CB_DISTANCE - t / 2;\n    this.positionGrip(this.controlGrips.topLeft.visual, e, i), this.positionGrip(this.controlGrips.topCenter.visual, o, i), this.positionGrip(this.controlGrips.topRight.visual, n, i), this.positionGrip(this.controlGrips.centerLeft.visual, e, s), this.positionGrip(this.controlGrips.centerRight.visual, n, s), this.positionGrip(this.controlGrips.bottomLeft.visual, e, r), this.positionGrip(this.controlGrips.bottomCenter.visual, o, r), this.positionGrip(this.controlGrips.bottomRight.visual, n, r), this.positionGrip(this.rotatorGrip.visual, o, i - 3 * this.CB_DISTANCE);\n  }, i.prototype.positionGrip = function (t, e, i) {\n    var o = t.transform.baseVal.getItem(0);\n    o.setTranslate(e, i), t.transform.baseVal.replaceItem(o, 0);\n  }, i.prototype.hideControlBox = function () {\n    this.controlBox.style.display = \"none\";\n  }, i.prototype.showControlBox = function () {\n    this.controlBox.style.display = \"\";\n  }, i.prototype.getState = function () {\n    return Object.assign({\n      left: this.left,\n      top: this.top,\n      width: this.width,\n      height: this.height,\n      rotationAngle: this.rotationAngle,\n      visualTransformMatrix: v.toITransformMatrix(this.visual.transform.baseVal.getItem(0).matrix),\n      containerTransformMatrix: v.toITransformMatrix(this.container.transform.baseVal.getItem(0).matrix)\n    }, t.prototype.getState.call(this));\n  }, i.prototype.restoreState = function (e) {\n    t.prototype.restoreState.call(this, e);\n    var i = e;\n    this.left = i.left, this.top = i.top, this.width = i.width, this.height = i.height, this.rotationAngle = i.rotationAngle, this.visual.transform.baseVal.getItem(0).setMatrix(v.toSVGMatrix(this.visual.transform.baseVal.getItem(0).matrix, i.visualTransformMatrix)), this.container.transform.baseVal.getItem(0).setMatrix(v.toSVGMatrix(this.container.transform.baseVal.getItem(0).matrix, i.containerTransformMatrix));\n  }, i.prototype.scale = function (e, i) {\n    t.prototype.scale.call(this, e, i);\n    var o = this.rotatePoint({\n      x: this.left,\n      y: this.top\n    }),\n        s = this.unrotatePoint({\n      x: o.x * e,\n      y: o.y * i\n    });\n    this.left = s.x, this.top = s.y, this.width = this.width * e, this.height = this.height * i, this.adjustControlBox();\n  }, i;\n}(g),\n    b = function (t) {\n  function i(e, i, o) {\n    var s = t.call(this, e, i, o) || this;\n    return s.fillColor = \"transparent\", s.strokeColor = \"transparent\", s.strokeWidth = 0, s.strokeDasharray = \"\", s.opacity = 1, s.setStrokeColor = s.setStrokeColor.bind(s), s.setFillColor = s.setFillColor.bind(s), s.setStrokeWidth = s.setStrokeWidth.bind(s), s.setStrokeDasharray = s.setStrokeDasharray.bind(s), s.createVisual = s.createVisual.bind(s), s;\n  }\n\n  return e(i, t), i.prototype.ownsTarget = function (e) {\n    return !(!t.prototype.ownsTarget.call(this, e) && e !== this.visual);\n  }, i.prototype.createVisual = function () {\n    this.visual = r.createRect(1, 1, [[\"fill\", this.fillColor], [\"stroke\", this.strokeColor], [\"stroke-width\", this.strokeWidth.toString()], [\"stroke-dasharray\", this.strokeDasharray], [\"opacity\", this.opacity.toString()]]), this.addMarkerVisualToContainer(this.visual);\n  }, i.prototype.pointerDown = function (e, i) {\n    t.prototype.pointerDown.call(this, e, i), \"new\" === this.state && (this.createVisual(), this.moveVisual(e), this._state = \"creating\");\n  }, i.prototype.manipulate = function (e) {\n    t.prototype.manipulate.call(this, e);\n  }, i.prototype.resize = function (e) {\n    t.prototype.resize.call(this, e), this.setSize();\n  }, i.prototype.setSize = function () {\n    t.prototype.setSize.call(this), r.setAttributes(this.visual, [[\"width\", this.width.toString()], [\"height\", this.height.toString()]]);\n  }, i.prototype.pointerUp = function (e) {\n    t.prototype.pointerUp.call(this, e), this.setSize();\n  }, i.prototype.setStrokeColor = function (t) {\n    this.strokeColor = t, this.visual && r.setAttributes(this.visual, [[\"stroke\", this.strokeColor]]);\n  }, i.prototype.setFillColor = function (t) {\n    this.fillColor = t, this.visual && r.setAttributes(this.visual, [[\"fill\", this.fillColor]]);\n  }, i.prototype.setStrokeWidth = function (t) {\n    this.strokeWidth = t, this.visual && r.setAttributes(this.visual, [[\"stroke-width\", this.strokeWidth.toString()]]);\n  }, i.prototype.setStrokeDasharray = function (t) {\n    this.strokeDasharray = t, this.visual && r.setAttributes(this.visual, [[\"stroke-dasharray\", this.strokeDasharray]]);\n  }, i.prototype.getState = function () {\n    return Object.assign({\n      fillColor: this.fillColor,\n      strokeColor: this.strokeColor,\n      strokeWidth: this.strokeWidth,\n      strokeDasharray: this.strokeDasharray,\n      opacity: this.opacity\n    }, t.prototype.getState.call(this));\n  }, i.prototype.restoreState = function (e) {\n    var i = e;\n    this.fillColor = i.fillColor, this.strokeColor = i.strokeColor, this.strokeWidth = i.strokeWidth, this.strokeDasharray = i.strokeDasharray, this.opacity = i.opacity, this.createVisual(), t.prototype.restoreState.call(this, e), this.setSize();\n  }, i.prototype.scale = function (e, i) {\n    t.prototype.scale.call(this, e, i), this.setSize();\n  }, i.title = \"Rectangle marker\", i;\n}(C),\n    w = function (t) {\n  function i(e, i, o, s) {\n    var r = t.call(this, e, s || '<svg viewBox=\"0 0 24 24\"><path d=\"M3 17h18v-2H3v2m0 3h18v-1H3v1m0-7h18v-3H3v3m0-9v4h18V4H3z\"/></svg>') || this;\n    return r.widths = [], r.widthBoxes = [], r.widths = i, r.currentWidth = o, r.setCurrentWidth = r.setCurrentWidth.bind(r), r;\n  }\n\n  return e(i, t), i.prototype.getUi = function () {\n    var t = this,\n        e = document.createElement(\"div\");\n    return e.style.display = \"flex\", e.style.overflow = \"hidden\", e.style.flexGrow = \"2\", this.widths.forEach(function (i) {\n      var o = document.createElement(\"div\");\n      o.style.display = \"flex\", o.style.flexGrow = \"2\", o.style.alignItems = \"center\", o.style.justifyContent = \"space-between\", o.style.padding = \"5px\", o.style.borderWidth = \"2px\", o.style.borderStyle = \"solid\", o.style.borderColor = i === t.currentWidth ? l.settings.toolboxAccentColor : \"transparent\", o.addEventListener(\"click\", function () {\n        t.setCurrentWidth(i, o);\n      }), e.appendChild(o);\n      var s = document.createElement(\"div\");\n      s.innerText = i.toString(), s.style.marginRight = \"5px\", o.appendChild(s);\n      var r = document.createElement(\"div\");\n      r.style.minHeight = \"20px\", r.style.flexGrow = \"2\", r.style.display = \"flex\", r.style.alignItems = \"center\";\n      var n = document.createElement(\"hr\");\n      n.style.minWidth = \"20px\", n.style.border = \"0px\", n.style.borderTop = i + \"px solid \" + l.settings.toolboxColor, n.style.flexGrow = \"2\", r.appendChild(n), o.appendChild(r), t.widthBoxes.push(o);\n    }), e;\n  }, i.prototype.setCurrentWidth = function (t, e) {\n    this.currentWidth = t, this.widthBoxes.forEach(function (t) {\n      t.style.borderColor = t === e ? l.settings.toolboxAccentColor : \"transparent\";\n    }), this.onWidthChanged && this.onWidthChanged(this.currentWidth);\n  }, i;\n}(u),\n    S = function (t) {\n  function i(e, i, o, s) {\n    var r = t.call(this, e, s || '<svg viewBox=\"0 0 24 24\"><path d=\"M3 16h5v-2H3v2m6.5 0h5v-2h-5v2m6.5 0h5v-2h-5v2M3 20h2v-2H3v2m4 0h2v-2H7v2m4 0h2v-2h-2v2m4 0h2v-2h-2v2m4 0h2v-2h-2v2M3 12h8v-2H3v2m10 0h8v-2h-8v2M3 4v4h18V4H3z\"/></svg>') || this;\n    return r.styles = [], r.styleBoxes = [], r.styles = i, r.currentStyle = o, r.setCurrentStyle = r.setCurrentStyle.bind(r), r;\n  }\n\n  return e(i, t), i.prototype.getUi = function () {\n    var t = this,\n        e = document.createElement(\"div\");\n    return e.style.display = \"flex\", e.style.overflow = \"hidden\", e.style.flexGrow = \"2\", this.styles.forEach(function (i) {\n      var o = document.createElement(\"div\");\n      o.style.display = \"flex\", o.style.alignItems = \"center\", o.style.justifyContent = \"space-between\", o.style.padding = \"5px\", o.style.borderWidth = \"2px\", o.style.borderStyle = \"solid\", o.style.overflow = \"hidden\", o.style.maxWidth = 100 / t.styles.length - 5 + \"%\", o.style.borderColor = i === t.currentStyle ? l.settings.toolboxAccentColor : \"transparent\", o.addEventListener(\"click\", function () {\n        t.setCurrentStyle(i, o);\n      }), e.appendChild(o);\n      var s = document.createElement(\"div\");\n      s.style.minHeight = \"20px\", s.style.flexGrow = \"2\", s.style.overflow = \"hidden\";\n      var r = '<svg width=\"100\" height=\"20\">\\n      <line x1=\"0\" y1=\"10\" x2=\"100\" y2=\"10\" stroke=\"' + l.settings.toolboxColor + '\" stroke-width=\"3\" ' + (\"\" !== i ? 'stroke-dasharray=\"' + i + '\"' : \"\") + \" />\\n  </svg>\";\n      s.innerHTML = r, o.appendChild(s), t.styleBoxes.push(o);\n    }), e;\n  }, i.prototype.setCurrentStyle = function (t, e) {\n    this.currentStyle = t, this.styleBoxes.forEach(function (t) {\n      t.style.borderColor = t === e ? l.settings.toolboxAccentColor : \"transparent\";\n    }), this.onStyleChanged && this.onStyleChanged(this.currentStyle);\n  }, i;\n}(u),\n    x = function (t) {\n  function i(e, i, o) {\n    var s = t.call(this, e, i, o) || this;\n    return s.strokeColor = o.defaultColor, s.strokeWidth = o.defaultStrokeWidth, s.strokeDasharray = o.defaultStrokeDasharray, s.strokePanel = new y(\"Line color\", o.defaultColorSet, o.defaultColor), s.strokePanel.onColorChanged = s.setStrokeColor, s.strokeWidthPanel = new w(\"Line width\", o.defaultStrokeWidths, o.defaultStrokeWidth), s.strokeWidthPanel.onWidthChanged = s.setStrokeWidth, s.strokeStylePanel = new S(\"Line style\", o.defaultStrokeDasharrays, o.defaultStrokeDasharray), s.strokeStylePanel.onStyleChanged = s.setStrokeDasharray, s;\n  }\n\n  return e(i, t), Object.defineProperty(i.prototype, \"toolboxPanels\", {\n    get: function () {\n      return [this.strokePanel, this.strokeWidthPanel, this.strokeStylePanel];\n    },\n    enumerable: !1,\n    configurable: !0\n  }), i.prototype.getState = function () {\n    var e = t.prototype.getState.call(this);\n    return e.typeName = i.typeName, e;\n  }, i.typeName = \"FrameMarker\", i.title = \"Frame marker\", i.icon = '<svg viewBox=\"0 0 24 24\"><path d=\"M4 6v13h16V6H4m14 11H6V8h12v9z\"/></svg>', i;\n}(b),\n    k = function () {\n  this.defaultColorSet = [\"#EF4444\", \"#10B981\", \"#2563EB\", \"#FFFF00\", \"#7C3AED\", \"#F472B6\", \"#000000\", \"#FFFFFF\"], this.defaultColor = this.defaultColorSet[0], this.defaultFillColor = this.defaultColorSet[0], this.defaultStrokeColor = this.defaultColorSet[7], this.defaultHighlightColor = this.defaultColorSet[3], this.defaultStrokeWidth = 3, this.defaultStrokeDasharray = \"\", this.defaultHighlightOpacity = .5, this.defaultFontFamily = \"Helvetica, Arial, sans-serif\", this.defaultStrokeWidths = [1, 2, 3, 5, 10], this.defaultStrokeDasharrays = [\"\", \"3\", \"12 3\", \"9 6 3 6\"], this.defaultOpacitySteps = [.1, .25, .5, .75, 1], this.displayMode = \"inline\", this.defaultFontFamilies = ['Times, \"Times New Roman\", serif', \"Helvetica, Arial, sans-serif\", 'Courier, \"Courier New\", monospace', \"cursive\", \"fantasy\"], this.popupMargin = 30, this.newFreehandMarkerOnPointerUp = !1;\n},\n    B = function (t) {\n  function i(e, i, o) {\n    var s = t.call(this, e, i, o) || this;\n    return s.x1 = 0, s.y1 = 0, s.x2 = 0, s.y2 = 0, s.defaultLength = 50, s.manipulationStartX = 0, s.manipulationStartY = 0, s.manipulationStartX1 = 0, s.manipulationStartY1 = 0, s.manipulationStartX2 = 0, s.manipulationStartY2 = 0, s.setupControlBox(), s;\n  }\n\n  return e(i, t), i.prototype.ownsTarget = function (e) {\n    return !!t.prototype.ownsTarget.call(this, e) || !(!this.grip1.ownsTarget(e) && !this.grip2.ownsTarget(e));\n  }, i.prototype.pointerDown = function (e, i) {\n    t.prototype.pointerDown.call(this, e, i), this.manipulationStartX = e.x, this.manipulationStartY = e.y, \"new\" === this.state && (this.x1 = e.x, this.y1 = e.y, this.x2 = e.x, this.y2 = e.y), this.manipulationStartX1 = this.x1, this.manipulationStartY1 = this.y1, this.manipulationStartX2 = this.x2, this.manipulationStartY2 = this.y2, \"new\" !== this.state && (this.select(), this.grip1.ownsTarget(i) ? this.activeGrip = this.grip1 : this.grip2.ownsTarget(i) ? this.activeGrip = this.grip2 : this.activeGrip = void 0, this.activeGrip ? this._state = \"resize\" : this._state = \"move\");\n  }, i.prototype.pointerUp = function (e) {\n    var i = this.state;\n    t.prototype.pointerUp.call(this, e), \"creating\" === this.state && Math.abs(this.x1 - this.x2) < 10 && Math.abs(this.y1 - this.y2) < 10 ? (this.x2 = this.x1 + this.defaultLength, this.adjustVisual(), this.adjustControlBox()) : this.manipulate(e), this._state = \"select\", \"creating\" === i && this.onMarkerCreated && this.onMarkerCreated(this);\n  }, i.prototype.adjustVisual = function () {}, i.prototype.manipulate = function (t) {\n    \"creating\" === this.state ? this.resize(t) : \"move\" === this.state ? (this.x1 = this.manipulationStartX1 + t.x - this.manipulationStartX, this.y1 = this.manipulationStartY1 + t.y - this.manipulationStartY, this.x2 = this.manipulationStartX2 + t.x - this.manipulationStartX, this.y2 = this.manipulationStartY2 + t.y - this.manipulationStartY, this.adjustVisual(), this.adjustControlBox()) : \"resize\" === this.state && this.resize(t);\n  }, i.prototype.resize = function (t) {\n    switch (this.activeGrip) {\n      case this.grip1:\n        this.x1 = t.x, this.y1 = t.y;\n        break;\n\n      case this.grip2:\n      case void 0:\n        this.x2 = t.x, this.y2 = t.y;\n    }\n\n    this.adjustVisual(), this.adjustControlBox();\n  }, i.prototype.select = function () {\n    t.prototype.select.call(this), this.adjustControlBox(), this.controlBox.style.display = \"\";\n  }, i.prototype.deselect = function () {\n    t.prototype.deselect.call(this), this.controlBox.style.display = \"none\";\n  }, i.prototype.setupControlBox = function () {\n    this.controlBox = r.createGroup(), this.container.appendChild(this.controlBox), this.addControlGrips(), this.controlBox.style.display = \"none\";\n  }, i.prototype.adjustControlBox = function () {\n    this.positionGrips();\n  }, i.prototype.addControlGrips = function () {\n    this.grip1 = this.createGrip(), this.grip2 = this.createGrip(), this.positionGrips();\n  }, i.prototype.createGrip = function () {\n    var t = new m();\n    return t.visual.transform.baseVal.appendItem(r.createTransform()), this.controlBox.appendChild(t.visual), t;\n  }, i.prototype.positionGrips = function () {\n    var t = this.grip1.GRIP_SIZE;\n    this.positionGrip(this.grip1.visual, this.x1 - t / 2, this.y1 - t / 2), this.positionGrip(this.grip2.visual, this.x2 - t / 2, this.y2 - t / 2);\n  }, i.prototype.positionGrip = function (t, e, i) {\n    var o = t.transform.baseVal.getItem(0);\n    o.setTranslate(e, i), t.transform.baseVal.replaceItem(o, 0);\n  }, i.prototype.getState = function () {\n    return Object.assign({\n      x1: this.x1,\n      y1: this.y1,\n      x2: this.x2,\n      y2: this.y2\n    }, t.prototype.getState.call(this));\n  }, i.prototype.restoreState = function (e) {\n    t.prototype.restoreState.call(this, e);\n    var i = e;\n    this.x1 = i.x1, this.y1 = i.y1, this.x2 = i.x2, this.y2 = i.y2;\n  }, i.prototype.scale = function (e, i) {\n    t.prototype.scale.call(this, e, i), this.x1 = this.x1 * e, this.y1 = this.y1 * i, this.x2 = this.x2 * e, this.y2 = this.y2 * i, this.adjustVisual(), this.adjustControlBox();\n  }, i;\n}(g),\n    T = function (t) {\n  function i(e, i, o) {\n    var s = t.call(this, e, i, o) || this;\n    return s.strokeColor = \"transparent\", s.strokeWidth = 0, s.strokeDasharray = \"\", s.setStrokeColor = s.setStrokeColor.bind(s), s.setStrokeWidth = s.setStrokeWidth.bind(s), s.setStrokeDasharray = s.setStrokeDasharray.bind(s), s.strokeColor = o.defaultColor, s.strokeWidth = o.defaultStrokeWidth, s.strokeDasharray = o.defaultStrokeDasharray, s.strokePanel = new y(\"Line color\", o.defaultColorSet, o.defaultColor), s.strokePanel.onColorChanged = s.setStrokeColor, s.strokeWidthPanel = new w(\"Line width\", o.defaultStrokeWidths, o.defaultStrokeWidth), s.strokeWidthPanel.onWidthChanged = s.setStrokeWidth, s.strokeStylePanel = new S(\"Line style\", o.defaultStrokeDasharrays, o.defaultStrokeDasharray), s.strokeStylePanel.onStyleChanged = s.setStrokeDasharray, s;\n  }\n\n  return e(i, t), i.prototype.ownsTarget = function (e) {\n    return !(!t.prototype.ownsTarget.call(this, e) && e !== this.visual && e !== this.selectorLine && e !== this.visibleLine);\n  }, i.prototype.createVisual = function () {\n    this.visual = r.createGroup(), this.selectorLine = r.createLine(this.x1, this.y1, this.x2, this.y2, [[\"stroke\", \"transparent\"], [\"stroke-width\", (this.strokeWidth + 10).toString()]]), this.visibleLine = r.createLine(this.x1, this.y1, this.x2, this.y2, [[\"stroke\", this.strokeColor], [\"stroke-width\", this.strokeWidth.toString()]]), this.visual.appendChild(this.selectorLine), this.visual.appendChild(this.visibleLine), this.addMarkerVisualToContainer(this.visual);\n  }, i.prototype.pointerDown = function (e, i) {\n    t.prototype.pointerDown.call(this, e, i), \"new\" === this.state && (this.createVisual(), this.adjustVisual(), this._state = \"creating\");\n  }, i.prototype.adjustVisual = function () {\n    this.selectorLine.setAttribute(\"x1\", this.x1.toString()), this.selectorLine.setAttribute(\"y1\", this.y1.toString()), this.selectorLine.setAttribute(\"x2\", this.x2.toString()), this.selectorLine.setAttribute(\"y2\", this.y2.toString()), this.visibleLine.setAttribute(\"x1\", this.x1.toString()), this.visibleLine.setAttribute(\"y1\", this.y1.toString()), this.visibleLine.setAttribute(\"x2\", this.x2.toString()), this.visibleLine.setAttribute(\"y2\", this.y2.toString()), r.setAttributes(this.visibleLine, [[\"stroke\", this.strokeColor]]), r.setAttributes(this.visibleLine, [[\"stroke-width\", this.strokeWidth.toString()]]), r.setAttributes(this.visibleLine, [[\"stroke-dasharray\", this.strokeDasharray.toString()]]);\n  }, i.prototype.setStrokeColor = function (t) {\n    this.strokeColor = t, this.adjustVisual();\n  }, i.prototype.setStrokeWidth = function (t) {\n    this.strokeWidth = t, this.adjustVisual();\n  }, i.prototype.setStrokeDasharray = function (t) {\n    this.strokeDasharray = t, this.adjustVisual();\n  }, Object.defineProperty(i.prototype, \"toolboxPanels\", {\n    get: function () {\n      return [this.strokePanel, this.strokeWidthPanel, this.strokeStylePanel];\n    },\n    enumerable: !1,\n    configurable: !0\n  }), i.prototype.getState = function () {\n    var e = Object.assign({\n      strokeColor: this.strokeColor,\n      strokeWidth: this.strokeWidth,\n      strokeDasharray: this.strokeDasharray\n    }, t.prototype.getState.call(this));\n    return e.typeName = i.typeName, e;\n  }, i.prototype.restoreState = function (e) {\n    t.prototype.restoreState.call(this, e);\n    var i = e;\n    this.strokeColor = i.strokeColor, this.strokeWidth = i.strokeWidth, this.strokeDasharray = i.strokeDasharray, this.createVisual(), this.adjustVisual();\n  }, i.typeName = \"LineMarker\", i.title = \"Line marker\", i.icon = '<svg viewBox=\"0 0 24 24\"><path d=\"M19 13H5v-2h14v2z\"/></svg>', i;\n}(B),\n    M = function (t) {\n  function i(e, i, o, s) {\n    var r = t.call(this, e, s || '<svg viewBox=\"0 0 24 24\"><path d=\"M17 8h3v12h1v1h-4v-1h1v-3h-4l-1.5 3H14v1h-4v-1h1l6-12m1 1l-3.5 7H18V9M5 3h5c1.11 0 2 .89 2 2v11H9v-5H6v5H3V5c0-1.11.89-2 2-2m1 2v4h3V5H6z\"/></svg>') || this;\n    return r.fonts = [], r.fontBoxes = [], r.fonts = i, r.currentFont = o, r.setCurrentFont = r.setCurrentFont.bind(r), r;\n  }\n\n  return e(i, t), i.prototype.getUi = function () {\n    var t = this,\n        e = document.createElement(\"div\");\n    return e.style.overflow = \"hidden\", e.style.flexGrow = \"2\", this.fonts.forEach(function (i) {\n      var o = document.createElement(\"div\");\n      o.style.display = \"inline-block\", o.style.alignItems = \"center\", o.style.justifyContent = \"space-between\", o.style.padding = \"5px\", o.style.borderWidth = \"2px\", o.style.borderStyle = \"solid\", o.style.overflow = \"hidden\", o.style.maxWidth = 100 / t.fonts.length - 5 + \"%\", o.style.borderColor = i === t.currentFont ? l.settings.toolboxAccentColor : \"transparent\", o.addEventListener(\"click\", function () {\n        t.setCurrentFont(i, o);\n      }), e.appendChild(o);\n      var s = document.createElement(\"div\");\n      s.style.display = \"flex\", s.style.minHeight = \"20px\", s.style.flexGrow = \"2\", s.style.fontFamily = i, s.style.overflow = \"hidden\";\n      var r = document.createElement(\"div\");\n      r.style.whiteSpace = \"nowrap\", r.style.overflow = \"hidden\", r.style.textOverflow = \"ellipsis\", r.innerHTML = \"The quick brown fox jumps over the lazy dog\", s.appendChild(r), o.appendChild(s), t.fontBoxes.push(o);\n    }), e;\n  }, i.prototype.setCurrentFont = function (t, e) {\n    this.currentFont = t, this.fontBoxes.forEach(function (t) {\n      t.style.borderColor = t === e ? l.settings.toolboxAccentColor : \"transparent\";\n    }), this.onFontChanged && this.onFontChanged(this.currentFont);\n  }, i;\n}(u),\n    E = function (t) {\n  function i(e, i, o) {\n    var s = t.call(this, e, i, o) || this;\n    return s.color = \"transparent\", s.padding = 5, s.DEFAULT_TEXT = \"your text here\", s.text = s.DEFAULT_TEXT, s.isMoved = !1, s.color = o.defaultColor, s.fontFamily = o.defaultFontFamily, s.defaultSize = {\n      x: 100,\n      y: 30\n    }, s.setColor = s.setColor.bind(s), s.setFont = s.setFont.bind(s), s.renderText = s.renderText.bind(s), s.sizeText = s.sizeText.bind(s), s.textEditDivClicked = s.textEditDivClicked.bind(s), s.showTextEditor = s.showTextEditor.bind(s), s.setSize = s.setSize.bind(s), s.positionTextEditor = s.positionTextEditor.bind(s), s.colorPanel = new y(\"Color\", o.defaultColorSet, o.defaultColor), s.colorPanel.onColorChanged = s.setColor, s.fontFamilyPanel = new M(\"Font\", o.defaultFontFamilies, o.defaultFontFamily), s.fontFamilyPanel.onFontChanged = s.setFont, s;\n  }\n\n  return e(i, t), i.prototype.ownsTarget = function (e) {\n    if (t.prototype.ownsTarget.call(this, e) || e === this.visual || e === this.textElement || e === this.bgRectangle) return !0;\n    var i = !1;\n    return this.textElement.childNodes.forEach(function (t) {\n      t === e && (i = !0);\n    }), i;\n  }, i.prototype.createVisual = function () {\n    this.visual = r.createGroup(), this.bgRectangle = r.createRect(1, 1, [[\"fill\", \"transparent\"]]), this.visual.appendChild(this.bgRectangle), this.textElement = r.createText([[\"fill\", this.color], [\"font-family\", this.fontFamily], [\"font-size\", \"16px\"], [\"x\", \"0\"], [\"y\", \"0\"]]), this.textElement.transform.baseVal.appendItem(r.createTransform()), this.textElement.transform.baseVal.appendItem(r.createTransform()), this.visual.appendChild(this.textElement), this.addMarkerVisualToContainer(this.visual), this.renderText();\n  }, i.prototype.pointerDown = function (e, i) {\n    t.prototype.pointerDown.call(this, e, i), this.isMoved = !1, this.pointerDownPoint = e, this.pointerDownTimestamp = Date.now(), \"new\" === this.state && (this.createVisual(), this.moveVisual(e), this._state = \"creating\");\n  }, i.prototype.renderText = function () {\n    for (var t = this; this.textElement.lastChild;) this.textElement.removeChild(this.textElement.lastChild);\n\n    this.text.split(/\\r\\n|[\\n\\v\\f\\r\\x85\\u2028\\u2029]/).forEach(function (e) {\n      \"\" === e.trim() && (e = \" \"), t.textElement.appendChild(r.createTSpan(e, [[\"x\", \"0\"], [\"dy\", \"1.2em\"]]));\n    }), setTimeout(this.sizeText, 10);\n  }, i.prototype.getTextScale = function () {\n    var t = this.textElement.getBBox(),\n        e = 1;\n\n    if (t.width > 0 && t.height > 0) {\n      var i = (1 * this.width - this.width * this.padding * 2 / 100) / t.width,\n          o = (1 * this.height - this.height * this.padding * 2 / 100) / t.height;\n      e = Math.min(i, o);\n    }\n\n    return e;\n  }, i.prototype.getTextPosition = function (t) {\n    var e = this.textElement.getBBox(),\n        i = 0,\n        o = 0;\n    return e.width > 0 && e.height > 0 && (i = (this.width - e.width * t) / 2, o = this.height / 2 - e.height * t / 2), {\n      x: i,\n      y: o\n    };\n  }, i.prototype.sizeText = function () {\n    var t = this.textElement.getBBox(),\n        e = this.getTextScale(),\n        i = this.getTextPosition(e);\n    i.y -= t.y * e, this.textElement.transform.baseVal.getItem(0).setTranslate(i.x, i.y), this.textElement.transform.baseVal.getItem(1).setScale(e, e);\n  }, i.prototype.manipulate = function (e) {\n    t.prototype.manipulate.call(this, e), void 0 !== this.pointerDownPoint && (this.isMoved = Math.abs(e.x - this.pointerDownPoint.x) > 5 || Math.abs(e.y - this.pointerDownPoint.y) > 5);\n  }, i.prototype.resize = function (e) {\n    t.prototype.resize.call(this, e), this.isMoved = !0, this.setSize(), this.sizeText();\n  }, i.prototype.setSize = function () {\n    t.prototype.setSize.call(this), r.setAttributes(this.visual, [[\"width\", this.width.toString()], [\"height\", this.height.toString()]]), r.setAttributes(this.bgRectangle, [[\"width\", this.width.toString()], [\"height\", this.height.toString()]]);\n  }, i.prototype.pointerUp = function (e) {\n    var i = this.state;\n    t.prototype.pointerUp.call(this, e), this.setSize(), (\"creating\" === i || !this.isMoved && Date.now() - this.pointerDownTimestamp > 500) && this.showTextEditor(), this.pointerDownPoint = void 0;\n  }, i.prototype.showTextEditor = function () {\n    var t = this;\n    this._state = \"edit\", this.overlayContainer.innerHTML = \"\", this.textEditDiv = document.createElement(\"div\"), this.textEditDiv.style.flexGrow = \"2\", this.textEditDiv.style.alignItems = \"center\", this.textEditDiv.style.justifyContent = \"center\", this.textEditDiv.style.pointerEvents = \"auto\", this.textEditDiv.style.overflow = \"hidden\", this.textEditor = document.createElement(\"div\"), this.textEditor.style.position = \"absolute\", this.textEditor.style.fontFamily = this.fontFamily, this.textEditor.style.lineHeight = \"1em\", this.textEditor.innerText = this.text, this.textEditor.contentEditable = \"true\", this.textEditor.style.color = this.color, this.positionTextEditor(), this.textEditor.addEventListener(\"pointerup\", function (t) {\n      t.stopPropagation();\n    }), this.textEditor.addEventListener(\"input\", function () {\n      for (var e = Number.parseFloat(t.textEditor.style.fontSize); t.textEditor.clientWidth >= Number.parseInt(t.textEditor.style.maxWidth) && e > .9;) e -= .1, t.textEditor.style.fontSize = Math.max(e, .9) + \"em\";\n    }), this.textEditor.addEventListener(\"keyup\", function (t) {\n      t.cancelBubble = !0;\n    }), this.textEditDiv.addEventListener(\"pointerup\", function () {\n      t.textEditDivClicked(t.textEditor.innerText);\n    }), this.textEditDiv.appendChild(this.textEditor), this.overlayContainer.appendChild(this.textEditDiv), this.hideVisual(), this.textEditor.focus(), document.execCommand(\"selectAll\");\n  }, i.prototype.positionTextEditor = function () {\n    if (\"edit\" === this.state) {\n      this.textElement.style.display = \"\";\n      var t = this.getTextScale(),\n          e = this.rotatePoint({\n        x: this.left + this.width / 2,\n        y: this.top + this.height / 2\n      }),\n          i = this.textElement.getBBox(),\n          o = {\n        x: i.width * t,\n        y: i.height * t\n      };\n      e.x -= o.x / 2, e.y -= o.y / 2, this.textEditor.style.top = e.y + \"px\", this.textEditor.style.left = e.x + \"px\", this.textEditor.style.maxWidth = this.overlayContainer.offsetWidth - e.x + \"px\", this.textEditor.style.fontSize = Math.max(16 * t, 12) + \"px\", this.textElement.style.display = \"none\";\n    }\n  }, i.prototype.textEditDivClicked = function (t) {\n    this.text = t, this.overlayContainer.innerHTML = \"\", this.renderText(), this.showVisual();\n  }, i.prototype.deselect = function () {\n    \"edit\" === this.state && this.textEditDivClicked(this.textEditor.innerText), t.prototype.deselect.call(this);\n  }, i.prototype.dblClick = function (e, i) {\n    t.prototype.dblClick.call(this, e, i), this.showTextEditor();\n  }, i.prototype.setColor = function (t) {\n    r.setAttributes(this.textElement, [[\"fill\", t]]), this.color = t, this.textEditor && (this.textEditor.style.color = this.color);\n  }, i.prototype.setFont = function (t) {\n    r.setAttributes(this.textElement, [[\"font-family\", t]]), this.fontFamily = t, this.textEditor && (this.textEditor.style.fontFamily = this.fontFamily), this.renderText();\n  }, i.prototype.hideVisual = function () {\n    this.textElement.style.display = \"none\", this.hideControlBox();\n  }, i.prototype.showVisual = function () {\n    \"edit\" === this.state && (this._state = \"select\"), this.textElement.style.display = \"\", this.showControlBox();\n  }, Object.defineProperty(i.prototype, \"toolboxPanels\", {\n    get: function () {\n      return [this.colorPanel, this.fontFamilyPanel];\n    },\n    enumerable: !1,\n    configurable: !0\n  }), i.prototype.getState = function () {\n    var e = Object.assign({\n      color: this.color,\n      fontFamily: this.fontFamily,\n      padding: this.padding,\n      text: this.text\n    }, t.prototype.getState.call(this));\n    return e.typeName = i.typeName, e;\n  }, i.prototype.restoreState = function (e) {\n    var i = e;\n    this.color = i.color, this.fontFamily = i.fontFamily, this.padding = i.padding, this.text = i.text, this.createVisual(), t.prototype.restoreState.call(this, e), this.setSize();\n  }, i.prototype.scale = function (e, i) {\n    t.prototype.scale.call(this, e, i), this.setSize(), this.sizeText(), this.positionTextEditor();\n  }, i.typeName = \"TextMarker\", i.title = \"Text marker\", i.icon = '<svg viewBox=\"0 0 24 24\"><path d=\"M9.6 14L12 7.7l2.4 6.3M11 5L5.5 19h2.2l1.1-3H15l1.1 3h2.2L13 5h-2z\"/></svg>', i;\n}(C),\n    P = function (t) {\n  function i(e, i, o) {\n    var s = t.call(this, e, i, o) || this;\n    return s.color = \"transparent\", s.lineWidth = 3, s.drawing = !1, s.color = o.defaultColor, s.setColor = s.setColor.bind(s), s.addCanvas = s.addCanvas.bind(s), s.finishCreation = s.finishCreation.bind(s), s.colorPanel = new y(\"Color\", o.defaultColorSet, o.defaultColor), s.colorPanel.onColorChanged = s.setColor, s;\n  }\n\n  return e(i, t), i.prototype.ownsTarget = function (e) {\n    return !(!t.prototype.ownsTarget.call(this, e) && e !== this.visual && e !== this.drawingImage);\n  }, i.prototype.createVisual = function () {\n    this.visual = r.createGroup(), this.drawingImage = r.createImage(), this.visual.appendChild(this.drawingImage);\n    var t = r.createTransform();\n    this.visual.transform.baseVal.appendItem(t), this.addMarkerVisualToContainer(this.visual);\n  }, i.prototype.pointerDown = function (e, i) {\n    \"new\" === this.state && (this.addCanvas(), this.createVisual(), this._state = \"creating\"), \"creating\" === this.state ? (this.canvasContext.strokeStyle = this.color, this.canvasContext.lineWidth = this.lineWidth, this.canvasContext.beginPath(), this.canvasContext.moveTo(e.x, e.y), this.drawing = !0) : t.prototype.pointerDown.call(this, e, i);\n  }, i.prototype.manipulate = function (e) {\n    \"creating\" === this.state ? this.drawing && (this.canvasContext.lineTo(e.x, e.y), this.canvasContext.stroke()) : t.prototype.manipulate.call(this, e);\n  }, i.prototype.resize = function (e) {\n    t.prototype.resize.call(this, e), r.setAttributes(this.visual, [[\"width\", this.width.toString()], [\"height\", this.height.toString()]]), r.setAttributes(this.drawingImage, [[\"width\", this.width.toString()], [\"height\", this.height.toString()]]);\n  }, i.prototype.pointerUp = function (e) {\n    \"creating\" === this._state ? this.drawing && (this.canvasContext.closePath(), this.drawing = !1, this.globalSettings.newFreehandMarkerOnPointerUp && this.finishCreation()) : t.prototype.pointerUp.call(this, e);\n  }, i.prototype.addCanvas = function () {\n    this.overlayContainer.innerHTML = \"\", this.canvasElement = document.createElement(\"canvas\"), this.canvasElement.width = this.overlayContainer.clientWidth, this.canvasElement.height = this.overlayContainer.clientHeight, this.canvasContext = this.canvasElement.getContext(\"2d\"), this.overlayContainer.appendChild(this.canvasElement);\n  }, i.prototype.select = function () {\n    \"creating\" === this.state && this.finishCreation(), t.prototype.select.call(this);\n  }, i.prototype.deselect = function () {\n    \"creating\" === this.state && this.finishCreation(), t.prototype.deselect.call(this);\n  }, i.prototype.finishCreation = function () {\n    for (var t = this.canvasContext.getImageData(0, 0, this.canvasElement.width, this.canvasElement.height), e = [this.canvasElement.width + 1, this.canvasElement.height + 1, -1, -1], i = e[0], o = e[1], s = e[2], r = e[3], n = !1, a = 0; a < this.canvasElement.height; a++) for (var l = 0; l < this.canvasElement.width; l++) {\n      t.data[a * this.canvasElement.width * 4 + 4 * l + 3] > 0 && (n = !0, a < o && (o = a), l < i && (i = l), a > r && (r = a), l > s && (s = l));\n    }\n\n    if (n) {\n      this.left = i, this.top = o, this.width = s - i, this.height = r - o;\n      var h = document.createElement(\"canvas\");\n      h.width = this.width, h.height = this.height, h.getContext(\"2d\").putImageData(this.canvasContext.getImageData(i, o, s - i, r - o), 0, 0), this.drawingImgUrl = h.toDataURL(\"image/png\"), this.setDrawingImage(), this._state = \"select\", this.onMarkerCreated && this.onMarkerCreated(this);\n    }\n\n    this.overlayContainer.innerHTML = \"\";\n  }, i.prototype.setDrawingImage = function () {\n    r.setAttributes(this.drawingImage, [[\"width\", this.width.toString()], [\"height\", this.height.toString()]]), r.setAttributes(this.drawingImage, [[\"href\", this.drawingImgUrl]]), this.moveVisual({\n      x: this.left,\n      y: this.top\n    });\n  }, i.prototype.setColor = function (t) {\n    this.color = t;\n  }, Object.defineProperty(i.prototype, \"toolboxPanels\", {\n    get: function () {\n      return \"new\" === this.state || \"creating\" === this.state ? [this.colorPanel] : [];\n    },\n    enumerable: !1,\n    configurable: !0\n  }), i.prototype.getState = function () {\n    var e = Object.assign({\n      drawingImgUrl: this.drawingImgUrl\n    }, t.prototype.getState.call(this));\n    return e.typeName = i.typeName, e;\n  }, i.prototype.restoreState = function (e) {\n    this.createVisual(), t.prototype.restoreState.call(this, e), this.drawingImgUrl = e.drawingImgUrl, this.setDrawingImage();\n  }, i.prototype.scale = function (e, i) {\n    t.prototype.scale.call(this, e, i), this.setDrawingImage();\n  }, i.typeName = \"FreehandMarker\", i.title = \"Freehand marker\", i.icon = '<svg viewBox=\"0 0 24 24\"><path d=\"M9.75 20.85c1.78-.7 1.39-2.63.49-3.85-.89-1.25-2.12-2.11-3.36-2.94A9.817 9.817 0 014.54 12c-.28-.33-.85-.94-.27-1.06.59-.12 1.61.46 2.13.68.91.38 1.81.82 2.65 1.34l1.01-1.7C8.5 10.23 6.5 9.32 4.64 9.05c-1.06-.16-2.18.06-2.54 1.21-.32.99.19 1.99.77 2.77 1.37 1.83 3.5 2.71 5.09 4.29.34.33.75.72.95 1.18.21.44.16.47-.31.47-1.24 0-2.79-.97-3.8-1.61l-1.01 1.7c1.53.94 4.09 2.41 5.96 1.79m11.09-15.6c.22-.22.22-.58 0-.79l-1.3-1.3a.562.562 0 00-.78 0l-1.02 1.02 2.08 2.08M11 10.92V13h2.08l6.15-6.15-2.08-2.08L11 10.92z\"/></svg>', i;\n}(C),\n    L = function (t) {\n  function i(e, i, o) {\n    var s = t.call(this, e, o || '<svg viewBox=\"0 0 24 24\"><path d=\"M8 14v4l-6-6 6-6v4h8V6l6 6-6 6v-4H8z\"/></svg>') || this;\n    return s.typeBoxes = [], s.currentType = i, s.setCurrentType = s.setCurrentType.bind(s), s;\n  }\n\n  return e(i, t), i.prototype.getUi = function () {\n    var t = this,\n        e = document.createElement(\"div\");\n    e.style.display = \"flex\", e.style.overflow = \"hidden\", e.style.flexGrow = \"2\";\n\n    for (var i = function (i) {\n      var s = \"both\";\n\n      switch (i) {\n        case 0:\n          s = \"both\";\n          break;\n\n        case 1:\n          s = \"start\";\n          break;\n\n        case 2:\n          s = \"end\";\n          break;\n\n        case 3:\n          s = \"none\";\n      }\n\n      var r = document.createElement(\"div\");\n\n      if (r.style.display = \"flex\", r.style.flexGrow = \"2\", r.style.alignItems = \"center\", r.style.justifyContent = \"space-between\", r.style.padding = \"5px\", r.style.borderWidth = \"2px\", r.style.borderStyle = \"solid\", r.style.borderColor = s === o.currentType ? l.settings.toolboxAccentColor : \"transparent\", r.addEventListener(\"click\", function () {\n        t.setCurrentType(s, r);\n      }), e.appendChild(r), \"both\" === s || \"start\" === s) {\n        var n = document.createElement(\"div\");\n        n.style.display = \"flex\", n.style.alignItems = \"center\", n.style.minHeight = \"20px\", n.innerHTML = '<svg viewBox=\"0 0 10 10\" width=\"10\" height=\"10\" xmlns=\"http://www.w3.org/2000/svg\">\\n          <polygon points=\"0,5 10,0 10,10\" fill=\"' + l.settings.toolboxColor + '\" />\\n        </svg>', n.style.marginLeft = \"5px\", r.appendChild(n);\n      }\n\n      var a = document.createElement(\"div\");\n      a.style.display = \"flex\", a.style.alignItems = \"center\", a.style.minHeight = \"20px\", a.style.flexGrow = \"2\";\n      var h = document.createElement(\"hr\");\n\n      if (h.style.minWidth = \"20px\", h.style.border = \"0px\", h.style.borderTop = \"3px solid \" + l.settings.toolboxColor, h.style.flexGrow = \"2\", a.appendChild(h), r.appendChild(a), \"both\" === s || \"end\" === s) {\n        var p = document.createElement(\"div\");\n        p.style.display = \"flex\", p.style.alignItems = \"center\", p.style.minHeight = \"20px\", p.innerHTML = '<svg viewBox=\"0 0 10 10\" width=\"10\" height=\"10\" xmlns=\"http://www.w3.org/2000/svg\">\\n          <polygon points=\"0,0 10,5 0,10\" fill=\"' + l.settings.toolboxColor + '\" />\\n        </svg>', p.style.marginRight = \"5px\", r.appendChild(p);\n      }\n\n      o.typeBoxes.push(r);\n    }, o = this, s = 0; s < 4; s++) i(s);\n\n    return e;\n  }, i.prototype.setCurrentType = function (t, e) {\n    this.currentType = t, this.typeBoxes.forEach(function (t) {\n      t.style.borderColor = t === e ? l.settings.toolboxAccentColor : \"transparent\";\n    }), this.onArrowTypeChanged && this.onArrowTypeChanged(this.currentType);\n  }, i;\n}(u),\n    A = function (t) {\n  function i(e, i, o) {\n    var s = t.call(this, e, i, o) || this;\n    return s.arrowType = \"end\", s.arrowBaseHeight = 10, s.arrowBaseWidth = 10, s.getArrowPoints = s.getArrowPoints.bind(s), s.setArrowType = s.setArrowType.bind(s), s.arrowTypePanel = new L(\"Arrow type\", \"end\"), s.arrowTypePanel.onArrowTypeChanged = s.setArrowType, s;\n  }\n\n  return e(i, t), i.prototype.ownsTarget = function (e) {\n    return !(!t.prototype.ownsTarget.call(this, e) && e !== this.arrow1 && e !== this.arrow2);\n  }, i.prototype.getArrowPoints = function (t, e) {\n    var i = this.arrowBaseWidth + 2 * this.strokeWidth,\n        o = this.arrowBaseHeight + 2 * this.strokeWidth;\n    return t - i / 2 + \",\" + (e + o / 2) + \" \" + t + \",\" + (e - o / 2) + \" \" + (t + i / 2) + \",\" + (e + o / 2);\n  }, i.prototype.createTips = function () {\n    this.arrow1 = r.createPolygon(this.getArrowPoints(this.x1, this.y1), [[\"fill\", this.strokeColor]]), this.arrow1.transform.baseVal.appendItem(r.createTransform()), this.visual.appendChild(this.arrow1), this.arrow2 = r.createPolygon(this.getArrowPoints(this.x2, this.y2), [[\"fill\", this.strokeColor]]), this.arrow2.transform.baseVal.appendItem(r.createTransform()), this.visual.appendChild(this.arrow2);\n  }, i.prototype.pointerDown = function (e, i) {\n    t.prototype.pointerDown.call(this, e, i), \"creating\" === this.state && this.createTips();\n  }, i.prototype.adjustVisual = function () {\n    if (t.prototype.adjustVisual.call(this), this.arrow1 && this.arrow2 && (this.arrow1.style.display = \"both\" === this.arrowType || \"start\" === this.arrowType ? \"\" : \"none\", this.arrow2.style.display = \"both\" === this.arrowType || \"end\" === this.arrowType ? \"\" : \"none\", r.setAttributes(this.arrow1, [[\"points\", this.getArrowPoints(this.x1, this.y1)], [\"fill\", this.strokeColor]]), r.setAttributes(this.arrow2, [[\"points\", this.getArrowPoints(this.x2, this.y2)], [\"fill\", this.strokeColor]]), Math.abs(this.x1 - this.x2) > .1)) {\n      var e = 180 * Math.atan((this.y2 - this.y1) / (this.x2 - this.x1)) / Math.PI + 90 * Math.sign(this.x1 - this.x2),\n          i = this.arrow1.transform.baseVal.getItem(0);\n      i.setRotate(e, this.x1, this.y1), this.arrow1.transform.baseVal.replaceItem(i, 0);\n      var o = this.arrow2.transform.baseVal.getItem(0);\n      o.setRotate(e + 180, this.x2, this.y2), this.arrow2.transform.baseVal.replaceItem(o, 0);\n    }\n  }, i.prototype.setArrowType = function (t) {\n    this.arrowType = t, this.adjustVisual();\n  }, Object.defineProperty(i.prototype, \"toolboxPanels\", {\n    get: function () {\n      return [this.strokePanel, this.strokeWidthPanel, this.strokeStylePanel, this.arrowTypePanel];\n    },\n    enumerable: !1,\n    configurable: !0\n  }), i.prototype.getState = function () {\n    var e = Object.assign({\n      arrowType: this.arrowType\n    }, t.prototype.getState.call(this));\n    return e.typeName = i.typeName, e;\n  }, i.prototype.restoreState = function (e) {\n    t.prototype.restoreState.call(this, e);\n    var i = e;\n    this.arrowType = i.arrowType, this.createTips(), this.adjustVisual();\n  }, i.typeName = \"ArrowMarker\", i.title = \"Arrow marker\", i.icon = '<svg viewBox=\"0 0 24 24\"><path d=\"M19 6.41L17.59 5 7 15.59V9H5v10h10v-2H8.41L19 6.41z\"/></svg>', i;\n}(T),\n    I = function (t) {\n  function i(e, i, o) {\n    var s = t.call(this, e, i, o) || this;\n    return s.fillColor = o.defaultFillColor, s.strokeWidth = 0, s.fillPanel = new y(\"Color\", o.defaultColorSet, o.defaultFillColor), s.fillPanel.onColorChanged = s.setFillColor, s;\n  }\n\n  return e(i, t), Object.defineProperty(i.prototype, \"toolboxPanels\", {\n    get: function () {\n      return [this.fillPanel];\n    },\n    enumerable: !1,\n    configurable: !0\n  }), i.prototype.getState = function () {\n    var e = t.prototype.getState.call(this);\n    return e.typeName = i.typeName, e;\n  }, i.typeName = \"CoverMarker\", i.title = \"Cover marker\", i.icon = '<svg viewBox=\"0 0 24 24\"><path d=\"M4 6v13h16V6H4z\"/></svg>', i;\n}(b),\n    D = function (t) {\n  function i(e, i, o, s) {\n    var r = t.call(this, e, s || '<svg viewBox=\"0 0 24 24\"><path d=\"M17.66 8L12 2.35 6.34 8A8.02 8.02 0 004 13.64c0 2 .78 4.11 2.34 5.67a7.99 7.99 0 0011.32 0c1.56-1.56 2.34-3.67 2.34-5.67S19.22 9.56 17.66 8M6 14c0-2 .62-3.27 1.76-4.4L12 5.27l4.24 4.38C17.38 10.77 18 12 18 14H6z\"/></svg>') || this;\n    return r.opacities = [], r.opacityBoxes = [], r.opacities = i, r.currentOpacity = o, r.setCurrentOpacity = r.setCurrentOpacity.bind(r), r;\n  }\n\n  return e(i, t), i.prototype.getUi = function () {\n    var t = this,\n        e = document.createElement(\"div\");\n    return e.style.display = \"flex\", e.style.overflow = \"hidden\", e.style.flexGrow = \"2\", e.style.justifyContent = \"space-between\", this.opacities.forEach(function (i) {\n      var o = document.createElement(\"div\");\n      o.style.display = \"flex\", o.style.alignItems = \"center\", o.style.justifyContent = \"center\", o.style.padding = \"5px\", o.style.borderWidth = \"2px\", o.style.borderStyle = \"solid\", o.style.borderColor = i === t.currentOpacity ? l.settings.toolboxAccentColor : \"transparent\", o.addEventListener(\"click\", function () {\n        t.setCurrentOpacity(i, o);\n      }), e.appendChild(o);\n      var s = document.createElement(\"div\");\n      s.innerText = 100 * i + \"%\", o.appendChild(s), t.opacityBoxes.push(o);\n    }), e;\n  }, i.prototype.setCurrentOpacity = function (t, e) {\n    this.currentOpacity = t, this.opacityBoxes.forEach(function (t) {\n      t.style.borderColor = t === e ? l.settings.toolboxAccentColor : \"transparent\";\n    }), this.onOpacityChanged && this.onOpacityChanged(this.currentOpacity);\n  }, i;\n}(u),\n    H = function (t) {\n  function i(e, i, o) {\n    var s = t.call(this, e, i, o) || this;\n    return s.setOpacity = s.setOpacity.bind(s), s.fillColor = o.defaultHighlightColor, s.strokeWidth = 0, s.opacity = o.defaultHighlightOpacity, s.fillPanel = new y(\"Color\", o.defaultColorSet, s.fillColor), s.fillPanel.onColorChanged = s.setFillColor, s.opacityPanel = new D(\"Opacity\", o.defaultOpacitySteps, s.opacity), s.opacityPanel.onOpacityChanged = s.setOpacity, s;\n  }\n\n  return e(i, t), i.prototype.setOpacity = function (t) {\n    this.opacity = t, this.visual && r.setAttributes(this.visual, [[\"opacity\", this.opacity.toString()]]);\n  }, Object.defineProperty(i.prototype, \"toolboxPanels\", {\n    get: function () {\n      return [this.fillPanel, this.opacityPanel];\n    },\n    enumerable: !1,\n    configurable: !0\n  }), i.prototype.getState = function () {\n    var e = t.prototype.getState.call(this);\n    return e.typeName = i.typeName, e;\n  }, i.typeName = \"HighlightMarker\", i.title = \"Highlight marker\", i.icon = '<svg viewBox=\"0 0 24 24\"><path d=\"M18.5 1.15c-.53 0-1.04.19-1.43.58l-5.81 5.82 5.65 5.65 5.82-5.81c.77-.78.77-2.04 0-2.83l-2.84-2.83c-.39-.39-.89-.58-1.39-.58M10.3 8.5l-5.96 5.96c-.78.78-.78 2.04.02 2.85C3.14 18.54 1.9 19.77.67 21h5.66l.86-.86c.78.76 2.03.75 2.81-.02l5.95-5.96\"/></svg>', i;\n}(I),\n    N = '<svg viewBox=\"0 0 24 24\"><path d=\"M19 11.5s-2 2.17-2 3.5a2 2 0 002 2 2 2 0 002-2c0-1.33-2-3.5-2-3.5M5.21 10L10 5.21 14.79 10m1.77-1.06L7.62 0 6.21 1.41l2.38 2.38-5.15 5.15c-.59.56-.59 1.53 0 2.12l5.5 5.5c.29.29.68.44 1.06.44s.77-.15 1.06-.44l5.5-5.5c.59-.59.59-1.56 0-2.12z\"/></svg>',\n    O = function (t) {\n  function i(e, i, o) {\n    var s = t.call(this, e, i, o) || this;\n    return s.bgColor = \"transparent\", s.tipPosition = {\n      x: 0,\n      y: 0\n    }, s.tipBase1Position = {\n      x: 0,\n      y: 0\n    }, s.tipBase2Position = {\n      x: 0,\n      y: 0\n    }, s.tipMoving = !1, s.color = o.defaultStrokeColor, s.bgColor = o.defaultFillColor, s.fontFamily = o.defaultFontFamily, s.defaultSize = {\n      x: 100,\n      y: 30\n    }, s.setBgColor = s.setBgColor.bind(s), s.getTipPoints = s.getTipPoints.bind(s), s.positionTip = s.positionTip.bind(s), s.setTipPoints = s.setTipPoints.bind(s), s.colorPanel = new y(\"Text color\", o.defaultColorSet, s.color, '<svg viewBox=\"0 0 24 24\"><path d=\"M9.62 12L12 5.67 14.37 12M11 3L5.5 17h2.25l1.12-3h6.25l1.13 3h2.25L13 3h-2z\"/></svg>'), s.colorPanel.onColorChanged = s.setColor, s.bgColorPanel = new y(\"Fill color\", o.defaultColorSet, s.bgColor, N), s.bgColorPanel.onColorChanged = s.setBgColor, s.fontFamilyPanel = new M(\"Font\", o.defaultFontFamilies, o.defaultFontFamily), s.fontFamilyPanel.onFontChanged = s.setFont, s.tipGrip = new m(), s.tipGrip.visual.transform.baseVal.appendItem(r.createTransform()), s.controlBox.appendChild(s.tipGrip.visual), s;\n  }\n\n  return e(i, t), i.prototype.ownsTarget = function (e) {\n    return t.prototype.ownsTarget.call(this, e) || this.tipGrip.ownsTarget(e) || this.tip === e;\n  }, i.prototype.createTip = function () {\n    r.setAttributes(this.bgRectangle, [[\"fill\", this.bgColor], [\"rx\", \"10px\"]]), this.tip = r.createPolygon(this.getTipPoints(), [[\"fill\", this.bgColor]]), this.visual.appendChild(this.tip);\n  }, i.prototype.pointerDown = function (e, i) {\n    \"new\" === this.state && t.prototype.pointerDown.call(this, e, i), \"creating\" === this.state ? this.createTip() : this.tipGrip.ownsTarget(i) ? (this.manipulationStartLeft = this.left, this.manipulationStartTop = this.top, this.tipMoving = !0) : t.prototype.pointerDown.call(this, e, i);\n  }, i.prototype.pointerUp = function (e) {\n    if (this.tipMoving) this.tipMoving = !1;else {\n      var i = \"creating\" === this.state;\n      t.prototype.pointerUp.call(this, e), this.setTipPoints(i), this.positionTip();\n    }\n  }, i.prototype.manipulate = function (e) {\n    if (this.tipMoving) {\n      var i = this.unrotatePoint(e);\n      this.tipPosition = {\n        x: i.x - this.manipulationStartLeft,\n        y: i.y - this.manipulationStartTop\n      }, this.positionTip();\n    } else t.prototype.manipulate.call(this, e);\n  }, i.prototype.setBgColor = function (t) {\n    r.setAttributes(this.bgRectangle, [[\"fill\", t]]), r.setAttributes(this.tip, [[\"fill\", t]]), this.bgColor = t;\n  }, i.prototype.getTipPoints = function () {\n    return this.setTipPoints(\"creating\" === this.state), this.tipBase1Position.x + \",\" + this.tipBase1Position.y + \" \" + this.tipBase2Position.x + \",\" + this.tipBase2Position.y + \" \" + this.tipPosition.x + \",\" + this.tipPosition.y;\n  }, i.prototype.setTipPoints = function (t) {\n    void 0 === t && (t = !1);\n    var e = Math.min(this.height / 2, 15),\n        i = this.height / 5;\n    t && (this.tipPosition = {\n      x: e + i / 2,\n      y: this.height + 20\n    });\n    var o = Math.atan(this.height / 2 / (this.width / 2));\n    if (this.tipPosition.x < this.width / 2 && this.tipPosition.y < this.height / 2) o < Math.atan((this.height / 2 - this.tipPosition.y) / (this.width / 2 - this.tipPosition.x)) ? (i = this.width / 5, e = Math.min(this.width / 2, 15), this.tipBase1Position = {\n      x: e,\n      y: 0\n    }, this.tipBase2Position = {\n      x: e + i,\n      y: 0\n    }) : (this.tipBase1Position = {\n      x: 0,\n      y: e\n    }, this.tipBase2Position = {\n      x: 0,\n      y: e + i\n    });else if (this.tipPosition.x >= this.width / 2 && this.tipPosition.y < this.height / 2) {\n      o < Math.atan((this.height / 2 - this.tipPosition.y) / (this.tipPosition.x - this.width / 2)) ? (i = this.width / 5, e = Math.min(this.width / 2, 15), this.tipBase1Position = {\n        x: this.width - e - i,\n        y: 0\n      }, this.tipBase2Position = {\n        x: this.width - e,\n        y: 0\n      }) : (this.tipBase1Position = {\n        x: this.width,\n        y: e\n      }, this.tipBase2Position = {\n        x: this.width,\n        y: e + i\n      });\n    } else if (this.tipPosition.x >= this.width / 2 && this.tipPosition.y >= this.height / 2) {\n      o < Math.atan((this.tipPosition.y - this.height / 2) / (this.tipPosition.x - this.width / 2)) ? (i = this.width / 5, e = Math.min(this.width / 2, 15), this.tipBase1Position = {\n        x: this.width - e - i,\n        y: this.height\n      }, this.tipBase2Position = {\n        x: this.width - e,\n        y: this.height\n      }) : (this.tipBase1Position = {\n        x: this.width,\n        y: this.height - e - i\n      }, this.tipBase2Position = {\n        x: this.width,\n        y: this.height - e\n      });\n    } else {\n      o < Math.atan((this.tipPosition.y - this.height / 2) / (this.width / 2 - this.tipPosition.x)) ? (i = this.width / 5, e = Math.min(this.width / 2, 15), this.tipBase1Position = {\n        x: e,\n        y: this.height\n      }, this.tipBase2Position = {\n        x: e + i,\n        y: this.height\n      }) : (this.tipBase1Position = {\n        x: 0,\n        y: this.height - e\n      }, this.tipBase2Position = {\n        x: 0,\n        y: this.height - e - i\n      });\n    }\n  }, i.prototype.resize = function (e) {\n    t.prototype.resize.call(this, e), this.positionTip();\n  }, i.prototype.positionTip = function () {\n    r.setAttributes(this.tip, [[\"points\", this.getTipPoints()]]);\n    var t = this.tipGrip.visual.transform.baseVal.getItem(0);\n    t.setTranslate(this.tipPosition.x, this.tipPosition.y), this.tipGrip.visual.transform.baseVal.replaceItem(t, 0);\n  }, Object.defineProperty(i.prototype, \"toolboxPanels\", {\n    get: function () {\n      return [this.colorPanel, this.bgColorPanel, this.fontFamilyPanel];\n    },\n    enumerable: !1,\n    configurable: !0\n  }), i.prototype.select = function () {\n    this.positionTip(), t.prototype.select.call(this);\n  }, i.prototype.getState = function () {\n    var e = Object.assign({\n      bgColor: this.bgColor,\n      tipPosition: this.tipPosition\n    }, t.prototype.getState.call(this));\n    return e.typeName = i.typeName, e;\n  }, i.prototype.restoreState = function (e) {\n    var i = e;\n    this.bgColor = i.bgColor, this.tipPosition = i.tipPosition, t.prototype.restoreState.call(this, e), this.createTip(), this.setTipPoints();\n  }, i.prototype.scale = function (e, i) {\n    t.prototype.scale.call(this, e, i), this.tipPosition = {\n      x: this.tipPosition.x * e,\n      y: this.tipPosition.y * i\n    }, this.positionTip();\n  }, i.typeName = \"CalloutMarker\", i.title = \"Callout marker\", i.icon = '<svg viewBox=\"0 0 24 24\"><path d=\"M4 2h16a2 2 0 012 2v12a2 2 0 01-2 2h-4l-4 4-4-4H4a2 2 0 01-2-2V4a2 2 0 012-2m0 2v12h4.83L12 19.17 15.17 16H20V4H4m2 3h12v2H6V7m0 4h10v2H6v-2z\"/></svg>', i;\n}(E),\n    W = function (t) {\n  function i(e, i, o) {\n    var r = t.call(this, e, i, o) || this;\n    return r.fillColor = \"transparent\", r.strokeColor = \"transparent\", r.strokeWidth = 0, r.strokeDasharray = \"\", r.opacity = 1, r.strokeColor = o.defaultColor, r.strokeWidth = o.defaultStrokeWidth, r.strokeDasharray = o.defaultStrokeDasharray, r.fillColor = o.defaultFillColor, r.setStrokeColor = r.setStrokeColor.bind(r), r.setFillColor = r.setFillColor.bind(r), r.setStrokeWidth = r.setStrokeWidth.bind(r), r.setStrokeDasharray = r.setStrokeDasharray.bind(r), r.setOpacity = r.setOpacity.bind(r), r.createVisual = r.createVisual.bind(r), r.strokePanel = new y(\"Line color\", s(o.defaultColorSet, [\"transparent\"]), o.defaultColor), r.strokePanel.onColorChanged = r.setStrokeColor, r.fillPanel = new y(\"Fill color\", s(o.defaultColorSet, [\"transparent\"]), r.fillColor, N), r.fillPanel.onColorChanged = r.setFillColor, r.strokeWidthPanel = new w(\"Line width\", o.defaultStrokeWidths, o.defaultStrokeWidth), r.strokeWidthPanel.onWidthChanged = r.setStrokeWidth, r.strokeStylePanel = new S(\"Line style\", o.defaultStrokeDasharrays, o.defaultStrokeDasharray), r.strokeStylePanel.onStyleChanged = r.setStrokeDasharray, r.opacityPanel = new D(\"Opacity\", o.defaultOpacitySteps, r.opacity), r.opacityPanel.onOpacityChanged = r.setOpacity, r;\n  }\n\n  return e(i, t), i.prototype.ownsTarget = function (e) {\n    return !(!t.prototype.ownsTarget.call(this, e) && e !== this.visual);\n  }, i.prototype.createVisual = function () {\n    this.visual = r.createEllipse(this.width / 2, this.height / 2, [[\"fill\", this.fillColor], [\"stroke\", this.strokeColor], [\"stroke-width\", this.strokeWidth.toString()], [\"stroke-dasharray\", this.strokeDasharray], [\"opacity\", this.opacity.toString()]]), this.addMarkerVisualToContainer(this.visual);\n  }, i.prototype.pointerDown = function (e, i) {\n    t.prototype.pointerDown.call(this, e, i), \"new\" === this.state && (this.createVisual(), this.moveVisual(e), this._state = \"creating\");\n  }, i.prototype.manipulate = function (e) {\n    t.prototype.manipulate.call(this, e);\n  }, i.prototype.resize = function (e) {\n    t.prototype.resize.call(this, e), this.setSize();\n  }, i.prototype.setSize = function () {\n    t.prototype.setSize.call(this), r.setAttributes(this.visual, [[\"cx\", (this.width / 2).toString()], [\"cy\", (this.height / 2).toString()], [\"rx\", (this.width / 2).toString()], [\"ry\", (this.height / 2).toString()]]);\n  }, i.prototype.pointerUp = function (e) {\n    t.prototype.pointerUp.call(this, e), this.setSize();\n  }, i.prototype.setStrokeColor = function (t) {\n    this.strokeColor = t, this.visual && r.setAttributes(this.visual, [[\"stroke\", this.strokeColor]]);\n  }, i.prototype.setFillColor = function (t) {\n    this.fillColor = t, this.visual && r.setAttributes(this.visual, [[\"fill\", this.fillColor]]);\n  }, i.prototype.setStrokeWidth = function (t) {\n    this.strokeWidth = t, this.visual && r.setAttributes(this.visual, [[\"stroke-width\", this.strokeWidth.toString()]]);\n  }, i.prototype.setStrokeDasharray = function (t) {\n    this.strokeDasharray = t, this.visual && r.setAttributes(this.visual, [[\"stroke-dasharray\", this.strokeDasharray]]);\n  }, i.prototype.setOpacity = function (t) {\n    this.opacity = t, this.visual && r.setAttributes(this.visual, [[\"opacity\", this.opacity.toString()]]);\n  }, Object.defineProperty(i.prototype, \"toolboxPanels\", {\n    get: function () {\n      return [this.strokePanel, this.fillPanel, this.strokeWidthPanel, this.strokeStylePanel, this.opacityPanel];\n    },\n    enumerable: !1,\n    configurable: !0\n  }), i.prototype.getState = function () {\n    var e = Object.assign({\n      fillColor: this.fillColor,\n      strokeColor: this.strokeColor,\n      strokeWidth: this.strokeWidth,\n      strokeDasharray: this.strokeDasharray,\n      opacity: this.opacity\n    }, t.prototype.getState.call(this));\n    return e.typeName = i.typeName, e;\n  }, i.prototype.restoreState = function (e) {\n    var i = e;\n    this.fillColor = i.fillColor, this.strokeColor = i.strokeColor, this.strokeWidth = i.strokeWidth, this.strokeDasharray = i.strokeDasharray, this.opacity = i.opacity, this.createVisual(), t.prototype.restoreState.call(this, e), this.setSize();\n  }, i.prototype.scale = function (e, i) {\n    t.prototype.scale.call(this, e, i), this.setSize();\n  }, i.typeName = \"EllipseMarker\", i.title = \"Ellipse marker\", i.icon = '<svg viewBox=\"0 0 24 24\"><path d=\"M12 4C6.5 4 2 7.58 2 12s4.5 8 10 8 10-3.58 10-8-4.5-8-10-8z\"/></svg>', i;\n}(C),\n    R = function (t) {\n  function i(e, i, o) {\n    return t.call(this, e, i, o) || this;\n  }\n\n  return e(i, t), Object.defineProperty(i.prototype, \"tipLength\", {\n    get: function () {\n      return 10 + 3 * this.strokeWidth;\n    },\n    enumerable: !1,\n    configurable: !0\n  }), i.prototype.ownsTarget = function (e) {\n    return !(!t.prototype.ownsTarget.call(this, e) && e !== this.tip1 && e !== this.tip2);\n  }, i.prototype.createTips = function () {\n    this.tip1 = r.createLine(this.x1 - this.tipLength / 2, this.y1, this.x1 + this.tipLength / 2, this.y1, [[\"stroke\", this.strokeColor], [\"stroke-width\", this.strokeWidth.toString()]]), this.tip1.transform.baseVal.appendItem(r.createTransform()), this.visual.appendChild(this.tip1), this.tip2 = r.createLine(this.x2 - this.tipLength / 2, this.y2, this.x2 + this.tipLength / 2, this.y2, [[\"stroke\", this.strokeColor], [\"stroke-width\", this.strokeWidth.toString()]]), this.tip2.transform.baseVal.appendItem(r.createTransform()), this.visual.appendChild(this.tip2);\n  }, i.prototype.pointerDown = function (e, i) {\n    t.prototype.pointerDown.call(this, e, i), \"creating\" === this.state && this.createTips();\n  }, i.prototype.adjustVisual = function () {\n    if (t.prototype.adjustVisual.call(this), this.tip1 && this.tip2 && (r.setAttributes(this.tip1, [[\"x1\", (this.x1 - this.tipLength / 2).toString()], [\"y1\", this.y1.toString()], [\"x2\", (this.x1 + this.tipLength / 2).toString()], [\"y2\", this.y1.toString()], [\"stroke\", this.strokeColor], [\"stroke-width\", this.strokeWidth.toString()]]), r.setAttributes(this.tip2, [[\"x1\", (this.x2 - this.tipLength / 2).toString()], [\"y1\", this.y2.toString()], [\"x2\", (this.x2 + this.tipLength / 2).toString()], [\"y2\", this.y2.toString()], [\"stroke\", this.strokeColor], [\"stroke-width\", this.strokeWidth.toString()]]), Math.abs(this.x1 - this.x2) > .1)) {\n      var e = 180 * Math.atan((this.y2 - this.y1) / (this.x2 - this.x1)) / Math.PI + 90 * Math.sign(this.x1 - this.x2),\n          i = this.tip1.transform.baseVal.getItem(0);\n      i.setRotate(e, this.x1, this.y1), this.tip1.transform.baseVal.replaceItem(i, 0);\n      var o = this.tip2.transform.baseVal.getItem(0);\n      o.setRotate(e + 180, this.x2, this.y2), this.tip2.transform.baseVal.replaceItem(o, 0);\n    }\n  }, Object.defineProperty(i.prototype, \"toolboxPanels\", {\n    get: function () {\n      return [this.strokePanel, this.strokeWidthPanel, this.strokeStylePanel];\n    },\n    enumerable: !1,\n    configurable: !0\n  }), i.prototype.getState = function () {\n    var e = t.prototype.getState.call(this);\n    return e.typeName = i.typeName, e;\n  }, i.prototype.restoreState = function (e) {\n    t.prototype.restoreState.call(this, e), this.createTips(), this.adjustVisual();\n  }, i.typeName = \"MeasurementMarker\", i.title = \"Measurement marker\", i.icon = '<svg viewBox=\"0 0 24 24\"><path d=\"M1.39 18.36l1.77-1.76L4.58 18l1.06-1.05-1.42-1.41 1.42-1.42 2.47 2.48 1.06-1.06-2.47-2.48 1.41-1.41 1.42 1.41L10.59 12l-1.42-1.41 1.42-1.42 2.47 2.48 1.06-1.06-2.47-2.48 1.41-1.41 1.41 1.41 1.07-1.06-1.42-1.41 1.42-1.42L18 6.7l1.07-1.06-2.47-2.48 1.76-1.77 4.25 4.25L5.64 22.61l-4.25-4.25z\"/></svg>', i;\n}(T),\n    V = function (t) {\n  function i(e, i, o) {\n    var s = t.call(this, e, i, o) || this;\n    return s.strokePanel.colors = o.defaultColorSet, s.fillColor = \"transparent\", s;\n  }\n\n  return e(i, t), Object.defineProperty(i.prototype, \"toolboxPanels\", {\n    get: function () {\n      return [this.strokePanel, this.strokeWidthPanel, this.strokeStylePanel];\n    },\n    enumerable: !1,\n    configurable: !0\n  }), i.prototype.getState = function () {\n    var e = t.prototype.getState.call(this);\n    return e.typeName = i.typeName, e;\n  }, i.typeName = \"EllipseFrameMarker\", i.title = \"Ellipse frame marker\", i.icon = '<svg viewBox=\"0 0 24 24\"><path d=\"M12 6c4.41 0 8 2.69 8 6s-3.59 6-8 6-8-2.69-8-6 3.59-6 8-6m0-2C6.5 4 2 7.58 2 12s4.5 8 10 8 10-3.58 10-8-4.5-8-10-8z\"/></svg>', i;\n}(W),\n    G = function () {\n  function t() {\n    this.undoStack = [], this.redoStack = [];\n  }\n\n  return Object.defineProperty(t.prototype, \"isUndoPossible\", {\n    get: function () {\n      return this.undoStack.length > 0;\n    },\n    enumerable: !1,\n    configurable: !0\n  }), Object.defineProperty(t.prototype, \"isRedoPossible\", {\n    get: function () {\n      return this.redoStack.length > 0;\n    },\n    enumerable: !1,\n    configurable: !0\n  }), t.prototype.addUndoStep = function (t) {\n    0 !== this.undoStack.length && JSON.stringify(this.undoStack[this.undoStack.length - 1]) === JSON.stringify(t) || (this.undoStack.push(t), JSON.stringify(this.lastRedoStep) !== JSON.stringify(t) && this.redoStack.splice(0, this.redoStack.length));\n  }, t.prototype.undo = function () {\n    if (this.undoStack.length > 1) {\n      var t = this.undoStack.pop();\n      return void 0 !== t && this.redoStack.push(t), this.undoStack.length > 0 ? this.undoStack[this.undoStack.length - 1] : void 0;\n    }\n  }, t.prototype.redo = function () {\n    return this.lastRedoStep = this.redoStack.pop(), this.lastRedoStep;\n  }, t;\n}(),\n    _ = function () {\n  function t(t) {\n    this.touchPoints = 0, this._availableMarkerTypes = this.DEFAULT_MARKER_TYPES, this.mode = \"select\", this.markers = [], this.isDragging = !1, this.renderEventListeners = [], this.closeEventListeners = [], this.settings = new k(), this._isOpen = !1, this.undoRedoManager = new G(), this.renderAtNaturalSize = !1, this.renderImageType = \"image/png\", this.renderMarkersOnly = !1, l.settings = l.defaultSettings, this.uiStyleSettings = l.settings, this.target = t, this.targetRoot = document.body, this.width = t.clientWidth, this.height = t.clientHeight, l.removeStyleSheet(), this.open = this.open.bind(this), this.setTopLeft = this.setTopLeft.bind(this), this.toolbarButtonClicked = this.toolbarButtonClicked.bind(this), this.createNewMarker = this.createNewMarker.bind(this), this.addNewMarker = this.addNewMarker.bind(this), this.markerCreated = this.markerCreated.bind(this), this.setCurrentMarker = this.setCurrentMarker.bind(this), this.onPointerDown = this.onPointerDown.bind(this), this.onDblClick = this.onDblClick.bind(this), this.onPointerMove = this.onPointerMove.bind(this), this.onPointerUp = this.onPointerUp.bind(this), this.onKeyUp = this.onKeyUp.bind(this), this.overrideOverflow = this.overrideOverflow.bind(this), this.restoreOverflow = this.restoreOverflow.bind(this), this.close = this.close.bind(this), this.closeUI = this.closeUI.bind(this), this.addCloseEventListener = this.addCloseEventListener.bind(this), this.removeCloseEventListener = this.removeCloseEventListener.bind(this), this.addRenderEventListener = this.addRenderEventListener.bind(this), this.removeRenderEventListener = this.removeRenderEventListener.bind(this), this.clientToLocalCoordinates = this.clientToLocalCoordinates.bind(this), this.onWindowResize = this.onWindowResize.bind(this), this.deleteSelectedMarker = this.deleteSelectedMarker.bind(this), this.setWindowHeight = this.setWindowHeight.bind(this), this.removeMarker = this.removeMarker.bind(this);\n  }\n\n  return Object.defineProperty(t.prototype, \"ALL_MARKER_TYPES\", {\n    get: function () {\n      return [x, P, A, E, V, W, H, O, R, I, T];\n    },\n    enumerable: !1,\n    configurable: !0\n  }), Object.defineProperty(t.prototype, \"DEFAULT_MARKER_TYPES\", {\n    get: function () {\n      return [x, P, A, E, W, H, O];\n    },\n    enumerable: !1,\n    configurable: !0\n  }), Object.defineProperty(t.prototype, \"BASIC_MARKER_TYPES\", {\n    get: function () {\n      return [x, P, A, E, H];\n    },\n    enumerable: !1,\n    configurable: !0\n  }), Object.defineProperty(t.prototype, \"availableMarkerTypes\", {\n    get: function () {\n      return this._availableMarkerTypes;\n    },\n    set: function (t) {\n      var e = this;\n      this._availableMarkerTypes.splice(0), t.forEach(function (t) {\n        if (\"string\" == typeof t) {\n          var i = e.ALL_MARKER_TYPES.find(function (e) {\n            return e.typeName === t;\n          });\n          void 0 !== i && e._availableMarkerTypes.push(i);\n        } else e._availableMarkerTypes.push(t);\n      });\n    },\n    enumerable: !1,\n    configurable: !0\n  }), Object.defineProperty(t.prototype, \"isOpen\", {\n    get: function () {\n      return this._isOpen;\n    },\n    enumerable: !1,\n    configurable: !0\n  }), t.prototype.open = function () {\n    this.setupResizeObserver(), this.setEditingTarget(), this.setTopLeft(), this.initMarkerCanvas(), this.initOverlay(), this.attachEvents(), n.isLicensed || this.addLogo(), this._isOpen = !0;\n  }, t.prototype.show = function () {\n    this.setWindowHeight(), this.showUI(), this.open();\n  }, t.prototype.render = function () {\n    return i(this, void 0, void 0, function () {\n      var t;\n      return o(this, function (e) {\n        switch (e.label) {\n          case 0:\n            return this.setCurrentMarker(), (t = new a()).naturalSize = this.renderAtNaturalSize, t.imageType = this.renderImageType, t.imageQuality = this.renderImageQuality, t.markersOnly = this.renderMarkersOnly, t.width = this.renderWidth, t.height = this.renderHeight, [4, t.rasterize(this.target, this.markerImage)];\n\n          case 1:\n            return e.sent(), [4, t.rasterize(this.target, this.markerImage)];\n\n          case 2:\n            return [2, e.sent()];\n        }\n      });\n    });\n  }, t.prototype.close = function () {\n    this.isOpen && (this.coverDiv && this.closeUI(), this.targetObserver && this.targetObserver.unobserve(this.target), \"popup\" === this.settings.displayMode && window.removeEventListener(\"resize\", this.setWindowHeight), this.closeEventListeners.forEach(function (t) {\n      return t();\n    }), this._isOpen = !1);\n  }, t.prototype.addMarkersToToolbar = function () {\n    for (var t, e = [], i = 0; i < arguments.length; i++) e[i] = arguments[i];\n\n    (t = this._availableMarkerTypes).push.apply(t, e);\n  }, t.prototype.addRenderEventListener = function (t) {\n    this.renderEventListeners.push(t);\n  }, t.prototype.removeRenderEventListener = function (t) {\n    this.renderEventListeners.indexOf(t) > -1 && this.renderEventListeners.splice(this.renderEventListeners.indexOf(t), 1);\n  }, t.prototype.addCloseEventListener = function (t) {\n    this.closeEventListeners.push(t);\n  }, t.prototype.removeCloseEventListener = function (t) {\n    this.closeEventListeners.indexOf(t) > -1 && this.closeEventListeners.splice(this.closeEventListeners.indexOf(t), 1);\n  }, t.prototype.setupResizeObserver = function () {\n    var t = this;\n    \"inline\" === this.settings.displayMode ? (this.targetObserver = new ResizeObserver(function () {\n      t.resize(t.target.clientWidth, t.target.clientHeight);\n    }), this.targetObserver.observe(this.target)) : \"popup\" === this.settings.displayMode && (this.targetObserver = new ResizeObserver(function () {\n      var e = 1 * t.target.clientWidth / t.target.clientHeight,\n          i = t.editorCanvas.clientWidth / e > t.editorCanvas.clientHeight ? t.editorCanvas.clientHeight * e : t.editorCanvas.clientWidth,\n          o = i < t.editorCanvas.clientWidth ? t.editorCanvas.clientHeight : t.editorCanvas.clientWidth / e;\n      t.resize(i, o);\n    }), this.targetObserver.observe(this.editorCanvas), window.addEventListener(\"resize\", this.setWindowHeight));\n  }, t.prototype.setWindowHeight = function () {\n    this.windowHeight = window.innerHeight;\n  }, t.prototype.resize = function (t, e) {\n    var i = t / this.imageWidth,\n        o = e / this.imageHeight;\n    this.imageWidth = Math.round(t), this.imageHeight = Math.round(e), this.editingTarget.src = this.target.src, this.editingTarget.width = this.imageWidth, this.editingTarget.height = this.imageHeight, this.editingTarget.style.width = this.imageWidth + \"px\", this.editingTarget.style.height = this.imageHeight + \"px\", this.markerImage.setAttribute(\"width\", this.imageWidth.toString()), this.markerImage.setAttribute(\"height\", this.imageHeight.toString()), this.markerImage.setAttribute(\"viewBox\", \"0 0 \" + this.imageWidth.toString() + \" \" + this.imageHeight.toString()), this.markerImageHolder.style.width = this.imageWidth + \"px\", this.markerImageHolder.style.height = this.imageHeight + \"px\", this.overlayContainer.style.width = this.imageWidth + \"px\", this.overlayContainer.style.height = this.imageHeight + \"px\", \"popup\" !== this.settings.displayMode ? this.coverDiv.style.width = this.imageWidth.toString() + \"px\" : (this.setTopLeft(), this.positionMarkerImage()), void 0 !== this.toolbar && this.toolbar.adjustLayout(), this.positionLogo(), this.scaleMarkers(i, o);\n  }, t.prototype.scaleMarkers = function (t, e) {\n    this.currentMarker && this.currentMarker instanceof E || (this.setCurrentMarker(), this.toolbar.setSelectMode()), this.markers.forEach(function (i) {\n      return i.scale(t, e);\n    });\n  }, t.prototype.setEditingTarget = function () {\n    this.imageWidth = Math.round(this.target.clientWidth), this.imageHeight = Math.round(this.target.clientHeight), this.editingTarget.src = this.target.src, this.editingTarget.width = this.imageWidth, this.editingTarget.height = this.imageHeight, this.editingTarget.style.width = this.imageWidth + \"px\", this.editingTarget.style.height = this.imageHeight + \"px\";\n  }, t.prototype.setTopLeft = function () {\n    var t = this.editingTarget.getBoundingClientRect(),\n        e = this.editorCanvas.getBoundingClientRect();\n    this.left = t.left - e.left, this.top = t.top - e.top;\n  }, t.prototype.initMarkerCanvas = function () {\n    this.markerImageHolder = document.createElement(\"div\"), this.markerImageHolder.style.setProperty(\"touch-action\", \"pinch-zoom\"), this.markerImage = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\"), this.markerImage.setAttribute(\"xmlns\", \"http://www.w3.org/2000/svg\"), this.markerImage.setAttribute(\"width\", this.imageWidth.toString()), this.markerImage.setAttribute(\"height\", this.imageHeight.toString()), this.markerImage.setAttribute(\"viewBox\", \"0 0 \" + this.imageWidth.toString() + \" \" + this.imageHeight.toString()), this.markerImage.style.pointerEvents = \"auto\", this.markerImageHolder.style.position = \"absolute\", this.markerImageHolder.style.width = this.imageWidth + \"px\", this.markerImageHolder.style.height = this.imageHeight + \"px\", this.markerImageHolder.style.transformOrigin = \"top left\", this.positionMarkerImage(), this.defs = r.createDefs(), this.markerImage.appendChild(this.defs), this.markerImageHolder.appendChild(this.markerImage), this.editorCanvas.appendChild(this.markerImageHolder);\n  }, t.prototype.initOverlay = function () {\n    this.overlayContainer = document.createElement(\"div\"), this.overlayContainer.style.position = \"absolute\", this.overlayContainer.style.left = \"0px\", this.overlayContainer.style.top = \"0px\", this.overlayContainer.style.width = this.imageWidth + \"px\", this.overlayContainer.style.height = this.imageHeight + \"px\", this.overlayContainer.style.display = \"flex\", this.markerImageHolder.appendChild(this.overlayContainer);\n  }, t.prototype.positionMarkerImage = function () {\n    this.markerImageHolder.style.top = this.top + \"px\", this.markerImageHolder.style.left = this.left + \"px\";\n  }, t.prototype.attachEvents = function () {\n    var t = this;\n    this.markerImage.addEventListener(\"pointerdown\", this.onPointerDown), this.markerImage.addEventListener(\"dblclick\", this.onDblClick), window.addEventListener(\"pointermove\", this.onPointerMove), window.addEventListener(\"pointerup\", this.onPointerUp), window.addEventListener(\"pointercancel\", function () {\n      t.touchPoints > 0 && t.touchPoints--;\n    }), window.addEventListener(\"pointerout\", function () {\n      t.touchPoints > 0 && t.touchPoints--;\n    }), window.addEventListener(\"pointerleave\", this.onPointerUp), window.addEventListener(\"resize\", this.onWindowResize), window.addEventListener(\"keyup\", this.onKeyUp);\n  }, t.prototype.addLogo = function () {\n    this.logoUI = document.createElement(\"div\"), this.logoUI.style.display = \"inline-block\", this.logoUI.style.margin = \"0px\", this.logoUI.style.padding = \"0px\", this.logoUI.style.fill = \"#333333\";\n    var t = document.createElement(\"a\");\n    t.href = \"https://markerjs.com/\", t.target = \"_blank\", t.innerHTML = '<svg viewBox=\"0 0 112 96\" xmlns=\"http://www.w3.org/2000/svg\" fill-rule=\"evenodd\" clip-rule=\"evenodd\" stroke-linejoin=\"round\" stroke-miterlimit=\"1.414\"><path fill=\"#e5f20d\" fill-opacity=\".647\" d=\"M0 40.386h111.96V95.62H0z\"/><path d=\"M93.61 61.452c0 .987-.328 1.831-.987 2.53-.657.7-1.52 1.048-2.591 1.048-1.481 0-2.222-.74-2.222-2.22 0-16.617-.533-29.347-1.604-38.192-1.068-8.842-2.92-13.265-5.552-13.265-4.443 0-10.94 15.509-19.497 46.52v.124c0 .987-.328 1.831-.987 2.53-.657.7-1.52 1.048-2.592 1.048-1.48 0-2.22-.74-2.22-2.22 0-3.29.165-8.392.493-15.302.33-7.732.494-13.82.494-18.262 0-6.17-.186-10.55-.556-13.142-.37-2.591-1.172-3.887-2.406-3.887-2.796 0-6.333 5.12-10.612 15.363C38.494 34.367 34.01 46.44 29.32 60.34l-1.11 3.209a5.714 5.714 0 01-1.42 2.097c-.617.578-1.295.864-2.036.864-.987 0-1.644-.081-1.974-.247-.328-.162-.533-.656-.617-1.48-.41-4.03-.74-9.418-.987-16.165-.163-1.728-.329-4.566-.494-8.515-.822-13.901-1.562-23.3-2.221-28.196-.657-4.893-.987-7.628-.987-8.205 0-.657.33-1.44.987-2.345.659-.903 1.276-1.357 1.85-1.357 1.319 0 2.387.947 3.21 2.838.411.906.863 4.526 1.357 10.859.493 6.335.905 14.19 1.233 23.568l.617 18.88c4.527-13.983 9.216-26.673 14.068-38.068C45.65 6.686 50.093.988 54.123.988c2.715 0 4.566 1.974 5.553 5.923.987 3.949 1.481 9.667 1.481 17.152 0 3.949-.081 9.625-.247 17.029l-.123 5.676c3.373-11.762 6.725-21.634 10.057-29.615 3.331-7.979 6.685-11.97 10.056-11.97 8.475 0 12.71 18.757 12.71 56.269z\" fill-rule=\"nonzero\"/></svg>', t.title = \"Powered by marker.js\", t.style.display = \"grid\", t.style.alignItems = \"center\", t.style.justifyItems = \"center\", t.style.padding = \"3px\", t.style.width = \"20px\", t.style.height = \"20px\", this.logoUI.appendChild(t), this.editorCanvas.appendChild(this.logoUI), this.logoUI.style.position = \"absolute\", this.logoUI.style.pointerEvents = \"all\", this.positionLogo();\n  }, t.prototype.positionLogo = function () {\n    this.logoUI && (this.logoUI.style.left = this.markerImageHolder.offsetLeft + 10 + \"px\", this.logoUI.style.top = this.markerImageHolder.offsetTop + this.markerImageHolder.offsetHeight - this.logoUI.clientHeight - 10 + \"px\");\n  }, t.prototype.overrideOverflow = function () {\n    this.scrollXState = window.scrollX, this.scrollYState = window.scrollY, this.bodyOverflowState = document.body.style.overflow, window.scroll({\n      top: 0,\n      left: 0\n    }), document.body.style.overflow = \"hidden\";\n  }, t.prototype.restoreOverflow = function () {\n    document.body.style.overflow = this.bodyOverflowState, window.scroll({\n      top: this.scrollYState,\n      left: this.scrollXState\n    });\n  }, t.prototype.showUI = function () {\n    switch (\"popup\" === this.settings.displayMode && this.overrideOverflow(), this.coverDiv = document.createElement(\"div\"), this.coverDiv.className = l.CLASS_PREFIX, this.coverDiv.style.fontSize = \"16px\", this.settings.displayMode) {\n      case \"inline\":\n        this.coverDiv.style.position = \"absolute\";\n        var t = this.target.offsetTop > l.settings.toolbarHeight ? this.target.offsetTop - l.settings.toolbarHeight : 0;\n        this.coverDiv.style.top = t + \"px\", this.coverDiv.style.left = this.target.offsetLeft.toString() + \"px\", this.coverDiv.style.width = this.target.offsetWidth.toString() + \"px\", this.coverDiv.style.zIndex = \"5\";\n        break;\n\n      case \"popup\":\n        this.coverDiv.style.position = \"absolute\", this.coverDiv.style.top = \"0px\", this.coverDiv.style.left = \"0px\", this.coverDiv.style.width = \"100vw\", this.coverDiv.style.height = window.innerHeight + \"px\", this.coverDiv.style.backgroundColor = \"rgba(0, 0, 0, 0.75)\", this.coverDiv.style.zIndex = \"1000\", this.coverDiv.style.display = \"flex\";\n    }\n\n    this.targetRoot.appendChild(this.coverDiv), this.uiDiv = document.createElement(\"div\"), this.uiDiv.style.display = \"flex\", this.uiDiv.style.flexDirection = \"column\", this.uiDiv.style.flexGrow = \"2\", this.uiDiv.style.margin = \"popup\" === this.settings.displayMode ? this.settings.popupMargin + \"px\" : \"0px\", this.uiDiv.style.border = \"0px\", this.coverDiv.appendChild(this.uiDiv), this.toolbar = new c(this.uiDiv, this.settings.displayMode, this._availableMarkerTypes, this.uiStyleSettings), this.toolbar.addButtonClickListener(this.toolbarButtonClicked), this.toolbar.show(this.uiStyleSettings.hideToolbar ? \"hidden\" : \"visible\"), this.contentDiv = document.createElement(\"div\"), this.contentDiv.style.display = \"flex\", this.contentDiv.style.flexDirection = \"row\", this.contentDiv.style.flexGrow = \"2\", this.contentDiv.style.flexShrink = \"1\", this.contentDiv.style.backgroundColor = this.uiStyleSettings.canvasBackgroundColor, \"popup\" === this.settings.displayMode && (this.contentDiv.style.maxHeight = this.windowHeight - 2 * this.settings.popupMargin - 3.5 * this.uiStyleSettings.toolbarHeight + \"px\", this.contentDiv.style.maxWidth = \"calc(100vw - \" + 2 * this.settings.popupMargin + \"px)\"), this.uiDiv.appendChild(this.contentDiv), this.editorCanvas = document.createElement(\"div\"), this.editorCanvas.style.flexGrow = \"2\", this.editorCanvas.style.flexShrink = \"1\", this.editorCanvas.style.position = \"relative\", this.editorCanvas.style.overflow = \"hidden\", this.editorCanvas.style.display = \"flex\", \"popup\" === this.settings.displayMode && (this.editorCanvas.style.alignItems = \"center\", this.editorCanvas.style.justifyContent = \"center\"), this.editorCanvas.style.pointerEvents = \"none\", this.contentDiv.appendChild(this.editorCanvas), this.editingTarget = document.createElement(\"img\"), this.editorCanvas.appendChild(this.editingTarget), this.toolbox = new d(this.uiDiv, this.settings.displayMode, this.uiStyleSettings), this.toolbox.show(this.uiStyleSettings.hideToolbox ? \"hidden\" : \"visible\");\n  }, t.prototype.closeUI = function () {\n    \"popup\" === this.settings.displayMode && this.restoreOverflow(), this.targetRoot.removeChild(this.coverDiv);\n  }, t.prototype.removeMarker = function (t) {\n    this.markerImage.removeChild(t.container), this.markers.indexOf(t) > -1 && this.markers.splice(this.markers.indexOf(t), 1), t.dispose();\n  }, t.prototype.switchToSelectMode = function () {\n    this.mode = \"select\", void 0 !== this.currentMarker && (\"new\" !== this.currentMarker.state ? this.currentMarker.select() : (this.removeMarker(this.currentMarker), this.setCurrentMarker(), this.markerImage.style.cursor = \"default\"), this.addUndoStep());\n  }, t.prototype.toolbarButtonClicked = function (t, e) {\n    if (\"marker\" === t && void 0 !== e) this.createNewMarker(e);else if (\"action\" === t) switch (e) {\n      case \"select\":\n        this.switchToSelectMode();\n        break;\n\n      case \"delete\":\n        this.deleteSelectedMarker();\n        break;\n\n      case \"undo\":\n        this.switchToSelectMode(), this.addUndoStep(), this.undo();\n        break;\n\n      case \"redo\":\n        this.switchToSelectMode(), this.redo();\n        break;\n\n      case \"close\":\n        this.close();\n        break;\n\n      case \"render\":\n        this.startRenderAndClose();\n    }\n  }, t.prototype.deleteSelectedMarker = function () {\n    void 0 !== this.currentMarker && (this.currentMarker.dispose(), this.markerImage.removeChild(this.currentMarker.container), this.markers.splice(this.markers.indexOf(this.currentMarker), 1), this.addUndoStep());\n  }, t.prototype.selectLastMarker = function () {\n    this.markers.length > 0 && this.setCurrentMarker(this.markers[this.markers.length - 1]);\n  }, t.prototype.addUndoStep = function () {\n    void 0 !== this.currentMarker && \"edit\" === this.currentMarker.state || this.undoRedoManager.addUndoStep(this.getState());\n  }, t.prototype.undo = function () {\n    var t = this.undoRedoManager.undo();\n    void 0 !== t && (this.restoreState(t), this.selectLastMarker());\n  }, t.prototype.redo = function () {\n    var t = this.undoRedoManager.redo();\n    void 0 !== t && (this.restoreState(t), this.selectLastMarker());\n  }, t.prototype.startRenderAndClose = function () {\n    return i(this, void 0, void 0, function () {\n      var t, e;\n      return o(this, function (i) {\n        switch (i.label) {\n          case 0:\n            return [4, this.render()];\n\n          case 1:\n            return t = i.sent(), e = this.getState(), this.renderEventListeners.forEach(function (i) {\n              return i(t, e);\n            }), this.close(), [2];\n        }\n      });\n    });\n  }, t.prototype.getState = function () {\n    var t = {\n      width: this.imageWidth,\n      height: this.imageHeight,\n      markers: []\n    };\n    return this.markers.forEach(function (e) {\n      return t.markers.push(e.getState());\n    }), t;\n  }, t.prototype.restoreState = function (t) {\n    var e = this;\n\n    for (this.markers.splice(0); this.markerImage.lastChild;) this.markerImage.removeChild(this.markerImage.lastChild);\n\n    t.markers.forEach(function (t) {\n      var i = e._availableMarkerTypes.find(function (e) {\n        return e.typeName === t.typeName;\n      });\n\n      if (void 0 !== i) {\n        var o = e.addNewMarker(i);\n        o.restoreState(t), e.markers.push(o);\n      }\n    }), t.width && t.height && (t.width !== this.imageWidth || t.height !== this.imageHeight) && this.scaleMarkers(this.imageWidth / t.width, this.imageHeight / t.height);\n  }, t.prototype.addNewMarker = function (t) {\n    var e = r.createGroup();\n    return this.markerImage.appendChild(e), new t(e, this.overlayContainer, this.settings);\n  }, t.prototype.createNewMarker = function (t) {\n    this.setCurrentMarker(), this.currentMarker = this.addNewMarker(t), this.currentMarker.onMarkerCreated = this.markerCreated, this.markerImage.style.cursor = \"crosshair\", this.toolbox.setPanelButtons(this.currentMarker.toolboxPanels);\n  }, t.prototype.markerCreated = function (t) {\n    this.mode = \"select\", this.markerImage.style.cursor = \"default\", this.markers.push(t), this.setCurrentMarker(t), t instanceof P && this.settings.newFreehandMarkerOnPointerUp ? (this.markers.push(t), this.createNewMarker(P)) : this.toolbar.setSelectMode(), this.addUndoStep();\n  }, t.prototype.setCurrentMarker = function (t) {\n    void 0 !== this.currentMarker && (this.currentMarker.deselect(), this.toolbar.setCurrentMarker(), this.toolbox.setPanelButtons([])), this.currentMarker = t, void 0 !== this.currentMarker && (this.currentMarker.select(), this.toolbar.setCurrentMarker(this.currentMarker), this.toolbox.setPanelButtons(this.currentMarker.toolboxPanels));\n  }, t.prototype.onPointerDown = function (t) {\n    if (this.touchPoints++, 1 === this.touchPoints || \"touch\" !== t.pointerType) if (void 0 === this.currentMarker || \"new\" !== this.currentMarker.state && \"creating\" !== this.currentMarker.state) {\n      if (\"select\" === this.mode) {\n        var e = this.markers.find(function (e) {\n          return e.ownsTarget(t.target);\n        });\n        void 0 !== e ? (this.setCurrentMarker(e), this.isDragging = !0, this.currentMarker.pointerDown(this.clientToLocalCoordinates(t.clientX, t.clientY), t.target)) : this.setCurrentMarker();\n      }\n    } else this.isDragging = !0, this.currentMarker.pointerDown(this.clientToLocalCoordinates(t.clientX, t.clientY));\n  }, t.prototype.onDblClick = function (t) {\n    if (\"select\" === this.mode) {\n      var e = this.markers.find(function (e) {\n        return e.ownsTarget(t.target);\n      });\n      void 0 !== e && e !== this.currentMarker && this.setCurrentMarker(e), void 0 !== this.currentMarker ? this.currentMarker.dblClick(this.clientToLocalCoordinates(t.clientX, t.clientY), t.target) : this.setCurrentMarker();\n    }\n  }, t.prototype.onPointerMove = function (t) {\n    1 !== this.touchPoints && \"touch\" === t.pointerType || (void 0 !== this.currentMarker || this.isDragging) && (t.preventDefault(), this.currentMarker.manipulate(this.clientToLocalCoordinates(t.clientX, t.clientY)));\n  }, t.prototype.onPointerUp = function (t) {\n    this.touchPoints > 0 && this.touchPoints--, 0 === this.touchPoints && this.isDragging && void 0 !== this.currentMarker && this.currentMarker.pointerUp(this.clientToLocalCoordinates(t.clientX, t.clientY)), this.isDragging = !1, this.addUndoStep();\n  }, t.prototype.onKeyUp = function (t) {\n    void 0 === this.currentMarker || \"Delete\" !== t.key && \"Backspace\" !== t.key || (this.removeMarker(this.currentMarker), this.setCurrentMarker(), this.markerImage.style.cursor = \"default\", this.addUndoStep());\n  }, t.prototype.clientToLocalCoordinates = function (t, e) {\n    var i = this.markerImage.getBoundingClientRect();\n    return {\n      x: t - i.x,\n      y: e - i.y\n    };\n  }, t.prototype.onWindowResize = function () {\n    this.positionUI();\n  }, t.prototype.positionUI = function () {\n    switch (this.setTopLeft(), this.settings.displayMode) {\n      case \"inline\":\n        var t = this.target.offsetTop > l.settings.toolbarHeight ? this.target.offsetTop - l.settings.toolbarHeight : 0;\n        this.coverDiv.style.top = t + \"px\", this.coverDiv.style.left = this.target.offsetLeft.toString() + \"px\";\n        break;\n\n      case \"popup\":\n        this.coverDiv.style.top = \"0px\", this.coverDiv.style.left = \"0px\", this.coverDiv.style.width = \"100vw\", this.coverDiv.style.height = this.windowHeight + \"px\", this.contentDiv.style.maxHeight = this.windowHeight - 2 * this.settings.popupMargin - 3.5 * this.uiStyleSettings.toolbarHeight + \"px\";\n    }\n\n    this.positionMarkerImage(), this.positionLogo();\n  }, t;\n}();\n\nexport { n as Activator, A as ArrowMarker, L as ArrowTypePanel, O as CalloutMarker, y as ColorPickerPanel, I as CoverMarker, V as EllipseFrameMarker, W as EllipseMarker, M as FontFamilyPanel, x as FrameMarker, P as FreehandMarker, H as HighlightMarker, T as LineMarker, S as LineStylePanel, w as LineWidthPanel, B as LinearMarkerBase, _ as MarkerArea, g as MarkerBase, R as MeasurementMarker, D as OpacityPanel, b as RectangleMarker, C as RectangularBoxMarkerBase, f as RectangularBoxMarkerGrips, m as ResizeGrip, k as Settings, l as Style, p as StyleClass, r as SvgHelper, E as TextMarker, u as ToolboxPanel, v as TransformMatrix };","map":{"version":3,"sources":["../node_modules/tslib/tslib.es6.js","../src/core/SvgHelper.ts","../src/core/Activator.ts","../src/core/Renderer.ts","../src/core/Style.ts","../src/ui/Toolbar.ts","../src/ui/Toolbox.ts","../src/ui/ToolboxPanel.ts","../src/ui/toolbox-panels/ColorPickerPanel.ts","../src/core/MarkerBase.ts","../src/markers/RectangularBoxMarkerGrips.ts","../src/markers/ResizeGrip.ts","../src/core/TransformMatrix.ts","../src/markers/RectangularBoxMarkerBase.ts","../src/markers/RectangleMarker.ts","../src/ui/toolbox-panels/LineWidthPanel.ts","../src/ui/toolbox-panels/LineStylePanel.ts","../src/markers/frame-marker/FrameMarker.ts","../src/core/Settings.ts","../src/markers/LinearMarkerBase.ts","../src/markers/line-marker/LineMarker.ts","../src/ui/toolbox-panels/FontFamilyPanel.ts","../src/markers/text-marker/TextMarker.ts","../src/markers/freehand-marker/FreehandMarker.ts","../src/ui/toolbox-panels/ArrowTypePanel.ts","../src/markers/arrow-marker/ArrowMarker.ts","../src/markers/cover-marker/CoverMarker.ts","../src/ui/toolbox-panels/OpacityPanel.ts","../src/markers/highlight-marker/HighlightMarker.ts","../src/markers/callout-marker/CalloutMarker.ts","../src/markers/ellipse-marker/EllipseMarker.ts","../src/markers/measurement-marker/MeasurementMarker.ts","../src/markers/ellipse-frame-marker/EllipseFrameMarker.ts","../src/core/UndoRedoManager.ts","../src/MarkerArea.ts"],"names":["extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","__extends","__","this","constructor","create","__awaiter","thisArg","_arguments","P","generator","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","__generator","body","_","label","sent","t","trys","ops","f","y","g","verb","throw","return","Symbol","iterator","n","v","op","TypeError","pop","length","push","__spreadArrays","s","i","il","arguments","r","k","a","j","jl","SvgHelper","document","createElementNS","el","attributes","attr","setAttribute","width","height","rect","toString","setAttributes","x1","y1","x2","y2","line","points","polygon","radius","circle","rx","ry","ellipse","createSVGTransform","id","orient","markerWidth","markerHeight","refX","refY","markerElement","marker","appendChild","text","tspan","textContent","image","x","svgPoint","createSVGPoint","Activator","key","RegExp","test","Renderer","target","markerImage","canvas","createElement","markerImageCopy","baseVal","valueAsString","viewBox","innerHTML","_this","naturalSize","naturalWidth","naturalHeight","undefined","data","outerHTML","ctx","getContext","markersOnly","drawImage","DOMURL","window","URL","img","Image","blob","Blob","type","url","createObjectURL","onload","revokeObjectURL","toDataURL","imageType","imageQuality","src","Style","canvasBackgroundColor","toolbarBackgroundColor","toolbarBackgroundHoverColor","toolbarColor","toolbarHeight","toolboxBackgroundColor","toolboxColor","toolboxAccentColor","undoButtonVisible","redoButtonVisible","defaultSettings","CLASS_PREFIX","styleClass","styleSheet","addStyleSheet","classes","sheet","addRule","name","style","styleRule","rules","selector","styleSheetRoot","head","StyleRule","addClass","StyleClass","removeChild","_localName","markerjsContainer","displayMode","markerItems","uiStyleSettings","addStyles","adjustLayout","bind","overflowButtonClicked","setCurrentMarker","Toolbar","visiblity","uiContainer","visibility","className","toolbarStyleClass","fadeInAnimationClassName","toolbarStyleColorsClassName","toolbarStyleColorsClass","actionButtonBlock","toolbarBlockStyleClass","whiteSpace","addActionButton","markerButtonBlock","flexGrow","textAlign","markerButtonOverflowBlock","toolbarOverflowBlockStyleClass","toolbarOverflowBlockStyleColorsClassName","toolbarOverflowBlockStyleColorsClass","display","forEach","mi","buttonContainer","toolbarButtonStyleClass","icon","addEventListener","markerToolbarButtonClicked","buttons","markerButtons","overflowButton","toolbarButtonStyleColorsClassName","toolbarButtonStyleColorsClass","resultButtonBlock","setSelectMode","listener","buttonClickListeners","indexOf","splice","resetButtonStyles","setActiveButton","numberToFit","Math","floor","clientWidth","buttonIndex","replace","top","offsetTop","offsetHeight","right","offsetWidth","offsetLeft","button","trim","toolbarActiveButtonStyleColorsClassName","toolbarActiveButtonStyleColorsClass","container","actionButton","actionToolbarButtonClicked","fill","selectButtonColor","deleteButtonColor","okButtonColor","closeButtonColor","round","buttonPadding","markerType","action","currentMarker","fillOpacity","pointerEvents","Toolbox","toolboxStyleClass","toolboxStyleColorsClass","toolboxButtonRowStyleClass","toolboxButtonRowStyleColorsClass","toolboxPanelRowStyleClass","toolboxPanelRowStyleColorsClass","toolboxButtonStyleClass","toolboxButtonStyleColorsClass","toolboxActiveButtonStyleColorsClass","panelButtonClick","toolboxStyleColorsClassName","panels","panelRow","toolboxPanelRowStyleColorsClassName","buttonRow","toolboxButtonRowStyleColorsClassName","panelButtons","panelBtnDiv","toolboxButtonStyleColorsClassName","panel","title","panelIndex","activePanel","panelUI","getUi","margin","fadeOutAnimationClassName","setTimeout","pb","index","toolboxActiveButtonStyleColorsClassName","colors","currentColor","_super","setCurrentColor","getColorBox","ColorPickerPanel","panelDiv","color","colorBoxContainer","colorBoxes","settings","buttonHeight","boxSizing","padding","marginRight","marginBottom","borderWidth","borderStyle","borderRadius","borderColor","colorBox","backgroundColor","box","onColorChanged","MarkerBase","_container","_overlayContainer","_state","overlayContainer","globalSettings","cursor","point","element","childNodes","insertBefore","typeName","state","scaleX","scaleY","findGripByVisual","RectangularBoxMarkerGrips","gripVisual","topLeft","ownsTarget","topCenter","topRight","centerLeft","centerRight","bottomLeft","bottomCenter","bottomRight","visual","createGroup","createCircle","GRIP_SIZE","ResizeGrip","TransformMatrix","matrix","c","currentMatrix","newMatrix","RectangularBoxMarkerBase","left","_visual","translate","createTransform","transform","appendItem","setupControlBox","controlGrips","rotatorGrip","pointerDown","manipulationStartLeft","manipulationStartTop","manipulationStartWidth","manipulationStartHeight","rotatedPoint","unrotatePoint","manipulationStartX","manipulationStartY","offsetX","offsetY","select","activeGrip","rotatedCenter","rotatePoint","centerX","centerY","moveVisual","rotate","getItem","setRotate","rotationAngle","replaceItem","adjustControlBox","inState","pointerUp","defaultSize","manipulate","onMarkerCreated","setTranslate","resize","newX","newWidth","newY","newHeight","setSize","abs","sign","atan","PI","applyRotation","getCTM","createPoint","matrixTransform","inverse","controlBox","deselect","CB_DISTANCE","controlRect","createRect","rotatorGripLine","createLine","addControlGrips","positionGrips","createGrip","grip","gripSize","cx","cy","bottom","positionGrip","assign","visualTransformMatrix","toITransformMatrix","containerTransformMatrix","getState","restoreState","rbmState","setMatrix","toSVGMatrix","scale","rPoint","RectangleMarker","setStrokeColor","setFillColor","setStrokeWidth","setStrokeDasharray","createVisual","fillColor","strokeColor","strokeWidth","strokeDasharray","opacity","addMarkerVisualToContainer","dashes","rectState","widths","currentWidth","setCurrentWidth","LineWidthPanel","overflow","lineWidth","widthBoxContainer","alignItems","justifyContent","innerText","widthBox","minHeight","hr","minWidth","border","borderTop","widthBoxes","onWidthChanged","styles","currentStyle","setCurrentStyle","LineStylePanel","lineStyle","styleBoxContainer","maxWidth","styleBox","styleSample","styleBoxes","newStyle","onStyleChanged","FrameMarker","defaultColor","defaultStrokeWidth","defaultStrokeDasharray","strokePanel","defaultColorSet","strokeWidthPanel","defaultStrokeWidths","strokeStylePanel","defaultStrokeDasharrays","LinearMarkerBase","grip1","grip2","manipulationStartX1","manipulationStartY1","manipulationStartX2","manipulationStartY2","defaultLength","adjustVisual","lmbState","LineMarker","selectorLine","visibleLine","lmState","fonts","currentFont","setCurrentFont","FontFamilyPanel","font","fontBoxContainer","fontBox","fontFamily","fontLabel","textOverflow","fontBoxes","newFont","onFontChanged","TextMarker","DEFAULT_TEXT","defaultFontFamily","setColor","setFont","renderText","sizeText","textEditDivClicked","showTextEditor","positionTextEditor","colorPanel","fontFamilyPanel","defaultFontFamilies","textElement","bgRectangle","found_1","span","createText","isMoved","pointerDownPoint","pointerDownTimestamp","Date","now","lastChild","split","createTSpan","textSize","getBBox","xScale","yScale","min","textBBox","getTextScale","position","getTextPosition","setScale","textEditDiv","textEditor","lineHeight","contentEditable","ev","stopPropagation","fontSize","Number","parseFloat","parseInt","max","cancelBubble","hideVisual","focus","execCommand","textScale","rPosition","rWH","showVisual","dblClick","hideControlBox","showControlBox","textState","FreehandMarker","addCanvas","finishCreation","drawingImage","createImage","canvasContext","strokeStyle","beginPath","moveTo","drawing","lineTo","stroke","closePath","newFreehandMarkerOnPointerUp","canvasElement","clientHeight","imgData","getImageData","_a","startX","startY","endX","endY","containsData","row","col","tmpCanvas","putImageData","drawingImgUrl","setDrawingImage","currentType","setCurrentType","ArrowTypePanel","ti","arrowType","typeBoxContainer","this_1","leftTip","marginLeft","lineBox","rightTip","typeBoxes","newType","onArrowTypeChanged","ArrowMarker","getArrowPoints","setArrowType","arrowTypePanel","arrow1","arrow2","arrowBaseWidth","arrowBaseHeight","createPolygon","createTips","lineAngle1","a1transform","a2transform","amState","CoverMarker","defaultFillColor","fillPanel","opacities","currentOpacity","setCurrentOpacity","OpacityPanel","opacityBoxContainer","opacityBoxes","onOpacityChanged","HighlightMarker","setOpacity","defaultHighlightColor","defaultHighlightOpacity","opacityPanel","defaultOpacitySteps","CalloutMarker","defaultStrokeColor","bgColor","setBgColor","getTipPoints","positionTip","setTipPoints","bgColorPanel","FillColorIcon","tipGrip","tip","createTip","tipMoving","isCreating","tipPosition","tipBase1Position","tipBase2Position","offset","baseWidth","cornerAngle","calloutState","EllipseMarker","createEllipse","MeasurementMarker","tip1","tip2","tipLength","EllipseFrameMarker","UndoRedoManager","undoStack","redoStack","stepData","JSON","stringify","lastRedoStep","lastStep","MarkerArea","DEFAULT_MARKER_TYPES","_availableMarkerTypes","mt","typeType","ALL_MARKER_TYPES","find","allT","Settings","_isOpen","targetRoot","removeStyleSheet","open","setTopLeft","toolbarButtonClicked","createNewMarker","addNewMarker","markerCreated","onPointerDown","onDblClick","onPointerMove","onPointerUp","onKeyUp","overrideOverflow","restoreOverflow","close","closeUI","addCloseEventListener","removeCloseEventListener","addRenderEventListener","removeRenderEventListener","clientToLocalCoordinates","onWindowResize","deleteSelectedMarker","setWindowHeight","removeMarker","setupResizeObserver","setEditingTarget","initMarkerCanvas","initOverlay","attachEvents","isLicensed","addLogo","showUI","renderer","renderAtNaturalSize","renderImageType","renderImageQuality","renderMarkersOnly","renderWidth","renderHeight","rasterize","isOpen","coverDiv","targetObserver","unobserve","removeEventListener","closeEventListeners","_i","markers","renderEventListeners","ResizeObserver","observe","ratio","editorCanvas","windowHeight","innerHeight","imageWidth","imageHeight","editingTarget","markerImageHolder","positionMarkerImage","toolbar","positionLogo","scaleMarkers","targetRect","getBoundingClientRect","bodyRect","setProperty","transformOrigin","defs","createDefs","touchPoints","logoUI","link","href","justifyItems","scrollXState","scrollX","scrollYState","scrollY","bodyOverflowState","scroll","coverTop","zIndex","uiDiv","flexDirection","popupMargin","addButtonClickListener","show","hideToolbar","contentDiv","flexShrink","maxHeight","toolbox","hideToolbox","dispose","mode","addUndoStep","buttonType","switchToSelectMode","undo","redo","startRenderAndClose","undoRedoManager","selectLastMarker","render","markerState","mType","setPanelButtons","toolboxPanels","pointerType","isDragging","clientX","clientY","hitMarker","m","preventDefault","clientRect","positionUI"],"mappings":"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","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","/**\r\n * Utility class to simplify SVG operations.\r\n */\r\nexport class SvgHelper {\r\n  /**\r\n   * Creates SVG \"defs\".\r\n   */\r\n  public static createDefs(): SVGDefsElement {\r\n    const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');\r\n\r\n    return defs;\r\n  }\r\n\r\n  /**\r\n   * Sets attributes on an arbitrary SVG element\r\n   * @param el - target SVG element.\r\n   * @param attributes - set of name-value attribute pairs.\r\n   */\r\n  public static setAttributes(\r\n    el: SVGElement,\r\n    attributes: Array<[string, string]>\r\n  ): void {\r\n    for (const [attr, value] of attributes) {\r\n      el.setAttribute(attr, value);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Creates an SVG rectangle with the specified width and height.\r\n   * @param width \r\n   * @param height \r\n   * @param attributes - additional attributes.\r\n   */\r\n  public static createRect(\r\n    width: number | string,\r\n    height: number | string,\r\n    attributes?: Array<[string, string]>\r\n  ): SVGRectElement {\r\n    const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\r\n\r\n    rect.setAttribute('width', width.toString());\r\n    rect.setAttribute('height', height.toString());\r\n    if (attributes) {\r\n      SvgHelper.setAttributes(rect, attributes);\r\n    }\r\n\r\n    return rect;\r\n  }\r\n\r\n  /**\r\n   * Creates an SVG line with specified end-point coordinates.\r\n   * @param x1 \r\n   * @param y1 \r\n   * @param x2 \r\n   * @param y2 \r\n   * @param attributes - additional attributes.\r\n   */\r\n  public static createLine(\r\n    x1: number | string,\r\n    y1: number | string,\r\n    x2: number | string,\r\n    y2: number | string,\r\n    attributes?: Array<[string, string]>\r\n  ): SVGLineElement {\r\n    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');\r\n\r\n    line.setAttribute('x1', x1.toString());\r\n    line.setAttribute('y1', y1.toString());\r\n    line.setAttribute('x2', x2.toString());\r\n    line.setAttribute('y2', y2.toString());\r\n    if (attributes) {\r\n      SvgHelper.setAttributes(line, attributes);\r\n    }\r\n\r\n    return line;\r\n  }\r\n\r\n  /**\r\n   * Creates an SVG polygon with specified points.\r\n   * @param points - points as string.\r\n   * @param attributes - additional attributes.\r\n   */\r\n  public static createPolygon(\r\n    points: string,\r\n    attributes?: Array<[string, string]>\r\n  ): SVGPolygonElement {\r\n    const polygon = document.createElementNS(\r\n      'http://www.w3.org/2000/svg',\r\n      'polygon'\r\n    );\r\n\r\n    polygon.setAttribute('points', points);\r\n    if (attributes) {\r\n      SvgHelper.setAttributes(polygon, attributes);\r\n    }\r\n\r\n    return polygon;\r\n  }\r\n\r\n  /**\r\n   * Creates an SVG circle with the specified radius.\r\n   * @param radius \r\n   * @param attributes - additional attributes.\r\n   */\r\n  public static createCircle(\r\n    radius: number,\r\n    attributes?: Array<[string, string]>\r\n  ): SVGCircleElement {\r\n    const circle = document.createElementNS(\r\n      'http://www.w3.org/2000/svg',\r\n      'circle'\r\n    );\r\n\r\n    circle.setAttribute('cx', (radius / 2).toString());\r\n    circle.setAttribute('cy', (radius / 2).toString());\r\n    circle.setAttribute('r', radius.toString());\r\n    if (attributes) {\r\n      SvgHelper.setAttributes(circle, attributes);\r\n    }\r\n\r\n    return circle;\r\n  }\r\n\r\n  /**\r\n   * Creates an SVG ellipse with the specified horizontal and vertical radii.\r\n   * @param rx \r\n   * @param ry \r\n   * @param attributes - additional attributes.\r\n   */\r\n  public static createEllipse(\r\n    rx: number,\r\n    ry: number,\r\n    attributes?: Array<[string, string]>\r\n  ): SVGEllipseElement {\r\n    const ellipse = document.createElementNS(\r\n      'http://www.w3.org/2000/svg',\r\n      'ellipse'\r\n    );\r\n\r\n    ellipse.setAttribute('cx', (rx / 2).toString());\r\n    ellipse.setAttribute('cy', (ry / 2).toString());\r\n    ellipse.setAttribute('rx', (rx / 2).toString());\r\n    ellipse.setAttribute('ry', (ry / 2).toString());\r\n    if (attributes) {\r\n      SvgHelper.setAttributes(ellipse, attributes);\r\n    }\r\n\r\n    return ellipse;\r\n  }\r\n\r\n  /**\r\n   * Creates an SVG group.\r\n   * @param attributes - additional attributes.\r\n   */\r\n  public static createGroup(attributes?: Array<[string, string]>): SVGGElement {\r\n    const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');\r\n    if (attributes) {\r\n      SvgHelper.setAttributes(g, attributes);\r\n    }\r\n    return g;\r\n  }\r\n\r\n  /**\r\n   * Creates an SVG transform.\r\n   */\r\n  public static createTransform(): SVGTransform {\r\n    const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n\r\n    return svg.createSVGTransform();\r\n  }\r\n\r\n  /**\r\n   * Creates an SVG marker.\r\n   * @param id \r\n   * @param orient \r\n   * @param markerWidth \r\n   * @param markerHeight \r\n   * @param refX \r\n   * @param refY \r\n   * @param markerElement \r\n   */\r\n  public static createMarker(\r\n    id: string,\r\n    orient: string,\r\n    markerWidth: number | string,\r\n    markerHeight: number | string,\r\n    refX: number | string,\r\n    refY: number | string,\r\n    markerElement: SVGGraphicsElement\r\n  ): SVGMarkerElement {\r\n    const marker = document.createElementNS(\r\n      'http://www.w3.org/2000/svg',\r\n      'marker'\r\n    );\r\n    SvgHelper.setAttributes(marker, [\r\n      ['id', id],\r\n      ['orient', orient],\r\n      ['markerWidth', markerWidth.toString()],\r\n      ['markerHeight', markerHeight.toString()],\r\n      ['refX', refX.toString()],\r\n      ['refY', refY.toString()],\r\n    ]);\r\n\r\n    marker.appendChild(markerElement);\r\n\r\n    return marker;\r\n  }\r\n\r\n  /**\r\n   * Creaes an SVG text element.\r\n   * @param attributes - additional attributes.\r\n   */\r\n  public static createText(\r\n    attributes?: Array<[string, string]>\r\n  ): SVGTextElement {\r\n    const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');\r\n    text.setAttribute('x', '0');\r\n    text.setAttribute('y', '0');\r\n\r\n    if (attributes) {\r\n      SvgHelper.setAttributes(text, attributes);\r\n    }\r\n\r\n    return text;\r\n  }\r\n\r\n  /**\r\n   * Creates an SVG TSpan.\r\n   * @param text - inner text.\r\n   * @param attributes - additional attributes.\r\n   */\r\n  public static createTSpan(\r\n    text: string,\r\n    attributes?: Array<[string, string]>\r\n  ): SVGTSpanElement {\r\n    const tspan = document.createElementNS(\r\n      'http://www.w3.org/2000/svg',\r\n      'tspan'\r\n    );\r\n    tspan.textContent = text;\r\n\r\n    if (attributes) {\r\n      SvgHelper.setAttributes(tspan, attributes);\r\n    }\r\n\r\n    return tspan;\r\n  }\r\n\r\n  /**\r\n   * Creates an SVG image element.\r\n   * @param attributes - additional attributes.\r\n   */\r\n  public static createImage(\r\n    attributes?: Array<[string, string]>\r\n  ): SVGImageElement {\r\n    const image = document.createElementNS(\r\n      'http://www.w3.org/2000/svg',\r\n      'image'\r\n    );\r\n\r\n    if (attributes) {\r\n      SvgHelper.setAttributes(image, attributes);\r\n    }\r\n\r\n    return image;\r\n  }\r\n\r\n  /**\r\n   * Creates an SVG point with the specified coordinates.\r\n   * @param x \r\n   * @param y \r\n   */\r\n  public static createPoint(      \r\n    x: number,\r\n    y: number\r\n  ): SVGPoint {\r\n      const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n      const svgPoint = svg.createSVGPoint();\r\n      svgPoint.x = x;\r\n      svgPoint.y = y;\r\n  \r\n      return svgPoint;\r\n  }\r\n}\r\n","/**\r\n * Manages commercial marker.js 2 licenses.\r\n */\r\nexport class Activator {\r\n  private static key: string;\r\n\r\n  /**\r\n   * Add a license key\r\n   * @param key license key sent to you after purchase.\r\n   */\r\n  public static addKey(key: string): void {\r\n    Activator.key = key;\r\n  }\r\n\r\n  /**\r\n   * Returns true if the copy of marker.js is commercially licensed.\r\n   */\r\n  public static get isLicensed(): boolean {\r\n    // NOTE:\r\n    // before removing or modifying this please consider supporting marker.js\r\n    // by visiting https://markerjs.com/ for details\r\n    // thank you!\r\n    if (Activator.key) {\r\n      const keyRegex = new RegExp(/^MJS2-[A-Z][0-9]{3}-[A-Z][0-9]{3}-[0-9]{4}$/, 'i');\r\n      return keyRegex.test(Activator.key);\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Renders the original image and markup to a flat raster image.\r\n */\r\nexport class Renderer {\r\n    /**\r\n     * Whether the image should be rendered at the original (natural) target image size.\r\n     */\r\n    public naturalSize = false; \r\n    /**\r\n     * Rendered image type (`image/png`, `image/jpeg`, etc.).\r\n     */\r\n    public imageType = 'image/png';\r\n    /**\r\n     * For formats that support it, specifies rendering quality.\r\n     * \r\n     * In the case of `image/jpeg` you can specify a value between 0 and 1 (lowest to highest quality).\r\n     *\r\n     * @type {number} - image rendering quality (0..1)\r\n     */\r\n    public imageQuality?: number;\r\n    /**\r\n     * When set to true, only the marker layer without the original image will be rendered.\r\n     */\r\n    public markersOnly = false;\r\n\r\n    /**\r\n     * When set and {@linkcode naturalSize} is `false` sets the width of the rendered image.\r\n     * \r\n     * Both `width` and `height` have to be set for this to take effect.\r\n     */\r\n    public width?: number;\r\n    /**\r\n     * When set and {@linkcode naturalSize} is `false` sets the height of the rendered image.\r\n     * \r\n     * Both `width` and `height` have to be set for this to take effect.\r\n     */\r\n    public height?: number;\r\n\r\n\r\n    /**\r\n     * Initiates rendering of the result image and returns a promise which when resolved\r\n     * contains a data URL for the rendered image.\r\n     * \r\n     * @param target - target (underlying original) image\r\n     * @param markerImage - marker layer\r\n     */\r\n    public rasterize(\r\n        target: HTMLImageElement, \r\n        markerImage: SVGSVGElement, \r\n    ): Promise<string> {\r\n        return new Promise<string>((resolve) => {\r\n            const canvas = document.createElement(\"canvas\");\r\n\r\n            const markerImageCopy = document.createElementNS(\r\n            'http://www.w3.org/2000/svg',\r\n            'svg'\r\n            );\r\n            markerImageCopy.setAttribute('xmlns', 'http://www.w3.org/2000/svg');\r\n            markerImageCopy.setAttribute('width', markerImage.width.baseVal.valueAsString);\r\n            markerImageCopy.setAttribute(\r\n              'height',\r\n              markerImage.height.baseVal.valueAsString\r\n            );\r\n            markerImageCopy.setAttribute(\r\n              'viewBox',\r\n              '0 0 ' +\r\n                markerImage.viewBox.baseVal.width.toString() +\r\n                ' ' +\r\n                markerImage.viewBox.baseVal.height.toString()\r\n            );            \r\n            markerImageCopy.innerHTML = markerImage.innerHTML;\r\n\r\n            if (this.naturalSize === true) {\r\n                // scale to full image size\r\n                markerImageCopy.width.baseVal.value = target.naturalWidth;\r\n                markerImageCopy.height.baseVal.value = target.naturalHeight;\r\n            } else if (this.width !== undefined && this.height !== undefined) {\r\n                // scale to specific dimensions\r\n                markerImageCopy.width.baseVal.value = this.width;\r\n                markerImageCopy.height.baseVal.value = this.height;\r\n            }\r\n    \r\n            canvas.width = markerImageCopy.width.baseVal.value;\r\n            canvas.height = markerImageCopy.height.baseVal.value;\r\n    \r\n            const data = markerImageCopy.outerHTML;\r\n\r\n            const ctx = canvas.getContext(\"2d\");\r\n            if (this.markersOnly !== true) { \r\n                ctx.drawImage(target, 0, 0, canvas.width, canvas.height);\r\n            }\r\n    \r\n            const DOMURL = window.URL; // || window.webkitURL || window;\r\n    \r\n            const img = new Image(canvas.width, canvas.height);\r\n            img.setAttribute(\"crossOrigin\", \"anonymous\");\r\n    \r\n            const blob = new Blob([data], { type: \"image/svg+xml\" });\r\n    \r\n            const url = DOMURL.createObjectURL(blob);\r\n    \r\n            img.onload = () => {\r\n                ctx.drawImage(img, 0, 0);\r\n                DOMURL.revokeObjectURL(url);\r\n    \r\n                const result = canvas.toDataURL(this.imageType, this.imageQuality);\r\n                resolve(result);\r\n            };\r\n    \r\n            img.src = url;\r\n        });\r\n    }\r\n}\r\n","import { IStyleSettings } from './IStyleSettings';\r\n\r\n/**\r\n * Simple utility CSS-in-JS implementation.\r\n */\r\nexport class Style {\r\n  /**\r\n   * Prefix used for all internally created CSS classes.\r\n   */\r\n  public static CLASS_PREFIX = '__markerjs2_';\r\n\r\n  private static classes: StyleClass[] = [];\r\n  private static rules: StyleRule[] = [];\r\n  private static styleSheet?: HTMLStyleElement;\r\n\r\n  /**\r\n   * For cases when you need to add the stylesheet to anything\r\n   * other than document.head (default), set this property\r\n   * befor calling `MarkerArea.show()`.\r\n   * \r\n   * Example: here we set the rendering/placement root (targetRoot)\r\n   * to the `shadowRoot` of a web componet and set `styleSheetRoot`\r\n   * to the same value as well.\r\n   * \r\n   * ```javascript\r\n   * const markerArea = new markerjs2.MarkerArea(target);\r\n   * markerArea.targetRoot = this.shadowRoot;\r\n   * markerjs2.Style.styleSheetRoot = this.shadowRoot;\r\n   * markerArea.show();\r\n   * ```\r\n   * \r\n   * Known issue/limitation:\r\n   * you can't use marker.js 2 in both main and Shadow DOM\r\n   * on the same page.\r\n   */\r\n  public static styleSheetRoot: HTMLElement;\r\n\r\n  /**\r\n   * Returns default UI styles.\r\n   */\r\n  public static get defaultSettings(): IStyleSettings {\r\n    return {\r\n      canvasBackgroundColor: '#ffffff',\r\n      toolbarBackgroundColor: '#111111',\r\n      toolbarBackgroundHoverColor: '#333333',\r\n      toolbarColor: '#eeeeee',\r\n      toolbarHeight: 40,\r\n      toolboxBackgroundColor: '#2a2a2a',\r\n      toolboxColor: '#eeeeee',\r\n      toolboxAccentColor: '#3080c3',\r\n      undoButtonVisible: true,\r\n      redoButtonVisible: false\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Holds current UI styles.\r\n   */\r\n  public static settings: IStyleSettings = Style.defaultSettings;\r\n\r\n  /**\r\n   * Returns global fade-in animation class name.\r\n   */\r\n  public static get fadeInAnimationClassName(): string {\r\n    return `${Style.CLASS_PREFIX}fade_in`;\r\n  }\r\n  /**\r\n   * Returns global fade-out animation class name.\r\n   */\r\n  public static get fadeOutAnimationClassName(): string {\r\n    return `${Style.CLASS_PREFIX}fade_out`;\r\n  }\r\n\r\n  /**\r\n   * Adds a CSS class declaration.\r\n   * @param styleClass - class to add.\r\n   */\r\n  public static addClass(styleClass: StyleClass): StyleClass {\r\n    if (Style.styleSheet === undefined) {\r\n      Style.addStyleSheet();\r\n    }\r\n    Style.classes.push(styleClass);\r\n    Style.styleSheet.sheet.addRule('.' + styleClass.name, styleClass.style);\r\n    return styleClass;\r\n  }\r\n\r\n  /**\r\n   * Add arbitrary CSS rule\r\n   * @param styleRule - CSS rule to add.\r\n   */\r\n  public static addRule(styleRule: StyleRule): void {\r\n    if (Style.styleSheet === undefined) {\r\n      Style.addStyleSheet();\r\n    }\r\n    Style.rules.push(styleRule);\r\n    Style.styleSheet.sheet.addRule(styleRule.selector, styleRule.style);\r\n  }\r\n\r\n  private static addStyleSheet() {\r\n    Style.styleSheet = document.createElement('style');\r\n    (Style.styleSheetRoot ?? document.head).appendChild(Style.styleSheet);\r\n\r\n    // add global rules\r\n    Style.addRule(new StyleRule(`.${Style.CLASS_PREFIX} h3`, 'font-family: sans-serif'));\r\n\r\n    Style.addRule(new StyleRule(`@keyframes ${Style.CLASS_PREFIX}_fade_in_animation_frames`, `\r\n        from {\r\n          opacity: 0;\r\n        }\r\n        to {\r\n          opacity: 1;\r\n        }\r\n    `));\r\n    Style.addRule(new StyleRule(`@keyframes ${Style.CLASS_PREFIX}_fade_out_animation_frames`, `\r\n        from {\r\n          opacity: 1;\r\n        }\r\n        to {\r\n          opacity: 0;\r\n        }\r\n    `));\r\n\r\n    Style.addClass(new StyleClass('fade_in', `\r\n      animation-duration: 0.3s;\r\n      animation-name: ${Style.CLASS_PREFIX}_fade_in_animation_frames;\r\n    `));\r\n    Style.addClass(new StyleClass('fade_out', `\r\n      animation-duration: 0.3s;\r\n      animation-name: ${Style.CLASS_PREFIX}_fade_out_animation_frames;\r\n    `));\r\n  }\r\n\r\n  public static removeStyleSheet(): void {\r\n    if (Style.styleSheet) {\r\n      (Style.styleSheetRoot ?? document.head).removeChild(Style.styleSheet);\r\n      Style.styleSheet = undefined;\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Represents an arbitrary CSS rule.\r\n */\r\nexport class StyleRule {\r\n  /**\r\n   * CSS selector.\r\n   */\r\n  public selector: string;\r\n  /**\r\n   * Style declaration for the rule.\r\n   */\r\n  public style: string;\r\n  /**\r\n   * Creates an arbitrary CSS rule using the selector and style rules.\r\n   * @param selector - CSS selector\r\n   * @param style - styles to apply\r\n   */\r\n  constructor(selector: string, style: string) {\r\n    this.selector = selector;\r\n    this.style = style; \r\n  }\r\n}\r\n\r\n/**\r\n * Represents a CSS class.\r\n */\r\nexport class StyleClass {\r\n  /**\r\n   * CSS style rules for the class.\r\n   */\r\n  public style: string;\r\n  \r\n  private _localName: string;\r\n  /**\r\n   * Returns fully qualified CSS class name.\r\n   */\r\n  public get name(): string {\r\n    return `${Style.CLASS_PREFIX}${this._localName}`;\r\n  }\r\n\r\n  /**\r\n   * Creates a CSS class declaration based on supplied (local) name and style rules.\r\n   * @param name - local CSS class name (will be prefixed with the marker.js prefix).\r\n   * @param style - style declarations.\r\n   */\r\n  constructor(name: string, style: string) {\r\n    this._localName = name;\r\n    this.style = style; \r\n  }\r\n}\r\n","import { MarkerBase } from './../core/MarkerBase';\r\nimport { Style, StyleClass, StyleRule } from './../core/Style';\r\n\r\nimport CursorIcon from './toolbar-core-icons/cursor.svg';\r\nimport DeleteIcon from './toolbar-core-icons/delete.svg';\r\nimport CheckIcon from './toolbar-core-icons/check.svg';\r\nimport CloseIcon from './toolbar-core-icons/close.svg';\r\nimport OverflowIcon from './toolbar-core-icons/overflow.svg';\r\nimport UndoIcon from './toolbar-core-icons/undo.svg';\r\nimport RedoIcon from './toolbar-core-icons/redo.svg';\r\nimport { IStyleSettings } from '../core/IStyleSettings';\r\nimport { DisplayMode } from '../core/Settings';\r\n\r\n/**\r\n * Toolbar button type:\r\n * - `action` for non-marker buttons like select, delete, etc.\r\n * - `marker` for marker type buttons.\r\n */\r\nexport type ToolbarButtonType = 'action' | 'marker';\r\n\r\n/**\r\n * Click handler type for toolbar button click events.\r\n */\r\nexport type ToolbarButtonClickHandler = (\r\n  buttonType: ToolbarButtonType,\r\n  value?: typeof MarkerBase | string\r\n) => void;\r\n\r\n/**\r\n * Toolbar represents the main toolbar of the marker.js 2 interface.\r\n */\r\nexport class Toolbar {\r\n  private markerItems: typeof MarkerBase[];\r\n\r\n  private buttons: HTMLDivElement[] = [];\r\n  private markerButtons: HTMLDivElement[] = [];\r\n  private overflowButton: HTMLDivElement;\r\n\r\n  private markerjsContainer: HTMLDivElement;\r\n  private displayMode: DisplayMode;\r\n  private uiContainer: HTMLDivElement;\r\n\r\n  private toolbarStyleClass: StyleClass;\r\n  private toolbarStyleColorsClass: StyleClass;\r\n  private toolbarBlockStyleClass: StyleClass;\r\n  private toolbarOverflowBlockStyleClass: StyleClass;\r\n  private toolbarOverflowBlockStyleColorsClass: StyleClass;\r\n  private toolbarButtonStyleClass: StyleClass;\r\n  private toolbarButtonStyleColorsClass: StyleClass;\r\n  private toolbarActiveButtonStyleColorsClass: StyleClass;\r\n\r\n  private markerButtonBlock: HTMLDivElement\r\n  private markerButtonOverflowBlock: HTMLDivElement\r\n\r\n  private buttonClickListeners: ToolbarButtonClickHandler[] = [];\r\n\r\n  private uiStyleSettings: IStyleSettings;\r\n\r\n  private currentMarker?: MarkerBase;\r\n\r\n  /**\r\n   * Creates the main marker.js toolbar.\r\n   * @param markerjsContainer - container for the toolbar in the marker.js UI.\r\n   * @param displayMode - marker.js display mode (`inline` or `popup`).\r\n   * @param markerItems - available marker types.\r\n   * @param uiStyleSettings - settings for styling the tooblar ui.\r\n   */\r\n  constructor(\r\n    markerjsContainer: HTMLDivElement, \r\n    displayMode: DisplayMode, \r\n    markerItems: typeof MarkerBase[], \r\n    uiStyleSettings: IStyleSettings\r\n  ) {\r\n    this.markerjsContainer = markerjsContainer;\r\n    this.displayMode = displayMode;\r\n    this.markerItems = markerItems;\r\n    this.uiStyleSettings = uiStyleSettings;\r\n    this.addStyles();\r\n\r\n    this.adjustLayout = this.adjustLayout.bind(this);\r\n    this.overflowButtonClicked = this.overflowButtonClicked.bind(this);\r\n    this.setCurrentMarker = this.setCurrentMarker.bind(this);\r\n  }\r\n\r\n  /**\r\n   * Creates and displays the toolbar UI.\r\n   */\r\n  public show(visiblity: string): void {\r\n    this.uiContainer = document.createElement('div');\r\n    this.uiContainer.style.visibility = visiblity;\r\n    this.uiContainer.className = `${this.toolbarStyleClass.name} ${Style.fadeInAnimationClassName} ${\r\n      this.uiStyleSettings.toolbarStyleColorsClassName ? \r\n      this.uiStyleSettings.toolbarStyleColorsClassName : this.toolbarStyleColorsClass.name}`;\r\n\r\n    const actionButtonBlock = document.createElement('div');\r\n    actionButtonBlock.className = this.toolbarBlockStyleClass.name;\r\n    actionButtonBlock.style.whiteSpace = 'nowrap';\r\n    this.uiContainer.appendChild(actionButtonBlock);\r\n\r\n    this.addActionButton(actionButtonBlock, CursorIcon, 'select');\r\n    this.addActionButton(actionButtonBlock, DeleteIcon, 'delete');\r\n    if (this.uiStyleSettings.undoButtonVisible) {\r\n      this.addActionButton(actionButtonBlock, UndoIcon, 'undo');\r\n    }\r\n    if (this.uiStyleSettings.redoButtonVisible) {\r\n      this.addActionButton(actionButtonBlock, RedoIcon, 'redo');\r\n    }\r\n\r\n    this.markerButtonBlock = document.createElement('div');\r\n    this.markerButtonBlock.className = this.toolbarBlockStyleClass.name;\r\n    this.markerButtonBlock.style.flexGrow = '2';\r\n    this.markerButtonBlock.style.textAlign = 'center';\r\n    this.uiContainer.appendChild(this.markerButtonBlock);\r\n\r\n    this.markerButtonOverflowBlock = document.createElement('div');\r\n    this.markerButtonOverflowBlock.className = `${this.toolbarOverflowBlockStyleClass.name} ${\r\n      this.uiStyleSettings.toolbarOverflowBlockStyleColorsClassName ? \r\n      this.uiStyleSettings.toolbarOverflowBlockStyleColorsClassName : this.toolbarOverflowBlockStyleColorsClass.name}`;\r\n    this.markerButtonOverflowBlock.style.display = 'none';\r\n    this.uiContainer.appendChild(this.markerButtonOverflowBlock);\r\n\r\n    if (this.markerItems) {\r\n      this.markerItems.forEach((mi) => {\r\n        const buttonContainer = document.createElement('div');\r\n        buttonContainer.className = `${this.toolbarButtonStyleClass.name}`;\r\n        //  ${\r\n        //   this.uiStyleSettings.toolbarButtonStyleColorsClassName ? \r\n        //   this.uiStyleSettings.toolbarButtonStyleColorsClassName : this.toolbarButtonStyleColorsClass.name}`;\r\n        buttonContainer.innerHTML = mi.icon;\r\n        buttonContainer.addEventListener('click', () => {\r\n          this.markerToolbarButtonClicked(buttonContainer, mi);\r\n        });\r\n        //this.markerButtonBlock.appendChild(buttonContainer);\r\n        this.buttons.push(buttonContainer);\r\n        this.markerButtons.push(buttonContainer);\r\n      });\r\n      this.overflowButton = document.createElement('div');\r\n      this.overflowButton.className = `${this.toolbarButtonStyleClass.name} ${\r\n        this.uiStyleSettings.toolbarButtonStyleColorsClassName ? \r\n        this.uiStyleSettings.toolbarButtonStyleColorsClassName : this.toolbarButtonStyleColorsClass.name}`;\r\n      this.overflowButton.innerHTML = OverflowIcon;\r\n      this.overflowButton.addEventListener('click', this.overflowButtonClicked)\r\n      this.markerButtonBlock.appendChild(this.overflowButton);\r\n  }\r\n\r\n    const resultButtonBlock = document.createElement('div');\r\n    resultButtonBlock.className = this.toolbarBlockStyleClass.name;\r\n    resultButtonBlock.style.whiteSpace = 'nowrap';\r\n    this.uiContainer.appendChild(resultButtonBlock);\r\n\r\n    this.addActionButton(resultButtonBlock, CheckIcon, 'render');\r\n    this.addActionButton(resultButtonBlock, CloseIcon, 'close');\r\n\r\n    this.markerjsContainer.appendChild(this.uiContainer);\r\n    this.setSelectMode();\r\n\r\n    this.setCurrentMarker();\r\n\r\n    this.adjustLayout();\r\n    // setTimeout(this.adjustLayout, 10);\r\n  }\r\n\r\n  /**\r\n   * Add a listener to the toolbar button click event.\r\n   * @param listener \r\n   */\r\n  public addButtonClickListener(listener: ToolbarButtonClickHandler): void {\r\n    this.buttonClickListeners.push(listener);\r\n  }\r\n\r\n  /**\r\n   * Remove a listener for the toolbar button click event.\r\n   * @param listener \r\n   */\r\n  public removeButtonClickListener(listener: ToolbarButtonClickHandler): void {\r\n    if (this.buttonClickListeners.indexOf(listener) > -1) {\r\n      this.buttonClickListeners.splice(\r\n        this.buttonClickListeners.indexOf(listener),\r\n        1\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Switch toolbar to the `select` mode.\r\n   */\r\n  public setSelectMode(): void {\r\n    this.resetButtonStyles();\r\n    this.setActiveButton(this.buttons[0]);\r\n  }\r\n\r\n  /**\r\n   * Adjusts toolbar layout.\r\n   */\r\n  public adjustLayout(): void {\r\n    if (this.markerButtons && this.markerButtons.length > 0) {\r\n      const numberToFit = Math.floor(this.markerButtonBlock.clientWidth / this.uiStyleSettings.toolbarHeight) - 1;\r\n      this.markerButtonBlock.innerHTML = '';\r\n      this.markerButtonOverflowBlock.innerHTML = '';\r\n      for (let buttonIndex = 0; buttonIndex < this.markerButtons.length; buttonIndex++) {\r\n        if (buttonIndex < numberToFit || (buttonIndex === numberToFit && (this.markerButtons.length - 1) === numberToFit)) {\r\n          this.markerButtonBlock.appendChild(this.markerButtons[buttonIndex]);\r\n        } else {\r\n          if (buttonIndex === numberToFit) {\r\n            this.markerButtonBlock.appendChild(this.overflowButton);\r\n          }\r\n          this.markerButtonOverflowBlock.appendChild(this.markerButtons[buttonIndex]);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  private overflowButtonClicked() {\r\n    if (this.markerButtonOverflowBlock.style.display !== 'none') {\r\n      this.markerButtonOverflowBlock.className = this.markerButtonOverflowBlock.className.replace(\r\n        Style.fadeInAnimationClassName, '');\r\n      this.markerButtonOverflowBlock.style.display = 'none';\r\n    } else {\r\n      this.markerButtonOverflowBlock.className += ` ${Style.fadeInAnimationClassName}`;\r\n      this.markerButtonOverflowBlock.style.top = `${this.uiContainer.offsetTop + this.overflowButton.offsetHeight}px`;\r\n      this.markerButtonOverflowBlock.style.right = `${this.uiContainer.offsetWidth - this.overflowButton.offsetLeft - this.overflowButton.offsetWidth + this.uiContainer.offsetLeft * 2}px`;\r\n      this.markerButtonOverflowBlock.style.display = 'inline-block';\r\n    }\r\n  }\r\n\r\n  private resetButtonStyles() {\r\n    this.buttons.forEach(button => {\r\n      button.className = button.className\r\n        .replace(this.uiStyleSettings.toolbarButtonStyleColorsClassName ? \r\n          this.uiStyleSettings.toolbarButtonStyleColorsClassName : this.toolbarButtonStyleColorsClass.name, '')\r\n        .trim();\r\n      button.className = button.className\r\n        .replace(this.uiStyleSettings.toolbarActiveButtonStyleColorsClassName ? \r\n          this.uiStyleSettings.toolbarActiveButtonStyleColorsClassName : this.toolbarActiveButtonStyleColorsClass.name, '')\r\n        .trim();\r\n      button.className += ` ${this.uiStyleSettings.toolbarButtonStyleColorsClassName ? \r\n        this.uiStyleSettings.toolbarButtonStyleColorsClassName : this.toolbarButtonStyleColorsClass.name}`;\r\n    });\r\n  }\r\n\r\n  private addActionButton(container: HTMLDivElement, icon: string, value: string) {\r\n    const actionButton = document.createElement('div');\r\n    actionButton.className = `${this.toolbarButtonStyleClass.name}`;\r\n    //  ${\r\n    //   this.uiStyleSettings.toolbarButtonStyleColorsClassName ? \r\n    //   this.uiStyleSettings.toolbarButtonStyleColorsClassName : this.toolbarButtonStyleColorsClass.name}`;\r\n    actionButton.innerHTML = icon;\r\n    actionButton.addEventListener('click', () => {\r\n      this.actionToolbarButtonClicked(actionButton, value);\r\n    });\r\n    switch(value) {\r\n      case 'select':\r\n        actionButton.style.fill = this.uiStyleSettings.selectButtonColor;\r\n        break;\r\n      case 'delete':\r\n        actionButton.style.fill = this.uiStyleSettings.deleteButtonColor;\r\n        break;\r\n      case 'undo':\r\n          actionButton.style.fill = this.uiStyleSettings.selectButtonColor;\r\n          break;\r\n      case 'redo':\r\n          actionButton.style.fill = this.uiStyleSettings.selectButtonColor;\r\n          break;\r\n        case 'render':\r\n        actionButton.style.fill = this.uiStyleSettings.okButtonColor;\r\n        break;\r\n      case 'close':\r\n        actionButton.style.fill = this.uiStyleSettings.closeButtonColor;\r\n        break;\r\n    }\r\n\r\n    container.appendChild(actionButton);\r\n    this.buttons.push(actionButton);\r\n  }\r\n\r\n  private addStyles() {\r\n    this.toolbarStyleClass = Style.addClass(\r\n      new StyleClass(\r\n        'toolbar',\r\n        `\r\n      width: 100%;\r\n      flex-shrink: 0;\r\n      display: flex;\r\n      flex-direction: row;\r\n      justify-content: space-between;      \r\n      height: ${this.uiStyleSettings.toolbarHeight}px;\r\n      box-sizing: content-box;\r\n      ${this.displayMode === 'inline' ? `border-top-left-radius: ${Math.round(this.uiStyleSettings.toolbarHeight/10)}px;` : ''}\r\n      ${this.displayMode === 'inline' ? `border-top-right-radius: ${Math.round(this.uiStyleSettings.toolbarHeight/10)}px;` : ''}\r\n      overflow: hidden;\r\n    `\r\n      )\r\n    );\r\n\r\n    this.toolbarStyleColorsClass = Style.addClass(\r\n      new StyleClass(\r\n        'toolbar_colors',\r\n        `\r\n      background-color: ${this.uiStyleSettings.toolbarBackgroundColor};\r\n      box-shadow: 0px 3px rgba(33, 33, 33, 0.1);\r\n    `\r\n      )\r\n    );\r\n\r\n    this.toolbarBlockStyleClass = Style.addClass(\r\n      new StyleClass(\r\n        'toolbar-block',\r\n        `\r\n        display: inline-block;\r\n        box-sizing: content-box;\r\n    `\r\n      )\r\n    );\r\n\r\n    this.toolbarOverflowBlockStyleClass = Style.addClass(\r\n      new StyleClass(\r\n        'toolbar-overflow-block',\r\n        `\r\n        position: absolute;\r\n        top: ${this.uiStyleSettings.toolbarHeight}px;\r\n        max-width: ${this.uiStyleSettings.toolbarHeight * 2}px;\r\n        z-index: 10;\r\n        box-sizing: content-box;\r\n      `\r\n      )\r\n    );\r\n    this.toolbarOverflowBlockStyleColorsClass = Style.addClass(\r\n      new StyleClass(\r\n        'toolbar-overflow-block_colors',\r\n        `\r\n        background-color: ${this.uiStyleSettings.toolbarBackgroundColor};\r\n      `\r\n      )\r\n    );\r\n\r\n    const buttonPadding = this.uiStyleSettings.toolbarHeight / 4;\r\n    this.toolbarButtonStyleClass = Style.addClass(new StyleClass('toolbar_button', `\r\n      display: inline-block;\r\n      width: ${this.uiStyleSettings.toolbarHeight - buttonPadding * 2}px;\r\n      height: ${this.uiStyleSettings.toolbarHeight - buttonPadding * 2}px;\r\n      padding: ${buttonPadding}px;\r\n      box-sizing: content-box;\r\n    `));\r\n    this.toolbarButtonStyleColorsClass = Style.addClass(new StyleClass('toolbar_button_colors', `\r\n      fill: ${this.uiStyleSettings.toolbarColor};\r\n    `));\r\n\r\n    this.toolbarActiveButtonStyleColorsClass = Style.addClass(new StyleClass('toolbar_active_button', `\r\n      fill: ${this.uiStyleSettings.toolbarColor};\r\n      background-color: ${this.uiStyleSettings.toolbarBackgroundHoverColor}\r\n    `));\r\n\r\n    Style.addRule(\r\n      new StyleRule(\r\n        `.${this.toolbarButtonStyleClass.name} svg`,\r\n        `\r\n      height: ${this.uiStyleSettings.toolbarHeight / 2}px;\r\n    `\r\n      )\r\n    );\r\n\r\n    Style.addRule(\r\n      new StyleRule(\r\n        `.${this.toolbarButtonStyleColorsClass.name}:hover`,\r\n        `\r\n        background-color: ${this.uiStyleSettings.toolbarBackgroundHoverColor}\r\n    `\r\n      )\r\n    );\r\n  }\r\n\r\n  private markerToolbarButtonClicked(button: HTMLDivElement, markerType: typeof MarkerBase) {\r\n    this.setActiveButton(button);\r\n    if (this.buttonClickListeners && this.buttonClickListeners.length > 0) {\r\n      this.buttonClickListeners.forEach((listener) =>\r\n        listener('marker', markerType)\r\n      );\r\n    }\r\n    this.markerButtonOverflowBlock.style.display = 'none';\r\n  }\r\n\r\n  private actionToolbarButtonClicked(button: HTMLDivElement, action: string) {\r\n    if (this.buttonClickListeners && this.buttonClickListeners.length > 0) {\r\n      this.buttonClickListeners.forEach((listener) =>\r\n        listener('action', action)\r\n      );\r\n    }\r\n    this.markerButtonOverflowBlock.style.display = 'none';\r\n    this.setActiveButton(this.buttons[0]);\r\n  }\r\n\r\n  private setActiveButton(button: HTMLDivElement) {\r\n    this.resetButtonStyles();\r\n    button.className = button.className\r\n      .replace(this.uiStyleSettings.toolbarButtonStyleColorsClassName ? \r\n        this.uiStyleSettings.toolbarButtonStyleColorsClassName : this.toolbarButtonStyleColorsClass.name, '')\r\n      .trim();\r\n    button.className += ` ${this.uiStyleSettings.toolbarActiveButtonStyleColorsClassName ? \r\n      this.uiStyleSettings.toolbarActiveButtonStyleColorsClassName : this.toolbarActiveButtonStyleColorsClass.name}`;\r\n  }\r\n\r\n  /**\r\n   * Sets current marker and enables/disables the delete button accordingly.\r\n   * @param marker \r\n   */\r\n  public setCurrentMarker(marker?: MarkerBase): void {\r\n    this.currentMarker = marker;\r\n    if (this.currentMarker === undefined) {\r\n      this.buttons[1].style.fillOpacity = '0.4';\r\n      this.buttons[1].style.pointerEvents = 'none';\r\n    } else {\r\n      this.buttons[1].style.fillOpacity = '1';\r\n      this.buttons[1].style.pointerEvents = 'all';\r\n    }\r\n  }\r\n}\r\n","import { ToolboxPanel } from './ToolboxPanel';\r\nimport { Style, StyleClass, StyleRule } from './../core/Style';\r\nimport { DisplayMode } from '../core/Settings';\r\nimport { IStyleSettings } from '../core/IStyleSettings';\r\n\r\n/**\r\n * Represents the contextual toolbox for the selected marker type.\r\n */\r\nexport class Toolbox {\r\n  private panels: ToolboxPanel[] = [];\r\n  private activePanel: ToolboxPanel;\r\n  private panelButtons: HTMLDivElement[] = [];\r\n\r\n  private markerjsContainer: HTMLDivElement;\r\n  private displayMode: DisplayMode;\r\n  private uiContainer: HTMLDivElement;\r\n  private buttonRow: HTMLDivElement;\r\n  private panelRow: HTMLDivElement;\r\n\r\n  private toolboxStyleClass: StyleClass;\r\n  private toolboxStyleColorsClass: StyleClass;\r\n  private toolboxButtonStyleClass: StyleClass;\r\n  private toolboxButtonStyleColorsClass: StyleClass;\r\n  private toolboxActiveButtonStyleColorsClass: StyleClass;\r\n  private toolboxButtonRowStyleClass: StyleClass;\r\n  private toolboxButtonRowStyleColorsClass: StyleClass;\r\n  private toolboxPanelRowStyleClass: StyleClass;\r\n  private toolboxPanelRowStyleColorsClass: StyleClass;\r\n\r\n  private uiStyleSettings: IStyleSettings;\r\n  \r\n  private addStyles() {\r\n    this.toolboxStyleClass = Style.addClass(\r\n      new StyleClass(\r\n        'toolbox',\r\n        `\r\n      width: 100%;\r\n      flex-shrink: 0;\r\n      display: flex;\r\n      flex-direction: column;\r\n      font-family: sans-serif;\r\n      ${this.displayMode === 'popup' ? 'height:' + this.uiStyleSettings.toolbarHeight * 2.5 + 'px;' : ''}\r\n      box-sizing: content-box;\r\n      ${this.displayMode === 'popup' ? `background-color: ${this.uiStyleSettings.canvasBackgroundColor};` : ''}\r\n      ${this.displayMode === 'inline' ? `border-bottom-left-radius: ${Math.round(this.uiStyleSettings.toolbarHeight/10)}px;` : ''}\r\n      ${this.displayMode === 'inline' ? `border-bottom-right-radius: ${Math.round(this.uiStyleSettings.toolbarHeight/10)}px;` : ''}\r\n      overflow: hidden;\r\n    `\r\n      )\r\n    );\r\n    this.toolboxStyleColorsClass = Style.addClass(\r\n      new StyleClass(\r\n        'toolbox_colors',\r\n        `\r\n      color: ${this.uiStyleSettings.toolboxColor};\r\n    `\r\n      )\r\n    );\r\n\r\n    const buttonPadding = this.uiStyleSettings.toolbarHeight / 4;\r\n    this.toolboxButtonRowStyleClass = Style.addClass(new StyleClass('toolbox-button-row', `\r\n      display: flex;\r\n      cursor: default;\r\n      box-sizing: content-box;\r\n    `));\r\n    this.toolboxButtonRowStyleColorsClass = Style.addClass(new StyleClass('toolbox-button-row_colors', `\r\n      background-color: ${this.uiStyleSettings.toolbarBackgroundColor};\r\n    `));\r\n\r\n    this.toolboxPanelRowStyleClass = Style.addClass(new StyleClass('toolbox-panel-row', `\r\n      display: flex;\r\n      ${this.displayMode === 'inline' ? 'position: absolute;' : '' }\r\n      ${this.displayMode === 'inline' ? 'bottom: ' + this.uiStyleSettings.toolbarHeight + 'px;' : '' }\r\n      cursor: default;\r\n      height: ${this.uiStyleSettings.toolbarHeight * 1.5}px;\r\n      ${this.displayMode === 'inline' ? 'width: 100%;' : ''}\r\n      box-sizing: content-box;\r\n    `));\r\n    this.toolboxPanelRowStyleColorsClass = Style.addClass(new StyleClass('toolbox-panel-row_colors', `\r\n      background-color: ${this.uiStyleSettings.toolbarBackgroundHoverColor};\r\n    `));\r\n\r\n    this.toolboxButtonStyleClass = Style.addClass(new StyleClass('toolbox_button', `\r\n      display: inline-block;\r\n      width: ${this.uiStyleSettings.toolbarHeight - buttonPadding * 2}px;\r\n      height: ${this.uiStyleSettings.toolbarHeight - buttonPadding * 2}px;\r\n      padding: ${buttonPadding}px;\r\n      box-sizing: content-box;\r\n    `));\r\n    this.toolboxButtonStyleColorsClass = Style.addClass(new StyleClass('toolbox-button_colors', `\r\n      fill: ${this.uiStyleSettings.toolbarColor};\r\n    `));\r\n\r\n    this.toolboxActiveButtonStyleColorsClass = Style.addClass(new StyleClass('toolbox-active-button_colors', `\r\n      background-color: ${this.uiStyleSettings.toolbarBackgroundHoverColor};\r\n      fill: ${this.uiStyleSettings.toolbarColor};\r\n    `));\r\n\r\n    Style.addRule(\r\n      new StyleRule(\r\n        `.${this.toolboxButtonStyleColorsClass.name}:hover`,\r\n        `\r\n        background-color: ${this.uiStyleSettings.toolbarBackgroundHoverColor}\r\n    `\r\n      )\r\n    );\r\n\r\n    Style.addRule(\r\n      new StyleRule(\r\n        `.${this.toolboxButtonStyleClass.name} svg`,\r\n        `\r\n      height: ${this.uiStyleSettings.toolbarHeight / 2}px;\r\n    `\r\n      )\r\n    );\r\n\r\n  }\r\n\r\n  /**\r\n   * Creates the toolbox object\r\n   * @param markerjsContainer - container for the toolbox in marker.js UI.\r\n   * @param displayMode - marker.js display mode (`inline` or `popup`).\r\n   * @param uiStyleSettings - settings for styling the toolbox elements.\r\n   */\r\n  constructor(markerjsContainer: HTMLDivElement, displayMode: DisplayMode, uiStyleSettings: IStyleSettings) {\r\n    this.markerjsContainer = markerjsContainer;\r\n    this.displayMode = displayMode;\r\n    this.uiStyleSettings = uiStyleSettings;\r\n\r\n    this.panelButtonClick = this.panelButtonClick.bind(this);\r\n\r\n    this.addStyles();\r\n  }\r\n\r\n  /**\r\n   * Creates and displays the main toolbox UI.\r\n   */\r\n  public show(visiblity: string): void {\r\n    this.uiContainer = document.createElement('div');\r\n    this.uiContainer.style.visibility = visiblity;\r\n    this.uiContainer.className = `${this.toolboxStyleClass.name} ${\r\n      this.uiStyleSettings.toolboxStyleColorsClassName ?? this.toolboxStyleColorsClass.name}`;\r\n\r\n    this.markerjsContainer.appendChild(this.uiContainer);\r\n  }\r\n\r\n  /**\r\n   * Creaes buttons for the top-level toolbox panel.\r\n   * @param panels - available panels.\r\n   */\r\n  public setPanelButtons(panels: ToolboxPanel[]): void {\r\n    this.panels = panels;\r\n    if (this.uiContainer !== undefined) {\r\n      this.uiContainer.innerHTML = '';\r\n\r\n      this.panelRow = document.createElement('div');\r\n      this.panelRow.className = `${this.toolboxPanelRowStyleClass.name} ${\r\n        this.uiStyleSettings.toolboxPanelRowStyleColorsClassName ?? this.toolboxPanelRowStyleColorsClass.name}`;\r\n      this.uiContainer.appendChild(this.panelRow);\r\n      this.buttonRow = document.createElement('div');\r\n      this.buttonRow.className = `${this.toolboxButtonRowStyleClass.name} ${\r\n        this.uiStyleSettings.toolboxButtonRowStyleColorsClassName ?? this.toolboxButtonRowStyleColorsClass.name} `;\r\n      this.uiContainer.appendChild(this.buttonRow);\r\n\r\n      this.panelButtons.splice(0);\r\n\r\n      this.panels.forEach(panel => {\r\n        const panelBtnDiv = document.createElement('div');\r\n        panelBtnDiv.className = `${this.toolboxButtonStyleClass.name} ${\r\n          this.uiStyleSettings.toolboxButtonStyleColorsClassName ?? this.toolboxButtonStyleColorsClass.name}`;\r\n        panelBtnDiv.innerHTML = panel.icon;\r\n        panelBtnDiv.title = panel.title;\r\n        panelBtnDiv.addEventListener('click', () => {\r\n          this.panelButtonClick(panel);\r\n        })\r\n        this.panelButtons.push(panelBtnDiv);\r\n        this.buttonRow.appendChild(panelBtnDiv);\r\n      });\r\n      if (this.displayMode === 'inline') {\r\n        this.panelRow.style.display = 'none';\r\n      } else {\r\n        this.panelRow.style.visibility = 'hidden';\r\n      }\r\n    }\r\n    // if (this.displayMode === 'popup' && this.panels.length > 0) {\r\n    //   // this.showPanel(this.activePanel ? this.activePanel : this.panels[0]);\r\n    //   this.panelButtonClick(this.panels[0]);\r\n    // }\r\n  }\r\n\r\n  private panelButtonClick(panel: ToolboxPanel) {\r\n    let panelIndex = -1; \r\n    if (panel !== this.activePanel) {\r\n      panelIndex = this.panels.indexOf(panel);\r\n      this.panelRow.innerHTML = '';\r\n      const panelUI = panel.getUi();\r\n      panelUI.style.margin = `${this.uiStyleSettings.toolbarHeight / 4}px`;\r\n      this.panelRow.appendChild(panelUI);\r\n      this.panelRow.style.display = 'flex';\r\n      this.panelRow.style.visibility = 'visible';\r\n      this.panelRow.className = this.panelRow.className.replace(Style.fadeOutAnimationClassName, '');\r\n      this.panelRow.className += ` ${Style.fadeInAnimationClassName}`;\r\n      this.activePanel = panel;\r\n    } else {\r\n      this.activePanel = undefined;\r\n      // hide panel\r\n      this.panelRow.className = this.panelRow.className.replace(Style.fadeInAnimationClassName, '');\r\n      this.panelRow.className += ` ${Style.fadeOutAnimationClassName}`;\r\n      setTimeout(() => {\r\n        if (this.displayMode === 'inline') {\r\n          this.panelRow.style.display = 'none';\r\n        } else {\r\n          this.panelRow.style.visibility = 'hidden';\r\n        }\r\n      }, 200);\r\n    }\r\n    this.panelButtons.forEach((pb, index) => {\r\n      pb.className = `${this.toolboxButtonStyleClass.name} ` +\r\n        (index === panelIndex\r\n          ? `${this.uiStyleSettings.toolboxActiveButtonStyleColorsClassName ?? this.toolboxActiveButtonStyleColorsClass.name}`\r\n          :  `${this.uiStyleSettings.toolboxButtonStyleColorsClassName ?? this.toolboxButtonStyleColorsClass.name}`);\r\n    });\r\n  }\r\n\r\n}\r\n","/**\r\n * Base class for all toolbox property panels.\r\n */\r\nexport abstract class ToolboxPanel {\r\n  /**\r\n   * Panel name/title.\r\n   */\r\n  public title: string;\r\n  /**\r\n   * Panel button icon as an SVG markup.\r\n   */\r\n  public icon: string;\r\n  /**\r\n   * Create panel with supplied title and icon.\r\n   * @param title - panel name (used for accessibility)\r\n   * @param icon - panel button icon (SVG image markup)\r\n   */\r\n  constructor(title: string, icon?: string) {\r\n    this.title = title;\r\n    this.icon = icon;\r\n  }\r\n  /**\r\n   * Returns toolbox panel UI.\r\n   */\r\n  public abstract getUi(): HTMLDivElement;\r\n}\r\n","import { Style } from '../../core/Style';\r\nimport { ToolboxPanel } from '../ToolboxPanel';\r\nimport Icon from './color-picker-panel-icon.svg';\r\n\r\n/**\r\n * Handler type for the color change event.\r\n */\r\nexport type ColorChangeHandler = (newColor: string) => void;\r\n\r\n/**\r\n * Color picker panel.\r\n */\r\nexport class ColorPickerPanel extends ToolboxPanel {\r\n  public colors: string[] = [];\r\n  private currentColor?: string;\r\n  private addTransparent = false;\r\n\r\n  private colorBoxes: HTMLDivElement[] = [];\r\n\r\n  /**\r\n   * Color change event handler.\r\n   */\r\n  public onColorChanged?: ColorChangeHandler;\r\n\r\n  /**\r\n   * Creates a color picker panel.\r\n   * @param title - panel title.\r\n   * @param colors - available colors.\r\n   * @param currentColor - currently selected color.\r\n   * @param icon - panel button icon (SVG imager markup).\r\n   */\r\n  constructor(title: string, colors: string[], currentColor?: string, icon?: string) {\r\n    super(title, icon ? icon : Icon);\r\n    this.colors = colors;\r\n    this.currentColor = currentColor;\r\n\r\n    this.setCurrentColor = this.setCurrentColor.bind(this);\r\n    this.getColorBox = this.getColorBox.bind(this);\r\n  }\r\n\r\n  /**\r\n   * Returns panel UI.\r\n   */\r\n  public getUi(): HTMLDivElement {\r\n    const panelDiv = document.createElement('div');\r\n    this.colors.forEach((color) => {\r\n      const colorBoxContainer = this.getColorBox(color);\r\n      panelDiv.appendChild(colorBoxContainer);\r\n      this.colorBoxes.push(colorBoxContainer);\r\n    });\r\n    return panelDiv;\r\n  }\r\n\r\n  private getColorBox(color): HTMLDivElement {\r\n    const buttonPadding = Style.settings.toolbarHeight / 4;\r\n    const buttonHeight = Style.settings.toolbarHeight - buttonPadding;\r\n\r\n    const colorBoxContainer = document.createElement('div');\r\n    colorBoxContainer.style.display = 'inline-block';\r\n    colorBoxContainer.style.boxSizing = 'content-box';\r\n    colorBoxContainer.style.width = `${buttonHeight - 2}px`;\r\n    colorBoxContainer.style.height = `${buttonHeight - 2}px`;\r\n    colorBoxContainer.style.padding = '1px';\r\n    colorBoxContainer.style.marginRight = '2px';\r\n    colorBoxContainer.style.marginBottom = '2px';\r\n    colorBoxContainer.style.borderWidth = '2px';\r\n    colorBoxContainer.style.borderStyle = 'solid';\r\n    colorBoxContainer.style.borderRadius = `${(buttonHeight + 2)/2}px`\r\n    colorBoxContainer.style.borderColor =\r\n      color === this.currentColor ? Style.settings.toolboxAccentColor : 'transparent';\r\n\r\n    colorBoxContainer.addEventListener('click', () => {\r\n      this.setCurrentColor(color, colorBoxContainer);\r\n    })\r\n\r\n    const colorBox = document.createElement('div');\r\n    colorBox.style.display = 'inline-block';\r\n    colorBox.style.width = `${buttonHeight - 2}px`;\r\n    colorBox.style.height = `${buttonHeight - 2}px`;\r\n    colorBox.style.backgroundColor = color;\r\n    colorBox.style.borderRadius = `${buttonHeight/2}px`;\r\n    if (color === 'transparent') {\r\n      colorBox.style.fill = Style.settings.toolboxAccentColor;\r\n      colorBox.innerHTML = `<svg viewBox=\"0 0 24 24\">\r\n        <path d=\"M2,5.27L3.28,4L20,20.72L18.73,22L15.65,18.92C14.5,19.3 13.28,19.5 12,19.5C7,19.5 2.73,16.39 1,12C1.69,10.24 2.79,8.69 4.19,7.46L2,5.27M12,9A3,3 0 0,1 15,12C15,12.35 14.94,12.69 14.83,13L11,9.17C11.31,9.06 11.65,9 12,9M12,4.5C17,4.5 21.27,7.61 23,12C22.18,14.08 20.79,15.88 19,17.19L17.58,15.76C18.94,14.82 20.06,13.54 20.82,12C19.17,8.64 15.76,6.5 12,6.5C10.91,6.5 9.84,6.68 8.84,7L7.3,5.47C8.74,4.85 10.33,4.5 12,4.5M3.18,12C4.83,15.36 8.24,17.5 12,17.5C12.69,17.5 13.37,17.43 14,17.29L11.72,15C10.29,14.85 9.15,13.71 9,12.28L5.6,8.87C4.61,9.72 3.78,10.78 3.18,12Z\" />\r\n      </svg>`;\r\n    }\r\n\r\n    colorBoxContainer.appendChild(colorBox);\r\n\r\n    return colorBoxContainer;\r\n  }\r\n\r\n  private setCurrentColor(color: string, target: HTMLDivElement) {\r\n    this.currentColor = color;\r\n\r\n    this.colorBoxes.forEach(box => {\r\n      box.style.borderColor = box === target ? Style.settings.toolboxAccentColor : 'transparent';\r\n    });\r\n\r\n    if (this.onColorChanged) {\r\n      this.onColorChanged(color);\r\n    }\r\n  }\r\n}\r\n","import { IPoint } from './IPoint';\r\nimport { ToolboxPanel } from '../ui/ToolboxPanel';\r\nimport { MarkerBaseState, MarkerState } from './MarkerBaseState';\r\nimport { Settings } from './Settings';\r\n\r\n/**\r\n * Base class for all available and custom marker types.\r\n * \r\n * All markers used with marker.js 2 should be descendants of this class.\r\n */\r\nexport class MarkerBase {\r\n  /**\r\n   * String type name of the marker type. \r\n   * \r\n   * Used when adding {@link MarkerArea.availableMarkerTypes} via a string and to save and restore state.\r\n   */\r\n  public static typeName = 'MarkerBase';\r\n\r\n  protected _container: SVGGElement;\r\n  /**\r\n   * SVG container object holding the marker's visual.\r\n   */\r\n  public get container(): SVGGElement {\r\n    return this._container;\r\n  }\r\n  protected _overlayContainer: HTMLDivElement;\r\n  /**\r\n   * HTML container that can be used to render overlay objects while the marker is active.\r\n   * \r\n   * For example, this is used for the text editing layer while editing text in the {@see TextMarker}.\r\n   */\r\n  public get overlayContainer(): HTMLDivElement {\r\n    return this._overlayContainer;\r\n  }\r\n  protected _state: MarkerState = 'new';\r\n  /**\r\n   * Current marker state.\r\n   *\r\n   * Both MarkerArea and the marker itself can react differently to different events based on what state the marker is in.\r\n   */\r\n  public get state(): MarkerState {\r\n    return this._state;\r\n  }\r\n  protected globalSettings: Settings;\r\n\r\n  /**\r\n   * Returns the list of toolbox panels for this marker type.\r\n   */\r\n  public get toolboxPanels(): ToolboxPanel[] {\r\n    return [];\r\n  }\r\n\r\n  /**\r\n   * Marker type title (display name) used for accessibility and other attributes.\r\n   */\r\n  public static title: string;\r\n\r\n  /**\r\n   * SVG icon markup displayed on toolbar buttons.\r\n   */\r\n  public static icon: string;\r\n\r\n  /**\r\n   * Method called when marker creation is finished.\r\n   */\r\n  public onMarkerCreated: (marker: MarkerBase) => void;\r\n\r\n  /**\r\n   * Creates a new marker.\r\n   *\r\n   * @param container - SVG container to hold marker's visual.\r\n   * @param overlayContainer - overlay HTML container to hold additional overlay elements while editing.\r\n   * @param settings - settings object containing default markers settings.\r\n   */\r\n  constructor(container: SVGGElement, overlayContainer: HTMLDivElement, settings: Settings) {\r\n    this._container = container;\r\n    this._overlayContainer = overlayContainer;\r\n    this.globalSettings = settings;\r\n  }\r\n\r\n  /**\r\n   * Returns true if passed SVG element belongs to the marker. False otherwise.\r\n   * \r\n   * @param el - target element.\r\n   */\r\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n  public ownsTarget(el: EventTarget): boolean {\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Selects this marker and displays appropriate selected marker UI.\r\n   */\r\n  public select(): void {\r\n    this.container.style.cursor = 'move';\r\n  }\r\n\r\n  /**\r\n   * Deselects this marker and hides selected marker UI.\r\n   */\r\n  public deselect(): void {\r\n    this.container.style.cursor = 'default';\r\n  }\r\n\r\n  /**\r\n   * Handles pointer (mouse, touch, stylus, etc.) down event.\r\n   * \r\n   * @param point - event coordinates.\r\n   * @param target - direct event target element.\r\n   */\r\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars, @typescript-eslint/no-empty-function\r\n  public pointerDown(point: IPoint, target?: EventTarget):void {}\r\n\r\n  /**\r\n   * Handles pointer (mouse, touch, stylus, etc.) double click event.\r\n   * \r\n   * @param point - event coordinates.\r\n   * @param target - direct event target element.\r\n   */\r\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars, @typescript-eslint/no-empty-function\r\n  public dblClick(point: IPoint, target?: EventTarget):void {}\r\n\r\n  /**\r\n   * Handles marker manipulation (move, resize, rotate, etc.).\r\n   * \r\n   * @param point - event coordinates.\r\n   */\r\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars, @typescript-eslint/no-empty-function\r\n  public manipulate(point: IPoint):void {}\r\n\r\n  /**\r\n   * Handles pointer (mouse, touch, stylus, etc.) up event.\r\n   * \r\n   * @param point - event coordinates.\r\n   */\r\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars, @typescript-eslint/no-empty-function\r\n  public pointerUp(point: IPoint):void {}\r\n\r\n  /**\r\n   * Disposes the marker and clean's up.\r\n   */\r\n  // eslint-disable-next-line @typescript-eslint/no-empty-function\r\n  public dispose(): void {}\r\n\r\n  protected addMarkerVisualToContainer(element: SVGElement): void {\r\n    if (this.container.childNodes.length > 0) {\r\n      this.container.insertBefore(element, this.container.childNodes[0]);\r\n    } else {\r\n      this.container.appendChild(element);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns current marker state that can be restored in the future.\r\n   */\r\n  public getState(): MarkerBaseState {\r\n    return { \r\n      typeName: MarkerBase.typeName, \r\n      state: this.state \r\n    };\r\n  }\r\n\r\n  /**\r\n   * Restores previously saved marker state.\r\n   * \r\n   * @param state - previously saved state.\r\n   */\r\n  public restoreState(state: MarkerBaseState): void {\r\n    this._state = state.state;\r\n  }\r\n\r\n  /**\r\n   * Scales marker. Used after the image resize.\r\n   * \r\n   * @param scaleX - horizontal scale\r\n   * @param scaleY - vertical scale\r\n   */\r\n  // eslint-disable-next-line @typescript-eslint/no-empty-function, @typescript-eslint/no-unused-vars\r\n  public scale(scaleX: number, scaleY: number): void {}\r\n}\r\n","import { ResizeGrip } from './ResizeGrip';\r\n\r\n/**\r\n * RectangularBoxMarkerGrips is a set of resize/rotation grips for a rectangular marker.\r\n */\r\nexport class RectangularBoxMarkerGrips {\r\n  /**\r\n   * Top-left grip.\r\n   */\r\n  public topLeft: ResizeGrip;\r\n  /**\r\n   * Top-center grip.\r\n   */\r\n  public topCenter: ResizeGrip;\r\n  /**\r\n   * Top-right grip.\r\n   */\r\n  public topRight: ResizeGrip;\r\n  /**\r\n   * Center-left grip.\r\n   */\r\n  public centerLeft: ResizeGrip;\r\n  /**\r\n   * Center-right grip.\r\n   */\r\n  public centerRight: ResizeGrip;\r\n  /**\r\n   * Bottom-left grip.\r\n   */\r\n  public bottomLeft: ResizeGrip;\r\n  /**\r\n   * Bottom-center grip.\r\n   */\r\n  public bottomCenter: ResizeGrip;\r\n  /**\r\n   * Bottom-right grip.\r\n   */\r\n  public bottomRight: ResizeGrip;\r\n\r\n  /**\r\n   * Creates a new marker grip set.\r\n   */\r\n  constructor() {\r\n    this.findGripByVisual = this.findGripByVisual.bind(this);\r\n  }\r\n\r\n  /**\r\n   * Returns a marker grip owning the specified visual.\r\n   * @param gripVisual - visual for owner to be determined.\r\n   */\r\n  public findGripByVisual(\r\n    gripVisual: EventTarget\r\n  ): ResizeGrip | undefined {\r\n      if (this.topLeft.ownsTarget(gripVisual)) {\r\n        return this.topLeft;\r\n      } else if (this.topCenter.ownsTarget(gripVisual)) {\r\n        return this.topCenter;\r\n      } else if (this.topRight.ownsTarget(gripVisual)) {\r\n        return this.topRight;\r\n      } else if (this.centerLeft.ownsTarget(gripVisual)) {\r\n        return this.centerLeft;\r\n      } else if (this.centerRight.ownsTarget(gripVisual)) {\r\n        return this.centerRight;\r\n      } else if (this.bottomLeft.ownsTarget(gripVisual)) {\r\n        return this.bottomLeft;\r\n      } else if (this.bottomCenter.ownsTarget(gripVisual)) {\r\n        return this.bottomCenter;\r\n      } else if (this.bottomRight.ownsTarget(gripVisual)) {\r\n        return this.bottomRight;\r\n      } else {\r\n        return undefined;\r\n      }\r\n  }\r\n}\r\n","import { SvgHelper } from '../core/SvgHelper';\r\n\r\n/**\r\n * Represents a single resize-manipulation grip used in marker's manipulation controls.\r\n */\r\nexport class ResizeGrip {\r\n  /**\r\n   * Grip's visual element.\r\n   */\r\n  public visual: SVGGraphicsElement;\r\n\r\n  /**\r\n   * Grip's size (raduis).\r\n   */\r\n  public readonly GRIP_SIZE = 10;\r\n\r\n  /**\r\n   * Creates a new grip.\r\n   */\r\n  constructor() {\r\n    this.visual = SvgHelper.createGroup();\r\n    this.visual.appendChild(\r\n      SvgHelper.createCircle(this.GRIP_SIZE * 1.5, [['fill', 'transparent']])\r\n    );\r\n    this.visual.appendChild(\r\n      SvgHelper.createCircle(this.GRIP_SIZE, [\r\n        ['fill', '#cccccc'],\r\n        ['fill-opacity', '0.7'],\r\n        ['stroke', '#333333'],\r\n        ['stroke-width', '2'],\r\n        ['stroke-opacity', '0.7']\r\n      ])\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Returns true if passed SVG element belongs to the grip. False otherwise.\r\n   * \r\n   * @param el - target element.\r\n   */\r\n  public ownsTarget(el: EventTarget): boolean {\r\n    if (\r\n      el === this.visual ||\r\n      el === this.visual.childNodes[0] ||\r\n      el === this.visual.childNodes[1]\r\n    ) {\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Represents a simplified version of the SVGMatrix.\r\n */\r\nexport interface ITransformMatrix {\r\n  a: number;\r\n  b: number;\r\n  c: number;\r\n  d: number;\r\n  e: number;\r\n  f: number;\r\n}\r\n\r\n/**\r\n * A utility class to transform between SVGMatrix and its simplified representation.\r\n */\r\nexport class TransformMatrix {\r\n  public static toITransformMatrix(matrix: SVGMatrix): ITransformMatrix {\r\n    return {\r\n      a: matrix.a,\r\n      b: matrix.b,\r\n      c: matrix.c,\r\n      d: matrix.d,\r\n      e: matrix.e,\r\n      f: matrix.f\r\n    }\r\n  }\r\n  public static toSVGMatrix(currentMatrix: SVGMatrix, newMatrix: ITransformMatrix): SVGMatrix {\r\n    currentMatrix.a = newMatrix.a;\r\n    currentMatrix.b = newMatrix.b;\r\n    currentMatrix.c = newMatrix.c;\r\n    currentMatrix.d = newMatrix.d;\r\n    currentMatrix.e = newMatrix.e;\r\n    currentMatrix.f = newMatrix.f;\r\n    return currentMatrix;\r\n  }\r\n}","import { MarkerBase } from '../core/MarkerBase';\r\n\r\nimport { IPoint } from '../core/IPoint';\r\nimport { SvgHelper } from '../core/SvgHelper';\r\n\r\nimport { RectangularBoxMarkerGrips } from './RectangularBoxMarkerGrips';\r\nimport { ResizeGrip } from './ResizeGrip';\r\nimport { Settings } from '../core/Settings';\r\nimport { RectangularBoxMarkerBaseState } from './RectangularBoxMarkerBaseState';\r\nimport { MarkerBaseState } from '../core/MarkerBaseState';\r\nimport { TransformMatrix } from '../core/TransformMatrix';\r\n\r\n/**\r\n * RectangularBoxMarkerBase is a base class for all marker's with rectangular controls such as all rectangle markers,\r\n * text and callout markers.\r\n * \r\n * It creates and manages the rectangular control box and related resize, move, and rotate manipulations.\r\n */\r\nexport class RectangularBoxMarkerBase extends MarkerBase {\r\n  /**\r\n   * x coordinate of the top-left corner.\r\n   */\r\n  protected left = 0;\r\n  /**\r\n   * y coordinate of the top-left corner.\r\n   */\r\n  protected top = 0;\r\n  /**\r\n   * Marker width.\r\n   */\r\n  protected width = 0;\r\n  /**\r\n   * Marker height.\r\n   */\r\n  protected height = 0;\r\n\r\n  /**\r\n   * The default marker size when the marker is created with a click (without dragging).\r\n   */\r\n  protected defaultSize: IPoint = {x: 50, y: 20};\r\n\r\n  /**\r\n   * x coordinate of the top-left corner at the start of manipulation.\r\n   */\r\n  protected manipulationStartLeft: number;\r\n  /**\r\n   * y coordinate of the top-left corner at the start of manipulation.\r\n   */\r\n  protected manipulationStartTop: number;\r\n  /**\r\n   * Width at the start of manipulation.\r\n   */\r\n  protected manipulationStartWidth: number;\r\n  /**\r\n   * Height at the start of manipulation.\r\n   */\r\n  protected manipulationStartHeight: number;\r\n\r\n  /**\r\n   * x coordinate of the pointer at the start of manipulation.\r\n   */\r\n  protected manipulationStartX: number;\r\n  /**\r\n   * y coordinate of the pointer at the start of manipulation.\r\n   */\r\n  protected manipulationStartY: number;\r\n\r\n  /**\r\n   * Pointer's horizontal distance from the top left corner.\r\n   */\r\n  protected offsetX = 0;\r\n  /**\r\n   * Pointer's vertical distance from the top left corner.\r\n   */\r\n  protected offsetY = 0;\r\n\r\n  /**\r\n   * Marker's rotation angle.\r\n   */\r\n  protected rotationAngle = 0;\r\n\r\n  /**\r\n   * x coordinate of the marker's center.\r\n   */\r\n  protected get centerX(): number {\r\n    return this.left + this.width / 2;\r\n  }\r\n  /**\r\n   * y coordinate of the marker's center.\r\n   */\r\n  protected get centerY(): number {\r\n    return this.top + this.height / 2;\r\n  }\r\n\r\n  private _visual: SVGGraphicsElement;\r\n  /**\r\n   * Container for the marker's visual.\r\n   */\r\n  protected get visual(): SVGGraphicsElement {\r\n    return this._visual;\r\n  }\r\n  protected set visual(value: SVGGraphicsElement) {\r\n    this._visual = value;\r\n    const translate = SvgHelper.createTransform();\r\n    this._visual.transform.baseVal.appendItem(translate);\r\n  }\r\n\r\n  /**\r\n   * Container for the marker's editing controls.\r\n   */\r\n  protected controlBox: SVGGElement;\r\n  private readonly CB_DISTANCE: number = 10;\r\n  private controlRect: SVGRectElement;\r\n  private rotatorGripLine: SVGLineElement;\r\n\r\n  private controlGrips: RectangularBoxMarkerGrips;\r\n  private rotatorGrip: ResizeGrip;\r\n  private activeGrip: ResizeGrip;\r\n\r\n  /**\r\n   * Creates a new marker.\r\n   *\r\n   * @param container - SVG container to hold marker's visual.\r\n   * @param overlayContainer - overlay HTML container to hold additional overlay elements while editing.\r\n   * @param settings - settings object containing default markers settings.\r\n   */\r\n  constructor(container: SVGGElement, overlayContainer: HTMLDivElement, settings: Settings) {\r\n    super(container, overlayContainer, settings);\r\n\r\n    // add rotation transform\r\n    this.container.transform.baseVal.appendItem(SvgHelper.createTransform());\r\n\r\n    this.setupControlBox();\r\n  }\r\n\r\n  /**\r\n   * Returns true if passed SVG element belongs to the marker. False otherwise.\r\n   * \r\n   * @param el - target element.\r\n   */\r\n  public ownsTarget(el: EventTarget): boolean {\r\n    if (super.ownsTarget(el)) {\r\n      return true;\r\n    } else if (\r\n      this.controlGrips.findGripByVisual(el) !== undefined ||\r\n      this.rotatorGrip.ownsTarget(el)\r\n    ) {\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles pointer (mouse, touch, stylus, etc.) down event.\r\n   * \r\n   * @param point - event coordinates.\r\n   * @param target - direct event target element.\r\n   */\r\n  public pointerDown(point: IPoint, target?: EventTarget): void {\r\n    super.pointerDown(point, target);\r\n\r\n    if (this.state === 'new') {\r\n      this.left = point.x;\r\n      this.top = point.y;\r\n    }\r\n\r\n    this.manipulationStartLeft = this.left;\r\n    this.manipulationStartTop = this.top;\r\n    this.manipulationStartWidth = this.width;\r\n    this.manipulationStartHeight = this.height;\r\n\r\n    const rotatedPoint = this.unrotatePoint(point);\r\n    this.manipulationStartX = rotatedPoint.x;\r\n    this.manipulationStartY = rotatedPoint.y;\r\n\r\n    this.offsetX = rotatedPoint.x - this.left;\r\n    this.offsetY = rotatedPoint.y - this.top;\r\n\r\n    if (this.state !== 'new') {\r\n      this.select();\r\n      this.activeGrip = this.controlGrips.findGripByVisual(target as SVGGraphicsElement);\r\n      if (this.activeGrip !== undefined) {\r\n        this._state = 'resize';\r\n      } else if (this.rotatorGrip.ownsTarget(target)) {\r\n        this.activeGrip = this.rotatorGrip;\r\n\r\n        const rotatedCenter = this.rotatePoint({x: this.centerX, y: this.centerY});\r\n        this.left = rotatedCenter.x - this.width / 2;\r\n        this.top = rotatedCenter.y - this.height / 2;\r\n        this.moveVisual({ x: this.left, y: this.top });\r\n\r\n        const rotate = this.container.transform.baseVal.getItem(0);\r\n        rotate.setRotate(this.rotationAngle, this.centerX, this.centerY);\r\n        this.container.transform.baseVal.replaceItem(rotate, 0);\r\n\r\n        this.adjustControlBox();\r\n\r\n        this._state = 'rotate';\r\n      } else {\r\n        this._state = 'move';\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles pointer (mouse, touch, stylus, etc.) up event.\r\n   * \r\n   * @param point - event coordinates.\r\n   * @param target - direct event target element.\r\n   */\r\n  public pointerUp(point: IPoint): void {\r\n    const inState = this.state;\r\n    super.pointerUp(point);\r\n    if (this.state === 'creating' && this.width < 10 && this.height < 10) {\r\n      this.width = this.defaultSize.x;\r\n      this.height = this.defaultSize.y;\r\n    } else {\r\n      this.manipulate(point);\r\n    }\r\n    this._state = 'select';\r\n    if (inState === 'creating' && this.onMarkerCreated) {\r\n      this.onMarkerCreated(this);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Moves visual to the specified coordinates.\r\n   * @param point - coordinates of the new top-left corner of the visual.\r\n   */\r\n  protected moveVisual(point: IPoint): void {\r\n    const translate = this.visual.transform.baseVal.getItem(0);\r\n    translate.setTranslate(point.x, point.y);\r\n    this.visual.transform.baseVal.replaceItem(translate, 0);\r\n  }\r\n\r\n  /**\r\n   * Handles marker manipulation (move, resize, rotate, etc.).\r\n   * \r\n   * @param point - event coordinates.\r\n   */\r\n  public manipulate(point: IPoint): void {\r\n    const rotatedPoint = this.unrotatePoint(point);\r\n\r\n    if (this.state === 'creating') {\r\n      this.resize(point);\r\n    } else if (this.state === 'move') {\r\n      this.left =\r\n        this.manipulationStartLeft +\r\n        (rotatedPoint.x - this.manipulationStartLeft) -\r\n        this.offsetX;\r\n      this.top =\r\n        this.manipulationStartTop +\r\n        (rotatedPoint.y - this.manipulationStartTop) -\r\n        this.offsetY;\r\n      this.moveVisual({x: this.left, y: this.top});\r\n      this.adjustControlBox();\r\n    } else if (this.state === 'resize') {\r\n      this.resize(rotatedPoint);\r\n    } else if (this.state === 'rotate') {\r\n      this.rotate(point);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Resizes the marker based on pointer coordinates and context.\r\n   * @param point - pointer coordinates.\r\n   */\r\n  protected resize(point: IPoint): void {\r\n    let newX = this.manipulationStartLeft;\r\n    let newWidth = this.manipulationStartWidth;\r\n    let newY = this.manipulationStartTop;\r\n    let newHeight = this.manipulationStartHeight;\r\n\r\n    switch(this.activeGrip) {\r\n      case this.controlGrips.bottomLeft:\r\n      case this.controlGrips.centerLeft:\r\n      case this.controlGrips.topLeft:\r\n        newX = this.manipulationStartLeft + point.x - this.manipulationStartX;\r\n        newWidth = this.manipulationStartWidth + this.manipulationStartLeft - newX;\r\n        break; \r\n      case this.controlGrips.bottomRight:\r\n      case this.controlGrips.centerRight:\r\n      case this.controlGrips.topRight:\r\n      case undefined:\r\n        newWidth = this.manipulationStartWidth + point.x - this.manipulationStartX;\r\n        break; \r\n    }\r\n\r\n    switch(this.activeGrip) {\r\n      case this.controlGrips.topCenter:\r\n      case this.controlGrips.topLeft:\r\n      case this.controlGrips.topRight:\r\n        newY = this.manipulationStartTop + point.y - this.manipulationStartY;\r\n        newHeight = this.manipulationStartHeight + this.manipulationStartTop - newY;\r\n        break; \r\n      case this.controlGrips.bottomCenter:\r\n      case this.controlGrips.bottomLeft:\r\n      case this.controlGrips.bottomRight:\r\n      case undefined:\r\n        newHeight = this.manipulationStartHeight + point.y - this.manipulationStartY;\r\n        break; \r\n    }\r\n\r\n    if (newWidth >= 0) {\r\n      this.left = newX;\r\n      this.width = newWidth;\r\n    } else {\r\n      this.left = newX + newWidth;\r\n      this.width = -newWidth;\r\n    }\r\n    if (newHeight >= 0) {\r\n      this.top = newY;\r\n      this.height = newHeight;\r\n    } else {\r\n      this.top = newY + newHeight;\r\n      this.height = -newHeight;\r\n    }\r\n\r\n    this.setSize();\r\n  }\r\n\r\n  /**\r\n   * Sets control box size and location.\r\n   */\r\n  protected setSize(): void {\r\n    this.moveVisual({x: this.left, y: this.top});\r\n    this.adjustControlBox();\r\n  }\r\n\r\n  private rotate(point: IPoint) {\r\n    // avoid glitch when crossing the 0 rotation point\r\n    if (Math.abs(point.x - this.centerX) > 0.1) {\r\n      const sign = Math.sign(point.x - this.centerX);\r\n      this.rotationAngle =\r\n        (Math.atan((point.y - this.centerY) / (point.x - this.centerX)) * 180) /\r\n          Math.PI +\r\n        90 * sign;\r\n      this.applyRotation();\r\n    }\r\n  }\r\n\r\n  private applyRotation() {\r\n    const rotate = this.container.transform.baseVal.getItem(0);\r\n    rotate.setRotate(this.rotationAngle, this.centerX, this.centerY);\r\n    this.container.transform.baseVal.replaceItem(rotate, 0);\r\n  }\r\n\r\n  /**\r\n   * Returns point coordinates based on the actual screen coordinates and marker's rotation.\r\n   * @param point - original pointer coordinates\r\n   */\r\n  protected rotatePoint(point: IPoint): IPoint {\r\n    if (this.rotationAngle === 0) {\r\n      return point;\r\n    }\r\n    \r\n    const matrix = this.container.getCTM();\r\n    let svgPoint = SvgHelper.createPoint(point.x, point.y);\r\n    svgPoint = svgPoint.matrixTransform(matrix);\r\n\r\n    const result = { x: svgPoint.x, y: svgPoint.y };\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Returns original point coordinates based on coordinates with rotation applied.\r\n   * @param point - rotated point coordinates.\r\n   */\r\n  protected unrotatePoint(point: IPoint): IPoint {\r\n    if (this.rotationAngle === 0) {\r\n      return point;\r\n    }\r\n    \r\n    let matrix = this.container.getCTM();\r\n    matrix = matrix.inverse();\r\n    let svgPoint = SvgHelper.createPoint(point.x, point.y);\r\n    svgPoint = svgPoint.matrixTransform(matrix);\r\n\r\n    const result = { x: svgPoint.x, y: svgPoint.y };\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Displays marker's controls.\r\n   */\r\n  public select(): void {\r\n    super.select();\r\n    this.adjustControlBox();\r\n    this.controlBox.style.display = '';\r\n  }\r\n\r\n  /**\r\n   * Hides marker's controls.\r\n   */\r\n  public deselect(): void {\r\n    super.deselect();\r\n    this.controlBox.style.display = 'none';\r\n  }\r\n\r\n  private setupControlBox() {\r\n    this.controlBox = SvgHelper.createGroup();\r\n    const translate = SvgHelper.createTransform();\r\n    translate.setTranslate(-this.CB_DISTANCE / 2, -this.CB_DISTANCE / 2);\r\n    this.controlBox.transform.baseVal.appendItem(translate);\r\n\r\n    this.container.appendChild(this.controlBox);\r\n\r\n    this.controlRect = SvgHelper.createRect(\r\n      this.width + this.CB_DISTANCE,\r\n      this.height + this.CB_DISTANCE,\r\n      [\r\n        ['stroke', 'black'],\r\n        ['stroke-width', '1'],\r\n        ['stroke-opacity', '0.5'],\r\n        ['stroke-dasharray', '3, 2'],\r\n        ['fill', 'transparent'],\r\n        ['pointer-events', 'none']\r\n      ]\r\n    );\r\n\r\n    this.controlBox.appendChild(this.controlRect);\r\n\r\n    this.rotatorGripLine = SvgHelper.createLine(\r\n      (this.width + this.CB_DISTANCE * 2) / 2,\r\n      this.top - this.CB_DISTANCE,\r\n      (this.width + this.CB_DISTANCE * 2) / 2,\r\n      this.top - this.CB_DISTANCE * 3,\r\n      [\r\n        ['stroke', 'black'],\r\n        ['stroke-width', '1'],\r\n        ['stroke-opacity', '0.5'],\r\n        ['stroke-dasharray', '3, 2'],\r\n      ]\r\n    );\r\n\r\n    this.controlBox.appendChild(this.rotatorGripLine);\r\n\r\n    this.controlGrips = new RectangularBoxMarkerGrips();\r\n    this.addControlGrips();\r\n\r\n    this.controlBox.style.display = 'none';\r\n  }\r\n\r\n  private adjustControlBox() {\r\n    const translate = this.controlBox.transform.baseVal.getItem(0);\r\n    translate.setTranslate(\r\n      this.left - this.CB_DISTANCE / 2,\r\n      this.top - this.CB_DISTANCE / 2\r\n    );\r\n    this.controlBox.transform.baseVal.replaceItem(translate, 0);\r\n    this.controlRect.setAttribute(\r\n      'width',\r\n      (this.width + this.CB_DISTANCE).toString()\r\n    );\r\n    this.controlRect.setAttribute(\r\n      'height',\r\n      (this.height + this.CB_DISTANCE).toString()\r\n    );\r\n    this.rotatorGripLine.setAttribute(\r\n      'x1',\r\n      ((this.width + this.CB_DISTANCE) / 2).toString()\r\n    );\r\n    this.rotatorGripLine.setAttribute('y1', (-this.CB_DISTANCE / 2).toString());\r\n    this.rotatorGripLine.setAttribute(\r\n      'x2',\r\n      ((this.width + this.CB_DISTANCE) / 2).toString()\r\n    );\r\n    this.rotatorGripLine.setAttribute('y2', (-this.CB_DISTANCE * 3).toString());\r\n    this.positionGrips();\r\n  }\r\n\r\n  private addControlGrips() {\r\n    this.controlGrips.topLeft = this.createGrip();\r\n    this.controlGrips.topCenter = this.createGrip();\r\n    this.controlGrips.topRight = this.createGrip();\r\n    this.controlGrips.centerLeft = this.createGrip();\r\n    this.controlGrips.centerRight = this.createGrip();\r\n    this.controlGrips.bottomLeft = this.createGrip();\r\n    this.controlGrips.bottomCenter = this.createGrip();\r\n    this.controlGrips.bottomRight = this.createGrip();\r\n\r\n    this.rotatorGrip = this.createGrip();\r\n\r\n    this.positionGrips();\r\n  }\r\n\r\n  private createGrip(): ResizeGrip {\r\n    const grip = new ResizeGrip();\r\n    grip.visual.transform.baseVal.appendItem(SvgHelper.createTransform());\r\n    this.controlBox.appendChild(grip.visual);\r\n\r\n    return grip;\r\n  }\r\n\r\n  private positionGrips() {\r\n    const gripSize = this.controlGrips.topLeft.GRIP_SIZE;\r\n\r\n    const left = -gripSize / 2;\r\n    const top = left;\r\n    const cx = (this.width + this.CB_DISTANCE) / 2 - gripSize / 2;\r\n    const cy = (this.height + this.CB_DISTANCE) / 2 - gripSize / 2;\r\n    const bottom = this.height + this.CB_DISTANCE - gripSize / 2;\r\n    const right = this.width + this.CB_DISTANCE - gripSize / 2;\r\n\r\n    this.positionGrip(this.controlGrips.topLeft.visual, left, top);\r\n    this.positionGrip(this.controlGrips.topCenter.visual, cx, top);\r\n    this.positionGrip(this.controlGrips.topRight.visual, right, top);\r\n    this.positionGrip(this.controlGrips.centerLeft.visual, left, cy);\r\n    this.positionGrip(this.controlGrips.centerRight.visual, right, cy);\r\n    this.positionGrip(this.controlGrips.bottomLeft.visual, left, bottom);\r\n    this.positionGrip(this.controlGrips.bottomCenter.visual, cx, bottom);\r\n    this.positionGrip(this.controlGrips.bottomRight.visual, right, bottom);\r\n\r\n    this.positionGrip(this.rotatorGrip.visual, cx, top - this.CB_DISTANCE * 3);\r\n  }\r\n\r\n  private positionGrip(grip: SVGGraphicsElement, x: number, y: number) {\r\n    const translate = grip.transform.baseVal.getItem(0);\r\n    translate.setTranslate(x, y);\r\n    grip.transform.baseVal.replaceItem(translate, 0);\r\n  }\r\n\r\n  /**\r\n   * Hides marker's editing controls.\r\n   */\r\n  protected hideControlBox(): void {\r\n    this.controlBox.style.display = 'none';\r\n  }\r\n  /**\r\n   * Shows marker's editing controls.\r\n   */\r\n  protected showControlBox(): void {\r\n    this.controlBox.style.display = '';\r\n  }\r\n\r\n  /**\r\n   * Returns marker's state.\r\n   */\r\n  public getState(): RectangularBoxMarkerBaseState {\r\n    const result: RectangularBoxMarkerBaseState = Object.assign({\r\n      left: this.left,\r\n      top: this.top,\r\n      width: this.width,\r\n      height: this.height,\r\n      rotationAngle: this.rotationAngle,\r\n      visualTransformMatrix: TransformMatrix.toITransformMatrix(this.visual.transform.baseVal.getItem(0).matrix),\r\n      containerTransformMatrix: TransformMatrix.toITransformMatrix(this.container.transform.baseVal.getItem(0).matrix)\r\n    },\r\n    super.getState());\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Restores marker's state to the previously saved one.\r\n   * @param state - previously saved state.\r\n   */\r\n  public restoreState(state: MarkerBaseState): void {\r\n    super.restoreState(state);\r\n    const rbmState = state as RectangularBoxMarkerBaseState;\r\n    this.left = rbmState.left;\r\n    this.top = rbmState.top;\r\n    this.width = rbmState.width;\r\n    this.height = rbmState.height;\r\n    this.rotationAngle = rbmState.rotationAngle;\r\n    this.visual.transform.baseVal.getItem(0).setMatrix(\r\n      TransformMatrix.toSVGMatrix(this.visual.transform.baseVal.getItem(0).matrix, rbmState.visualTransformMatrix)\r\n    );\r\n    this.container.transform.baseVal.getItem(0).setMatrix(\r\n      TransformMatrix.toSVGMatrix(this.container.transform.baseVal.getItem(0).matrix, rbmState.containerTransformMatrix)\r\n    );\r\n    // this.moveVisual({x: this.left, y: this.top});\r\n    // this.applyRotation();\r\n  }\r\n\r\n  /**\r\n   * Scales marker. Used after the image resize.\r\n   * \r\n   * @param scaleX - horizontal scale\r\n   * @param scaleY - vertical scale\r\n   */\r\n  public scale(scaleX: number, scaleY: number): void {\r\n    super.scale(scaleX, scaleY);\r\n\r\n    const rPoint = this.rotatePoint({x: this.left, y: this.top});\r\n    const point = this.unrotatePoint({x: rPoint.x * scaleX, y: rPoint.y * scaleY});\r\n\r\n    this.left = point.x;\r\n    this.top = point.y;\r\n    this.width = this.width * scaleX;\r\n    this.height = this.height * scaleY;\r\n\r\n    this.adjustControlBox();\r\n  }\r\n\r\n}\r\n","import { IPoint } from '../core/IPoint';\r\nimport { SvgHelper } from '../core/SvgHelper';\r\nimport { RectangularBoxMarkerBase } from './RectangularBoxMarkerBase';\r\nimport { Settings } from '../core/Settings';\r\nimport { RectangleMarkerState } from './RectangleMarkerState';\r\nimport { MarkerBaseState } from '../core/MarkerBaseState';\r\n\r\n/**\r\n * RecatngleMarker is a base class for all rectangular markers (Frame, Cover, Highlight, etc.)\r\n */\r\nexport abstract class RectangleMarker extends RectangularBoxMarkerBase {\r\n  /**\r\n   * String type name of the marker type. \r\n   * \r\n   * Used when adding {@link MarkerArea.availableMarkerTypes} via a string and to save and restore state.\r\n   */\r\n  public static title = 'Rectangle marker';\r\n\r\n  /**\r\n   * Recangle fill color.\r\n   */\r\n  protected fillColor = 'transparent';\r\n  /**\r\n   * Rectangle stroke color.\r\n   */\r\n  protected strokeColor = 'transparent';\r\n  /**\r\n   * Rectangle border stroke width.\r\n   */\r\n  protected strokeWidth = 0;\r\n  /**\r\n   * Rectangle border stroke dash array.\r\n   */\r\n  protected strokeDasharray = '';\r\n  /**\r\n   * Rectangle opacity (alpha). 0 to 1.\r\n   */\r\n  protected opacity = 1;\r\n\r\n  /**\r\n   * Creates a new marker.\r\n   *\r\n   * @param container - SVG container to hold marker's visual.\r\n   * @param overlayContainer - overlay HTML container to hold additional overlay elements while editing.\r\n   * @param settings - settings object containing default markers settings.\r\n   */\r\n  constructor(container: SVGGElement, overlayContainer: HTMLDivElement, settings: Settings) {\r\n    super(container, overlayContainer, settings);\r\n\r\n    this.setStrokeColor = this.setStrokeColor.bind(this);\r\n    this.setFillColor = this.setFillColor.bind(this);\r\n    this.setStrokeWidth = this.setStrokeWidth.bind(this);\r\n    this.setStrokeDasharray = this.setStrokeDasharray.bind(this);\r\n    this.createVisual = this.createVisual.bind(this);\r\n  }\r\n\r\n  /**\r\n   * Returns true if passed SVG element belongs to the marker. False otherwise.\r\n   * \r\n   * @param el - target element.\r\n   */\r\n  public ownsTarget(el: EventTarget): boolean {\r\n    if (super.ownsTarget(el) || el === this.visual) {\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Creates the marker's rectangle visual.\r\n   */\r\n  protected createVisual(): void {\r\n    this.visual = SvgHelper.createRect(1, 1, [\r\n      ['fill', this.fillColor],\r\n      ['stroke', this.strokeColor],\r\n      ['stroke-width', this.strokeWidth.toString()],\r\n      ['stroke-dasharray', this.strokeDasharray],\r\n      ['opacity', this.opacity.toString()]\r\n    ]);\r\n    this.addMarkerVisualToContainer(this.visual);\r\n  }\r\n\r\n  /**\r\n   * Handles pointer (mouse, touch, stylus, etc.) down event.\r\n   * \r\n   * @param point - event coordinates.\r\n   * @param target - direct event target element.\r\n   */\r\n  public pointerDown(point: IPoint, target?: EventTarget): void {\r\n    super.pointerDown(point, target);\r\n    if (this.state === 'new') {\r\n      this.createVisual();\r\n\r\n      this.moveVisual(point);\r\n\r\n      this._state = 'creating';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles marker manipulation (move, resize, rotate, etc.).\r\n   * \r\n   * @param point - event coordinates.\r\n   */\r\n  public manipulate(point: IPoint): void {\r\n    super.manipulate(point);\r\n  }\r\n\r\n  /**\r\n   * Resizes the marker based on the pointer coordinates.\r\n   * @param point - current pointer coordinates.\r\n   */\r\n  protected resize(point: IPoint): void {\r\n    super.resize(point);\r\n    this.setSize();\r\n  }\r\n\r\n  /**\r\n   * Sets visual's width and height attributes based on marker's width and height.\r\n   */\r\n  protected setSize(): void {\r\n    super.setSize();\r\n    SvgHelper.setAttributes(this.visual, [\r\n      ['width', this.width.toString()],\r\n      ['height', this.height.toString()],\r\n    ]);\r\n  }\r\n\r\n  /**\r\n   * Handles pointer (mouse, touch, stylus, etc.) up event.\r\n   * \r\n   * @param point - event coordinates.\r\n   * @param target - direct event target element.\r\n   */\r\n  public pointerUp(point: IPoint): void {\r\n    super.pointerUp(point);\r\n    this.setSize();\r\n  }\r\n\r\n  /**\r\n   * Sets rectangle's border stroke color.\r\n   * @param color - color as string\r\n   */\r\n  protected setStrokeColor(color: string): void {\r\n    this.strokeColor = color;\r\n    if (this.visual) {\r\n      SvgHelper.setAttributes(this.visual, [['stroke', this.strokeColor]]);\r\n    }\r\n  }\r\n  /**\r\n   * Sets rectangle's fill color.\r\n   * @param color - color as string\r\n   */\r\n  protected setFillColor(color: string): void {\r\n    this.fillColor = color;\r\n    if (this.visual) {\r\n      SvgHelper.setAttributes(this.visual, [['fill', this.fillColor]]);\r\n    }\r\n  }\r\n  /**\r\n   * Sets rectangle's border stroke (line) width.\r\n   * @param color - color as string\r\n   */\r\n  protected setStrokeWidth(width: number): void {\r\n    this.strokeWidth = width;\r\n    if (this.visual) {\r\n      SvgHelper.setAttributes(this.visual, [['stroke-width', this.strokeWidth.toString()]]);\r\n    }\r\n  }\r\n  /**\r\n   * Sets rectangle's border stroke dash array.\r\n   * @param color - color as string\r\n   */\r\n  protected setStrokeDasharray(dashes: string): void {\r\n    this.strokeDasharray = dashes;\r\n    if (this.visual) {\r\n      SvgHelper.setAttributes(this.visual, [['stroke-dasharray', this.strokeDasharray]]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns current marker state that can be restored in the future.\r\n   */\r\n  public getState(): RectangleMarkerState {\r\n    const result: RectangleMarkerState = Object.assign({\r\n      fillColor: this.fillColor,\r\n      strokeColor: this.strokeColor,\r\n      strokeWidth: this.strokeWidth,\r\n      strokeDasharray: this.strokeDasharray,\r\n      opacity: this.opacity\r\n    }, super.getState());\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Restores previously saved marker state.\r\n   * \r\n   * @param state - previously saved state.\r\n   */\r\n  public restoreState(state: MarkerBaseState): void {\r\n    const rectState = state as RectangleMarkerState;\r\n    this.fillColor = rectState.fillColor;\r\n    this.strokeColor = rectState.strokeColor;\r\n    this.strokeWidth = rectState.strokeWidth;\r\n    this.strokeDasharray = rectState.strokeDasharray;\r\n    this.opacity = rectState.opacity;\r\n\r\n    this.createVisual();\r\n    super.restoreState(state);\r\n    this.setSize();\r\n  }\r\n\r\n  /**\r\n   * Scales marker. Used after the image resize.\r\n   * \r\n   * @param scaleX - horizontal scale\r\n   * @param scaleY - vertical scale\r\n   */\r\n  public scale(scaleX: number, scaleY: number): void {\r\n    super.scale(scaleX, scaleY);\r\n\r\n    this.setSize();\r\n  }\r\n\r\n}\r\n","import { Style } from '../../core/Style';\r\nimport { ToolboxPanel } from '../ToolboxPanel';\r\nimport Icon from './line-width-panel-icon.svg';\r\n\r\n/**\r\n * Line width change event handler type.\r\n */\r\nexport type WidthChangeHandler = (newWidth: number) => void;\r\n\r\n/**\r\n * Line width toolbox panel.\r\n */\r\nexport class LineWidthPanel extends ToolboxPanel {\r\n  private widths: number[] = [];\r\n  private currentWidth?: number;\r\n\r\n  private widthBoxes: HTMLDivElement[] = [];\r\n\r\n  /**\r\n   * Line width change event handler.\r\n   */\r\n  public onWidthChanged?: WidthChangeHandler;\r\n\r\n  /**\r\n   * Creates a line width toolbox panel.\r\n   * @param title - panel title.\r\n   * @param widths - available widths.\r\n   * @param currentWidth - currently set width.\r\n   * @param icon - toolbox panel icon (SVG image markup).\r\n   */\r\n  constructor(title: string, widths: number[], currentWidth?: number, icon?: string) {\r\n    super(title, icon ? icon : Icon);\r\n    this.widths = widths;\r\n    this.currentWidth = currentWidth;\r\n\r\n    this.setCurrentWidth = this.setCurrentWidth.bind(this);\r\n  }\r\n\r\n  /**\r\n   * Returns panel UI.\r\n   */\r\n  public getUi(): HTMLDivElement {\r\n    const panelDiv = document.createElement('div');\r\n    panelDiv.style.display = 'flex';\r\n    panelDiv.style.overflow = 'hidden';\r\n    panelDiv.style.flexGrow = '2';\r\n    this.widths.forEach((lineWidth) => {\r\n      const widthBoxContainer = document.createElement('div');\r\n      widthBoxContainer.style.display = 'flex';\r\n      widthBoxContainer.style.flexGrow = '2';\r\n      widthBoxContainer.style.alignItems = 'center';\r\n      widthBoxContainer.style.justifyContent = 'space-between';\r\n      widthBoxContainer.style.padding = '5px';\r\n      widthBoxContainer.style.borderWidth = '2px';\r\n      widthBoxContainer.style.borderStyle = 'solid';\r\n      widthBoxContainer.style.borderColor =\r\n        lineWidth === this.currentWidth ? Style.settings.toolboxAccentColor : 'transparent';\r\n\r\n      widthBoxContainer.addEventListener('click', () => {\r\n        this.setCurrentWidth(lineWidth, widthBoxContainer);\r\n      })\r\n      panelDiv.appendChild(widthBoxContainer);\r\n\r\n      const label = document.createElement('div');\r\n      label.innerText = lineWidth.toString();\r\n      label.style.marginRight = '5px';\r\n      widthBoxContainer.appendChild(label);\r\n\r\n      const widthBox = document.createElement('div');\r\n      widthBox.style.minHeight = '20px';\r\n      widthBox.style.flexGrow = '2';\r\n      widthBox.style.display = 'flex';\r\n      widthBox.style.alignItems = 'center';\r\n\r\n      const hr = document.createElement('hr');\r\n      hr.style.minWidth = '20px';\r\n      hr.style.border = '0px';\r\n      hr.style.borderTop = `${lineWidth}px solid ${Style.settings.toolboxColor}`;\r\n      hr.style.flexGrow = '2';\r\n      widthBox.appendChild(hr);\r\n\r\n      // widthBox.innerHTML = `<svg viewBox=\"0 0 140 20\" width=\"140\" height=\"20\" xmlns=\"http://www.w3.org/2000/svg\">\r\n      //   <line x1=\"0\" y1=\"10\" x2=\"140\" y2=\"10\" stroke=\"${Style.settings.toolboxColor}\" stroke-width=\"${lineWidth}\" />\r\n      // </svg>`;\r\n\r\n      widthBoxContainer.appendChild(widthBox);\r\n\r\n      this.widthBoxes.push(widthBoxContainer);\r\n    });\r\n    return panelDiv;\r\n  }\r\n\r\n  private setCurrentWidth(newWidth: number, target: HTMLDivElement) {\r\n    this.currentWidth = newWidth;\r\n\r\n    this.widthBoxes.forEach(box => {\r\n      box.style.borderColor = box === target ? Style.settings.toolboxAccentColor : 'transparent';\r\n    });\r\n\r\n    if (this.onWidthChanged) {\r\n      this.onWidthChanged(this.currentWidth);\r\n    }\r\n  }\r\n}\r\n","import { Style } from '../../core/Style';\r\nimport { ToolboxPanel } from '../ToolboxPanel';\r\nimport Icon from './line-style-panel-icon.svg';\r\n\r\n/**\r\n * Line style change event handler type.\r\n */\r\nexport type StyleChangeHandler = (newStyle: string) => void;\r\n\r\n/**\r\n * Line style (solid, dashed, etc.) toolbox panel.\r\n */\r\nexport class LineStylePanel extends ToolboxPanel {\r\n  private styles: string[] = [];\r\n  private currentStyle?: string;\r\n\r\n  private styleBoxes: HTMLDivElement[] = [];\r\n\r\n  /**\r\n   * Handler for the style change event.\r\n   */\r\n  public onStyleChanged?: StyleChangeHandler;\r\n\r\n  /**\r\n   * Creates a line style toolbox panel.\r\n   * @param title - panel title\r\n   * @param styles - available line styles (dash array).\r\n   * @param currentStyle - currently selected style.\r\n   * @param icon - panel button icon (SVG image markup).\r\n   */\r\n  constructor(title: string, styles: string[], currentStyle?: string, icon?: string) {\r\n    super(title, icon ? icon : Icon);\r\n    this.styles = styles;\r\n    this.currentStyle = currentStyle;\r\n\r\n    this.setCurrentStyle = this.setCurrentStyle.bind(this);\r\n  }\r\n\r\n  /**\r\n   * Returns panel UI.\r\n   */\r\n  public getUi(): HTMLDivElement {\r\n    const panelDiv = document.createElement('div');\r\n    panelDiv.style.display = 'flex';\r\n    panelDiv.style.overflow = 'hidden';\r\n    panelDiv.style.flexGrow = '2';\r\n    this.styles.forEach((lineStyle) => {\r\n      const styleBoxContainer = document.createElement('div');\r\n      styleBoxContainer.style.display = 'flex'; //'inline-block';\r\n      styleBoxContainer.style.alignItems = 'center';\r\n      styleBoxContainer.style.justifyContent = 'space-between';\r\n      styleBoxContainer.style.padding = '5px';\r\n      styleBoxContainer.style.borderWidth = '2px';\r\n      styleBoxContainer.style.borderStyle = 'solid';\r\n      styleBoxContainer.style.overflow = 'hidden';\r\n      styleBoxContainer.style.maxWidth = `${100 / this.styles.length - 5}%`;\r\n      styleBoxContainer.style.borderColor =\r\n        lineStyle === this.currentStyle ? Style.settings.toolboxAccentColor : 'transparent';\r\n\r\n      styleBoxContainer.addEventListener('click', () => {\r\n        this.setCurrentStyle(lineStyle, styleBoxContainer);\r\n      })\r\n      panelDiv.appendChild(styleBoxContainer);\r\n\r\n      const styleBox = document.createElement('div');\r\n      styleBox.style.minHeight = '20px';\r\n      styleBox.style.flexGrow = '2';\r\n      styleBox.style.overflow = 'hidden';\r\n\r\n      const styleSample = `<svg width=\"100\" height=\"20\">\r\n      <line x1=\"0\" y1=\"10\" x2=\"100\" y2=\"10\" stroke=\"${\r\n        Style.settings.toolboxColor}\" stroke-width=\"3\" ${\r\n          lineStyle !== '' ? 'stroke-dasharray=\"' + lineStyle + '\"' : ''} />\r\n  </svg>`;\r\n\r\n      styleBox.innerHTML = styleSample;\r\n\r\n      styleBoxContainer.appendChild(styleBox);\r\n\r\n      this.styleBoxes.push(styleBoxContainer);\r\n    });\r\n    return panelDiv;\r\n  }\r\n\r\n  private setCurrentStyle(newStyle: string, target: HTMLDivElement) {\r\n    this.currentStyle = newStyle;\r\n\r\n    this.styleBoxes.forEach(box => {\r\n      box.style.borderColor = box === target ? Style.settings.toolboxAccentColor : 'transparent';\r\n    });\r\n\r\n    if (this.onStyleChanged) {\r\n      this.onStyleChanged(this.currentStyle);\r\n    }\r\n  }\r\n}\r\n","import Icon from './frame-marker-icon.svg';\r\nimport { ToolboxPanel } from '../../ui/ToolboxPanel';\r\nimport { ColorPickerPanel } from '../../ui/toolbox-panels/ColorPickerPanel';\r\nimport { Settings } from '../../core/Settings';\r\nimport { RectangleMarker } from '../RectangleMarker';\r\nimport { LineWidthPanel } from '../../ui/toolbox-panels/LineWidthPanel';\r\nimport { LineStylePanel } from '../../ui/toolbox-panels/LineStylePanel';\r\nimport { RectangleMarkerState } from '../RectangleMarkerState';\r\n\r\nexport class FrameMarker extends RectangleMarker {\r\n  /**\r\n   * String type name of the marker type. \r\n   * \r\n   * Used when adding {@link MarkerArea.availableMarkerTypes} via a string and to save and restore state.\r\n   */\r\n  public static typeName = 'FrameMarker';\r\n  \r\n  /**\r\n   * Marker type title (display name) used for accessibility and other attributes.\r\n   */\r\n  public static title = 'Frame marker';\r\n  /**\r\n   * SVG icon markup displayed on toolbar buttons.\r\n   */\r\n  public static icon = Icon;\r\n\r\n  private strokePanel: ColorPickerPanel;\r\n  private strokeWidthPanel: LineWidthPanel;\r\n  private strokeStylePanel: LineStylePanel;\r\n\r\n  /**\r\n   * Creates a new marker.\r\n   *\r\n   * @param container - SVG container to hold marker's visual.\r\n   * @param overlayContainer - overlay HTML container to hold additional overlay elements while editing.\r\n   * @param settings - settings object containing default markers settings.\r\n   */\r\n  constructor(container: SVGGElement, overlayContainer: HTMLDivElement, settings: Settings) {\r\n    super(container, overlayContainer, settings);\r\n\r\n    this.strokeColor = settings.defaultColor;\r\n    this.strokeWidth = settings.defaultStrokeWidth;\r\n    this.strokeDasharray = settings.defaultStrokeDasharray;\r\n\r\n    this.strokePanel = new ColorPickerPanel(\r\n      'Line color',\r\n      settings.defaultColorSet,\r\n      settings.defaultColor\r\n    );\r\n    this.strokePanel.onColorChanged = this.setStrokeColor;\r\n\r\n    this.strokeWidthPanel = new LineWidthPanel(\r\n      'Line width',\r\n      settings.defaultStrokeWidths,\r\n      settings.defaultStrokeWidth\r\n    );\r\n    this.strokeWidthPanel.onWidthChanged = this.setStrokeWidth;\r\n\r\n    this.strokeStylePanel = new LineStylePanel(\r\n      'Line style',\r\n      settings.defaultStrokeDasharrays,\r\n      settings.defaultStrokeDasharray\r\n    );\r\n    this.strokeStylePanel.onStyleChanged = this.setStrokeDasharray;\r\n  }\r\n\r\n  /**\r\n   * Returns the list of toolbox panels for this marker type.\r\n   */\r\n  public get toolboxPanels(): ToolboxPanel[] {\r\n    return [this.strokePanel, this.strokeWidthPanel, this.strokeStylePanel];\r\n  }\r\n\r\n  /**\r\n   * Returns current marker state that can be restored in the future.\r\n   */\r\n  public getState(): RectangleMarkerState {\r\n    const result = super.getState();\r\n    result.typeName = FrameMarker.typeName;\r\n    return result;\r\n  }\r\n}\r\n","/**\r\n * Represents a list of colors.\r\n */\r\nexport type ColorSet = string[];\r\n\r\n/**\r\n * marker.js 2 display mode - `inline` or `popup`.\r\n */\r\nexport type DisplayMode = 'inline' | 'popup';\r\n\r\n/**\r\n * Default settings for marker.js 2 markers.\r\n */\r\nexport class Settings {\r\n  /**\r\n   * List of colors used in color pickers.\r\n   */\r\n  public defaultColorSet: ColorSet = [\r\n    '#EF4444', // red\r\n    '#10B981', // green\r\n    '#2563EB', // blue\r\n    '#FFFF00', // yellow\r\n    '#7C3AED', // purple\r\n    '#F472B6', // pink\r\n    '#000000', // black\r\n    '#FFFFFF' //white\r\n  ];\r\n\r\n  /**\r\n   * Default foreground color.\r\n   */\r\n  public defaultColor = this.defaultColorSet[0];\r\n  /**\r\n   * Default fill color.\r\n   */\r\n  public defaultFillColor = this.defaultColorSet[0];\r\n  /**\r\n   * Default stroke color for markers with background (eg. {@link CalloutMarker}).\r\n   */\r\n  public defaultStrokeColor = this.defaultColorSet[7];\r\n  /**\r\n   * Default highlighter color.\r\n   */\r\n  public defaultHighlightColor = this.defaultColorSet[3];\r\n  /**\r\n   * Default stroke (line) width.\r\n   */\r\n  public defaultStrokeWidth = 3;\r\n  /**\r\n   * Default line dash array\r\n   */\r\n  public defaultStrokeDasharray = '';\r\n  /**\r\n   * Default opacity (alpha) of the {@link HighlightMarker} (and other highlighters).\r\n   */\r\n  public defaultHighlightOpacity = 0.5;\r\n  /**\r\n   * Default font family for text-based markers (eg. {@link TextMarker} and {@link CalloutMarker}).\r\n   *\r\n   */\r\n  public defaultFontFamily = 'Helvetica, Arial, sans-serif';\r\n\r\n  /**\r\n   * Stroke (line) width options.\r\n   */\r\n  public defaultStrokeWidths = [1, 2, 3, 5, 10];\r\n  \r\n  /**\r\n   * Stroke dash array options.\r\n   */\r\n  public defaultStrokeDasharrays = ['', '3', '12 3', '9 6 3 6'];\r\n\r\n  /**\r\n   * Opacity options.\r\n   */\r\n  public defaultOpacitySteps = [0.1, 0.25, 0.5, 0.75, 1];\r\n\r\n  /**\r\n   * Default display mode.\r\n   */\r\n  public displayMode: DisplayMode = 'inline';\r\n\r\n  /**\r\n   * Font family options.\r\n   */\r\n  public defaultFontFamilies = [\r\n    'Times, \"Times New Roman\", serif',\r\n    'Helvetica, Arial, sans-serif',\r\n    'Courier, \"Courier New\", monospace',\r\n    'cursive',\r\n    'fantasy'\r\n  ];\r\n\r\n  /**\r\n   * Margin in pixels between marker.js popup UI and window borders.\r\n   */\r\n  public popupMargin = 30;\r\n\r\n  /**\r\n   * Create a new Freehand marker for every stroke.\r\n   */\r\n  public newFreehandMarkerOnPointerUp = false;\r\n}\r\n","import { MarkerBase } from '../core/MarkerBase';\r\n\r\nimport { IPoint } from '../core/IPoint';\r\nimport { SvgHelper } from '../core/SvgHelper';\r\n\r\nimport { ResizeGrip } from './ResizeGrip';\r\nimport { Settings } from '../core/Settings';\r\nimport { LinearMarkerBaseState } from './LinearMarkerBaseState';\r\nimport { MarkerBaseState } from '../core/MarkerBaseState';\r\n\r\n/**\r\n * LinearMarkerBase is a base class for all line-type markers (Line, Arrow, Measurement Tool, etc.).\r\n */\r\nexport class LinearMarkerBase extends MarkerBase {\r\n  /**\r\n   * x coordinate of the first end-point\r\n   */\r\n  protected x1 = 0;\r\n  /**\r\n   * y coordinate of the first end-point\r\n   */\r\n  protected y1 = 0;\r\n  /**\r\n   * x coordinate of the second end-point\r\n   */\r\n  protected x2 = 0;\r\n  /**\r\n   * y coordinate of the second end-point\r\n   */\r\n  protected y2 = 0;\r\n\r\n  /**\r\n   * Default line length when marker is created with a simple click (without dragging).\r\n   */\r\n  protected defaultLength = 50;\r\n\r\n  private manipulationStartX = 0;\r\n  private manipulationStartY = 0;\r\n\r\n  private manipulationStartX1 = 0;\r\n  private manipulationStartY1 = 0;\r\n  private manipulationStartX2 = 0;\r\n  private manipulationStartY2 = 0;\r\n\r\n  /**\r\n   * Marker's main visual.\r\n   */\r\n  protected visual: SVGGraphicsElement;\r\n\r\n  private controlBox: SVGGElement;\r\n\r\n  private grip1: ResizeGrip;\r\n  private grip2: ResizeGrip;\r\n  private activeGrip: ResizeGrip;\r\n\r\n  /**\r\n   * Creates a LineMarkerBase object.\r\n   * \r\n   * @param container - SVG container to hold marker's visual.\r\n   * @param overlayContainer - overlay HTML container to hold additional overlay elements while editing.\r\n   * @param settings - settings object containing default markers settings.\r\n   */\r\n  constructor(container: SVGGElement, overlayContainer: HTMLDivElement, settings: Settings) {\r\n    super(container, overlayContainer, settings);\r\n\r\n    this.setupControlBox();\r\n  }\r\n\r\n  /**\r\n   * Returns true if passed SVG element belongs to the marker. False otherwise.\r\n   * \r\n   * @param el - target element.\r\n   */\r\n  public ownsTarget(el: EventTarget): boolean {\r\n    if (super.ownsTarget(el)) {\r\n      return true;\r\n    } else if (\r\n      this.grip1.ownsTarget(el) || this.grip2.ownsTarget(el)\r\n    ) {\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  \r\n  /**\r\n   * Handles pointer (mouse, touch, stylus, etc.) down event.\r\n   * \r\n   * @param point - event coordinates.\r\n   * @param target - direct event target element.\r\n   */\r\n  public pointerDown(point: IPoint, target?: EventTarget): void {\r\n    super.pointerDown(point, target);\r\n\r\n    this.manipulationStartX = point.x;\r\n    this.manipulationStartY = point.y;\r\n\r\n    if (this.state === 'new') {\r\n      this.x1 = point.x;\r\n      this.y1 = point.y;\r\n      this.x2 = point.x;\r\n      this.y2 = point.y;\r\n    }\r\n\r\n    this.manipulationStartX1 = this.x1;\r\n    this.manipulationStartY1 = this.y1;\r\n    this.manipulationStartX2 = this.x2;\r\n    this.manipulationStartY2 = this.y2;\r\n\r\n    if (this.state !== 'new') {\r\n      this.select();\r\n      if (this.grip1.ownsTarget(target)) {\r\n        this.activeGrip = this.grip1;\r\n      } else if (this.grip2.ownsTarget(target)) {\r\n        this.activeGrip = this.grip2;\r\n      } else {\r\n        this.activeGrip = undefined;\r\n      }\r\n\r\n      if (this.activeGrip) {\r\n        this._state = 'resize';\r\n      } else {\r\n        this._state = 'move';\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles pointer (mouse, touch, stylus, etc.) up event.\r\n   * \r\n   * @param point - event coordinates.\r\n   * @param target - direct event target element.\r\n   */\r\n  public pointerUp(point: IPoint): void {\r\n    const inState = this.state;\r\n    super.pointerUp(point);\r\n    if (this.state === 'creating' && Math.abs(this.x1 - this.x2) < 10 && Math.abs(this.y1 - this.y2) < 10) {\r\n      this.x2 = this.x1 + this.defaultLength;\r\n      this.adjustVisual();\r\n      this.adjustControlBox()\r\n    } else {\r\n      this.manipulate(point);\r\n    }\r\n    this._state = 'select';\r\n    if (inState === 'creating' && this.onMarkerCreated) {\r\n      this.onMarkerCreated(this);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * When implemented adjusts marker visual after manipulation when needed.\r\n   */\r\n  // eslint-disable-next-line @typescript-eslint/no-empty-function\r\n  protected adjustVisual(): void {}\r\n\r\n  /**\r\n   * Handles marker manipulation (move, resize, rotate, etc.).\r\n   * \r\n   * @param point - event coordinates.\r\n   */\r\n  public manipulate(point: IPoint): void {\r\n    if (this.state === 'creating') {\r\n      this.resize(point);\r\n    } else if (this.state === 'move') {\r\n      this.x1 = this.manipulationStartX1 + point.x - this.manipulationStartX;\r\n      this.y1 = this.manipulationStartY1 + point.y - this.manipulationStartY;\r\n      this.x2 = this.manipulationStartX2 + point.x - this.manipulationStartX;\r\n      this.y2 = this.manipulationStartY2 + point.y - this.manipulationStartY;\r\n      this.adjustVisual();\r\n      this.adjustControlBox();\r\n    } else if (this.state === 'resize') {\r\n      this.resize(point);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Resizes the line marker.\r\n   * @param point - current manipulation coordinates.\r\n   */\r\n  protected resize(point: IPoint): void {\r\n    switch(this.activeGrip) {\r\n      case this.grip1:\r\n        this.x1 = point.x;\r\n        this.y1 = point.y;\r\n        break; \r\n      case this.grip2:\r\n      case undefined:\r\n        this.x2 = point.x;\r\n        this.y2 = point.y;\r\n        break; \r\n    }\r\n    this.adjustVisual();\r\n    this.adjustControlBox();\r\n  }\r\n\r\n  /**\r\n   * Displays marker's controls.\r\n   */\r\n  public select(): void {\r\n    super.select();\r\n    this.adjustControlBox();\r\n    this.controlBox.style.display = '';\r\n  }\r\n\r\n  /**\r\n   * Hides marker's controls.\r\n   */\r\n  public deselect(): void {\r\n    super.deselect();\r\n    this.controlBox.style.display = 'none';\r\n  }\r\n\r\n  private setupControlBox() {\r\n    this.controlBox = SvgHelper.createGroup();\r\n    this.container.appendChild(this.controlBox);\r\n\r\n    this.addControlGrips();\r\n\r\n    this.controlBox.style.display = 'none';\r\n  }\r\n\r\n  private adjustControlBox() {\r\n    this.positionGrips();\r\n  }\r\n\r\n  private addControlGrips() {\r\n    this.grip1 = this.createGrip();\r\n    this.grip2 = this.createGrip();\r\n\r\n    this.positionGrips();\r\n  }\r\n\r\n  private createGrip(): ResizeGrip {\r\n    const grip = new ResizeGrip();\r\n    grip.visual.transform.baseVal.appendItem(SvgHelper.createTransform());\r\n    this.controlBox.appendChild(grip.visual);\r\n\r\n    return grip;\r\n  }\r\n\r\n  private positionGrips() {\r\n    const gripSize = this.grip1.GRIP_SIZE;\r\n\r\n    this.positionGrip(this.grip1.visual, this.x1 - gripSize / 2, this.y1 - gripSize / 2);\r\n    this.positionGrip(this.grip2.visual, this.x2 - gripSize / 2, this.y2 - gripSize / 2);\r\n  }\r\n\r\n  private positionGrip(grip: SVGGraphicsElement, x: number, y: number) {\r\n    const translate = grip.transform.baseVal.getItem(0);\r\n    translate.setTranslate(x, y);\r\n    grip.transform.baseVal.replaceItem(translate, 0);\r\n  }\r\n\r\n  /**\r\n   * Returns marker's state.\r\n   */\r\n  public getState(): LinearMarkerBaseState {\r\n    const result: LinearMarkerBaseState = Object.assign({\r\n      x1: this.x1,\r\n      y1: this.y1,\r\n      x2: this.x2,\r\n      y2: this.y2\r\n    }, super.getState());\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Restores marker's state to the previously saved one.\r\n   * @param state - previously saved state.\r\n   */\r\n  public restoreState(state: MarkerBaseState): void {\r\n    super.restoreState(state);\r\n    const lmbState = state as LinearMarkerBaseState;\r\n    this.x1 = lmbState.x1;\r\n    this.y1 = lmbState.y1;\r\n    this.x2 = lmbState.x2;\r\n    this.y2 = lmbState.y2;\r\n  }\r\n\r\n  /**\r\n   * Scales marker. Used after the image resize.\r\n   * \r\n   * @param scaleX - horizontal scale\r\n   * @param scaleY - vertical scale\r\n   */\r\n  public scale(scaleX: number, scaleY: number): void {\r\n    super.scale(scaleX, scaleY);\r\n\r\n    this.x1 = this.x1 * scaleX;\r\n    this.y1 = this.y1 * scaleY;\r\n    this.x2 = this.x2 * scaleX;\r\n    this.y2 = this.y2 * scaleY;\r\n\r\n    this.adjustVisual();\r\n    this.adjustControlBox();\r\n  }\r\n}\r\n","import { IPoint } from '../../core/IPoint';\r\nimport { SvgHelper } from '../../core/SvgHelper';\r\nimport { Settings } from '../../core/Settings';\r\nimport { LinearMarkerBase } from '../LinearMarkerBase';\r\nimport Icon from './line-marker-icon.svg';\r\nimport { ColorPickerPanel } from '../../ui/toolbox-panels/ColorPickerPanel';\r\nimport { ToolboxPanel } from '../../ui/ToolboxPanel';\r\nimport { LineWidthPanel } from '../../ui/toolbox-panels/LineWidthPanel';\r\nimport { LineStylePanel } from '../../ui/toolbox-panels/LineStylePanel';\r\nimport { LineMarkerState } from './LineMarkerState';\r\nimport { MarkerBaseState } from '../../core/MarkerBaseState';\r\n\r\nexport class LineMarker extends LinearMarkerBase {\r\n  /**\r\n   * String type name of the marker type. \r\n   * \r\n   * Used when adding {@link MarkerArea.availableMarkerTypes} via a string and to save and restore state.\r\n   */\r\n  public static typeName = 'LineMarker';\r\n  \r\n  /**\r\n   * Marker type title (display name) used for accessibility and other attributes.\r\n   */\r\n  public static title = 'Line marker';\r\n  /**\r\n   * SVG icon markup displayed on toolbar buttons.\r\n   */\r\n  public static icon = Icon;\r\n\r\n  /**\r\n   * Invisible wider line to make selection easier/possible.\r\n   */\r\n  protected selectorLine: SVGLineElement;\r\n  /**\r\n   * Visible marker line.\r\n   */\r\n  protected visibleLine: SVGLineElement;\r\n\r\n  /**\r\n   * Line color.\r\n   */\r\n  protected strokeColor = 'transparent';\r\n  /**\r\n   * Line width.\r\n   */\r\n  protected strokeWidth = 0;\r\n  /**\r\n   * Line dash array.\r\n   */\r\n  protected strokeDasharray = '';\r\n\r\n  /**\r\n   * Color pickar panel for line color.\r\n   */\r\n  protected strokePanel: ColorPickerPanel;\r\n  /**\r\n   * Line width toolbox panel.\r\n   */\r\n  protected strokeWidthPanel: LineWidthPanel;\r\n  /**\r\n   * Line dash array toolbox panel.\r\n   */\r\n  protected strokeStylePanel: LineStylePanel;\r\n\r\n  /**\r\n   * Creates a new marker.\r\n   *\r\n   * @param container - SVG container to hold marker's visual.\r\n   * @param overlayContainer - overlay HTML container to hold additional overlay elements while editing.\r\n   * @param settings - settings object containing default markers settings.\r\n   */\r\n  constructor(container: SVGGElement, overlayContainer: HTMLDivElement, settings: Settings) {\r\n    super(container, overlayContainer, settings);\r\n\r\n    this.setStrokeColor = this.setStrokeColor.bind(this);\r\n    this.setStrokeWidth = this.setStrokeWidth.bind(this);\r\n    this.setStrokeDasharray = this.setStrokeDasharray.bind(this);\r\n\r\n    this.strokeColor = settings.defaultColor;\r\n    this.strokeWidth = settings.defaultStrokeWidth;\r\n    this.strokeDasharray = settings.defaultStrokeDasharray;\r\n\r\n    this.strokePanel = new ColorPickerPanel(\r\n      'Line color',\r\n      settings.defaultColorSet,\r\n      settings.defaultColor\r\n    );\r\n    this.strokePanel.onColorChanged = this.setStrokeColor;\r\n\r\n    this.strokeWidthPanel = new LineWidthPanel(\r\n      'Line width',\r\n      settings.defaultStrokeWidths,\r\n      settings.defaultStrokeWidth\r\n    );\r\n    this.strokeWidthPanel.onWidthChanged = this.setStrokeWidth;\r\n\r\n    this.strokeStylePanel = new LineStylePanel(\r\n      'Line style',\r\n      settings.defaultStrokeDasharrays,\r\n      settings.defaultStrokeDasharray\r\n    );\r\n    this.strokeStylePanel.onStyleChanged = this.setStrokeDasharray;\r\n  }\r\n\r\n  /**\r\n   * Returns true if passed SVG element belongs to the marker. False otherwise.\r\n   * \r\n   * @param el - target element.\r\n   */\r\n  public ownsTarget(el: EventTarget): boolean {\r\n    if (\r\n      super.ownsTarget(el) ||\r\n      el === this.visual ||\r\n      el === this.selectorLine ||\r\n      el === this.visibleLine\r\n    ) {\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  private createVisual() {\r\n    this.visual = SvgHelper.createGroup();\r\n    this.selectorLine = SvgHelper.createLine(\r\n      this.x1,\r\n      this.y1,\r\n      this.x2,\r\n      this.y2,\r\n      [\r\n        ['stroke', 'transparent'],\r\n        ['stroke-width', (this.strokeWidth + 10).toString()],\r\n      ]\r\n    );\r\n    this.visibleLine = SvgHelper.createLine(\r\n      this.x1,\r\n      this.y1,\r\n      this.x2,\r\n      this.y2,\r\n      [\r\n        ['stroke', this.strokeColor],\r\n        ['stroke-width', this.strokeWidth.toString()],\r\n      ]\r\n    );\r\n    this.visual.appendChild(this.selectorLine);\r\n    this.visual.appendChild(this.visibleLine);\r\n\r\n    this.addMarkerVisualToContainer(this.visual);\r\n  }\r\n\r\n  /**\r\n   * Handles pointer (mouse, touch, stylus, etc.) down event.\r\n   * \r\n   * @param point - event coordinates.\r\n   * @param target - direct event target element.\r\n   */\r\n  public pointerDown(point: IPoint, target?: EventTarget): void {\r\n    super.pointerDown(point, target);\r\n    if (this.state === 'new') {\r\n      this.createVisual();\r\n      this.adjustVisual();\r\n\r\n      this._state = 'creating';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adjusts visual after manipulation.\r\n   */\r\n  protected adjustVisual(): void {\r\n    this.selectorLine.setAttribute('x1', this.x1.toString());\r\n    this.selectorLine.setAttribute('y1', this.y1.toString());\r\n    this.selectorLine.setAttribute('x2', this.x2.toString());\r\n    this.selectorLine.setAttribute('y2', this.y2.toString());\r\n\r\n    this.visibleLine.setAttribute('x1', this.x1.toString());\r\n    this.visibleLine.setAttribute('y1', this.y1.toString());\r\n    this.visibleLine.setAttribute('x2', this.x2.toString());\r\n    this.visibleLine.setAttribute('y2', this.y2.toString());\r\n\r\n    SvgHelper.setAttributes(this.visibleLine, [['stroke', this.strokeColor]]);\r\n    SvgHelper.setAttributes(this.visibleLine, [['stroke-width', this.strokeWidth.toString()]]);\r\n    SvgHelper.setAttributes(this.visibleLine, [['stroke-dasharray', this.strokeDasharray.toString()]]);\r\n  }\r\n\r\n  /**\r\n   * Sets line color.\r\n   * @param color - new color.\r\n   */\r\n  protected setStrokeColor(color: string): void {\r\n    this.strokeColor = color;\r\n    this.adjustVisual();\r\n  }\r\n  /**\r\n   * Sets line width.\r\n   * @param width - new width.\r\n   */\r\n  protected setStrokeWidth(width: number): void {\r\n    this.strokeWidth = width\r\n    this.adjustVisual();\r\n  }\r\n\r\n  /**\r\n   * Sets line dash array.\r\n   * @param dashes - new dash array.\r\n   */\r\n  protected setStrokeDasharray(dashes: string): void {\r\n    this.strokeDasharray = dashes;\r\n    this.adjustVisual();\r\n  }\r\n\r\n  /**\r\n   * Returns the list of toolbox panels for this marker type.\r\n   */\r\n  public get toolboxPanels(): ToolboxPanel[] {\r\n    return [this.strokePanel, this.strokeWidthPanel, this.strokeStylePanel];\r\n  }\r\n\r\n  /**\r\n   * Returns current marker state that can be restored in the future.\r\n   */\r\n  public getState(): LineMarkerState {\r\n    const result: LineMarkerState = Object.assign({\r\n      strokeColor: this.strokeColor,\r\n      strokeWidth: this.strokeWidth,\r\n      strokeDasharray: this.strokeDasharray\r\n    }, super.getState());\r\n    result.typeName = LineMarker.typeName;\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Restores previously saved marker state.\r\n   * \r\n   * @param state - previously saved state.\r\n   */\r\n  public restoreState(state: MarkerBaseState): void {\r\n    super.restoreState(state);\r\n\r\n    const lmState = state as LineMarkerState;\r\n    this.strokeColor = lmState.strokeColor;\r\n    this.strokeWidth = lmState.strokeWidth;\r\n    this.strokeDasharray = lmState.strokeDasharray;\r\n\r\n    this.createVisual();\r\n    this.adjustVisual();\r\n  }\r\n}\r\n","import { Style } from '../../core/Style';\r\nimport { ToolboxPanel } from '../ToolboxPanel';\r\nimport Icon from './font-family-panel-icon.svg';\r\n\r\n/**\r\n * Font change event handler type.\r\n */\r\nexport type FontChangeHandler = (newFont: string) => void;\r\n\r\n/**\r\n * Font family selection toolbox panel.\r\n */\r\nexport class FontFamilyPanel extends ToolboxPanel {\r\n  private fonts: string[] = [];\r\n  private currentFont?: string;\r\n\r\n  private fontBoxes: HTMLDivElement[] = [];\r\n\r\n  /**\r\n   * Handler for the font family change event.\r\n   */\r\n  public onFontChanged?: FontChangeHandler;\r\n\r\n  /**\r\n   * Creates a font family toolbox panel.\r\n   * @param title - panel title.\r\n   * @param fonts - available font families.\r\n   * @param currentFont - currently selected font family.\r\n   * @param icon - panel button icon (SVG image markup).\r\n   */\r\n  constructor(title: string, fonts: string[], currentFont?: string, icon?: string) {\r\n    super(title, icon ? icon : Icon);\r\n    this.fonts = fonts;\r\n    this.currentFont = currentFont;\r\n\r\n    this.setCurrentFont = this.setCurrentFont.bind(this);\r\n  }\r\n\r\n  /**\r\n   * Returns panel UI.\r\n   */\r\n  public getUi(): HTMLDivElement {\r\n    const panelDiv = document.createElement('div');\r\n    // panelDiv.style.display = 'flex';\r\n    panelDiv.style.overflow = 'hidden';\r\n    panelDiv.style.flexGrow = '2';\r\n    this.fonts.forEach((font) => {\r\n      const fontBoxContainer = document.createElement('div');\r\n      fontBoxContainer.style.display = 'inline-block';\r\n      // fontBoxContainer.style.flexGrow = '2';\r\n      fontBoxContainer.style.alignItems = 'center';\r\n      fontBoxContainer.style.justifyContent = 'space-between';\r\n      fontBoxContainer.style.padding = '5px';\r\n      fontBoxContainer.style.borderWidth = '2px';\r\n      fontBoxContainer.style.borderStyle = 'solid';\r\n      fontBoxContainer.style.overflow = 'hidden';\r\n      fontBoxContainer.style.maxWidth = `${100 / this.fonts.length - 5}%`;\r\n      fontBoxContainer.style.borderColor =\r\n        font === this.currentFont ? Style.settings.toolboxAccentColor : 'transparent';\r\n\r\n      fontBoxContainer.addEventListener('click', () => {\r\n        this.setCurrentFont(font, fontBoxContainer);\r\n      })\r\n      panelDiv.appendChild(fontBoxContainer);\r\n\r\n      const fontBox = document.createElement('div');\r\n      fontBox.style.display = 'flex';\r\n      fontBox.style.minHeight = '20px';\r\n      fontBox.style.flexGrow = '2';\r\n      fontBox.style.fontFamily = font;\r\n      fontBox.style.overflow = 'hidden';\r\n\r\n      const fontLabel = document.createElement('div');\r\n      fontLabel.style.whiteSpace = 'nowrap';\r\n      fontLabel.style.overflow = 'hidden';\r\n      fontLabel.style.textOverflow = 'ellipsis';\r\n      fontLabel.innerHTML = 'The quick brown fox jumps over the lazy dog';\r\n\r\n      fontBox.appendChild(fontLabel);\r\n\r\n      fontBoxContainer.appendChild(fontBox);\r\n\r\n      this.fontBoxes.push(fontBoxContainer);\r\n    });\r\n    return panelDiv;\r\n  }\r\n\r\n  private setCurrentFont(newFont: string, target: HTMLDivElement) {\r\n    this.currentFont = newFont;\r\n\r\n    this.fontBoxes.forEach(box => {\r\n      box.style.borderColor = box === target ? Style.settings.toolboxAccentColor : 'transparent';\r\n    });\r\n\r\n    if (this.onFontChanged) {\r\n      this.onFontChanged(this.currentFont);\r\n    }\r\n  }\r\n}\r\n","import { IPoint } from '../../core/IPoint';\r\nimport { SvgHelper } from '../../core/SvgHelper';\r\nimport { RectangularBoxMarkerBase } from '../RectangularBoxMarkerBase';\r\nimport { Settings } from '../../core/Settings';\r\nimport Icon from './text-marker-icon.svg';\r\nimport { ColorPickerPanel } from '../../ui/toolbox-panels/ColorPickerPanel';\r\nimport { ToolboxPanel } from '../../ui/ToolboxPanel';\r\nimport { FontFamilyPanel } from '../../ui/toolbox-panels/FontFamilyPanel';\r\nimport { TextMarkerState } from './TextMarkerState';\r\nimport { MarkerBaseState } from '../../core/MarkerBaseState';\r\n\r\nexport class TextMarker extends RectangularBoxMarkerBase {\r\n  /**\r\n   * String type name of the marker type. \r\n   * \r\n   * Used when adding {@link MarkerArea.availableMarkerTypes} via a string and to save and restore state.\r\n   */\r\n  public static typeName = 'TextMarker';\r\n\r\n  /**\r\n   * Marker type title (display name) used for accessibility and other attributes.\r\n   */\r\n  public static title = 'Text marker';\r\n  /**\r\n   * SVG icon markup displayed on toolbar buttons.\r\n   */\r\n  public static icon = Icon;\r\n\r\n  /**\r\n   * Text color.\r\n   */\r\n  protected color = 'transparent';\r\n  /**\r\n   * Text's font family.\r\n   */\r\n  protected fontFamily: string;\r\n  /**\r\n   * Padding inside of the marker's bounding box in percents.\r\n   */\r\n  protected padding = 5;\r\n\r\n  /**\r\n   * Text color picker toolbox panel.\r\n   */\r\n  protected colorPanel: ColorPickerPanel;\r\n  /**\r\n   * Text font family toolbox panel.\r\n   */\r\n  protected fontFamilyPanel: FontFamilyPanel;\r\n\r\n  private readonly DEFAULT_TEXT = \"your text here\";\r\n  private text: string = this.DEFAULT_TEXT;\r\n  /**\r\n   * Visual text element.\r\n   */\r\n  protected textElement: SVGTextElement;\r\n  /**\r\n   * Text background rectangle.\r\n   */\r\n  protected bgRectangle: SVGRectElement;\r\n  /**\r\n   * Div element for the text editor container.\r\n   */\r\n  protected textEditDiv: HTMLDivElement;\r\n  /**\r\n   * Editable text element.\r\n   */\r\n  protected textEditor: HTMLDivElement;\r\n\r\n  private isMoved = false;\r\n  private pointerDownPoint: IPoint;\r\n  private pointerDownTimestamp: number;\r\n\r\n  /**\r\n   * Creates a new marker.\r\n   *\r\n   * @param container - SVG container to hold marker's visual.\r\n   * @param overlayContainer - overlay HTML container to hold additional overlay elements while editing.\r\n   * @param settings - settings object containing default markers settings.\r\n   */\r\n  constructor(container: SVGGElement, overlayContainer: HTMLDivElement, settings: Settings) {\r\n    super(container, overlayContainer, settings);\r\n\r\n    this.color = settings.defaultColor;\r\n    this.fontFamily = settings.defaultFontFamily;\r\n\r\n    this.defaultSize = {x: 100, y: 30};\r\n\r\n    this.setColor = this.setColor.bind(this);\r\n    this.setFont = this.setFont.bind(this);\r\n    this.renderText = this.renderText.bind(this);\r\n    this.sizeText = this.sizeText.bind(this);\r\n    this.textEditDivClicked = this.textEditDivClicked.bind(this);\r\n    this.showTextEditor = this.showTextEditor.bind(this);\r\n    this.setSize = this.setSize.bind(this);\r\n    this.positionTextEditor = this.positionTextEditor.bind(this);\r\n\r\n    this.colorPanel = new ColorPickerPanel(\r\n      'Color',\r\n      settings.defaultColorSet,\r\n      settings.defaultColor\r\n    );\r\n    this.colorPanel.onColorChanged = this.setColor;\r\n\r\n    this.fontFamilyPanel = new FontFamilyPanel(\r\n      'Font',\r\n      settings.defaultFontFamilies,\r\n      settings.defaultFontFamily\r\n    );\r\n    this.fontFamilyPanel.onFontChanged = this.setFont;\r\n  }\r\n\r\n  /**\r\n   * Returns true if passed SVG element belongs to the marker. False otherwise.\r\n   * \r\n   * @param el - target element.\r\n   */\r\n  public ownsTarget(el: EventTarget): boolean {\r\n    if (super.ownsTarget(el) || el === this.visual || el === this.textElement || el === this.bgRectangle) {\r\n      return true;\r\n    } else {\r\n      let found = false;\r\n      this.textElement.childNodes.forEach(span => {\r\n        if (span === el) {\r\n          found = true;\r\n        }\r\n      })\r\n      return found;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Creates text marker visual.\r\n   */\r\n  protected createVisual(): void {\r\n    this.visual = SvgHelper.createGroup();\r\n\r\n    this.bgRectangle = SvgHelper.createRect(1, 1, [\r\n      ['fill', 'transparent']\r\n    ]);\r\n    this.visual.appendChild(this.bgRectangle);\r\n\r\n    this.textElement = SvgHelper.createText([\r\n      ['fill', this.color],\r\n      ['font-family', this.fontFamily],\r\n      ['font-size', '16px'],\r\n      ['x', '0'],\r\n      ['y', '0']\r\n    ]);\r\n    this.textElement.transform.baseVal.appendItem(SvgHelper.createTransform()); // translate transorm\r\n    this.textElement.transform.baseVal.appendItem(SvgHelper.createTransform()); // scale transorm\r\n\r\n    this.visual.appendChild(this.textElement);\r\n\r\n    this.addMarkerVisualToContainer(this.visual);\r\n    this.renderText();\r\n  }\r\n\r\n  /**\r\n   * Handles pointer (mouse, touch, stylus, etc.) down event.\r\n   * \r\n   * @param point - event coordinates.\r\n   * @param target - direct event target element.\r\n   */\r\n  public pointerDown(point: IPoint, target?: EventTarget): void {\r\n    super.pointerDown(point, target);\r\n\r\n    this.isMoved = false;\r\n    this.pointerDownPoint = point;\r\n    this.pointerDownTimestamp = Date.now();\r\n\r\n    if (this.state === 'new') {\r\n      this.createVisual();\r\n      this.moveVisual(point);\r\n      this._state = 'creating';\r\n    }\r\n  }\r\n\r\n  private renderText() {\r\n    const LINE_SIZE = \"1.2em\";\r\n\r\n    while (this.textElement.lastChild) {\r\n        this.textElement.removeChild(this.textElement.lastChild);\r\n    }\r\n\r\n    const lines = this.text.split(/\\r\\n|[\\n\\v\\f\\r\\x85\\u2028\\u2029]/);\r\n    lines.forEach(line => {\r\n        if (line.trim() === \"\") {\r\n            line = \" \"; // workaround for swallowed empty lines\r\n        }\r\n        this.textElement.appendChild(SvgHelper.createTSpan(line, [[\"x\", \"0\"], [\"dy\", LINE_SIZE]]));\r\n    });\r\n\r\n    setTimeout(this.sizeText, 10);\r\n  }\r\n\r\n  private getTextScale(): number {\r\n    const textSize = this.textElement.getBBox();\r\n    let scale = 1.0;\r\n    if (textSize.width > 0 && textSize.height > 0) {\r\n        const xScale = (this.width * 1.0 - this.width * this.padding * 2 / 100) / textSize.width;\r\n        const yScale = (this.height * 1.0 - this.height * this.padding * 2 / 100) / textSize.height;\r\n        scale = Math.min(xScale, yScale);\r\n    }\r\n    return scale;\r\n  }\r\n\r\n  private getTextPosition(scale: number): IPoint {\r\n    const textSize = this.textElement.getBBox();\r\n    let x = 0;\r\n    let y = 0;\r\n    if (textSize.width > 0 && textSize.height > 0) {\r\n      x = (this.width - textSize.width * scale) / 2;\r\n      y = this.height / 2 - textSize.height * scale / 2;\r\n    }\r\n    return {x: x, y: y};\r\n  }\r\n\r\n  private sizeText() {\r\n    const textBBox = this.textElement.getBBox();\r\n    const scale = this.getTextScale();\r\n    const position = this.getTextPosition(scale);\r\n    position.y -= textBBox.y * scale; // workaround adjustment for text not being placed at y=0\r\n\r\n    this.textElement.transform.baseVal.getItem(0).setTranslate(position.x, position.y);\r\n    this.textElement.transform.baseVal.getItem(1).setScale(scale, scale);\r\n  }\r\n\r\n\r\n  /**\r\n   * Handles marker manipulation (move, resize, rotate, etc.).\r\n   * \r\n   * @param point - event coordinates.\r\n   */\r\n  public manipulate(point: IPoint): void {\r\n    super.manipulate(point);\r\n    if (this.pointerDownPoint !== undefined) {\r\n      this.isMoved = Math.abs(point.x - this.pointerDownPoint.x) > 5 || \r\n        Math.abs(point.y - this.pointerDownPoint.y) > 5;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Resize marker based on current pointer coordinates and context.\r\n   * @param point \r\n   */\r\n  protected resize(point: IPoint): void {\r\n    super.resize(point);\r\n    this.isMoved = true;\r\n    this.setSize();\r\n    this.sizeText();\r\n  }\r\n\r\n  /**\r\n   * Sets size of marker elements after manipulation.\r\n   */\r\n  protected setSize(): void {\r\n    super.setSize();\r\n    SvgHelper.setAttributes(this.visual, [\r\n      ['width', this.width.toString()],\r\n      ['height', this.height.toString()],\r\n    ]);\r\n    SvgHelper.setAttributes(this.bgRectangle, [\r\n      ['width', this.width.toString()],\r\n      ['height', this.height.toString()],\r\n    ]);\r\n  }\r\n\r\n  /**\r\n   * Handles pointer (mouse, touch, stylus, etc.) up event.\r\n   * \r\n   * @param point - event coordinates.\r\n   */\r\n  public pointerUp(point: IPoint): void {\r\n    const inState = this.state;\r\n    super.pointerUp(point);\r\n    this.setSize();\r\n    if (inState === 'creating' || \r\n      (!this.isMoved && (Date.now() - this.pointerDownTimestamp) > 500)) {\r\n      this.showTextEditor();\r\n    }\r\n    this.pointerDownPoint = undefined;\r\n  }\r\n\r\n  private showTextEditor() {\r\n    this._state = 'edit';\r\n    this.overlayContainer.innerHTML = '';\r\n\r\n    this.textEditDiv = document.createElement('div');\r\n    // textEditDiv.style.display = 'flex';\r\n    this.textEditDiv.style.flexGrow = '2';\r\n    //textEditDiv.style.backgroundColor = 'rgb(0,0,0,0.7)';\r\n    this.textEditDiv.style.alignItems = 'center';\r\n    this.textEditDiv.style.justifyContent = 'center';\r\n    this.textEditDiv.style.pointerEvents = 'auto';\r\n    this.textEditDiv.style.overflow = 'hidden';\r\n\r\n    this.textEditor = document.createElement('div');\r\n    this.textEditor.style.position = 'absolute';\r\n    this.textEditor.style.fontFamily = this.fontFamily;\r\n    this.textEditor.style.lineHeight = '1em';\r\n    this.textEditor.innerText = this.text;\r\n    this.textEditor.contentEditable = 'true';\r\n    this.textEditor.style.color = this.color;\r\n    this.positionTextEditor();\r\n    this.textEditor.addEventListener('pointerup', (ev) => {\r\n      ev.stopPropagation();\r\n    });\r\n    this.textEditor.addEventListener('input', () => {\r\n      let fontSize = Number.parseFloat(this.textEditor.style.fontSize);\r\n      while(this.textEditor.clientWidth >= Number.parseInt(this.textEditor.style.maxWidth) && fontSize > 0.9) {\r\n        fontSize -= 0.1;\r\n        this.textEditor.style.fontSize = `${Math.max(fontSize, 0.9)}em`;\r\n      }\r\n    })\r\n    this.textEditor.addEventListener('keyup', (ev) => {\r\n      ev.cancelBubble = true;\r\n    });\r\n\r\n    this.textEditDiv.addEventListener('pointerup', () => {\r\n      this.textEditDivClicked(this.textEditor.innerText);\r\n    })\r\n    this.textEditDiv.appendChild(this.textEditor);\r\n    this.overlayContainer.appendChild(this.textEditDiv);\r\n\r\n    this.hideVisual();\r\n\r\n    this.textEditor.focus();\r\n    document.execCommand('selectAll');\r\n  }\r\n\r\n  private positionTextEditor() {\r\n    if (this.state === 'edit') {\r\n      this.textElement.style.display = '';\r\n      const textScale = this.getTextScale();\r\n      // const textPosition = this.getTextPosition(textScale);\r\n      const rPosition = this.rotatePoint({\r\n        x: this.left + this.width / 2, \r\n        y: this.top + this.height / 2\r\n      });\r\n      const textSize = this.textElement.getBBox();\r\n      const rWH = {\r\n        x: textSize.width * textScale,\r\n        y: textSize.height * textScale\r\n      };\r\n      rPosition.x -= rWH.x / 2;\r\n      rPosition.y -= rWH.y / 2;\r\n\r\n      this.textEditor.style.top = `${rPosition.y}px`;\r\n      this.textEditor.style.left = `${rPosition.x}px`;\r\n      this.textEditor.style.maxWidth = `${this.overlayContainer.offsetWidth - rPosition.x}px`;\r\n      this.textEditor.style.fontSize = `${Math.max(16 * textScale, 12)}px`;\r\n      this.textElement.style.display = 'none';\r\n    }\r\n  }\r\n\r\n  private textEditDivClicked(text: string) {\r\n    this.text = text;\r\n    this.overlayContainer.innerHTML = '';\r\n    this.renderText();\r\n    this.showVisual();\r\n  }\r\n\r\n  /**\r\n   * Deselects this marker, renders text (if necessary), and hides selected marker UI.\r\n   */\r\n  public deselect(): void {\r\n    if (this.state === 'edit') {\r\n      this.textEditDivClicked(this.textEditor.innerText);\r\n    }\r\n    super.deselect();\r\n  }\r\n  \r\n  /**\r\n   * Opens text editor on double-click.\r\n   * @param point \r\n   * @param target \r\n   */\r\n  public dblClick(point: IPoint, target?: EventTarget):void {\r\n    super.dblClick(point, target);\r\n\r\n    this.showTextEditor();\r\n  }\r\n\r\n  /**\r\n   * Sets text color.\r\n   * @param color - new text color.\r\n   */\r\n  protected setColor(color: string): void {\r\n    SvgHelper.setAttributes(this.textElement, [['fill', color]]);\r\n    this.color = color;\r\n    if (this.textEditor) {\r\n      this.textEditor.style.color = this.color;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sets font family.\r\n   * @param font - new font family.\r\n   */\r\n  protected setFont(font: string): void {\r\n    SvgHelper.setAttributes(this.textElement, [['font-family', font]]);\r\n    this.fontFamily = font;\r\n    if (this.textEditor) {\r\n      this.textEditor.style.fontFamily = this.fontFamily;\r\n    }\r\n    this.renderText();\r\n  }\r\n\r\n  /**\r\n   * Hides marker visual.\r\n   */\r\n  protected hideVisual(): void {\r\n    this.textElement.style.display = 'none';\r\n    this.hideControlBox();\r\n  }\r\n  /**\r\n   * Shows marker visual.\r\n   */\r\n  protected showVisual(): void {\r\n    if (this.state === 'edit') {\r\n      this._state = 'select';\r\n    }\r\n    this.textElement.style.display = '';\r\n    this.showControlBox();\r\n  }\r\n\r\n  /**\r\n   * Returns the list of toolbox panels for this marker type.\r\n   */\r\n  public get toolboxPanels(): ToolboxPanel[] {\r\n    return [this.colorPanel, this.fontFamilyPanel];\r\n  }\r\n\r\n  /**\r\n   * Returns current marker state that can be restored in the future.\r\n   */\r\n  public getState(): TextMarkerState {\r\n    const result: TextMarkerState = Object.assign({\r\n      color: this.color,\r\n      fontFamily: this.fontFamily,\r\n      padding: this.padding,\r\n      text: this.text\r\n    }, super.getState());\r\n    result.typeName = TextMarker.typeName;\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Restores previously saved marker state.\r\n   * \r\n   * @param state - previously saved state.\r\n   */\r\n  public restoreState(state: MarkerBaseState): void {\r\n    const textState = state as TextMarkerState;\r\n    this.color = textState.color;\r\n    this.fontFamily = textState.fontFamily;\r\n    this.padding = textState.padding;\r\n    this.text = textState.text;\r\n\r\n    this.createVisual();\r\n    super.restoreState(state);\r\n    this.setSize();\r\n  }\r\n\r\n  /**\r\n   * Scales marker. Used after the image resize.\r\n   * \r\n   * @param scaleX - horizontal scale\r\n   * @param scaleY - vertical scale\r\n   */\r\n  public scale(scaleX: number, scaleY: number): void {\r\n    super.scale(scaleX, scaleY);\r\n\r\n    this.setSize();\r\n    this.sizeText();\r\n    this.positionTextEditor();\r\n  }\r\n}\r\n","import { IPoint } from '../../core/IPoint';\r\nimport { SvgHelper } from '../../core/SvgHelper';\r\nimport { RectangularBoxMarkerBase } from '../RectangularBoxMarkerBase';\r\nimport { Settings } from '../../core/Settings';\r\nimport Icon from './freehand-marker-icon.svg';\r\nimport { ColorPickerPanel } from '../../ui/toolbox-panels/ColorPickerPanel';\r\nimport { ToolboxPanel } from '../../ui/ToolboxPanel';\r\nimport { FreehandMarkerState } from './FreehandMarkerState';\r\nimport { MarkerBaseState } from '../../core/MarkerBaseState';\r\n\r\n\r\nexport class FreehandMarker extends RectangularBoxMarkerBase {\r\n  /**\r\n   * String type name of the marker type. \r\n   * \r\n   * Used when adding {@link MarkerArea.availableMarkerTypes} via a string and to save and restore state.\r\n   */\r\n  public static typeName = 'FreehandMarker';\r\n\r\n  /**\r\n   * Marker type title (display name) used for accessibility and other attributes.\r\n   */\r\n  public static title = 'Freehand marker';\r\n  /**\r\n   * SVG icon markup displayed on toolbar buttons.\r\n   */\r\n  public static icon = Icon;\r\n\r\n  /**\r\n   * Marker color.\r\n   */\r\n  protected color = 'transparent';\r\n  /**\r\n   * Marker's stroke width.\r\n   */\r\n  protected lineWidth = 3;\r\n\r\n  private colorPanel: ColorPickerPanel;\r\n\r\n  private canvasElement: HTMLCanvasElement;\r\n  private canvasContext: CanvasRenderingContext2D;\r\n\r\n  private drawingImage: SVGImageElement;\r\n  private drawingImgUrl: string;\r\n\r\n  private drawing = false;\r\n\r\n  /**\r\n   * Creates a new marker.\r\n   *\r\n   * @param container - SVG container to hold marker's visual.\r\n   * @param overlayContainer - overlay HTML container to hold additional overlay elements while editing.\r\n   * @param settings - settings object containing default markers settings.\r\n   */\r\n  constructor(\r\n    container: SVGGElement,\r\n    overlayContainer: HTMLDivElement,\r\n    settings: Settings\r\n  ) {\r\n    super(container, overlayContainer, settings);\r\n\r\n    this.color = settings.defaultColor;\r\n\r\n    this.setColor = this.setColor.bind(this);\r\n    this.addCanvas = this.addCanvas.bind(this);\r\n    this.finishCreation = this.finishCreation.bind(this);\r\n\r\n    this.colorPanel = new ColorPickerPanel(\r\n      'Color',\r\n      settings.defaultColorSet,\r\n      settings.defaultColor\r\n    );\r\n    this.colorPanel.onColorChanged = this.setColor;\r\n  }\r\n\r\n  /**\r\n   * Returns true if passed SVG element belongs to the marker. False otherwise.\r\n   * \r\n   * @param el - target element.\r\n   */\r\n  public ownsTarget(el: EventTarget): boolean {\r\n    if (\r\n      super.ownsTarget(el) ||\r\n      el === this.visual ||\r\n      el === this.drawingImage\r\n    ) {\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  private createVisual() {\r\n    this.visual = SvgHelper.createGroup();\r\n    this.drawingImage = SvgHelper.createImage();\r\n    this.visual.appendChild(this.drawingImage);\r\n\r\n    const translate = SvgHelper.createTransform();\r\n    this.visual.transform.baseVal.appendItem(translate);\r\n    this.addMarkerVisualToContainer(this.visual);\r\n  }\r\n\r\n  /**\r\n   * Handles pointer (mouse, touch, stylus, etc.) down event.\r\n   * \r\n   * @param point - event coordinates.\r\n   * @param target - direct event target element.\r\n   */\r\n  public pointerDown(point: IPoint, target?: EventTarget): void {\r\n    if (this.state === 'new') {\r\n      this.addCanvas();\r\n\r\n      this.createVisual();\r\n\r\n      this._state = 'creating';\r\n    }\r\n\r\n    if (this.state === 'creating') {\r\n      this.canvasContext.strokeStyle = this.color;\r\n      this.canvasContext.lineWidth = this.lineWidth;\r\n      this.canvasContext.beginPath();\r\n      this.canvasContext.moveTo(point.x, point.y);\r\n      this.drawing = true;\r\n    } else {\r\n      super.pointerDown(point, target);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles marker manipulation (move, resize, rotate, etc.).\r\n   * \r\n   * @param point - event coordinates.\r\n   */\r\n  public manipulate(point: IPoint): void {\r\n    if (this.state === 'creating') {\r\n      if (this.drawing) {\r\n        this.canvasContext.lineTo(point.x, point.y);\r\n        this.canvasContext.stroke();\r\n      }\r\n    } else {\r\n      super.manipulate(point);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Resize marker based on current pointer coordinates and context.\r\n   * @param point \r\n   */\r\n  protected resize(point: IPoint): void {\r\n    super.resize(point);\r\n    SvgHelper.setAttributes(this.visual, [\r\n      ['width', this.width.toString()],\r\n      ['height', this.height.toString()],\r\n    ]);\r\n    SvgHelper.setAttributes(this.drawingImage, [\r\n      ['width', this.width.toString()],\r\n      ['height', this.height.toString()],\r\n    ]);\r\n  }\r\n\r\n  /**\r\n   * Handles pointer (mouse, touch, stylus, etc.) up event.\r\n   * \r\n   * @param point - event coordinates.\r\n   */\r\n  public pointerUp(point: IPoint): void {\r\n    if (this._state === 'creating') {\r\n      if (this.drawing) {\r\n        this.canvasContext.closePath();\r\n        this.drawing = false;\r\n        if (this.globalSettings.newFreehandMarkerOnPointerUp) {\r\n          this.finishCreation();\r\n        }\r\n      }\r\n    } else {\r\n      super.pointerUp(point);\r\n    }\r\n  }\r\n\r\n  private addCanvas() {\r\n    this.overlayContainer.innerHTML = '';\r\n\r\n    this.canvasElement = document.createElement('canvas');\r\n    this.canvasElement.width = this.overlayContainer.clientWidth;\r\n    this.canvasElement.height = this.overlayContainer.clientHeight;\r\n    this.canvasContext = this.canvasElement.getContext('2d');\r\n    this.overlayContainer.appendChild(this.canvasElement);\r\n  }\r\n\r\n  /**\r\n   * Selects this marker and displays appropriate selected marker UI.\r\n   */\r\n  public select(): void {\r\n    if (this.state === 'creating') {\r\n      this.finishCreation();\r\n    }\r\n    super.select();\r\n  }\r\n\r\n  /**\r\n   * Deselects this marker and hides selected marker UI.\r\n   */\r\n  public deselect(): void {\r\n    if (this.state === 'creating') {\r\n      this.finishCreation();\r\n    }\r\n    super.deselect();\r\n  }\r\n\r\n  private finishCreation() {\r\n    const imgData = this.canvasContext.getImageData(\r\n      0,\r\n      0,\r\n      this.canvasElement.width,\r\n      this.canvasElement.height\r\n    );\r\n\r\n    let [startX, startY, endX, endY] = [\r\n      this.canvasElement.width + 1,\r\n      this.canvasElement.height + 1,\r\n      -1,\r\n      -1,\r\n    ];\r\n    let containsData = false;\r\n    for (let row = 0; row < this.canvasElement.height; row++) {\r\n      for (let col = 0; col < this.canvasElement.width; col++) {\r\n        const pixAlpha =\r\n          imgData.data[row * this.canvasElement.width * 4 + col * 4 + 3];\r\n        if (pixAlpha > 0) {\r\n          containsData = true;\r\n          if (row < startY) {\r\n            startY = row;\r\n          }\r\n          if (col < startX) {\r\n            startX = col;\r\n          }\r\n          if (row > endY) {\r\n            endY = row;\r\n          }\r\n          if (col > endX) {\r\n            endX = col;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    if (containsData) {\r\n      this.left = startX;\r\n      this.top = startY;\r\n      this.width = endX - startX;\r\n      this.height = endY - startY;\r\n\r\n      const tmpCanvas = document.createElement('canvas');\r\n      tmpCanvas.width = this.width;\r\n      tmpCanvas.height = this.height;\r\n      const tmpCtx = tmpCanvas.getContext('2d');\r\n      tmpCtx.putImageData(\r\n        this.canvasContext.getImageData(\r\n          startX,\r\n          startY,\r\n          endX - startX,\r\n          endY - startY\r\n        ),\r\n        0,\r\n        0\r\n      );\r\n\r\n      this.drawingImgUrl = tmpCanvas.toDataURL('image/png');\r\n      this.setDrawingImage();\r\n\r\n      this._state = 'select';\r\n      if (this.onMarkerCreated) {\r\n        this.onMarkerCreated(this);\r\n      }\r\n    }\r\n    this.overlayContainer.innerHTML = '';\r\n  }\r\n\r\n  private setDrawingImage() {\r\n    SvgHelper.setAttributes(this.drawingImage, [\r\n      ['width', this.width.toString()],\r\n      ['height', this.height.toString()],\r\n    ]);\r\n    SvgHelper.setAttributes(this.drawingImage, [['href', this.drawingImgUrl]]);\r\n    this.moveVisual({ x: this.left, y: this.top });\r\n  }\r\n\r\n  /**\r\n   * Sets marker drawing color.\r\n   * @param color - new color.\r\n   */\r\n  protected setColor(color: string): void {\r\n    this.color = color;\r\n  }\r\n\r\n  /**\r\n   * Returns the list of toolbox panels for this marker type.\r\n   */\r\n  public get toolboxPanels(): ToolboxPanel[] {\r\n    if (this.state === 'new' || this.state === 'creating') {\r\n      return [this.colorPanel];\r\n    } else {\r\n      return [];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns current marker state that can be restored in the future.\r\n   */\r\n  public getState(): FreehandMarkerState {\r\n    const result: FreehandMarkerState = Object.assign({\r\n      drawingImgUrl: this.drawingImgUrl\r\n    }, super.getState());\r\n    result.typeName = FreehandMarker.typeName;\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Restores previously saved marker state.\r\n   * \r\n   * @param state - previously saved state.\r\n   */\r\n  public restoreState(state: MarkerBaseState): void {\r\n    this.createVisual();\r\n    super.restoreState(state);\r\n    this.drawingImgUrl = (state as FreehandMarkerState).drawingImgUrl;\r\n    this.setDrawingImage();\r\n  }\r\n\r\n  /**\r\n   * Scales marker. Used after the image resize.\r\n   * \r\n   * @param scaleX - horizontal scale\r\n   * @param scaleY - vertical scale\r\n   */\r\n  public scale(scaleX: number, scaleY: number): void {\r\n    super.scale(scaleX, scaleY);\r\n\r\n    this.setDrawingImage();\r\n  }\r\n\r\n}\r\n","import { Style } from '../../core/Style';\r\nimport { ToolboxPanel } from '../ToolboxPanel';\r\nimport Icon from './arrow-type-panel-icon.svg';\r\n\r\n/**\r\n * Represents available arrow types.\r\n * \r\n * - `both` - arrow tips on both sides.\r\n * - `start` - arrow tip on the starting point of line.\r\n * - `end` - arrow tip on the ending point of line.\r\n * - `none` - no arrow tips.\r\n */\r\nexport type ArrowType = 'both' | 'start' | 'end' | 'none';\r\n/**\r\n * Handler for arrow type change event.\r\n */\r\nexport type ArrowTypeChangeHandler = (newType: ArrowType) => void;\r\n\r\n/**\r\n * Arrow type selection panel.\r\n */\r\nexport class ArrowTypePanel extends ToolboxPanel {\r\n  private currentType?: ArrowType;\r\n\r\n  private typeBoxes: HTMLDivElement[] = [];\r\n\r\n  /**\r\n   * Event handler for the arrow type change event.\r\n   */\r\n  public onArrowTypeChanged?: ArrowTypeChangeHandler;\r\n\r\n  /**\r\n   * Creates an ArrowTypePanel.\r\n   * @param title - panel title.\r\n   * @param currentType - currently set arrow type.\r\n   * @param icon - panel button icon (SVG image markup).\r\n   */\r\n  constructor(title: string, currentType?: ArrowType, icon?: string) {\r\n    super(title, icon ? icon : Icon);\r\n    this.currentType = currentType;\r\n\r\n    this.setCurrentType = this.setCurrentType.bind(this);\r\n  }\r\n\r\n  /**\r\n   * Returns panel UI.\r\n   */\r\n  public getUi(): HTMLDivElement {\r\n    const panelDiv = document.createElement('div');\r\n    panelDiv.style.display = 'flex';\r\n    panelDiv.style.overflow = 'hidden';\r\n    panelDiv.style.flexGrow = '2';\r\n    for (let ti = 0; ti < 4; ti++) {\r\n      let arrowType: ArrowType = 'both';\r\n      switch(ti) {\r\n        case 0:\r\n          arrowType = 'both';\r\n          break;\r\n        case 1:\r\n          arrowType = 'start';\r\n          break;\r\n        case 2:\r\n          arrowType = 'end';\r\n          break;\r\n        case 3:\r\n          arrowType = 'none';\r\n          break;\r\n      }\r\n      const typeBoxContainer = document.createElement('div');\r\n      typeBoxContainer.style.display = 'flex';\r\n      typeBoxContainer.style.flexGrow = '2';\r\n      typeBoxContainer.style.alignItems = 'center';\r\n      typeBoxContainer.style.justifyContent = 'space-between';\r\n      typeBoxContainer.style.padding = '5px';\r\n      typeBoxContainer.style.borderWidth = '2px';\r\n      typeBoxContainer.style.borderStyle = 'solid';\r\n      typeBoxContainer.style.borderColor =\r\n        arrowType === this.currentType ? Style.settings.toolboxAccentColor : 'transparent';\r\n\r\n      typeBoxContainer.addEventListener('click', () => {\r\n        this.setCurrentType(arrowType, typeBoxContainer);\r\n      })\r\n      panelDiv.appendChild(typeBoxContainer);\r\n\r\n      if (arrowType === 'both' || arrowType === 'start') {\r\n        const leftTip = document.createElement('div');\r\n        leftTip.style.display = 'flex';\r\n        leftTip.style.alignItems = 'center';\r\n        leftTip.style.minHeight = '20px';\r\n        leftTip.innerHTML = `<svg viewBox=\"0 0 10 10\" width=\"10\" height=\"10\" xmlns=\"http://www.w3.org/2000/svg\">\r\n          <polygon points=\"0,5 10,0 10,10\" fill=\"${Style.settings.toolboxColor}\" />\r\n        </svg>`;\r\n        leftTip.style.marginLeft = '5px';\r\n        typeBoxContainer.appendChild(leftTip);\r\n      }\r\n\r\n      const lineBox = document.createElement('div');\r\n      lineBox.style.display = 'flex';\r\n      lineBox.style.alignItems = 'center';\r\n      lineBox.style.minHeight = '20px';\r\n      lineBox.style.flexGrow = '2';\r\n\r\n      const hr = document.createElement('hr');\r\n      hr.style.minWidth = '20px';\r\n      hr.style.border = '0px';\r\n      hr.style.borderTop = `3px solid ${Style.settings.toolboxColor}`;\r\n      hr.style.flexGrow = '2';\r\n      lineBox.appendChild(hr);\r\n\r\n      typeBoxContainer.appendChild(lineBox);\r\n\r\n      if (arrowType === 'both' || arrowType === 'end') {\r\n        const rightTip = document.createElement('div');\r\n        rightTip.style.display = 'flex';\r\n        rightTip.style.alignItems = 'center';\r\n        rightTip.style.minHeight = '20px';\r\n        rightTip.innerHTML = `<svg viewBox=\"0 0 10 10\" width=\"10\" height=\"10\" xmlns=\"http://www.w3.org/2000/svg\">\r\n          <polygon points=\"0,0 10,5 0,10\" fill=\"${Style.settings.toolboxColor}\" />\r\n        </svg>`;\r\n        rightTip.style.marginRight = '5px';\r\n        typeBoxContainer.appendChild(rightTip);\r\n      }\r\n\r\n      this.typeBoxes.push(typeBoxContainer);\r\n    }\r\n    return panelDiv;\r\n  }\r\n\r\n  private setCurrentType(newType: ArrowType, target: HTMLDivElement) {\r\n    this.currentType = newType;\r\n\r\n    this.typeBoxes.forEach(box => {\r\n      box.style.borderColor = box === target ? Style.settings.toolboxAccentColor : 'transparent';\r\n    });\r\n\r\n    if (this.onArrowTypeChanged) {\r\n      this.onArrowTypeChanged(this.currentType);\r\n    }\r\n  }\r\n}\r\n","import { IPoint } from '../../core/IPoint';\r\nimport { SvgHelper } from '../../core/SvgHelper';\r\nimport { Settings } from '../../core/Settings';\r\nimport Icon from './arrow-marker-icon.svg';\r\nimport { ToolboxPanel } from '../../ui/ToolboxPanel';\r\nimport { LineMarker } from '../line-marker/LineMarker';\r\nimport { ArrowType, ArrowTypePanel } from '../../ui/toolbox-panels/ArrowTypePanel';\r\nimport { ArrowMarkerState } from './ArrowMarkerState';\r\nimport { MarkerBaseState } from '../../core/MarkerBaseState';\r\n\r\n/**\r\n * Represents an arrow marker.\r\n */\r\nexport class ArrowMarker extends LineMarker {\r\n  /**\r\n   * String type name of the marker type. \r\n   * \r\n   * Used when adding {@link MarkerArea.availableMarkerTypes} via a string and to save and restore state.\r\n   */\r\n  public static typeName = 'ArrowMarker';\r\n\r\n  /**\r\n   * Marker type title (display name) used for accessibility and other attributes.\r\n   */\r\n  public static title = 'Arrow marker';\r\n  /**\r\n   * SVG icon markup displayed on toolbar buttons.\r\n   */\r\n  public static icon = Icon;\r\n\r\n  private arrow1: SVGPolygonElement;\r\n  private arrow2: SVGPolygonElement;\r\n\r\n  private arrowType: ArrowType = 'end';\r\n\r\n  private arrowBaseHeight = 10;\r\n  private arrowBaseWidth = 10;\r\n\r\n  /**\r\n   * Toolbox panel for arrow type selection.\r\n   */\r\n  protected arrowTypePanel: ArrowTypePanel;\r\n\r\n  /**\r\n   * Creates a new marker.\r\n   *\r\n   * @param container - SVG container to hold marker's visual.\r\n   * @param overlayContainer - overlay HTML container to hold additional overlay elements while editing.\r\n   * @param settings - settings object containing default markers settings.\r\n   */\r\n  constructor(container: SVGGElement, overlayContainer: HTMLDivElement, settings: Settings) {\r\n    super(container, overlayContainer, settings);\r\n\r\n    this.getArrowPoints = this.getArrowPoints.bind(this);\r\n    this.setArrowType = this.setArrowType.bind(this);\r\n\r\n    this.arrowTypePanel = new ArrowTypePanel('Arrow type', 'end');\r\n    this.arrowTypePanel.onArrowTypeChanged = this.setArrowType;\r\n  }\r\n\r\n  /**\r\n   * Returns true if passed SVG element belongs to the marker. False otherwise.\r\n   * \r\n   * @param el - target element.\r\n   */\r\n  public ownsTarget(el: EventTarget): boolean {\r\n    if (\r\n      super.ownsTarget(el) ||\r\n      el === this.arrow1 || el === this.arrow2\r\n    ) {\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  private getArrowPoints(offsetX: number, offsetY: number): string {\r\n    const width = this.arrowBaseWidth + this.strokeWidth * 2;\r\n    const height = this.arrowBaseHeight + this.strokeWidth * 2;\r\n    return `${offsetX - width / 2},${\r\n      offsetY + height / 2\r\n    } ${offsetX},${offsetY - height / 2} ${\r\n      offsetX + width / 2},${offsetY + height / 2}`;\r\n  }\r\n\r\n  private createTips() {\r\n    this.arrow1 = SvgHelper.createPolygon(this.getArrowPoints(this.x1, this.y1), [['fill', this.strokeColor]]);\r\n    this.arrow1.transform.baseVal.appendItem(SvgHelper.createTransform());\r\n    this.visual.appendChild(this.arrow1);\r\n\r\n    this.arrow2 = SvgHelper.createPolygon(this.getArrowPoints(this.x2, this.y2), [['fill', this.strokeColor]]);\r\n    this.arrow2.transform.baseVal.appendItem(SvgHelper.createTransform());\r\n    this.visual.appendChild(this.arrow2);\r\n  }\r\n\r\n  /**\r\n   * Handles pointer (mouse, touch, stylus, etc.) down event.\r\n   * \r\n   * @param point - event coordinates.\r\n   * @param target - direct event target element.\r\n   */\r\n  public pointerDown(point: IPoint, target?: EventTarget): void {\r\n    super.pointerDown(point, target);\r\n    if (this.state === 'creating') {\r\n      this.createTips();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adjusts marker visual after manipulation.\r\n   */\r\n  protected adjustVisual(): void {\r\n    super.adjustVisual();\r\n\r\n    if (this.arrow1 && this.arrow2) {\r\n      this.arrow1.style.display = (this.arrowType === 'both' || this.arrowType === 'start') ? '' : 'none';\r\n      this.arrow2.style.display = (this.arrowType === 'both' || this.arrowType === 'end') ? '' : 'none';\r\n\r\n      SvgHelper.setAttributes(this.arrow1, [\r\n        ['points', this.getArrowPoints(this.x1, this.y1)],\r\n        ['fill', this.strokeColor]\r\n      ]);\r\n      SvgHelper.setAttributes(this.arrow2, [\r\n        ['points', this.getArrowPoints(this.x2, this.y2)],\r\n        ['fill', this.strokeColor]\r\n      ]);\r\n\r\n      if (Math.abs(this.x1 - this.x2) > 0.1) {\r\n        const lineAngle1 =\r\n          (Math.atan((this.y2 - this.y1) / (this.x2 - this.x1)) * 180) / Math.PI + 90 * Math.sign(this.x1 - this.x2);\r\n\r\n        const a1transform = this.arrow1.transform.baseVal.getItem(0);\r\n        a1transform.setRotate(lineAngle1, this.x1, this.y1);\r\n        this.arrow1.transform.baseVal.replaceItem(a1transform, 0);\r\n\r\n        const a2transform = this.arrow2.transform.baseVal.getItem(0);\r\n        a2transform.setRotate(lineAngle1 + 180, this.x2, this.y2);\r\n        this.arrow2.transform.baseVal.replaceItem(a2transform, 0);\r\n      }\r\n    }\r\n  }\r\n\r\n  private setArrowType(arrowType: ArrowType) {\r\n    this.arrowType = arrowType;\r\n    this.adjustVisual();\r\n  }\r\n\r\n  /**\r\n   * Returns the list of toolbox panels for this marker type.\r\n   */\r\n  public get toolboxPanels(): ToolboxPanel[] {\r\n    return [this.strokePanel, this.strokeWidthPanel, this.strokeStylePanel, this.arrowTypePanel];\r\n  }\r\n\r\n  /**\r\n   * Returns current marker state that can be restored in the future.\r\n   */\r\n  public getState(): ArrowMarkerState {\r\n    const result: ArrowMarkerState = Object.assign({\r\n      arrowType: this.arrowType\r\n    }, super.getState());\r\n    result.typeName = ArrowMarker.typeName;\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Restores previously saved marker state.\r\n   * \r\n   * @param state - previously saved state.\r\n   */\r\n  public restoreState(state: MarkerBaseState): void {\r\n    super.restoreState(state);\r\n\r\n    const amState = state as ArrowMarkerState;\r\n    this.arrowType = amState.arrowType;\r\n\r\n    this.createTips();\r\n    this.adjustVisual();\r\n  }\r\n\r\n}\r\n","import Icon from './cover-marker-icon.svg';\r\nimport { ToolboxPanel } from '../../ui/ToolboxPanel';\r\nimport { ColorPickerPanel } from '../../ui/toolbox-panels/ColorPickerPanel';\r\nimport { Settings } from '../../core/Settings';\r\nimport { RectangleMarker } from '../RectangleMarker';\r\nimport { RectangleMarkerState } from '../RectangleMarkerState';\r\n\r\nexport class CoverMarker extends RectangleMarker {\r\n  /**\r\n   * String type name of the marker type. \r\n   * \r\n   * Used when adding {@link MarkerArea.availableMarkerTypes} via a string and to save and restore state.\r\n   */\r\n  public static typeName = 'CoverMarker';\r\n\r\n  /**\r\n   * Marker type title (display name) used for accessibility and other attributes.\r\n   */\r\n  public static title = 'Cover marker';\r\n  /**\r\n   * SVG icon markup displayed on toolbar buttons.\r\n   */\r\n  public static icon = Icon;\r\n\r\n  /**\r\n   * Color picker panel for the background color.\r\n   */\r\n  protected fillPanel: ColorPickerPanel;\r\n\r\n  /**\r\n   * Creates a new marker.\r\n   *\r\n   * @param container - SVG container to hold marker's visual.\r\n   * @param overlayContainer - overlay HTML container to hold additional overlay elements while editing.\r\n   * @param settings - settings object containing default markers settings.\r\n   */\r\n  constructor(container: SVGGElement, overlayContainer: HTMLDivElement, settings: Settings) {\r\n    super(container, overlayContainer, settings);\r\n\r\n    this.fillColor = settings.defaultFillColor;\r\n    this.strokeWidth = 0;\r\n\r\n    this.fillPanel = new ColorPickerPanel(\r\n      'Color',\r\n      settings.defaultColorSet,\r\n      settings.defaultFillColor\r\n    );\r\n    this.fillPanel.onColorChanged = this.setFillColor;\r\n  }\r\n\r\n  /**\r\n   * Returns the list of toolbox panels for this marker type.\r\n   */\r\n  public get toolboxPanels(): ToolboxPanel[] {\r\n    return [this.fillPanel];\r\n  }\r\n\r\n  /**\r\n   * Returns current marker state that can be restored in the future.\r\n   */\r\n  public getState(): RectangleMarkerState {\r\n    const result = super.getState();\r\n    result.typeName = CoverMarker.typeName;\r\n    return result;\r\n  }\r\n}\r\n","import { Style } from '../../core/Style';\r\nimport { ToolboxPanel } from '../ToolboxPanel';\r\nimport Icon from './opacity-panel-icon.svg';\r\n\r\n/**\r\n * Opacity chage event handler type.\r\n */\r\nexport type OpacityChangeHandler = (newOpacity: number) => void;\r\n\r\n/**\r\n * Opacity panel.\r\n */\r\nexport class OpacityPanel extends ToolboxPanel {\r\n  private opacities: number[] = [];\r\n  private currentOpacity?: number;\r\n\r\n  private opacityBoxes: HTMLDivElement[] = [];\r\n\r\n  /**\r\n   * Opacity change event handler.\r\n   */\r\n  public onOpacityChanged?: OpacityChangeHandler;\r\n\r\n  /**\r\n   * Creates an opacity panel.\r\n   * @param title - panel title.\r\n   * @param opacities - available opacities.\r\n   * @param currentOpacity - current opacity.\r\n   * @param icon - toolbox panel button (SVG image markup).\r\n   */\r\n  constructor(title: string, opacities: number[], currentOpacity?: number, icon?: string) {\r\n    super(title, icon ? icon : Icon);\r\n    this.opacities = opacities;\r\n    this.currentOpacity = currentOpacity;\r\n\r\n    this.setCurrentOpacity = this.setCurrentOpacity.bind(this);\r\n  }\r\n\r\n  /**\r\n   * Returns panel UI.\r\n   */\r\n  public getUi(): HTMLDivElement {\r\n    const panelDiv = document.createElement('div');\r\n    panelDiv.style.display = 'flex';\r\n    panelDiv.style.overflow = 'hidden';\r\n    panelDiv.style.flexGrow = '2';\r\n    panelDiv.style.justifyContent = 'space-between';\r\n    this.opacities.forEach((opacity) => {\r\n      const opacityBoxContainer = document.createElement('div');\r\n      opacityBoxContainer.style.display = 'flex';\r\n      //opacityBoxContainer.style.flexGrow = '2';\r\n      opacityBoxContainer.style.alignItems = 'center';\r\n      opacityBoxContainer.style.justifyContent = 'center';\r\n      opacityBoxContainer.style.padding = '5px';\r\n      opacityBoxContainer.style.borderWidth = '2px';\r\n      opacityBoxContainer.style.borderStyle = 'solid';\r\n      opacityBoxContainer.style.borderColor =\r\n        opacity === this.currentOpacity ? Style.settings.toolboxAccentColor : 'transparent';\r\n\r\n      opacityBoxContainer.addEventListener('click', () => {\r\n        this.setCurrentOpacity(opacity, opacityBoxContainer);\r\n      })\r\n      panelDiv.appendChild(opacityBoxContainer);\r\n\r\n      const label = document.createElement('div');\r\n      label.innerText = `${(opacity * 100)}%`;\r\n      opacityBoxContainer.appendChild(label);\r\n\r\n      this.opacityBoxes.push(opacityBoxContainer);\r\n    });\r\n    return panelDiv;\r\n  }\r\n\r\n  private setCurrentOpacity(newWidth: number, target: HTMLDivElement) {\r\n    this.currentOpacity = newWidth;\r\n\r\n    this.opacityBoxes.forEach(box => {\r\n      box.style.borderColor = box === target ? Style.settings.toolboxAccentColor : 'transparent';\r\n    });\r\n\r\n    if (this.onOpacityChanged) {\r\n      this.onOpacityChanged(this.currentOpacity);\r\n    }\r\n  }\r\n}\r\n","import Icon from './highlight-marker-icon.svg';\r\nimport { ToolboxPanel } from '../../ui/ToolboxPanel';\r\nimport { ColorPickerPanel } from '../../ui/toolbox-panels/ColorPickerPanel';\r\nimport { Settings } from '../../core/Settings';\r\nimport { CoverMarker } from '../cover-marker/CoverMarker';\r\nimport { OpacityPanel } from '../../ui/toolbox-panels/OpacityPanel';\r\nimport { SvgHelper } from '../../core/SvgHelper';\r\nimport { RectangleMarkerState } from '../RectangleMarkerState';\r\n\r\nexport class HighlightMarker extends CoverMarker {\r\n  /**\r\n   * String type name of the marker type. \r\n   * \r\n   * Used when adding {@link MarkerArea.availableMarkerTypes} via a string and to save and restore state.\r\n   */\r\n  public static typeName = 'HighlightMarker';\r\n  /**\r\n   * Marker type title (display name) used for accessibility and other attributes.\r\n   */\r\n  public static title = 'Highlight marker';\r\n  /**\r\n   * SVG icon markup displayed on toolbar buttons.\r\n   */\r\n  public static icon = Icon;\r\n\r\n  protected opacityPanel: OpacityPanel;\r\n\r\n  /**\r\n   * Creates a new marker.\r\n   *\r\n   * @param container - SVG container to hold marker's visual.\r\n   * @param overlayContainer - overlay HTML container to hold additional overlay elements while editing.\r\n   * @param settings - settings object containing default markers settings.\r\n   */\r\n  constructor(container: SVGGElement, overlayContainer: HTMLDivElement, settings: Settings) {\r\n    super(container, overlayContainer, settings);\r\n\r\n    this.setOpacity = this.setOpacity.bind(this);\r\n\r\n    this.fillColor = settings.defaultHighlightColor;\r\n    this.strokeWidth = 0;\r\n    this.opacity = settings.defaultHighlightOpacity;\r\n\r\n    this.fillPanel = new ColorPickerPanel(\r\n      'Color',\r\n      settings.defaultColorSet,\r\n      this.fillColor\r\n    );\r\n    this.fillPanel.onColorChanged = this.setFillColor;\r\n\r\n    this.opacityPanel = new OpacityPanel(\r\n      'Opacity',\r\n      settings.defaultOpacitySteps,\r\n      this.opacity\r\n    );\r\n    this.opacityPanel.onOpacityChanged = this.setOpacity;\r\n  }\r\n\r\n  /**\r\n   * Sets marker's opacity (0..1).\r\n   * @param opacity - new opacity value.\r\n   */\r\n  protected setOpacity(opacity: number): void {\r\n    this.opacity = opacity;\r\n    if (this.visual) {\r\n      SvgHelper.setAttributes(this.visual, [['opacity', this.opacity.toString()]]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the list of toolbox panels for this marker type.\r\n   */\r\n  public get toolboxPanels(): ToolboxPanel[] {\r\n    return [this.fillPanel, this.opacityPanel];\r\n  }\r\n\r\n  /**\r\n   * Returns current marker state that can be restored in the future.\r\n   */\r\n  public getState(): RectangleMarkerState {\r\n    const result = super.getState();\r\n    result.typeName = HighlightMarker.typeName;\r\n    return result;\r\n  }\r\n}\r\n","import { IPoint } from '../../core/IPoint';\r\nimport { SvgHelper } from '../../core/SvgHelper';\r\nimport { Settings } from '../../core/Settings';\r\nimport Icon from './callout-marker-icon.svg';\r\nimport TextColorIcon from '../../ui/toolbox-panels/text-color-icon.svg';\r\nimport FillColorIcon from '../../ui/toolbox-panels/fill-color-icon.svg';\r\nimport { ColorPickerPanel } from '../../ui/toolbox-panels/ColorPickerPanel';\r\nimport { ToolboxPanel } from '../../ui/ToolboxPanel';\r\nimport { FontFamilyPanel } from '../../ui/toolbox-panels/FontFamilyPanel';\r\nimport { TextMarker } from '../text-marker/TextMarker';\r\nimport { ResizeGrip } from '../ResizeGrip';\r\nimport { CalloutMarkerState } from './CalloutMarkerState';\r\nimport { MarkerBaseState } from '../../core/MarkerBaseState';\r\n\r\nexport class CalloutMarker extends TextMarker {\r\n  /**\r\n   * String type name of the marker type. \r\n   * \r\n   * Used when adding {@link MarkerArea.availableMarkerTypes} via a string and to save and restore state.\r\n   */\r\n  public static typeName = 'CalloutMarker';\r\n\r\n  /**\r\n   * Marker type title (display name) used for accessibility and other attributes.\r\n   */\r\n  public static title = 'Callout marker';\r\n  /**\r\n   * SVG icon markup displayed on toolbar buttons.\r\n   */\r\n  public static icon = Icon;\r\n\r\n  private bgColor = 'transparent';\r\n  /**\r\n   * Color picker toolbox panel for the background (fill) color.\r\n   */\r\n  protected bgColorPanel: ColorPickerPanel;\r\n\r\n  private tipPosition: IPoint = { x: 0, y: 0 };\r\n  private tipBase1Position: IPoint = { x: 0, y: 0 };\r\n  private tipBase2Position: IPoint = { x: 0, y: 0 };\r\n  private tip: SVGPolygonElement;\r\n  private tipGrip: ResizeGrip;\r\n  private tipMoving = false;\r\n\r\n  /**\r\n   * Creates a new marker.\r\n   *\r\n   * @param container - SVG container to hold marker's visual.\r\n   * @param overlayContainer - overlay HTML container to hold additional overlay elements while editing.\r\n   * @param settings - settings object containing default markers settings.\r\n   */\r\n  constructor(\r\n    container: SVGGElement,\r\n    overlayContainer: HTMLDivElement,\r\n    settings: Settings\r\n  ) {\r\n    super(container, overlayContainer, settings);\r\n\r\n    this.color = settings.defaultStrokeColor;\r\n    this.bgColor = settings.defaultFillColor;\r\n    this.fontFamily = settings.defaultFontFamily;\r\n\r\n    this.defaultSize = { x: 100, y: 30 };\r\n\r\n    this.setBgColor = this.setBgColor.bind(this);\r\n    this.getTipPoints = this.getTipPoints.bind(this);\r\n    this.positionTip = this.positionTip.bind(this);\r\n    this.setTipPoints = this.setTipPoints.bind(this);\r\n\r\n    this.colorPanel = new ColorPickerPanel(\r\n      'Text color',\r\n      settings.defaultColorSet,\r\n      this.color,\r\n      TextColorIcon\r\n    );\r\n    this.colorPanel.onColorChanged = this.setColor;\r\n\r\n    this.bgColorPanel = new ColorPickerPanel(\r\n      'Fill color',\r\n      settings.defaultColorSet,\r\n      this.bgColor,\r\n      FillColorIcon\r\n    );\r\n    this.bgColorPanel.onColorChanged = this.setBgColor;\r\n\r\n    this.fontFamilyPanel = new FontFamilyPanel(\r\n      'Font',\r\n      settings.defaultFontFamilies,\r\n      settings.defaultFontFamily\r\n    );\r\n    this.fontFamilyPanel.onFontChanged = this.setFont;\r\n\r\n    this.tipGrip = new ResizeGrip();\r\n    this.tipGrip.visual.transform.baseVal.appendItem(\r\n      SvgHelper.createTransform()\r\n    );\r\n    this.controlBox.appendChild(this.tipGrip.visual);\r\n  }\r\n\r\n  /**\r\n   * Returns true if passed SVG element belongs to the marker. False otherwise.\r\n   * \r\n   * @param el - target element.\r\n   */\r\n  public ownsTarget(el: EventTarget): boolean {\r\n    return (\r\n      super.ownsTarget(el) || this.tipGrip.ownsTarget(el) || this.tip === el\r\n    );\r\n  }\r\n\r\n  private createTip() {\r\n    SvgHelper.setAttributes(this.bgRectangle, [\r\n      ['fill', this.bgColor],\r\n      ['rx', '10px'],\r\n    ]);\r\n\r\n    this.tip = SvgHelper.createPolygon(this.getTipPoints(), [\r\n      ['fill', this.bgColor],\r\n    ]);\r\n    this.visual.appendChild(this.tip);\r\n  }\r\n\r\n  /**\r\n   * Handles pointer (mouse, touch, stylus, etc.) down event.\r\n   * \r\n   * @param point - event coordinates.\r\n   * @param target - direct event target element.\r\n   */\r\n  public pointerDown(point: IPoint, target?: EventTarget): void {\r\n    if (this.state === 'new') {\r\n      super.pointerDown(point, target);\r\n    }\r\n\r\n    if (this.state === 'creating') {\r\n      this.createTip();\r\n    } else if (this.tipGrip.ownsTarget(target)) {\r\n      this.manipulationStartLeft = this.left;\r\n      this.manipulationStartTop = this.top;\r\n      this.tipMoving = true;\r\n    } else {\r\n      super.pointerDown(point, target);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles pointer (mouse, touch, stylus, etc.) up event.\r\n   * \r\n   * @param point - event coordinates.\r\n   */\r\n  public pointerUp(point: IPoint): void {\r\n    if (this.tipMoving) {\r\n      this.tipMoving = false;\r\n    } else {\r\n      const isCreating = this.state === 'creating';\r\n      super.pointerUp(point);\r\n      this.setTipPoints(isCreating);\r\n      this.positionTip();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles marker manipulation (move, resize, rotate, etc.).\r\n   * \r\n   * @param point - event coordinates.\r\n   */\r\n  public manipulate(point: IPoint): void {\r\n    if (this.tipMoving) {\r\n      const rotatedPoint = this.unrotatePoint(point);\r\n      this.tipPosition = {\r\n        x: rotatedPoint.x - this.manipulationStartLeft,\r\n        y: rotatedPoint.y - this.manipulationStartTop,\r\n      };\r\n      this.positionTip();\r\n    } else {\r\n      super.manipulate(point);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sets marker's background/fill color.\r\n   * @param color - new background color.\r\n   */\r\n  protected setBgColor(color: string): void {\r\n    SvgHelper.setAttributes(this.bgRectangle, [['fill', color]]);\r\n    SvgHelper.setAttributes(this.tip, [['fill', color]]);\r\n    this.bgColor = color;\r\n  }\r\n\r\n  private getTipPoints(): string {\r\n    this.setTipPoints(this.state === 'creating');\r\n    return `${this.tipBase1Position.x},${this.tipBase1Position.y\r\n      } ${this.tipBase2Position.x},${this.tipBase2Position.y\r\n      } ${this.tipPosition.x},${this.tipPosition.y}`;\r\n  }\r\n\r\n  private setTipPoints(isCreating = false) {\r\n    let offset = Math.min(this.height / 2, 15);\r\n    let baseWidth = this.height / 5;\r\n    if (isCreating) {\r\n      this.tipPosition = { x: offset + baseWidth / 2, y: this.height + 20 };\r\n    }\r\n\r\n    const cornerAngle = Math.atan((this.height / 2) / (this.width / 2));\r\n    if (this.tipPosition.x < this.width / 2 && this.tipPosition.y < this.height / 2) {\r\n      // top left\r\n      const tipAngle = Math.atan((this.height / 2 - this.tipPosition.y) / (this.width / 2 - this.tipPosition.x));\r\n      if (cornerAngle < tipAngle) {\r\n        baseWidth = this.width / 5;\r\n        offset = Math.min(this.width / 2, 15);\r\n        this.tipBase1Position = { x: offset, y: 0 };\r\n        this.tipBase2Position = { x: offset + baseWidth, y: 0 };\r\n      } else {\r\n        this.tipBase1Position = { x: 0, y: offset };\r\n        this.tipBase2Position = { x: 0, y: offset + baseWidth };\r\n      }\r\n    } else if (this.tipPosition.x >= this.width / 2 && this.tipPosition.y < this.height / 2) {\r\n      // top right\r\n      const tipAngle = Math.atan((this.height / 2 - this.tipPosition.y) / (this.tipPosition.x - this.width / 2));\r\n      if (cornerAngle < tipAngle) {\r\n        baseWidth = this.width / 5;\r\n        offset = Math.min(this.width / 2, 15);\r\n        this.tipBase1Position = { x: this.width - offset - baseWidth, y: 0 };\r\n        this.tipBase2Position = { x: this.width - offset, y: 0 };\r\n      } else {\r\n        this.tipBase1Position = { x: this.width, y: offset };\r\n        this.tipBase2Position = { x: this.width, y: offset + baseWidth };\r\n      }\r\n    } else if (this.tipPosition.x >= this.width / 2 && this.tipPosition.y >= this.height / 2) {\r\n      // bottom right\r\n      const tipAngle = Math.atan((this.tipPosition.y - this.height / 2) / (this.tipPosition.x - this.width / 2));\r\n      if (cornerAngle < tipAngle) {\r\n        baseWidth = this.width / 5;\r\n        offset = Math.min(this.width / 2, 15);\r\n        this.tipBase1Position = { x: this.width - offset - baseWidth, y: this.height };\r\n        this.tipBase2Position = { x: this.width - offset, y: this.height };\r\n      } else {\r\n        this.tipBase1Position = { x: this.width, y: this.height - offset - baseWidth };\r\n        this.tipBase2Position = { x: this.width, y: this.height - offset };\r\n      }\r\n    } else {\r\n      // bottom left\r\n      const tipAngle = Math.atan((this.tipPosition.y - this.height / 2) / (this.width / 2 - this.tipPosition.x));\r\n      if (cornerAngle < tipAngle) {\r\n        baseWidth = this.width / 5;\r\n        offset = Math.min(this.width / 2, 15);\r\n        this.tipBase1Position = { x: offset, y: this.height };\r\n        this.tipBase2Position = { x: offset + baseWidth, y: this.height };\r\n      } else {\r\n        this.tipBase1Position = { x: 0, y: this.height - offset };\r\n        this.tipBase2Position = { x: 0, y: this.height - offset - baseWidth };\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Resize marker based on current pointer coordinates and context.\r\n   * @param point \r\n   */\r\n  protected resize(point: IPoint): void {\r\n    super.resize(point);\r\n    this.positionTip();\r\n  }\r\n\r\n  private positionTip() {\r\n    SvgHelper.setAttributes(this.tip, [['points', this.getTipPoints()]]);\r\n    const translate = this.tipGrip.visual.transform.baseVal.getItem(0);\r\n    translate.setTranslate(this.tipPosition.x, this.tipPosition.y);\r\n    this.tipGrip.visual.transform.baseVal.replaceItem(translate, 0);\r\n  }\r\n\r\n  /**\r\n   * Returns the list of toolbox panels for this marker type.\r\n   */\r\n  public get toolboxPanels(): ToolboxPanel[] {\r\n    return [this.colorPanel, this.bgColorPanel, this.fontFamilyPanel];\r\n  }\r\n\r\n  /**\r\n   * Selects this marker and displays appropriate selected marker UI.\r\n   */\r\n  public select(): void {\r\n    this.positionTip();\r\n    super.select();\r\n  }\r\n\r\n  /**\r\n   * Returns current marker state that can be restored in the future.\r\n   */\r\n  public getState(): CalloutMarkerState {\r\n    const result: CalloutMarkerState = Object.assign({\r\n      bgColor: this.bgColor,\r\n      tipPosition: this.tipPosition\r\n    }, super.getState());\r\n    result.typeName = CalloutMarker.typeName;\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Restores previously saved marker state.\r\n   * \r\n   * @param state - previously saved state.\r\n   */\r\n  public restoreState(state: MarkerBaseState): void {\r\n    const calloutState = state as CalloutMarkerState;\r\n    this.bgColor = calloutState.bgColor;\r\n    this.tipPosition = calloutState.tipPosition;\r\n\r\n    super.restoreState(state);\r\n    this.createTip();\r\n    this.setTipPoints();\r\n  }\r\n\r\n  /**\r\n   * Scales marker. Used after the image resize.\r\n   * \r\n   * @param scaleX - horizontal scale\r\n   * @param scaleY - vertical scale\r\n   */\r\n  public scale(scaleX: number, scaleY: number): void {\r\n    super.scale(scaleX, scaleY);\r\n\r\n    this.tipPosition = {x: this.tipPosition.x * scaleX, y: this.tipPosition.y * scaleY};\r\n\r\n    this.positionTip();\r\n  }\r\n}\r\n","import Icon from './ellipse-marker-icon.svg';\r\nimport { IPoint } from '../../core/IPoint';\r\nimport { SvgHelper } from '../../core/SvgHelper';\r\nimport { RectangularBoxMarkerBase } from '../RectangularBoxMarkerBase';\r\nimport { Settings } from '../../core/Settings';\r\nimport { RectangleMarkerState } from '../RectangleMarkerState';\r\nimport { MarkerBaseState } from '../../core/MarkerBaseState';\r\nimport { ColorPickerPanel } from '../../ui/toolbox-panels/ColorPickerPanel';\r\nimport { LineWidthPanel } from '../../ui/toolbox-panels/LineWidthPanel';\r\nimport { LineStylePanel } from '../../ui/toolbox-panels/LineStylePanel';\r\nimport { ToolboxPanel } from '../../ui/ToolboxPanel';\r\nimport FillColorIcon from '../../ui/toolbox-panels/fill-color-icon.svg';\r\nimport { OpacityPanel } from '../../ui/toolbox-panels/OpacityPanel';\r\n\r\nexport class EllipseMarker extends RectangularBoxMarkerBase {\r\n  /**\r\n   * String type name of the marker type. \r\n   * \r\n   * Used when adding {@link MarkerArea.availableMarkerTypes} via a string and to save and restore state.\r\n   */\r\n  public static typeName = 'EllipseMarker';\r\n  /**\r\n   * Marker type title (display name) used for accessibility and other attributes.\r\n   */\r\n  public static title = 'Ellipse marker';\r\n  /**\r\n   * SVG icon markup displayed on toolbar buttons.\r\n   */\r\n  public static icon = Icon;\r\n\r\n  /**\r\n   * Ellipse fill color.\r\n   */\r\n  protected fillColor = 'transparent';\r\n  /**\r\n   * Ellipse border color.\r\n   */\r\n  protected strokeColor = 'transparent';\r\n  /**\r\n   * Ellipse border line width.\r\n   */\r\n  protected strokeWidth = 0;\r\n  /**\r\n   * Ellipse border dash array.\r\n   */\r\n  protected strokeDasharray = '';\r\n  /**\r\n   * Ellipse opacity (0..1).\r\n   */\r\n  protected opacity = 1;\r\n\r\n  protected strokePanel: ColorPickerPanel;\r\n  protected fillPanel: ColorPickerPanel;\r\n  protected strokeWidthPanel: LineWidthPanel;\r\n  protected strokeStylePanel: LineStylePanel;\r\n  protected opacityPanel: OpacityPanel;\r\n\r\n  /**\r\n   * Creates a new marker.\r\n   *\r\n   * @param container - SVG container to hold marker's visual.\r\n   * @param overlayContainer - overlay HTML container to hold additional overlay elements while editing.\r\n   * @param settings - settings object containing default markers settings.\r\n   */\r\n  constructor(container: SVGGElement, overlayContainer: HTMLDivElement, settings: Settings) {\r\n    super(container, overlayContainer, settings);\r\n\r\n    this.strokeColor = settings.defaultColor;\r\n    this.strokeWidth = settings.defaultStrokeWidth;\r\n    this.strokeDasharray = settings.defaultStrokeDasharray;\r\n    this.fillColor = settings.defaultFillColor;\r\n\r\n    this.setStrokeColor = this.setStrokeColor.bind(this);\r\n    this.setFillColor = this.setFillColor.bind(this);\r\n    this.setStrokeWidth = this.setStrokeWidth.bind(this);\r\n    this.setStrokeDasharray = this.setStrokeDasharray.bind(this);\r\n    this.setOpacity = this.setOpacity.bind(this);\r\n    this.createVisual = this.createVisual.bind(this);\r\n\r\n    this.strokePanel = new ColorPickerPanel(\r\n      'Line color',\r\n      [...settings.defaultColorSet, 'transparent'],\r\n      settings.defaultColor\r\n    );\r\n    this.strokePanel.onColorChanged = this.setStrokeColor;\r\n\r\n    this.fillPanel = new ColorPickerPanel(\r\n      'Fill color',\r\n      [...settings.defaultColorSet, 'transparent'],\r\n      this.fillColor,\r\n      FillColorIcon\r\n    );\r\n    this.fillPanel.onColorChanged = this.setFillColor;\r\n\r\n    this.strokeWidthPanel = new LineWidthPanel(\r\n      'Line width',\r\n      settings.defaultStrokeWidths,\r\n      settings.defaultStrokeWidth\r\n    );\r\n    this.strokeWidthPanel.onWidthChanged = this.setStrokeWidth;\r\n\r\n    this.strokeStylePanel = new LineStylePanel(\r\n      'Line style',\r\n      settings.defaultStrokeDasharrays,\r\n      settings.defaultStrokeDasharray\r\n    );\r\n    this.strokeStylePanel.onStyleChanged = this.setStrokeDasharray;\r\n\r\n    this.opacityPanel = new OpacityPanel(\r\n      'Opacity',\r\n      settings.defaultOpacitySteps,\r\n      this.opacity\r\n    );\r\n    this.opacityPanel.onOpacityChanged = this.setOpacity;\r\n  }\r\n\r\n  /**\r\n   * Returns true if passed SVG element belongs to the marker. False otherwise.\r\n   * \r\n   * @param el - target element.\r\n   */\r\n  public ownsTarget(el: EventTarget): boolean {\r\n    if (super.ownsTarget(el) || el === this.visual) {\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Creates marker visual.\r\n   */\r\n  protected createVisual(): void {\r\n    this.visual = SvgHelper.createEllipse(this.width / 2, this.height / 2, [\r\n      ['fill', this.fillColor],\r\n      ['stroke', this.strokeColor],\r\n      ['stroke-width', this.strokeWidth.toString()],\r\n      ['stroke-dasharray', this.strokeDasharray],\r\n      ['opacity', this.opacity.toString()]\r\n    ]);\r\n    this.addMarkerVisualToContainer(this.visual);\r\n  }\r\n\r\n  /**\r\n   * Handles pointer (mouse, touch, stylus, etc.) down event.\r\n   * \r\n   * @param point - event coordinates.\r\n   * @param target - direct event target element.\r\n   */\r\n  public pointerDown(point: IPoint, target?: EventTarget): void {\r\n    super.pointerDown(point, target);\r\n    if (this.state === 'new') {\r\n      this.createVisual();\r\n\r\n      this.moveVisual(point);\r\n\r\n      this._state = 'creating';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles marker manipulation (move, resize, rotate, etc.).\r\n   * \r\n   * @param point - event coordinates.\r\n   */\r\n  public manipulate(point: IPoint): void {\r\n    super.manipulate(point);\r\n  }\r\n\r\n  /**\r\n   * Resize marker based on current pointer coordinates and context.\r\n   * @param point \r\n   */\r\n  protected resize(point: IPoint): void {\r\n    super.resize(point);\r\n    this.setSize();\r\n  }\r\n\r\n  /**\r\n   * Sets marker's visual size after manipulation.\r\n   */\r\n  protected setSize(): void {\r\n    super.setSize();\r\n    SvgHelper.setAttributes(this.visual, [\r\n      ['cx', (this.width / 2).toString()],\r\n      ['cy', (this.height / 2).toString()],\r\n      ['rx', (this.width / 2).toString()],\r\n      ['ry', (this.height / 2).toString()],\r\n    ]);\r\n  }\r\n\r\n  /**\r\n   * Handles pointer (mouse, touch, stylus, etc.) up event.\r\n   * \r\n   * @param point - event coordinates.\r\n   */\r\n  public pointerUp(point: IPoint): void {\r\n    super.pointerUp(point);\r\n    this.setSize();\r\n  }\r\n\r\n  /**\r\n   * Sets marker's line color.\r\n   * @param color - new line color.\r\n   */\r\n  protected setStrokeColor(color: string): void {\r\n    this.strokeColor = color;\r\n    if (this.visual) {\r\n      SvgHelper.setAttributes(this.visual, [['stroke', this.strokeColor]]);\r\n    }\r\n  }\r\n  /**\r\n   * Sets marker's fill (background) color.\r\n   * @param color - new fill color.\r\n   */\r\n  protected setFillColor(color: string): void {\r\n    this.fillColor = color;\r\n    if (this.visual) {\r\n      SvgHelper.setAttributes(this.visual, [['fill', this.fillColor]]);\r\n    }\r\n  }\r\n  /**\r\n   * Sets marker's line width.\r\n   * @param width - new line width\r\n   */\r\n  protected setStrokeWidth(width: number): void {\r\n    this.strokeWidth = width;\r\n    if (this.visual) {\r\n      SvgHelper.setAttributes(this.visual, [['stroke-width', this.strokeWidth.toString()]]);\r\n    }\r\n  }\r\n  /**\r\n   * Sets marker's border dash array.\r\n   * @param dashes - new dash array.\r\n   */\r\n  protected setStrokeDasharray(dashes: string): void {\r\n    this.strokeDasharray = dashes;\r\n    if (this.visual) {\r\n      SvgHelper.setAttributes(this.visual, [['stroke-dasharray', this.strokeDasharray]]);\r\n    }\r\n  }\r\n  /**\r\n   * Sets marker's opacity.\r\n   * @param opacity - new opacity value (0..1).\r\n   */\r\n  protected setOpacity(opacity: number): void {\r\n    this.opacity = opacity;\r\n    if (this.visual) {\r\n      SvgHelper.setAttributes(this.visual, [['opacity', this.opacity.toString()]]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the list of toolbox panels for this marker type.\r\n   */\r\n  public get toolboxPanels(): ToolboxPanel[] {\r\n    return [this.strokePanel, this.fillPanel, this.strokeWidthPanel, this.strokeStylePanel, this.opacityPanel];\r\n  }\r\n\r\n  /**\r\n   * Returns current marker state that can be restored in the future.\r\n   */\r\n  public getState(): RectangleMarkerState {\r\n    const result: RectangleMarkerState = Object.assign({\r\n      fillColor: this.fillColor,\r\n      strokeColor: this.strokeColor,\r\n      strokeWidth: this.strokeWidth,\r\n      strokeDasharray: this.strokeDasharray,\r\n      opacity: this.opacity\r\n    }, super.getState());\r\n    result.typeName = EllipseMarker.typeName;\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Restores previously saved marker state.\r\n   * \r\n   * @param state - previously saved state.\r\n   */\r\n  public restoreState(state: MarkerBaseState): void {\r\n    const rectState = state as RectangleMarkerState;\r\n    this.fillColor = rectState.fillColor;\r\n    this.strokeColor = rectState.strokeColor;\r\n    this.strokeWidth = rectState.strokeWidth;\r\n    this.strokeDasharray = rectState.strokeDasharray;\r\n    this.opacity = rectState.opacity;\r\n\r\n    this.createVisual();\r\n    super.restoreState(state);\r\n    this.setSize();\r\n  }\r\n\r\n  /**\r\n   * Scales marker. Used after the image resize.\r\n   * \r\n   * @param scaleX - horizontal scale\r\n   * @param scaleY - vertical scale\r\n   */\r\n  public scale(scaleX: number, scaleY: number): void {\r\n    super.scale(scaleX, scaleY);\r\n\r\n    this.setSize();\r\n  }\r\n}\r\n","import { IPoint } from '../../core/IPoint';\r\nimport { SvgHelper } from '../../core/SvgHelper';\r\nimport { Settings } from '../../core/Settings';\r\nimport Icon from './measurement-marker-icon.svg';\r\nimport { ToolboxPanel } from '../../ui/ToolboxPanel';\r\nimport { LineMarker } from '../line-marker/LineMarker';\r\nimport { MarkerBaseState } from '../../core/MarkerBaseState';\r\nimport { LineMarkerState } from '../line-marker/LineMarkerState';\r\n\r\nexport class MeasurementMarker extends LineMarker {\r\n  /**\r\n   * String type name of the marker type. \r\n   * \r\n   * Used when adding {@link MarkerArea.availableMarkerTypes} via a string and to save and restore state.\r\n   */\r\n  public static typeName = 'MeasurementMarker';\r\n\r\n  /**\r\n   * Marker type title (display name) used for accessibility and other attributes.\r\n   */\r\n  public static title = 'Measurement marker';\r\n  /**\r\n   * SVG icon markup displayed on toolbar buttons.\r\n   */\r\n  public static icon = Icon;\r\n\r\n  private tip1: SVGLineElement;\r\n  private tip2: SVGLineElement;\r\n\r\n  private get tipLength(): number {\r\n    return 10 + this.strokeWidth * 3;\r\n  }\r\n\r\n  /**\r\n   * Creates a new marker.\r\n   *\r\n   * @param container - SVG container to hold marker's visual.\r\n   * @param overlayContainer - overlay HTML container to hold additional overlay elements while editing.\r\n   * @param settings - settings object containing default markers settings.\r\n   */\r\n  constructor(container: SVGGElement, overlayContainer: HTMLDivElement, settings: Settings) {\r\n    super(container, overlayContainer, settings);\r\n  }\r\n\r\n  /**\r\n   * Returns true if passed SVG element belongs to the marker. False otherwise.\r\n   * \r\n   * @param el - target element.\r\n   */\r\n  public ownsTarget(el: EventTarget): boolean {\r\n    if (\r\n      super.ownsTarget(el) ||\r\n      el === this.tip1 || el === this.tip2\r\n    ) {\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  private createTips() {\r\n    this.tip1 = SvgHelper.createLine(\r\n      this.x1 - this.tipLength / 2, \r\n      this.y1, \r\n      this.x1 + this.tipLength / 2, \r\n      this.y1, \r\n      [\r\n        ['stroke', this.strokeColor],\r\n        ['stroke-width', this.strokeWidth.toString()]\r\n      ]);\r\n    this.tip1.transform.baseVal.appendItem(SvgHelper.createTransform());\r\n    this.visual.appendChild(this.tip1);\r\n\r\n    this.tip2 = SvgHelper.createLine(\r\n      this.x2 - this.tipLength / 2, \r\n      this.y2, \r\n      this.x2 + this.tipLength / 2, \r\n      this.y2, \r\n      [\r\n        ['stroke', this.strokeColor],\r\n        ['stroke-width', this.strokeWidth.toString()]\r\n      ]);\r\n    this.tip2.transform.baseVal.appendItem(SvgHelper.createTransform());\r\n    this.visual.appendChild(this.tip2);\r\n  }\r\n\r\n  /**\r\n   * Handles pointer (mouse, touch, stylus, etc.) down event.\r\n   * \r\n   * @param point - event coordinates.\r\n   * @param target - direct event target element.\r\n   */\r\n  public pointerDown(point: IPoint, target?: EventTarget): void {\r\n    super.pointerDown(point, target);\r\n    if (this.state === 'creating') {\r\n      this.createTips();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adjusts marker visual after manipulation.\r\n   */\r\n  protected adjustVisual(): void {\r\n    super.adjustVisual();\r\n\r\n    if (this.tip1 && this.tip2) {\r\n\r\n      SvgHelper.setAttributes(this.tip1,[\r\n        ['x1', (this.x1 - this.tipLength / 2).toString()], \r\n        ['y1', this.y1.toString()], \r\n        ['x2', (this.x1 + this.tipLength / 2).toString()], \r\n        ['y2', this.y1.toString()], \r\n        ['stroke', this.strokeColor],\r\n        ['stroke-width', this.strokeWidth.toString()]\r\n      ]);\r\n      SvgHelper.setAttributes(this.tip2,[\r\n        ['x1', (this.x2 - this.tipLength / 2).toString()], \r\n        ['y1', this.y2.toString()], \r\n        ['x2', (this.x2 + this.tipLength / 2).toString()], \r\n        ['y2', this.y2.toString()], \r\n        ['stroke', this.strokeColor],\r\n        ['stroke-width', this.strokeWidth.toString()]\r\n      ]);\r\n\r\n      if (Math.abs(this.x1 - this.x2) > 0.1) {\r\n        const lineAngle1 =\r\n          (Math.atan((this.y2 - this.y1) / (this.x2 - this.x1)) * 180) / Math.PI + 90 * Math.sign(this.x1 - this.x2);\r\n\r\n        const a1transform = this.tip1.transform.baseVal.getItem(0);\r\n        a1transform.setRotate(lineAngle1, this.x1, this.y1);\r\n        this.tip1.transform.baseVal.replaceItem(a1transform, 0);\r\n\r\n        const a2transform = this.tip2.transform.baseVal.getItem(0);\r\n        a2transform.setRotate(lineAngle1 + 180, this.x2, this.y2);\r\n        this.tip2.transform.baseVal.replaceItem(a2transform, 0);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the list of toolbox panels for this marker type.\r\n   */\r\n  public get toolboxPanels(): ToolboxPanel[] {\r\n    return [this.strokePanel, this.strokeWidthPanel, this.strokeStylePanel];\r\n  }\r\n\r\n  /**\r\n   * Returns current marker state that can be restored in the future.\r\n   */\r\n  public getState(): LineMarkerState {\r\n    const result =super.getState();\r\n    result.typeName = MeasurementMarker.typeName;\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Restores previously saved marker state.\r\n   * \r\n   * @param state - previously saved state.\r\n   */\r\n  public restoreState(state: MarkerBaseState): void {\r\n    super.restoreState(state);\r\n\r\n    this.createTips();\r\n    this.adjustVisual();\r\n  }\r\n}\r\n","import Icon from './ellipse-frame-marker-icon.svg';\r\nimport { Settings } from '../../core/Settings';\r\nimport { RectangleMarkerState } from '../RectangleMarkerState';\r\nimport { ToolboxPanel } from '../../ui/ToolboxPanel';\r\nimport { EllipseMarker } from '../ellipse-marker/EllipseMarker';\r\n\r\nexport class EllipseFrameMarker extends EllipseMarker {\r\n  /**\r\n   * String type name of the marker type. \r\n   * \r\n   * Used when adding {@link MarkerArea.availableMarkerTypes} via a string and to save and restore state.\r\n   */\r\n  public static typeName = 'EllipseFrameMarker';\r\n  /**\r\n   * Marker type title (display name) used for accessibility and other attributes.\r\n   */\r\n  public static title = 'Ellipse frame marker';\r\n  /**\r\n   * SVG icon markup displayed on toolbar buttons.\r\n   */\r\n  public static icon = Icon;\r\n\r\n  /**\r\n   * Creates a new marker.\r\n   *\r\n   * @param container - SVG container to hold marker's visual.\r\n   * @param overlayContainer - overlay HTML container to hold additional overlay elements while editing.\r\n   * @param settings - settings object containing default markers settings.\r\n   */\r\n  constructor(container: SVGGElement, overlayContainer: HTMLDivElement, settings: Settings) {\r\n    super(container, overlayContainer, settings);\r\n\r\n    // reset colors so 'transparent' is excluded\r\n    this.strokePanel.colors= settings.defaultColorSet;\r\n\r\n    this.fillColor = 'transparent';\r\n  }\r\n\r\n  /**\r\n   * Returns the list of toolbox panels for this marker type.\r\n   */\r\n  public get toolboxPanels(): ToolboxPanel[] {\r\n    return [this.strokePanel, this.strokeWidthPanel, this.strokeStylePanel];\r\n  }\r\n\r\n  /**\r\n   * Returns current marker state that can be restored in the future.\r\n   */\r\n  public getState(): RectangleMarkerState {\r\n    const result = super.getState();\r\n    result.typeName = EllipseFrameMarker.typeName;\r\n    return result;\r\n  }\r\n}\r\n","/**\r\n * Manages undo and redo stacks.\r\n */\r\nexport class UndoRedoManager<T> {\r\n  private undoStack: T[] = [];\r\n  private redoStack: T[] = [];\r\n\r\n  private lastRedoStep: T;\r\n\r\n  /**\r\n   * Returns true if there are items in the undo stack.\r\n   */\r\n  public get isUndoPossible(): boolean {\r\n    return this.undoStack.length > 0;\r\n  }\r\n\r\n  /**\r\n   * Returns true if there are items in the redo stack.\r\n   */\r\n  public get isRedoPossible(): boolean {\r\n    return this.redoStack.length > 0;\r\n  }\r\n\r\n  /**\r\n   * Adds a step to the undo stack.\r\n   * @param stepData data representing a state.\r\n   */\r\n  public addUndoStep(stepData: T): void {\r\n    if (\r\n      this.undoStack.length === 0 ||\r\n      JSON.stringify(this.undoStack[this.undoStack.length - 1]) !==\r\n        JSON.stringify(stepData)\r\n    ) {\r\n        this.undoStack.push(stepData);\r\n        if (JSON.stringify(this.lastRedoStep) !== JSON.stringify(stepData)) {\r\n          this.redoStack.splice(0, this.redoStack.length);\r\n        }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns data for the previous step in the undo stack and adds last step to the redo stack.\r\n   * @returns \r\n   */\r\n  public undo(): T | undefined {\r\n    if (this.undoStack.length > 1) {\r\n      const lastStep = this.undoStack.pop();\r\n      if (lastStep !== undefined) {\r\n        this.redoStack.push(lastStep);\r\n      }\r\n      return this.undoStack.length > 0 ? this.undoStack[this.undoStack.length - 1] : undefined;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns most recent item in the redo stack.\r\n   * @returns \r\n   */\r\n  public redo(): T | undefined {\r\n    this.lastRedoStep = this.redoStack.pop();\r\n    return this.lastRedoStep;\r\n  }\r\n}\r\n","import { SvgHelper } from './core/SvgHelper';\r\nimport { Activator } from './core/Activator';\r\nimport { Renderer } from './core/Renderer';\r\n\r\nimport Logo from './assets/markerjs-logo-m.svg';\r\nimport { MarkerBase } from './core/MarkerBase';\r\nimport { Toolbar, ToolbarButtonType } from './ui/Toolbar';\r\nimport { Toolbox } from './ui/Toolbox';\r\nimport { FrameMarker } from './markers/frame-marker/FrameMarker';\r\nimport { Settings } from './core/Settings';\r\nimport { Style } from './core/Style';\r\nimport { LineMarker } from './markers/line-marker/LineMarker';\r\nimport { TextMarker } from './markers/text-marker/TextMarker';\r\nimport { FreehandMarker } from './markers/freehand-marker/FreehandMarker';\r\nimport { ArrowMarker } from './markers/arrow-marker/ArrowMarker';\r\nimport { CoverMarker } from './markers/cover-marker/CoverMarker';\r\nimport { HighlightMarker } from './markers/highlight-marker/HighlightMarker';\r\nimport { CalloutMarker } from './markers/callout-marker/CalloutMarker';\r\nimport { MarkerAreaState } from './MarkerAreaState';\r\nimport { EllipseMarker } from './markers/ellipse-marker/EllipseMarker';\r\nimport { IStyleSettings } from './core/IStyleSettings';\r\nimport { MeasurementMarker } from './markers/measurement-marker/MeasurementMarker';\r\nimport { IPoint } from './core/IPoint';\r\nimport { EllipseFrameMarker } from './markers/ellipse-frame-marker/EllipseFrameMarker';\r\nimport { UndoRedoManager } from './core/UndoRedoManager';\r\n\r\n/**\r\n * @ignore\r\n */\r\nexport type MarkerAreaMode = 'select' | 'create' | 'delete';\r\n\r\n/**\r\n * Identifier for marker type when setting {@linkcode availableMarkerTypes}.\r\n * Marker type can be set as either a string or a marker type reference.\r\n */\r\nexport type MarkerTypeIdentifier = string | typeof MarkerBase;\r\n\r\n/**\r\n * Event handler type for {@linkcode MarkerArea} `render` event.\r\n */\r\nexport type RenderEventHandler = (\r\n  dataURL: string,\r\n  state?: MarkerAreaState\r\n) => void;\r\n/**\r\n * Event handler type for {@linkcode MarkerArea} `close` event.\r\n */\r\nexport type CloseEventHandler = () => void;\r\n\r\n/**\r\n * MarkerArea is the main class of marker.js 2. It controls the behavior and appearance of the library.\r\n *\r\n * The simplest marker.js 2 usage scenario looks something like this:\r\n *\r\n * ```typescript\r\n * import * as markerjs2 from 'markerjs2';\r\n * // create an instance of MarkerArea and pass the target image reference as a parameter\r\n * let markerArea = new markerjs2.MarkerArea(document.getElementById('myimg'));\r\n *\r\n * // register an event listener for when user clicks OK/save in the marker.js UI\r\n * markerArea.addRenderEventListener(dataUrl => {\r\n *   // we are setting the markup result to replace our original image on the page\r\n *   // but you can set a different image or upload it to your server\r\n *   document.getElementById('myimg').src = dataUrl;\r\n * });\r\n *\r\n * // finally, call the show() method and marker.js UI opens\r\n * markerArea.show();\r\n * ```\r\n */\r\nexport class MarkerArea {\r\n  private target: HTMLImageElement;\r\n  private targetObserver: ResizeObserver;\r\n\r\n  private width: number;\r\n  private height: number;\r\n  private imageWidth: number;\r\n  private imageHeight: number;\r\n  private left: number;\r\n  private top: number;\r\n  private windowHeight: number;\r\n\r\n  private markerImage: SVGSVGElement;\r\n  private markerImageHolder: HTMLDivElement;\r\n  private defs: SVGDefsElement;\r\n\r\n  private coverDiv: HTMLDivElement;\r\n  private uiDiv: HTMLDivElement;\r\n  private contentDiv: HTMLDivElement;\r\n  private editorCanvas: HTMLDivElement;\r\n  private editingTarget: HTMLImageElement;\r\n  private overlayContainer: HTMLDivElement;\r\n\r\n  private touchPoints = 0;\r\n\r\n  private logoUI: HTMLElement;\r\n\r\n  /**\r\n   * `targetRoot` is used to set an alternative positioning root for the marker.js UI.\r\n   *\r\n   * This is useful in cases when your target image is positioned, say, inside a div with `position: relative;`\r\n   *\r\n   * ```typescript\r\n   * // set targetRoot to a specific div instead of document.body\r\n   * markerArea.targetRoot = document.getElementById('myRootElement');\r\n   * ```\r\n   *\r\n   * @default document.body\r\n   */\r\n  public targetRoot: HTMLElement;\r\n\r\n  /**\r\n   * Returns a list of all built-in marker types for use with {@linkcode availableMarkerTypes}\r\n   *\r\n   * @readonly\r\n   */\r\n  public get ALL_MARKER_TYPES(): typeof MarkerBase[] {\r\n    return [\r\n      FrameMarker,\r\n      FreehandMarker,\r\n      ArrowMarker,\r\n      TextMarker,\r\n      EllipseFrameMarker,\r\n      EllipseMarker,\r\n      HighlightMarker,\r\n      CalloutMarker,\r\n      MeasurementMarker,\r\n      CoverMarker,\r\n      LineMarker,\r\n    ];\r\n  }\r\n\r\n  /**\r\n   * Returns a list of default set of built-in marker types.\r\n   * Used when {@linkcode availableMarkerTypes} isn't set explicitly.\r\n   *\r\n   * @readonly\r\n   */\r\n  public get DEFAULT_MARKER_TYPES(): typeof MarkerBase[] {\r\n    return [\r\n      FrameMarker,\r\n      FreehandMarker,\r\n      ArrowMarker,\r\n      TextMarker,\r\n      EllipseMarker,\r\n      HighlightMarker,\r\n      CalloutMarker,\r\n    ];\r\n  }\r\n\r\n  /**\r\n   * Returns a short list of essential built-in marker types for use with {@linkcode availableMarkerTypes}\r\n   *\r\n   * @readonly\r\n   */\r\n  public get BASIC_MARKER_TYPES(): typeof MarkerBase[] {\r\n    return [\r\n      FrameMarker,\r\n      FreehandMarker,\r\n      ArrowMarker,\r\n      TextMarker,\r\n      HighlightMarker,\r\n    ];\r\n  }\r\n\r\n  private _availableMarkerTypes: typeof MarkerBase[] = this\r\n    .DEFAULT_MARKER_TYPES;\r\n\r\n  /**\r\n   * Gets or sets a list of marker types avaiable to the user in the toolbar.\r\n   * The types can be passed as either type reference or a string type name.\r\n   *\r\n   * ```typescript\r\n   * this.markerArea1.availableMarkerTypes = ['CalloutMarker', ...this.markerArea1.BASIC_MARKER_TYPES];\r\n   * ```\r\n   *\r\n   * @default {@linkcode DEFAULT_MARKER_TYPES}\r\n   */\r\n  public get availableMarkerTypes(): MarkerTypeIdentifier[] {\r\n    return this._availableMarkerTypes;\r\n  }\r\n\r\n  public set availableMarkerTypes(value: MarkerTypeIdentifier[]) {\r\n    this._availableMarkerTypes.splice(0);\r\n    value.forEach((mt) => {\r\n      if (typeof mt === 'string') {\r\n        const typeType = this.ALL_MARKER_TYPES.find(\r\n          (allT) => allT.typeName === mt\r\n        );\r\n        if (typeType !== undefined) {\r\n          this._availableMarkerTypes.push(typeType);\r\n        }\r\n      } else {\r\n        this._availableMarkerTypes.push(mt);\r\n      }\r\n    });\r\n  }\r\n\r\n  private toolbar: Toolbar;\r\n  private toolbox: Toolbox;\r\n\r\n  private mode: MarkerAreaMode = 'select';\r\n\r\n  private currentMarker?: MarkerBase;\r\n  private markers: MarkerBase[] = [];\r\n\r\n  private isDragging = false;\r\n\r\n  // for preserving orginal window state before opening the editor\r\n  private bodyOverflowState: string;\r\n  private scrollYState: number;\r\n  private scrollXState: number;\r\n\r\n  private renderEventListeners: RenderEventHandler[] = [];\r\n  private closeEventListeners: CloseEventHandler[] = [];\r\n\r\n  public settings: Settings = new Settings();\r\n  public uiStyleSettings: IStyleSettings;\r\n\r\n  private _isOpen = false;\r\n  /**\r\n   * Returns `true` when MarkerArea is open and `false` otherwise.\r\n   *\r\n   * @readonly\r\n   */\r\n  public get isOpen(): boolean {\r\n    return this._isOpen;\r\n  }\r\n\r\n  private undoRedoManager: UndoRedoManager<\r\n    MarkerAreaState\r\n  > = new UndoRedoManager<MarkerAreaState>();\r\n\r\n  /**\r\n   * When set to true resulting image will be rendered at the natural (original) resolution\r\n   * of the target image. Otherwise (default), screen dimensions of the image are used.\r\n   *\r\n   * @default false (use screen dimensions)\r\n   */\r\n  public renderAtNaturalSize = false;\r\n  /**\r\n   * Type of image for the rendering result. Eg. `image/png` (default) or `image/jpeg`.\r\n   *\r\n   * @default `image/png`\r\n   */\r\n  public renderImageType = 'image/png';\r\n  /**\r\n   * When rendering engine/format supports it (jpeg, for exmample),\r\n   * sets the rendering quality for the resulting image.\r\n   *\r\n   * In case of `image/jpeg` the value should be between 0 (worst quality) and 1 (best quality).\r\n   */\r\n  public renderImageQuality?: number;\r\n  /**\r\n   * When set to `true`, will render only the marker layer without the original image.\r\n   * This could be useful when you want to non-destructively overlay markers on top of the original image.\r\n   *\r\n   * Note that in order for the markers layer to have a transparent background {@linkcode renderImageType}\r\n   * should be set to a format supporting transparency, such as `image/png`.\r\n   *\r\n   * @default false\r\n   */\r\n  public renderMarkersOnly = false;\r\n\r\n  /**\r\n   * When set and {@linkcode renderAtNaturalSize} is `false` sets the width of the rendered image.\r\n   *\r\n   * Both `renderWidth` and `renderHeight` have to be set for this to take effect.\r\n   */\r\n  public renderWidth?: number;\r\n  /**\r\n   * When set and {@linkcode renderAtNaturalSize} is `false` sets the height of the rendered image.\r\n   *\r\n   * Both `renderWidth` and `renderHeight` have to be set for this to take effect.\r\n   */\r\n  public renderHeight?: number;\r\n\r\n  /**\r\n   * Creates a new MarkerArea for the specified target image.\r\n   *\r\n   * ```typescript\r\n   * // create an instance of MarkerArea and pass the target image reference as a parameter\r\n   * let markerArea = new markerjs2.MarkerArea(document.getElementById('myimg'));\r\n   * ```\r\n   *\r\n   * @param target image object to mark up.\r\n   */\r\n  constructor(target: HTMLImageElement) {\r\n    Style.settings = Style.defaultSettings;\r\n    this.uiStyleSettings = Style.settings;\r\n\r\n    this.target = target;\r\n    this.targetRoot = document.body;\r\n\r\n    this.width = target.clientWidth;\r\n    this.height = target.clientHeight;\r\n\r\n    Style.removeStyleSheet();\r\n\r\n    this.open = this.open.bind(this);\r\n    this.setTopLeft = this.setTopLeft.bind(this);\r\n\r\n    this.toolbarButtonClicked = this.toolbarButtonClicked.bind(this);\r\n    this.createNewMarker = this.createNewMarker.bind(this);\r\n    this.addNewMarker = this.addNewMarker.bind(this);\r\n    this.markerCreated = this.markerCreated.bind(this);\r\n    this.setCurrentMarker = this.setCurrentMarker.bind(this);\r\n    this.onPointerDown = this.onPointerDown.bind(this);\r\n    this.onDblClick = this.onDblClick.bind(this);\r\n    this.onPointerMove = this.onPointerMove.bind(this);\r\n    this.onPointerUp = this.onPointerUp.bind(this);\r\n    this.onKeyUp = this.onKeyUp.bind(this);\r\n    this.overrideOverflow = this.overrideOverflow.bind(this);\r\n    this.restoreOverflow = this.restoreOverflow.bind(this);\r\n    this.close = this.close.bind(this);\r\n    this.closeUI = this.closeUI.bind(this);\r\n    this.addCloseEventListener = this.addCloseEventListener.bind(this);\r\n    this.removeCloseEventListener = this.removeCloseEventListener.bind(this);\r\n    this.addRenderEventListener = this.addRenderEventListener.bind(this);\r\n    this.removeRenderEventListener = this.removeRenderEventListener.bind(this);\r\n    this.clientToLocalCoordinates = this.clientToLocalCoordinates.bind(this);\r\n    this.onWindowResize = this.onWindowResize.bind(this);\r\n    this.deleteSelectedMarker = this.deleteSelectedMarker.bind(this);\r\n    this.setWindowHeight = this.setWindowHeight.bind(this);\r\n    this.removeMarker = this.removeMarker.bind(this);\r\n  }\r\n\r\n  private open(): void {\r\n    this.setupResizeObserver();\r\n    this.setEditingTarget();\r\n    this.setTopLeft();\r\n    this.initMarkerCanvas();\r\n    this.initOverlay();\r\n    this.attachEvents();\r\n\r\n    if (!Activator.isLicensed) {\r\n      // NOTE:\r\n      // before removing this call please consider supporting marker.js\r\n      // by visiting https://markerjs.com/ for details\r\n      // thank you!\r\n      this.addLogo();\r\n    }\r\n\r\n    this._isOpen = true;\r\n  }\r\n\r\n  /**\r\n   * Initializes the MarkerArea and opens the UI.\r\n   */\r\n  public show(): void {\r\n    this.setWindowHeight();\r\n    this.showUI();\r\n    this.open();\r\n  }\r\n\r\n  /**\r\n   * Renders the annotation result.\r\n   *\r\n   * Normally, you should use {@linkcode addRenderEventListener} method to set a listener for the `render` event\r\n   * rather than calling this method directly.\r\n   */\r\n  public async render(): Promise<string> {\r\n    this.setCurrentMarker();\r\n\r\n    const renderer = new Renderer();\r\n    renderer.naturalSize = this.renderAtNaturalSize;\r\n    renderer.imageType = this.renderImageType;\r\n    renderer.imageQuality = this.renderImageQuality;\r\n    renderer.markersOnly = this.renderMarkersOnly;\r\n    renderer.width = this.renderWidth;\r\n    renderer.height = this.renderHeight;\r\n\r\n    // workaround for an issue in Safari where FreeHand marker\r\n    // is not rendered on the first try for some reason\r\n    await renderer.rasterize(this.target, this.markerImage);\r\n\r\n    return await renderer.rasterize(this.target, this.markerImage);\r\n  }\r\n\r\n  /**\r\n   * Closes the MarkerArea UI.\r\n   */\r\n  public close(): void {\r\n    if (this.isOpen) {\r\n      if (this.coverDiv) {\r\n        this.closeUI();\r\n      }\r\n      if (this.targetObserver) {\r\n        this.targetObserver.unobserve(this.target);\r\n      }\r\n      if (this.settings.displayMode === 'popup') {\r\n        window.removeEventListener('resize', this.setWindowHeight);\r\n      }\r\n      this.closeEventListeners.forEach((listener) => listener());\r\n      this._isOpen = false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds one or more markers to the toolbar.\r\n   *\r\n   * @param markers - one or more marker types to be added.\r\n   */\r\n  public addMarkersToToolbar(...markers: typeof MarkerBase[]): void {\r\n    this._availableMarkerTypes.push(...markers);\r\n  }\r\n\r\n  /**\r\n   * Add a `render` event listener which is called when user clicks on the OK/save button\r\n   * in the toolbar.\r\n   *\r\n   * ```typescript\r\n   * // register an event listener for when user clicks OK/save in the marker.js UI\r\n   * markerArea.addRenderEventListener(dataUrl => {\r\n   *   // we are setting the markup result to replace our original image on the page\r\n   *   // but you can set a different image or upload it to your server\r\n   *   document.getElementById('myimg').src = dataUrl;\r\n   * });\r\n   * ```\r\n   *\r\n   * This is where you place your code to save a resulting image and/or MarkerAreaState.\r\n   *\r\n   * @param listener - a method handling rendering results\r\n   *\r\n   * @see {@link MarkerAreaState}\r\n   */\r\n  public addRenderEventListener(listener: RenderEventHandler): void {\r\n    this.renderEventListeners.push(listener);\r\n  }\r\n\r\n  /**\r\n   * Remove a `render` event handler.\r\n   *\r\n   * @param listener - previously registered `render` event handler.\r\n   */\r\n  public removeRenderEventListener(listener: RenderEventHandler): void {\r\n    if (this.renderEventListeners.indexOf(listener) > -1) {\r\n      this.renderEventListeners.splice(\r\n        this.renderEventListeners.indexOf(listener),\r\n        1\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add a `close` event handler to perform actions in your code after the user\r\n   * clicks on the close button (without saving).\r\n   *\r\n   * @param listener - close event listener\r\n   */\r\n  public addCloseEventListener(listener: CloseEventHandler): void {\r\n    this.closeEventListeners.push(listener);\r\n  }\r\n\r\n  /**\r\n   * Remove a `close` event handler.\r\n   *\r\n   * @param listener - previously registered `close` event handler.\r\n   */\r\n  public removeCloseEventListener(listener: CloseEventHandler): void {\r\n    if (this.closeEventListeners.indexOf(listener) > -1) {\r\n      this.closeEventListeners.splice(\r\n        this.closeEventListeners.indexOf(listener),\r\n        1\r\n      );\r\n    }\r\n  }\r\n\r\n  private setupResizeObserver() {\r\n    if (this.settings.displayMode === 'inline') {\r\n      this.targetObserver = new ResizeObserver(() => {\r\n        this.resize(this.target.clientWidth, this.target.clientHeight);\r\n      });\r\n      this.targetObserver.observe(this.target);\r\n    } else if (this.settings.displayMode === 'popup') {\r\n      this.targetObserver = new ResizeObserver(() => {\r\n        const ratio =\r\n          (1.0 * this.target.clientWidth) / this.target.clientHeight;\r\n        const newWidth =\r\n          this.editorCanvas.clientWidth / ratio > this.editorCanvas.clientHeight\r\n            ? this.editorCanvas.clientHeight * ratio\r\n            : this.editorCanvas.clientWidth;\r\n        const newHeight =\r\n          newWidth < this.editorCanvas.clientWidth\r\n            ? this.editorCanvas.clientHeight\r\n            : this.editorCanvas.clientWidth / ratio;\r\n        this.resize(newWidth, newHeight);\r\n      });\r\n      this.targetObserver.observe(this.editorCanvas);\r\n      window.addEventListener('resize', this.setWindowHeight);\r\n    }\r\n  }\r\n\r\n  private setWindowHeight() {\r\n    this.windowHeight = window.innerHeight;\r\n  }\r\n\r\n  private resize(newWidth: number, newHeight: number) {\r\n    const scaleX = newWidth / this.imageWidth;\r\n    const scaleY = newHeight / this.imageHeight;\r\n\r\n    this.imageWidth = Math.round(newWidth);\r\n    this.imageHeight = Math.round(newHeight);\r\n    this.editingTarget.src = this.target.src;\r\n    this.editingTarget.width = this.imageWidth;\r\n    this.editingTarget.height = this.imageHeight;\r\n    this.editingTarget.style.width = `${this.imageWidth}px`;\r\n    this.editingTarget.style.height = `${this.imageHeight}px`;\r\n\r\n    this.markerImage.setAttribute('width', this.imageWidth.toString());\r\n    this.markerImage.setAttribute('height', this.imageHeight.toString());\r\n    this.markerImage.setAttribute(\r\n      'viewBox',\r\n      '0 0 ' + this.imageWidth.toString() + ' ' + this.imageHeight.toString()\r\n    );\r\n\r\n    this.markerImageHolder.style.width = `${this.imageWidth}px`;\r\n    this.markerImageHolder.style.height = `${this.imageHeight}px`;\r\n\r\n    this.overlayContainer.style.width = `${this.imageWidth}px`;\r\n    this.overlayContainer.style.height = `${this.imageHeight}px`;\r\n\r\n    if (this.settings.displayMode !== 'popup') {\r\n      this.coverDiv.style.width = `${this.imageWidth.toString()}px`;\r\n    } else {\r\n      this.setTopLeft();\r\n      this.positionMarkerImage();\r\n    }\r\n\r\n    if (this.toolbar !== undefined) {\r\n      this.toolbar.adjustLayout();\r\n    }\r\n\r\n    this.positionLogo();\r\n\r\n    this.scaleMarkers(scaleX, scaleY);\r\n  }\r\n\r\n  private scaleMarkers(scaleX: number, scaleY: number) {\r\n    if (!(this.currentMarker && this.currentMarker instanceof TextMarker)) {\r\n      this.setCurrentMarker();\r\n      this.toolbar.setSelectMode();\r\n    }\r\n    this.markers.forEach((marker) => marker.scale(scaleX, scaleY));\r\n  }\r\n\r\n  private setEditingTarget() {\r\n    this.imageWidth = Math.round(this.target.clientWidth);\r\n    this.imageHeight = Math.round(this.target.clientHeight);\r\n    this.editingTarget.src = this.target.src;\r\n    this.editingTarget.width = this.imageWidth;\r\n    this.editingTarget.height = this.imageHeight;\r\n    this.editingTarget.style.width = `${this.imageWidth}px`;\r\n    this.editingTarget.style.height = `${this.imageHeight}px`;\r\n  }\r\n\r\n  private setTopLeft() {\r\n    const targetRect = this.editingTarget.getBoundingClientRect();\r\n    const bodyRect = this.editorCanvas.getBoundingClientRect();\r\n    this.left = targetRect.left - bodyRect.left;\r\n    this.top = targetRect.top - bodyRect.top;\r\n  }\r\n\r\n  private initMarkerCanvas(): void {\r\n    this.markerImageHolder = document.createElement('div');\r\n    this.markerImageHolder.style.setProperty('touch-action', 'pinch-zoom');\r\n\r\n    this.markerImage = document.createElementNS(\r\n      'http://www.w3.org/2000/svg',\r\n      'svg'\r\n    );\r\n    this.markerImage.setAttribute('xmlns', 'http://www.w3.org/2000/svg');\r\n    this.markerImage.setAttribute('width', this.imageWidth.toString());\r\n    this.markerImage.setAttribute('height', this.imageHeight.toString());\r\n    this.markerImage.setAttribute(\r\n      'viewBox',\r\n      '0 0 ' + this.imageWidth.toString() + ' ' + this.imageHeight.toString()\r\n    );\r\n    this.markerImage.style.pointerEvents = 'auto';\r\n\r\n    this.markerImageHolder.style.position = 'absolute';\r\n    this.markerImageHolder.style.width = `${this.imageWidth}px`;\r\n    this.markerImageHolder.style.height = `${this.imageHeight}px`;\r\n    this.markerImageHolder.style.transformOrigin = 'top left';\r\n    this.positionMarkerImage();\r\n\r\n    this.defs = SvgHelper.createDefs();\r\n    this.markerImage.appendChild(this.defs);\r\n\r\n    this.markerImageHolder.appendChild(this.markerImage);\r\n\r\n    this.editorCanvas.appendChild(this.markerImageHolder);\r\n  }\r\n\r\n  private initOverlay(): void {\r\n    this.overlayContainer = document.createElement('div');\r\n    this.overlayContainer.style.position = 'absolute';\r\n    this.overlayContainer.style.left = '0px';\r\n    this.overlayContainer.style.top = '0px';\r\n    this.overlayContainer.style.width = `${this.imageWidth}px`;\r\n    this.overlayContainer.style.height = `${this.imageHeight}px`;\r\n    this.overlayContainer.style.display = 'flex';\r\n    this.markerImageHolder.appendChild(this.overlayContainer);\r\n  }\r\n\r\n  private positionMarkerImage() {\r\n    this.markerImageHolder.style.top = this.top + 'px';\r\n    this.markerImageHolder.style.left = this.left + 'px';\r\n  }\r\n\r\n  private attachEvents() {\r\n    this.markerImage.addEventListener('pointerdown', this.onPointerDown);\r\n    this.markerImage.addEventListener('dblclick', this.onDblClick);\r\n    window.addEventListener('pointermove', this.onPointerMove);\r\n    window.addEventListener('pointerup', this.onPointerUp);\r\n    window.addEventListener('pointercancel', () => {\r\n      if (this.touchPoints > 0) {\r\n        this.touchPoints--;\r\n      }\r\n    });\r\n    window.addEventListener('pointerout', () => {\r\n      if (this.touchPoints > 0) {\r\n        this.touchPoints--;\r\n      }\r\n    });\r\n    window.addEventListener('pointerleave', this.onPointerUp);\r\n    window.addEventListener('resize', this.onWindowResize);\r\n    window.addEventListener('keyup', this.onKeyUp);\r\n  }\r\n\r\n  /**\r\n   * NOTE:\r\n   *\r\n   * before removing or modifying this method please consider supporting marker.js\r\n   * by visiting https://markerjs.com/#price for details\r\n   *\r\n   * thank you!\r\n   */\r\n  private addLogo() {\r\n    this.logoUI = document.createElement('div');\r\n    this.logoUI.style.display = 'inline-block';\r\n    this.logoUI.style.margin = '0px';\r\n    this.logoUI.style.padding = '0px';\r\n    this.logoUI.style.fill = '#333333';\r\n\r\n    const link = document.createElement('a');\r\n    link.href = 'https://markerjs.com/';\r\n    link.target = '_blank';\r\n    link.innerHTML = Logo;\r\n    link.title = 'Powered by marker.js';\r\n\r\n    link.style.display = 'grid';\r\n    link.style.alignItems = 'center';\r\n    link.style.justifyItems = 'center';\r\n    link.style.padding = '3px';\r\n    link.style.width = '20px';\r\n    link.style.height = '20px';\r\n\r\n    this.logoUI.appendChild(link);\r\n\r\n    this.editorCanvas.appendChild(this.logoUI);\r\n\r\n    this.logoUI.style.position = 'absolute';\r\n    this.logoUI.style.pointerEvents = 'all';\r\n    this.positionLogo();\r\n  }\r\n\r\n  private positionLogo() {\r\n    if (this.logoUI) {\r\n      this.logoUI.style.left = `${this.markerImageHolder.offsetLeft + 10}px`;\r\n      this.logoUI.style.top = `${\r\n        this.markerImageHolder.offsetTop +\r\n        this.markerImageHolder.offsetHeight -\r\n        this.logoUI.clientHeight -\r\n        10\r\n      }px`;\r\n    }\r\n  }\r\n\r\n  private overrideOverflow() {\r\n    // backup current state of scrolling and overflow\r\n    this.scrollXState = window.scrollX;\r\n    this.scrollYState = window.scrollY;\r\n    this.bodyOverflowState = document.body.style.overflow;\r\n\r\n    window.scroll({ top: 0, left: 0 });\r\n    document.body.style.overflow = 'hidden';\r\n  }\r\n\r\n  private restoreOverflow() {\r\n    document.body.style.overflow = this.bodyOverflowState;\r\n    window.scroll({ top: this.scrollYState, left: this.scrollXState });\r\n  }\r\n\r\n  private showUI(): void {\r\n    if (this.settings.displayMode === 'popup') {\r\n      this.overrideOverflow();\r\n    }\r\n\r\n    this.coverDiv = document.createElement('div');\r\n    this.coverDiv.className = Style.CLASS_PREFIX;\r\n    // hardcode font size so nothing inside is affected by higher up settings\r\n    this.coverDiv.style.fontSize = '16px';\r\n    switch (this.settings.displayMode) {\r\n      case 'inline': {\r\n        this.coverDiv.style.position = 'absolute';\r\n        const coverTop =\r\n          this.target.offsetTop > Style.settings.toolbarHeight\r\n            ? this.target.offsetTop - Style.settings.toolbarHeight\r\n            : 0;\r\n        this.coverDiv.style.top = `${coverTop}px`;\r\n        this.coverDiv.style.left = `${this.target.offsetLeft.toString()}px`;\r\n        this.coverDiv.style.width = `${this.target.offsetWidth.toString()}px`;\r\n        //this.coverDiv.style.height = `${this.target.offsetHeight.toString()}px`;\r\n        this.coverDiv.style.zIndex = '5';\r\n        // flex causes the ui to stretch when toolbox has wider nowrap panels\r\n        //this.coverDiv.style.display = 'flex';\r\n        break;\r\n      }\r\n      case 'popup': {\r\n        this.coverDiv.style.position = 'absolute';\r\n        this.coverDiv.style.top = '0px';\r\n        this.coverDiv.style.left = '0px';\r\n        this.coverDiv.style.width = '100vw';\r\n        this.coverDiv.style.height = `${window.innerHeight}px`;\r\n        this.coverDiv.style.backgroundColor = 'rgba(0, 0, 0, 0.75)';\r\n        this.coverDiv.style.zIndex = '1000';\r\n        this.coverDiv.style.display = 'flex';\r\n        // this.coverDiv.style.overflow = 'auto';\r\n      }\r\n    }\r\n    this.targetRoot.appendChild(this.coverDiv);\r\n\r\n    this.uiDiv = document.createElement('div');\r\n    this.uiDiv.style.display = 'flex';\r\n    this.uiDiv.style.flexDirection = 'column';\r\n    this.uiDiv.style.flexGrow = '2';\r\n    this.uiDiv.style.margin =\r\n      this.settings.displayMode === 'popup'\r\n        ? `${this.settings.popupMargin}px`\r\n        : '0px';\r\n    this.uiDiv.style.border = '0px';\r\n    // this.uiDiv.style.overflow = 'hidden';\r\n    //this.uiDiv.style.backgroundColor = '#ffffff';\r\n    this.coverDiv.appendChild(this.uiDiv);\r\n\r\n    this.toolbar = new Toolbar(\r\n      this.uiDiv,\r\n      this.settings.displayMode,\r\n      this._availableMarkerTypes,\r\n      this.uiStyleSettings\r\n    );\r\n    this.toolbar.addButtonClickListener(this.toolbarButtonClicked);\r\n    this.toolbar.show(this.uiStyleSettings.hideToolbar ? 'hidden' : 'visible');\r\n\r\n    this.contentDiv = document.createElement('div');\r\n    this.contentDiv.style.display = 'flex';\r\n    this.contentDiv.style.flexDirection = 'row';\r\n    this.contentDiv.style.flexGrow = '2';\r\n    this.contentDiv.style.flexShrink = '1';\r\n    this.contentDiv.style.backgroundColor = this.uiStyleSettings.canvasBackgroundColor;\r\n    if (this.settings.displayMode === 'popup') {\r\n      this.contentDiv.style.maxHeight = `${\r\n        this.windowHeight -\r\n        this.settings.popupMargin * 2 -\r\n        this.uiStyleSettings.toolbarHeight * 3.5\r\n      }px`;\r\n      // this.contentDiv.style.maxHeight = `calc(100vh - ${\r\n      //   this.settings.popupMargin * 2 + this.uiStyleSettings.toolbarHeight * 3.5}px)`;\r\n      this.contentDiv.style.maxWidth = `calc(100vw - ${\r\n        this.settings.popupMargin * 2\r\n      }px)`;\r\n    }\r\n    this.uiDiv.appendChild(this.contentDiv);\r\n\r\n    this.editorCanvas = document.createElement('div');\r\n    this.editorCanvas.style.flexGrow = '2';\r\n    this.editorCanvas.style.flexShrink = '1';\r\n    this.editorCanvas.style.position = 'relative';\r\n    this.editorCanvas.style.overflow = 'hidden';\r\n    this.editorCanvas.style.display = 'flex';\r\n    if (this.settings.displayMode === 'popup') {\r\n      this.editorCanvas.style.alignItems = 'center';\r\n      this.editorCanvas.style.justifyContent = 'center';\r\n    }\r\n    this.editorCanvas.style.pointerEvents = 'none';\r\n    this.contentDiv.appendChild(this.editorCanvas);\r\n\r\n    this.editingTarget = document.createElement('img');\r\n    this.editorCanvas.appendChild(this.editingTarget);\r\n\r\n    this.toolbox = new Toolbox(\r\n      this.uiDiv,\r\n      this.settings.displayMode,\r\n      this.uiStyleSettings\r\n    );\r\n    this.toolbox.show(this.uiStyleSettings.hideToolbox ? 'hidden' : 'visible');\r\n  }\r\n\r\n  private closeUI() {\r\n    if (this.settings.displayMode === 'popup') {\r\n      this.restoreOverflow();\r\n    }\r\n    // @todo better cleanup\r\n    this.targetRoot.removeChild(this.coverDiv);\r\n  }\r\n\r\n  private removeMarker(marker: MarkerBase) {\r\n    this.markerImage.removeChild(marker.container);\r\n    if (this.markers.indexOf(marker) > -1) {\r\n      this.markers.splice(this.markers.indexOf(marker), 1);\r\n    }\r\n    marker.dispose();\r\n  }\r\n\r\n  private switchToSelectMode() {\r\n    this.mode = 'select';\r\n    if (this.currentMarker !== undefined) {\r\n      if (this.currentMarker.state !== 'new') {\r\n        this.currentMarker.select();\r\n      } else {\r\n        this.removeMarker(this.currentMarker);\r\n        this.setCurrentMarker();\r\n        this.markerImage.style.cursor = 'default';\r\n      }\r\n      this.addUndoStep();\r\n    }\r\n  }\r\n\r\n  private toolbarButtonClicked(\r\n    buttonType: ToolbarButtonType,\r\n    value?: typeof MarkerBase | string\r\n  ) {\r\n    if (buttonType === 'marker' && value !== undefined) {\r\n      this.createNewMarker(<typeof MarkerBase>value);\r\n    } else if (buttonType === 'action') {\r\n      switch (value) {\r\n        case 'select': {\r\n          this.switchToSelectMode();\r\n          break;\r\n        }\r\n        case 'delete': {\r\n          this.deleteSelectedMarker();\r\n          break;\r\n        }\r\n        case 'undo': {\r\n          this.switchToSelectMode();\r\n          this.addUndoStep();\r\n          this.undo();\r\n          break;\r\n        }\r\n        case 'redo': {\r\n          this.switchToSelectMode();\r\n          this.redo();\r\n          break;\r\n        }\r\n        case 'close': {\r\n          this.close();\r\n          break;\r\n        }\r\n        case 'render': {\r\n          this.startRenderAndClose();\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes currently selected marker.\r\n   */\r\n  public deleteSelectedMarker(): void {\r\n    if (this.currentMarker !== undefined) {\r\n      this.currentMarker.dispose();\r\n      this.markerImage.removeChild(this.currentMarker.container);\r\n      this.markers.splice(this.markers.indexOf(this.currentMarker), 1);\r\n      this.addUndoStep();\r\n    }\r\n  }\r\n\r\n  private selectLastMarker() {\r\n    if (this.markers.length > 0) {\r\n      this.setCurrentMarker(this.markers[this.markers.length - 1]);\r\n    }\r\n  }\r\n\r\n  private addUndoStep() {\r\n    if (this.currentMarker === undefined || this.currentMarker.state !== 'edit') {\r\n      this.undoRedoManager.addUndoStep(this.getState());\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Undo last action.\r\n   */\r\n  public undo(): void {\r\n    const stepData = this.undoRedoManager.undo();\r\n    if (stepData !== undefined) {\r\n      this.restoreState(stepData);\r\n      this.selectLastMarker();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Redo previously undone action.\r\n   */\r\n  public redo(): void {\r\n    const stepData = this.undoRedoManager.redo();\r\n    if (stepData !== undefined) {\r\n      this.restoreState(stepData);\r\n      this.selectLastMarker();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initiates markup rendering.\r\n   *\r\n   * Get results by adding a render event listener via {@linkcode addRenderEventListener}.\r\n   */\r\n  public async startRenderAndClose(): Promise<void> {\r\n    const result = await this.render();\r\n    const state = this.getState();\r\n    this.renderEventListeners.forEach((listener) => listener(result, state));\r\n    this.close();\r\n  }\r\n\r\n  /**\r\n   * Returns the complete state for the MarkerArea that can be preserved and used\r\n   * to continue annotation next time.\r\n   */\r\n  public getState(): MarkerAreaState {\r\n    const result: MarkerAreaState = {\r\n      width: this.imageWidth,\r\n      height: this.imageHeight,\r\n      markers: [],\r\n    };\r\n    this.markers.forEach((marker) => result.markers.push(marker.getState()));\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Restores MarkerArea state to continue previous annotation session.\r\n   *\r\n   * **IMPORTANT**: call `restoreState()` __after__ you've opened the MarkerArea with {@linkcode show}.\r\n   *\r\n   * ```typescript\r\n   * this.markerArea1.show();\r\n   * if (this.currentState) {\r\n   *   this.markerArea1.restoreState(this.currentState);\r\n   * }\r\n   * ```\r\n   *\r\n   * @param state - previously saved state object.\r\n   */\r\n  public restoreState(state: MarkerAreaState): void {\r\n    this.markers.splice(0);\r\n    while (this.markerImage.lastChild) {\r\n      this.markerImage.removeChild(this.markerImage.lastChild);\r\n    }\r\n    state.markers.forEach((markerState) => {\r\n      const markerType = this._availableMarkerTypes.find(\r\n        (mType) => mType.typeName === markerState.typeName\r\n      );\r\n      if (markerType !== undefined) {\r\n        const marker = this.addNewMarker(markerType);\r\n        marker.restoreState(markerState);\r\n        this.markers.push(marker);\r\n      }\r\n    });\r\n    if (\r\n      state.width &&\r\n      state.height &&\r\n      (state.width !== this.imageWidth || state.height !== this.imageHeight)\r\n    ) {\r\n      this.scaleMarkers(\r\n        this.imageWidth / state.width,\r\n        this.imageHeight / state.height\r\n      );\r\n    }\r\n  }\r\n\r\n  private addNewMarker(markerType: typeof MarkerBase): MarkerBase {\r\n    const g = SvgHelper.createGroup();\r\n    this.markerImage.appendChild(g);\r\n\r\n    return new markerType(g, this.overlayContainer, this.settings);\r\n  }\r\n\r\n  /**\r\n   * Initiate new marker creation.\r\n   *\r\n   * marker.js switches to marker creation mode for the marker type specified\r\n   * and users can draw a new marker like they would by pressing a corresponding\r\n   * toolbar button.\r\n   *\r\n   * This example initiates creation of a `FrameMarker`:\r\n   * ```typescript\r\n   * this.markerArea1.createNewMarker(FrameMarker);\r\n   * ```\r\n   *\r\n   * @param markerType\r\n   */\r\n  public createNewMarker(markerType: typeof MarkerBase): void {\r\n    this.setCurrentMarker();\r\n    this.currentMarker = this.addNewMarker(markerType);\r\n    this.currentMarker.onMarkerCreated = this.markerCreated;\r\n    this.markerImage.style.cursor = 'crosshair';\r\n    this.toolbox.setPanelButtons(this.currentMarker.toolboxPanels);\r\n  }\r\n\r\n  private markerCreated(marker: MarkerBase) {\r\n    this.mode = 'select';\r\n    this.markerImage.style.cursor = 'default';\r\n    this.markers.push(marker);\r\n    this.setCurrentMarker(marker);\r\n    if (\r\n      marker instanceof FreehandMarker &&\r\n      this.settings.newFreehandMarkerOnPointerUp\r\n    ) {\r\n      this.markers.push(marker);\r\n      this.createNewMarker(FreehandMarker);\r\n    } else {\r\n      this.toolbar.setSelectMode();\r\n    }\r\n    this.addUndoStep();\r\n  }\r\n\r\n  private setCurrentMarker(marker?: MarkerBase) {\r\n    if (this.currentMarker !== undefined) {\r\n      this.currentMarker.deselect();\r\n      this.toolbar.setCurrentMarker();\r\n      this.toolbox.setPanelButtons([]);\r\n    }\r\n    this.currentMarker = marker;\r\n    if (this.currentMarker !== undefined) {\r\n      this.currentMarker.select();\r\n      this.toolbar.setCurrentMarker(this.currentMarker);\r\n      this.toolbox.setPanelButtons(this.currentMarker.toolboxPanels);\r\n    }\r\n  }\r\n\r\n  private onPointerDown(ev: PointerEvent) {\r\n    this.touchPoints++;\r\n    if (this.touchPoints === 1 || ev.pointerType !== 'touch') {\r\n      if (\r\n        this.currentMarker !== undefined &&\r\n        (this.currentMarker.state === 'new' ||\r\n          this.currentMarker.state === 'creating')\r\n      ) {\r\n        this.isDragging = true;\r\n        this.currentMarker.pointerDown(\r\n          this.clientToLocalCoordinates(ev.clientX, ev.clientY)\r\n        );\r\n      } else if (this.mode === 'select') {\r\n        const hitMarker = this.markers.find((m) => m.ownsTarget(ev.target));\r\n        if (hitMarker !== undefined) {\r\n          this.setCurrentMarker(hitMarker);\r\n          this.isDragging = true;\r\n          this.currentMarker.pointerDown(\r\n            this.clientToLocalCoordinates(ev.clientX, ev.clientY),\r\n            ev.target\r\n          );\r\n        } else {\r\n          this.setCurrentMarker();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  private onDblClick(ev: PointerEvent) {\r\n    if (this.mode === 'select') {\r\n      const hitMarker = this.markers.find((m) => m.ownsTarget(ev.target));\r\n      if (hitMarker !== undefined && hitMarker !== this.currentMarker) {\r\n        this.setCurrentMarker(hitMarker);\r\n      }\r\n      if (this.currentMarker !== undefined) {\r\n        this.currentMarker.dblClick(\r\n          this.clientToLocalCoordinates(ev.clientX, ev.clientY),\r\n          ev.target\r\n        );\r\n      } else {\r\n        this.setCurrentMarker();\r\n      }\r\n    }\r\n  }\r\n\r\n  private onPointerMove(ev: PointerEvent) {\r\n    if (this.touchPoints === 1 || ev.pointerType !== 'touch') {\r\n      if (this.currentMarker !== undefined || this.isDragging) {\r\n        ev.preventDefault();\r\n        this.currentMarker.manipulate(\r\n          this.clientToLocalCoordinates(ev.clientX, ev.clientY)\r\n        );\r\n      }\r\n    }\r\n  }\r\n  private onPointerUp(ev: PointerEvent) {\r\n    if (this.touchPoints > 0) {\r\n      this.touchPoints--;\r\n    }\r\n    if (this.touchPoints === 0) {\r\n      if (this.isDragging && this.currentMarker !== undefined) {\r\n        this.currentMarker.pointerUp(\r\n          this.clientToLocalCoordinates(ev.clientX, ev.clientY)\r\n        );\r\n      }\r\n    }\r\n    this.isDragging = false;\r\n    this.addUndoStep();\r\n  }\r\n\r\n  private onKeyUp(ev: KeyboardEvent) {\r\n    if (\r\n      this.currentMarker !== undefined &&\r\n      (ev.key === 'Delete' || ev.key === 'Backspace')\r\n    ) {\r\n      this.removeMarker(this.currentMarker);\r\n      this.setCurrentMarker();\r\n      this.markerImage.style.cursor = 'default';\r\n      this.addUndoStep();\r\n    }\r\n  }\r\n\r\n  private clientToLocalCoordinates(x: number, y: number): IPoint {\r\n    const clientRect = this.markerImage.getBoundingClientRect();\r\n    return { x: x - clientRect.x, y: y - clientRect.y };\r\n  }\r\n\r\n  private onWindowResize() {\r\n    this.positionUI();\r\n  }\r\n\r\n  private positionUI() {\r\n    this.setTopLeft();\r\n    switch (this.settings.displayMode) {\r\n      case 'inline': {\r\n        const coverTop =\r\n          this.target.offsetTop > Style.settings.toolbarHeight\r\n            ? this.target.offsetTop - Style.settings.toolbarHeight\r\n            : 0;\r\n        this.coverDiv.style.top = `${coverTop}px`;\r\n        this.coverDiv.style.left = `${this.target.offsetLeft.toString()}px`;\r\n        break;\r\n      }\r\n      case 'popup': {\r\n        this.coverDiv.style.top = '0px';\r\n        this.coverDiv.style.left = '0px';\r\n        this.coverDiv.style.width = '100vw';\r\n        this.coverDiv.style.height = `${this.windowHeight}px`;\r\n        this.contentDiv.style.maxHeight = `${\r\n          this.windowHeight -\r\n          this.settings.popupMargin * 2 -\r\n          this.uiStyleSettings.toolbarHeight * 3.5\r\n        }px`;\r\n      }\r\n    }\r\n    this.positionMarkerImage();\r\n    this.positionLogo();\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}